/*!
 * LMV v7.52.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.FirstPerson=function(e){var t={};function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=862)}({862:function(e,t,a){"use strict";function o(e){var t,a,o,n,i,r,s,u,l,c,T=Autodesk.Viewing.Private,d=e.navigation,g=e.container,p=d.getCamera(),h=1,v=6,f={},A=new THREE.Clock(!0),E={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},b={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},R=0,S=1,m=2,O=3,P=function(){},w={};for(var k in b)Object.prototype.hasOwnProperty.call(b,k)&&(w[b[k]]=P);this.activate=function(a){var o=e.model.getBoundingBox().size();h=Math.max(Math.min(Math.min(o.x,o.y),o.z)/10,1e-4),t=navigator.getGamepads()[0],n=new Autodesk.Viewing.Private.ViewerState(e),i=[],r=0,c=a,y(a)},this.deactivate=function(){c=null,n=null},this.update=function(e,n){(n&&(p=n),e=A.getDelta(),t=navigator.getGamepads()[0],a>-1)&&((new Date).getTime()-a>o&&I());if(t&&(u=2*e*h*v,p.isPerspective||d.toPerspective(),t&&function(){for(var e in w)if(Object.prototype.hasOwnProperty.call(w,e)&&t.buttons[e].pressed&&.5!=t.buttons[e].value)return f[e]=!0,!0;for(var a in f)if(Object.prototype.hasOwnProperty.call(f,a)&&f[a])return!0;return!(Math.abs(t.axes[R])<.1&&Math.abs(t.axes[S])<.1&&Math.abs(t.axes[m])<.1&&Math.abs(t.axes[O])<.1)}())){p.dirty=!0,s&&(l=p.position.z);var i=p.target.clone().sub(p.position),r=i.length();i.multiplyScalar(1/r);var c=i.clone().cross(p.up).normalize();if(Math.abs(t.axes[S])>.1){var T=i.clone().multiplyScalar(-t.axes[S]*u);p.position.add(T),p.target.add(T)}if(Math.abs(t.axes[R])>.1){var g=c.clone().multiplyScalar(t.axes[R]*u);p.position.add(g),p.target.add(g)}var E=new THREE.Quaternion,P=i;if(Math.abs(t.axes[O])>.1){var k=p.clone(),H=i.clone();E.setFromAxisAngle(c,-t.axes[O]*u/2),H.applyQuaternion(E),k.up.applyQuaternion(E);var y=k.worldup.clone(),_=H.angleTo(y),G=THREE.Math.degToRad(5);_>=G&&_<=Math.PI-G&&(P=i.clone().applyQuaternion(E),p.up.applyQuaternion(E))}var C=new THREE.Quaternion;Math.abs(t.axes[m])>.1&&(C.setFromAxisAngle(p.worldup,-t.axes[m]*u/2),P.applyQuaternion(C),p.up.applyQuaternion(C)),function(){for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&D(b[e])}(),s&&(p.position.z=l),P.multiplyScalar(r),p.target.copy(p.position).add(P)}return p};var I=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),a=-1},H=function(e){var t;switch(I(),e){case"up":t=s?"Vertical Lock Mode":"Fly mode"}!function(e,t,n,i,r){Autodesk.Viewing.Private.HudMessage.displayMessage(g,e,n,i,r),t>0?(a=(new Date).getTime(),o=t):(a=-1,o=0)}({msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:t},2e3)};function D(e){if(t.buttons[e].value>.1)switch(f[e]=!0,e){case b.LEFT_SHOULDER:case b.RIGHT_SHOULDER:w[e]();break;case b.LEFT_TRIGGER:w[e](t.buttons[b.LEFT_TRIGGER].value);break;case b.RIGHT_TRIGGER:w[e](t.buttons[b.RIGHT_TRIGGER].value)}else if(f[e])switch(f[e]=!1,e){case b.SOUTH_BTN:case b.EAST_BTN:case b.WEST_BTN:case b.NORTH_BTN:case b.NORTH_DPAD:case b.SOUTH_DPAD:case b.WEST_DPAD:case b.EAST_DPAD:case b.RIGHT_STICK_BUTTON:case b.LEFT_STICK_BUTTON:w[e]();break;case b.LEFT_TRIGGER:w[e](t.buttons[b.LEFT_TRIGGER].value);break;case b.RIGHT_TRIGGER:w[e](t.buttons[b.RIGHT_TRIGGER].value)}}var y=function(e){switch(e){case"headtracker":w[b.SOUTH_BTN]=B,w[b.SOUTH_DPAD]=_,w[b.NORTH_DPAD]=z,w[b.WEST_BTN]=Q,w[b.LEFT_SHOULDER]=G,w[b.RIGHT_SHOULDER]=C,w[b.LEFT_TRIGGER]=N,w[b.RIGHT_TRIGGER]=F,w[b.RIGHT_STICK_BUTTON]=M,w[b.LEFT_STICK_BUTTON]=K;break;default:w[b.SOUTH_BTN]=B,w[b.EAST_BTN]=L,w[b.WEST_BTN]=Q,w[b.NORTH_BTN]=W,w[b.SOUTH_DPAD]=_,w[b.WEST_DPAD]=V,w[b.EAST_DPAD]=x,w[b.NORTH_DPAD]=z,w[b.LEFT_SHOULDER]=G,w[b.RIGHT_SHOULDER]=C,w[b.LEFT_TRIGGER]=U,w[b.RIGHT_TRIGGER]=F,w[b.RIGHT_STICK_BUTTON]=M,w[b.LEFT_STICK_BUTTON]=K}},_=function(){e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},G=function(){s?l+=-t.buttons[b.LEFT_SHOULDER].pressed*u:p.translateY(-t.buttons[b.LEFT_SHOULDER].pressed*u)},C=function(){s?l+=t.buttons[b.RIGHT_SHOULDER].pressed*u:p.translateY(t.buttons[b.RIGHT_SHOULDER].pressed*u)},N=function(t){if(t>.1){if(.5==t)return void e.explode(0);var a=t;a>1&&(a=1),a<0&&(a=0),e.explode(a)}else e.explode(0)},U=function(e){if(e>.1){if(.5==e)return p.fov=75,void(f[b.LEFT_TRIGGER]=!1);p.fov=-45*e+75}else p.fov=75},F=function(e){if(e>.1){if(.5==e)return void(f[b.RIGHT_TRIGGER]=!1);v=-5.5*e+6}else v=6},L=function(){var e=n.getState(E);i.push(e),T.logger.log("Savepoint created.")},V=function(){i.length&&(--r<0&&(r=i.length-1),n.restoreState(i[r]))},x=function(){i.length&&(++r>=i.length&&(r=0),n.restoreState(i[r]))},B=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==c&&p.updateMatrixWorld(),t?e.impl.selector.toggleSelection(t.dbId,t.model):e.impl.selector.clearSelection()},M=function(){e.impl.selector.clearSelection()},K=function(){e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},Q=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);t&&(t.dbId in e.getHiddenNodes()?e.show(t.dbId):e.hide(t.dbId))},W=function(){e.getPropertyPanel(!0).setVisible(!e.getPropertyPanel(!0).isVisible())},z=function(){(s=!s)&&(l=p.position.z),H("up")}}function n(e){var t=Autodesk.Viewing.Private,a=-1!=navigator.userAgent.search("Mac OS"),n=e.navigation,i=e.container,r=n.getCamera(),s=["firstperson"];this.setGlobalManager(e.globalManager);var u,l={SHIFT:0,ALT:0,CONTROL:0},c=Autodesk.Viewing.KeyCode,T=!1,d=!0,g=!1,p=null,h=new THREE.Clock(!0),v=-1,f=5e3,A=1,E=2,b=0,R=-1e20,S=-1e20,m=0,O=0,P=!1,w=!1,k=!1,I=!1,H=!1,D=!1,y=(r.fov,r.isPerspective,!1);(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(u=new o(e));var _=!1;this.isActive=function(){return T},this.getNames=function(){return s},this.getName=function(){return s[0]},this.activate=function(){h.start(),r.isPerspective,n.toPerspective(),r.fov,n.setVerticalFov(75,!0);var t=e.model.getBoundingBox().size();A=Math.max(Math.min(Math.min(t.x,t.y),t.z)/10,1e-4),e.canvas.focus(),T=!0,e.getFirstPersonToolPopup()&&!y&&F(),this.addCrosshair(),e.impl.pauseHighlight(!0),u&&u.activate(this.getName())},this.deactivate=function(){T=!1,h.stop(),N(),this.removeCrosshair(),e.impl.pauseHighlight(!1),u&&u.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(e){0===e?E=2:(E*=e>0?1.1:.9)<.01&&(E=.01)},this.handleGesture=function(e){switch(e.pointers&&e.pointers.length>0&&(e.pageX=e.pointers[0].pageX,e.pageY=e.pointers[0].pageY),e.type){case"dragstart":return p="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===p&&this.handleMouseMove(e);case"dragend":return"drag"===p&&(this.handleButtonUp(e,0),p=null,!0)}return!1},this.handleSingleClick=function(){return!1},this.handleButtonDown=function(e,t){N();var o=function(e){if(p)return!1;var t=e.ctrlKey||a&&e.metaKey,o=e.metaKey&&!a;return t||o||e.shiftKey||e.altKey}(e);return 0!==t||o||(R=e.pageX,S=e.pageY,m=O=0,g=!0),!0},this.handleMouseMove=function(e){var t=R<-1e10?0:e.pageX-R,a=S<-1e10?0:e.pageY-S;return R=e.pageX,S=e.pageY,g===d&&(m+=.0035*t,O+=.0035*a),!0},this.handleButtonUp=function(e,t){return 0!==t||!g||(m=O=0,g=!1,!0)},this.handleKeyDown=function(e,t){N();var a=!1;switch(t){case c.ESCAPE:break;case c.TAB:a=!1;break;case c.SHIFT:l.SHIFT=1,a=!0;break;case c.CONTROL:l.CONTROL=1,a=!0;break;case c.ALT:l.ALT=1,a=!0;break;case c.SPACE:l.SPACE=1,a=!0;break;case c.EQUALS:this.adjustSpeed(1),a=!0;break;case c.DASH:this.adjustSpeed(-1),a=!0;break;case c.ZERO:this.adjustSpeed(0),a=!0;break;case c.UP:case c.w:P=!0,a=!0;break;case c.LEFT:case c.a:k=!0,a=!0;break;case c.DOWN:case c.s:w=!0,a=!0;break;case c.RIGHT:case c.d:I=!0,a=!0;break;case c.q:H=!0,a=!0;break;case c.e:D=!0,a=!0;break;case c.g:case c.F1:a=!0}return a},this.handleKeyUp=function(e,t){var a=!1;switch(t){case c.TAB:a=!1;break;case c.SHIFT:l.SHIFT=0,a=!0;break;case c.CONTROL:l.CONTROL=0,a=!0;break;case c.ALT:l.ALT=0,a=!0;break;case c.SPACE:l.SPACE=0,a=!0;break;case c.UP:case c.w:P=!1,a=!0,G();break;case c.LEFT:case c.a:k=!1,a=!0,G();break;case c.DOWN:case c.s:w=!1,a=!0,G();break;case c.RIGHT:case c.d:I=!1,a=!0,G();break;case c.q:H=!1,a=!0,G();break;case c.e:D=!1,a=!0,G();break;case c.g:U(d=!d),a=!0;break;case c.F1:F(),a=!0}return a},this.handleWheelInput=function(e){return n.getReverseZoomDirection()&&(e*=-1),b+=e,!0},this.handleSingleClick=function(){return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(){return!1},this.handleBlur=function(){return P=w=!1,k=I=!1,H=D=!1,!1},this.update=function(){if(!T||!n.isActionEnabled("walk"))return!1;var e=h.getDelta();v>-1&&((new Date).getTime()-v>f&&N());r.isPerspective||(console.log("Lost perspective mode: resetting view."),n.toPerspective());var t=r.clone(),a=e*E*A*(1===l.SHIFT?4:1),o=.5*e*A*(1===l.SHIFT?4:1);if(0!=b){var i=1*b*A*(1===l.SHIFT?4:1);t.translateZ(-i),b=0}P&&t.translateZ(-a),w&&t.translateZ(a),k&&t.translateX(-a),I&&t.translateX(a),H&&t.translateY(o),D&&t.translateY(-o);var s=t.position,c=0!==s.distanceToSquared(r.position),d=t.target,g=r.target.clone().sub(r.position),p=g.clone().cross(r.up).normalize();if(0!=O){var R=new THREE.Quaternion;R.setFromAxisAngle(p,-O);var S=g.clone();S.applyQuaternion(R);var y=r.worldup.clone(),_=S.angleTo(y),G=THREE.Math.degToRad(5);_>=G&&_<=Math.PI-G&&(g.applyQuaternion(R),t.up.applyQuaternion(R)),O=0}if(0!=m){var C=new THREE.Quaternion;C.setFromAxisAngle(r.worldup,-m),g.applyQuaternion(C),t.up.applyQuaternion(C),m=0}var U=0!==(d=s.clone().add(g)).distanceToSquared(r.target);return(c||U)&&(n.setView(s,d),n.orientCameraUp()),u&&(r=u.update(r)),r.dirty};var G=function(){_||(t.logger.track({category:"tool_used",name:"FirstPerson_tool"}),_=!0)},C=function(e,t,a,o,n){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(i,e,a,o,n),t>0?(v=(new Date).getTime(),f=t):(v=-1,f=0))},N=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),v=-1},U=function(e){N();var t=e?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation";C({msgTitleKey:"First Person Tool",messageKey:t,messageDefaultValue:t},0,(function(){}))},F=function(){N();C({msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",buttonText:"Ok Got It"},0,(function(){}),(function(){y=!0,e.setFirstPersonToolPopup(!1),N()}))};this.addCrosshair=function(){t.stringToDOM&&(this.crosshair=t.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),e.canvasWrap.appendChild(this.crosshair))},this.removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}function i(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.name="firstperson"}a.r(t),a.d(t,"FirstPersonExtension",(function(){return i})),Autodesk.Viewing.GlobalManagerMixin.call(n.prototype),i.prototype=Object.create(Autodesk.Viewing.Extension.prototype),i.prototype.constructor=i;var r=i.prototype;r.load=function(){var e=this,t=this.viewer,a=Autodesk.Viewing.UI;return this.tool=new n(t),t.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(t){if(-1!==t.toolName.indexOf("firstperson")&&e.firstPersonToolButton){var o=t.active?a.Button.State.ACTIVE:a.Button.State.INACTIVE;e.firstPersonToolButton.setState(o)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},r.createUI=function(){var e=this.viewer;if(e.getToolbar){var t=this,a=Autodesk.Viewing.UI,o=e.getToolbar().getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new a.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(){t.activeStatus?t.deactivate():t.activate()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var n=o.getControl("toolbar-cameraSubmenuTool");n?o.addControl(this.firstPersonToolButton,{index:o.indexOf(n.getId())}):o.addControl(this.firstPersonToolButton)}},r.unload=function(){var e=this.viewer;(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,e.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton)&&(e.getToolbar()&&this.firstPersonToolButton.removeFromParent(),this.firstPersonToolButton=null);return e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},r.activate=function(){return this.activeStatus||(this.viewer.setActiveNavigationTool("firstperson"),this.activeStatus=!0),!0},r.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",i)}});
//# sourceMappingURL=FirstPerson.min.js.map