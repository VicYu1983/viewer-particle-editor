{"version":3,"sources":["webpack://Autodesk.Extensions.[name]/webpack/bootstrap","webpack://Autodesk.Extensions.[name]/./extensions/PropertyQuery/query.js","webpack://Autodesk.Extensions.[name]/./extensions/PropertyQuery/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Filter","filter","this","_data","setList","list","setPrefix","prefix","setTerm","term","setText","text","keys","length","attribute","entry","toLowerCase","includes","Array","isArray","forEach","e","push","existingIndex","indexOf","splice","newList","removeList","addList","newPrefix","removePrefix","addPrefix","newTerm","removeTerm","addTerm","newText","removeText","addText","Fields","fields","include","validFields","included","attr","tokenizedField","split","excluded","attrIndex","Pagination","pagination","setOffset","offset","setLimit","limit","Query","type","clear","exclude","query","getData","select","av","Autodesk","Viewing","namespace","AutodeskNamespace","PropertyQueryExtension","viewer","options","modes","console","warn","objectlist","promises","item","model","dbIds","selection","objectid","getQuery","build","resourceNodes","getDocumentNode","search","role","guid","urn","Promise","resolve","reject","requestProperties","body","onSuccess","onFailure","loadContext","endpoint","initLoadContext","url","Private","ViewingService","getProperties","Extension","theExtensionManager","registerExtension"],"mappings":"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","file":"PropertyQuery/PropertyQuery.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 882);\n","class Filter {\n    constructor(filter) {\n        this._data = {};\n        if (!filter) return;\n        this.setList(filter.list);\n        this.setPrefix(filter.prefix);\n        this.setTerm(filter.term);\n        this.setText(filter.text);\n    }\n\n    /**\n     * Returns the filter data object\n     * @returns {object|null} data object if it is populated, null otherwise\n     */\n    getData() {\n        return Object.keys(this._data).length > 0 ? this._data : null;\n    }\n\n    /**\n     * Clears the filter's data object\n     */\n    clear() {\n        this._data = {};\n    }\n\n    /**\n     * Adds a new entry for an attribute into a filter's list.\n     * Currently the valid attributes are externalId and objectid\n     * @example\n     *  filter.addList(\"dbIds\", [33, 44]);\n     *  filter.addList(\"externalId\", [\"doc_982afc8a\", \"doc_afd75233\"]);\n     * @param {String} attribute - ex: \"dbIds\", \"externalId\"\n     * @param {String[]|String|Number[]|Number} entry - number(s) for objectid and string(s) for externalId\n     * @returns {boolean} - true if added, false otherwise\n     */\n    addList(attribute, entry) {\n        if (!attribute || !entry) {\n            return false;\n        }\n\n        attribute = attribute.toLowerCase();\n        switch (attribute) {\n            case 'objectid':\n            case 'objectids':\n            case 'dbid':\n            case 'dbids':\n                attribute = 'objectid';\n                break;\n            case 'externalid':\n            case 'externalids':\n                attribute = 'externalId';\n                break;\n            default:\n                // Invalid Type, return\n                return false;\n        }\n\n        if (!Object.prototype.hasOwnProperty.call(this._data, 'list')) {\n            this._data.list = {};\n        }\n\n        if (!Object.keys(this._data.list).includes(attribute)) {\n            this._data.list[attribute] = [];\n        }\n\n        entry = Array.isArray(entry) ? entry : [entry];\n        entry.forEach((e) => {\n            if (!this._data.list[attribute].includes(e)) {\n                this._data.list[attribute].push(e);\n            }\n        });\n\n        return true;\n    }\n\n    /**\n     * Removes a single attribute from the list.\n     * @example\n     *  // Remove 33 from the objectid array\n     *  filter.removeList(\"dbId\", 33);\n     *\n     *  // Remove all entries for \"externalId\"\n     *  filter.removeList(\"externalId\");\n     *\n     *  // Clear the entire list\n     *  filter.removeList();\n     * @param {String} attribute - ex: \"dbId(s)\", \"externalId\"\n     * @param {String|Number} entry - number for dbId(s) and string for externalId\n     * @returns {Boolean} - true if removed\n     */\n    removeList(attribute, entry) {\n        if (!attribute && !entry) {\n            delete this._data.list;\n            return true;\n        }\n\n        attribute = attribute.toLowerCase();\n        switch (attribute) {\n            case 'objectid':\n            case 'objectids':\n            case 'dbid':\n            case 'dbids':\n                attribute = 'objectid';\n                break;\n            case 'externalid':\n            case 'externalids':\n                attribute = 'externalId';\n                break;\n            default:\n                // Invalid Type, return\n                return false;\n        }\n\n        if (Object.prototype.hasOwnProperty.call(this._data.list, attribute)) {\n            if (!entry) {\n                delete this._data.list[attribute];\n                return true;\n            }\n            const existingIndex = this._data.list[attribute].indexOf(entry);\n            if (existingIndex > -1) {\n                this._data.list[attribute].splice(existingIndex, 1);\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * This parameter should contain a list of exact values for a specific object field.\n     * The query results returns objects that must contain the specified field and the values of the field should match one of the defined values.\n     * @example\n     * {\n     *  \"externalId\": [ \"doc_982afc8a\", \"doc_afd75233\" ],\n     *  // \"dbIds\": [33, 53],\n     * }\n     * @param {Object} newList - list object. see example above\n     * @returns {Boolean} - true if the new list object was set, false otherwise.\n     */\n    setList(newList) {\n        if (!newList) return false;\n        // Remove the existing list entries\n        this.removeList();\n        const keys = Object.keys(newList);\n        keys.forEach((key) => {\n            this.addList(key, newList[key]);\n        });\n        return true;\n    }\n\n    /**\n     * Adds a prefix to the filter. This query clause returns objects that must contain a specific attribute whose values should contain a specific prefix (case insensitive).\n     * @example\n     *  filter.addPrefix('name', 'Basic Wall [');\n     * @param {String} attribute - currently only \"name\" is supported\n     * @param {String} entry - Partial string to search for in the properties\n     * @returns {Boolean} - true if the prefix was added\n     */\n    addPrefix(attribute, entry) {\n        if (!Object.prototype.hasOwnProperty.call(this._data, 'prefix')) {\n            this._data.prefix = {};\n        }\n\n        // Currently the property:query api only supports the name attribute.\n        this._data.prefix[attribute] = entry;\n        return true;\n    }\n\n    /**\n     * Removes an existing prefix.\n     * @example\n     *  // Removes a single prefix\n     *  filter.removePrefix('name');\n     *\n     *  // Removes all prefixes\n     *  filter.removePrefix();\n     * @param {String} attribute - currently only \"name\" is supported\n     * @returns {Boolean} - true if the prefix was removed\n     */\n    removePrefix(attribute) {\n        if (!attribute) {\n            delete this._data.prefix;\n        } else if (Object.prototype.hasOwnProperty.call(this._data.prefix, attribute)) {\n            delete this._data.prefix[attribute];\n        } else {\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * Sets the prefix data. This method will override the existing prefix filter.\n     * @example\n     * {\n     *  \"name\": \"Basic Wall [\"\n     * }\n     * @param {Object} newPrefix - see example above\n     * @returns {Boolean} - true if prefix filter was set, false otherwise\n     */\n    setPrefix(newPrefix) {\n        if (!newPrefix) return false;\n        this.removePrefix();\n        for (let attribute in newPrefix) {\n            this.addPrefix(attribute, newPrefix[attribute]);\n        }\n\n        return true;\n    }\n\n    /**\n     * Adds a term to the filter. This query clause returns objects that contain a specific object field and the values of the field should match an exact value (case insensitive)\n     * @example\n     *  filter.addTerm('name', 'Rectangular');\n     * @param {String} attribute - currently only \"name\" is supported\n     * @param {String} entry - String to search for in the properties\n     * @returns {Boolean} - true if the term was added\n     */\n    addTerm(attribute, entry) {\n        if (!Object.prototype.hasOwnProperty.call(this._data, 'term')) {\n            this._data.term = {};\n        }\n\n        // Currently the property:query api only supports the name attribute.\n        this._data.term[attribute] = entry;\n        return true;\n    }\n\n    /**\n     * Removes an existing term.\n     * @example\n     *  // Removes a single term\n     *  filter.removeTerm('name');\n     *\n     *  // Removes all terms\n     *  filter.removeTerm();\n     * @param {String} attribute - currently only \"name\" is supported\n     * @returns {Boolean} - true if the term was removed\n     */\n    removeTerm(attribute) {\n        if (!attribute) {\n            delete this._data.term;\n        } else if (Object.prototype.hasOwnProperty.call(this._data.term, attribute)) {\n            delete this._data.term[attribute];\n        } else {\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * Sets the term data. This method will override the existing term filter.\n     * @example\n     * {\n     *  \"name\": \"Rectangular\"\n     * }\n     * @param {Object} newTerm - see example above\n     * @returns {Boolean} - true if term filter was set, false otherwise\n     */\n    setTerm(newTerm) {\n        if (!newTerm) return false;\n        this.removeTerm();\n        for (let attribute in newTerm) {\n            this.addTerm(attribute, newTerm[attribute]);\n        }\n\n        return true;\n    }\n\n    /**\n     * Adds a text to the filter. This query clause contains multiple terms for a specific object field. The query result returns objects that should contain the specified field and values of the field should contain one or more terms defined (case insensitive). Each term need be separated by the ASCII whitespace character and a maximum of 50 terms is allowed in one query.\n     * @example\n     *  filter.addText('properties.Material', 'Aluminum Steel');\n     * @param {String} attribute - example: properties.Material\n     * @param {String} entry - String to search for in the properties\n     * @returns {Boolean} - true if the text was added\n     */\n    addText(attribute, entry) {\n        if (!Object.prototype.hasOwnProperty.call(this._data, 'text')) {\n            this._data.text = {};\n        }\n\n        // Currently the property:query api only supports the name attribute.\n        this._data.text[attribute] = entry;\n        return true;\n    }\n\n    /**\n     * Removes an existing text.\n     * @example\n     *  // Removes a single text\n     *  filter.removeTerm('properties.Material');\n     *\n     *  // Removes all texts\n     *  filter.removeTerm();\n     * @param {String} attribute - currently only \"name\" is supported\n     * @returns {Boolean} - true if the term was removed\n     */\n    removeText(attribute) {\n        if (!attribute) {\n            delete this._data.text;\n        } else if (Object.prototype.hasOwnProperty.call(this._data.text, attribute)) {\n            delete this._data.text[attribute];\n        } else {\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * Sets the text data. This method will override the existing text filter.\n     * @example\n     * {\n     *  \"properties.Material\": \"Aluminum Steel\"\n     * }\n     * @param {Object} newText - see example above\n     * @returns {Boolean} - true if added, false otherwise\n     */\n    setText(newText) {\n        if (!newText) return false;\n        this.removeText();\n        for (let attribute in newText) {\n            this.addText(attribute, newText[attribute]);\n        }\n        return true;\n    }\n}\n\nclass Fields {\n    constructor(fields) {\n        this._data = [];\n        if (!fields) return;\n        this.include(fields);\n    }\n\n    /**\n     * Returns the fields data array\n     * @returns {array|null} data array if it is populated, null otherwise\n     */\n    getData() {\n        return Object.keys(this._data).length > 0 ? this._data : null;\n    }\n\n    /**\n     * The attribute(s) define a set of object fields which will be searched.\n     * @example\n     *  fields.include([\"objectid\", \"name\", \"properties.Energy*\", \"properties.Version\", \"properties.*.Version\", \"properties.Dimensions\"]);\n     * @param {String|String[]} attribute - valid attributes: 'objectid', 'name', 'externalId', 'properties'\n     * @returns {Boolean} - true if added, false otherwise\n     */\n    include(attribute) {\n        if (!attribute) return false;\n        const validFields = ['objectid', 'name', 'externalId', 'properties'];\n        let included = false;\n\n        attribute = Array.isArray(attribute) ? attribute : [attribute];\n        attribute.forEach((attr) => {\n            const tokenizedField = attr.split('.');\n            // We might want to process the input.\n            if (!this._data.includes(attr) && validFields.includes(tokenizedField[0])) {\n                this._data.push(attr);\n                included = true;\n            }\n        });\n\n        return included;\n    }\n\n    /**\n     * Removes the existing attribute from the fields array.\n     * @example\n     *  // Removed two attributes from the fields array\n     *  fields.exclude(['objectid', 'properties']);\n     *\n     *  // Clear the fields array\n     *  fields.exclude();\n     *\n     * @param {String[]|String} attribute - valid attributes: 'objectid', 'name', 'externalId', 'properties'\n     * @returns {Boolean} - true if removed, false otherwise\n     */\n    exclude(attribute) {\n        if (!attribute) {\n            this._data = [];\n            return true;\n        }\n\n        let excluded = false;\n        attribute = Array.isArray(attribute) ? attribute : [attribute];\n\n        const fields = [...this._data];\n        attribute.forEach((attr) => {\n            const attrIndex = fields.indexOf(attr);\n            if (attrIndex > -1) {\n                fields.splice(attrIndex, 1);\n                excluded = true;\n            }\n        });\n\n        this._data = fields;\n\n        return excluded;\n    }\n}\n\nclass Pagination {\n    constructor(pagination) {\n        this._data = {};\n        if (!pagination) return;\n        this.setOffset(pagination.offset);\n        this.setLimit(pagination.limit);\n    }\n\n    /**\n     * Returns the pagination data object\n     * @returns {object|null} data object if it is populated, null otherwise\n     */\n    getData() {\n        return Object.keys(this._data).length > 0 ? this._data : null;\n    }\n\n    /**\n     * Clears the pagination data object.\n     */\n    clear() {\n        this._data = {};\n    }\n\n    /**\n     * Sets the pagination offset. \n     * @example\n     *  pagination.setOffset(2);\n     * @param {Number} offset - The offset from the start of the collection to the first entry in the page. 0 based.\n     * @returns {Boolean} - true if offset added, false otherwise\n     */\n    setOffset(offset) {\n        if (offset == null) return false;\n        this._data.offset = offset;\n        return true;\n    }\n\n    /**\n     * Sets the pagination limit. \n     * @example\n     *  pagination.setLimit(30);\n     * @param {Number} limit - Sets the maximum number of objects that MAY be returned. A query MAY return fewer than the value of limit due to filtering. Value should be between 1 to 1000.\n     * @returns {Boolean} - true if limit added, false otherwise\n     */\n    setLimit(limit) {\n        if (limit == null) return false;\n        this._data.limit = limit;\n        return true;\n    }\n}\n\nexport class Query {\n    constructor(filter, fields, pagination) {\n        this.filter = new Filter(filter);\n        this.fields = new Fields(fields);\n        this.pagination = new Pagination(pagination);\n    }\n\n    /**\n     * Adds a filter type.\n     * @example\n     *  // Add a list\n     *  query.add('list', 'dbIds', [33, 44]);\n     * \n     *  // Add a prefix\n     *  query.add('prefix', 'name', 'Basic Wall [');\n     * \n     *  // Add a term\n     *  query.add('term', 'name', 'Rectangular');\n     * \n     *  // Add a text\n     *  query.add('text', 'properties.Material', 'Aluminum Steel');\n     * @param {String} type - The type of filter.\n     * @param {String} attribute - The attribute that is valid with the type.\n     * @param {String[]|String|Number[]|Number} entry - the entry to add for the specific type filter attribute.\n     * @returns {boolean} - true if added, false otherwise\n     */\n    add(type, attribute, entry) {\n        switch (type) {\n            case 'list':\n                return this.filter.addList(attribute, entry);\n            case 'prefix':\n                return this.filter.addPrefix(attribute, entry);\n            case 'term':\n                return this.filter.addTerm(attribute, entry);\n            case 'text':\n                return this.filter.addText(attribute, entry);\n            default:\n                return false;\n        }\n    }\n\n    /**\n     * Removes a filter type.\n     * @example\n     *  // Remove a list dbId entry\n     *  query.remove('list', 'dbIds', [33]);\n     * \n     *  // Remove all dbIds\n     *  query.remove('list', 'dbIds');\n     * \n     *  // Remove the whole list\n     *  query.remove('list');\n     * \n     *  // Remove a prefix\n     *  query.remove('prefix', 'name');\n     * \n     *  // Remove a term\n     *  query.remove('term', 'name');\n     * \n     *  // Remove a text\n     *  query.remove('text', 'properties.Material');\n     * \n     *  // To clear the whole filter\n     *  query.remove();\n     * \n     * @param {String} [type] - The type of filter.\n     * @param {String} [attribute] - The attribute that is valid with the type.\n     * @param {String[]|String|Number[]|Number} [entry] - the entry to remove for the specific type filter attribute.\n     * @returns {boolean} - true if removed, false otherwise\n     */\n    remove(type, attribute, entry) {\n        // If no parameters are passed in, clear the whole filter.\n        if (!type && !attribute && !entry) {\n            this.filter.clear();\n        }\n\n        switch (type) {\n            case 'list':\n                return this.filter.removeList(attribute, entry);\n            case 'prefix':\n                return this.filter.removePrefix(attribute);\n            case 'term':\n                return this.filter.removeTerm(attribute);\n            case 'text':\n                return this.filter.removeText(attribute);\n            default:\n                return false;\n        }\n    }\n\n    /** The attribute(s) define a set of object fields which will be searched.\n     * @example\n     *  query.include([\"objectid\", \"name\", \"properties.Energy*\", \"properties.Version\", \"properties.*.Version\", \"properties.Dimensions\"]);\n     * @param {String|String[]} attribute - valid attributes: 'objectid', 'name', 'externalId', 'properties'\n     * @returns {Boolean} - true if included, false otherwise\n     */\n    include(attribute) {\n        return this.fields.include(attribute);\n    }\n\n    /**\n     * Removes the existing attribute from the fields array.\n     * @example\n     *  // Remove two attributes from the fields array\n     *  query.exclude(['objectid', 'properties']);\n     *\n     *  // Clear the fields array\n     *  query.exclude();\n     *\n     * @param {String[]|String} attribute - valid attributes: 'objectid', 'name', 'externalId', 'properties'\n     * @returns {Boolean} - true if removed, false otherwise\n     */\n    exclude(attribute) {\n        return this.fields.exclude(attribute);\n    }\n\n    /**\n     * Set the offset and limit to paginate the poperties.\n     * If both parameters are missing the pagination object is cleared.\n     * @param {Number|null} offset - The offset from the start of the collection to the first entry in the page. 0 based.\n     * @param {Number|null} limit - Sets the maximum number of objects that MAY be returned. A query MAY return fewer than the value of limit due to filtering. Value should be between 1 to 1000.\n     * @returns {Boolean} - true if cleared or set.\n     */\n    paginate(offset, limit) {\n        if (offset == null && limit == null) {\n            this.pagination.clear();\n            return true;\n        }\n        this.pagination.setLimit(limit);\n        this.pagination.setOffset(offset);\n        return true;\n    }\n\n    /**\n     * Builds the query object.\n     * @returns {Object} - the query object that can be passed to the ModelDerivative properties:query api\n     */\n    build() {\n        const query = {};\n        const filter = this.filter.getData();\n        const fields = this.fields.getData();\n        const pagination = this.pagination.getData();\n\n        if (filter) {\n            query.filter = filter;\n        }\n\n        if (fields) {\n            query.select = fields;\n        }\n\n        if (pagination) {\n            query.pagination = pagination;\n        }\n\n        return query;\n    }\n}\n","'use strict';\n\nimport { Query } from './query';\nconst av = Autodesk.Viewing;\nconst namespace = AutodeskNamespace('Autodesk.Viewing.Extensions.PropertyQuery');\n\nnamespace.Query = Query;\n\n/**\n * Extension description\n *\n * The extension id is: 'Autodesk.PropertyQuery'\n *\n * @example\n *   viewer.loadExtension('Autodesk.PropertyQuery', options)\n *\n * @memberof Autodesk.Viewing.Extensions\n * @alias Autodesk.Viewing.Extensions.PropertyQuery\n * @see {@link Autodesk.Viewing.Extension} for common inherited methods.\n * @class\n */\nexport class PropertyQueryExtension extends av.Extension {\n    /**\n     * Autodesk.PropertyQueryExtension constructor\n     * @constructor\n     * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance.\n     * @param {Object} [options] Options for the PropertyQueryExtension\n     * @param {boolean} [options.someOption=false] This is how options should be documented\n     */\n    constructor(viewer, options) {\n        super(viewer, options);\n        this.modes = [];\n        this.mode = '';\n        this.name = 'PropertyQuery';\n        console.warn(\n            'This extension is currently under development. It will only work with models in the dev envirnoment.'\n        );\n    }\n\n    /**\n     * Called by the viewer once for the lifetime of the extension (unload() ends it)\n     * Perform all initializations here.\n     * The viewer sends `EXTENSION_LOADED_EVENT` after the load succeeds.\n     * @returns {boolean} True if the load was successful. Optionally, the function can return a Promise to indicate success (resolve) or failure (reject).\n     * @memberof Autodesk.Viewing.Extensions.PropertyQuery\n     * @alias Autodesk.Viewing.Extensions.PropertyQuery#deactivate\n     * @private\n     */\n    load() {\n        super.load();\n        return true;\n    }\n\n    /**\n     * Override the unload method to perform some cleanup of operations that were done in load.\n     * This function will be invoked when viewer.unloadExtension(\"Autodesk.PropertyQuery\") is called.\n     * @returns {boolean} True if the load was successful. Optionally, the function can return a Promise to indicate success (resolve) or failure (reject).\n     * @memberof Autodesk.Viewing.Extensions.PropertyQuery\n     * @alias Autodesk.Viewing.Extensions.PropertyQuery#deactivate\n     * @private\n     */\n    unload() {\n        super.unload();\n        return true;\n    }\n\n    /**\n     * Override the activate method to enable the functionality of the extension.\n     * @param [mode] - An optional mode that indicates a different way the extension can function.\n     * @see {@link Autodesk.Viewing.Extension#getModes }\n     * @returns {boolean} True if the extension activation was successful.\n     * @alias Autodesk.Viewing.Extensions.PropertyQuery#activate\n     */\n    activate(mode) {\n        super.activate(mode);\n        return true;\n    }\n\n    /**\n     * Override the deactivate method to disable the functionality of the extension.\n     * @returns {boolean} True if the extension deactivation was successful.\n     * @alias Autodesk.Viewing.Extensions.PropertyQuery#deactivate\n     */\n    deactivate() {\n        super.deactivate();\n        return true;\n    }\n\n    /**\n     * Returns a new Query that can be used for building and requesting the associated properties.\n     * @param {Object} [filter]\n     * @param {String[]} [select]\n     * @param {Object} [pagination]\n     * @returns {Query}\n     */\n    getQuery(filter, select, pagination) {\n        return new Query(filter, select, pagination);\n    }\n\n    /**\n     * Returns an array of promises that resolve once properties are received from the ModelDerivative properties:query API.\n     * @example\n     *  const ext = viewer.getExtension(\"Autodesk.PropertyQuery\");\n     *  const propPromises = ext.getProperties(viewer.getAggregateSelection());\n     *  Promise.all(propPromises).then((resp) => {\n     *      // Process properties\n     *  });\n     *\n     * @param {Object[]|Object} objectlist - An array of objects. The object will will contain a Autodesk.Viewing.Model instance the selection array of dbIds. Example: [{model: Autodesk.Viewing.Model, selection: [Number, Number, ...]}]\n     * @returns {Promises[]} - Returns an empty array if objectlist parameter missing. Otherwise, returns an array of promises that resolve with the property objects.\n     */\n    getProperties(objectlist) {\n        if (!objectlist) {\n            return [];\n        }\n        objectlist = Array.isArray(objectlist) ? objectlist : [objectlist];\n\n        // Currently the properties:query api requires dbIds to be passed in. Otherwise, the api responds with a 400 error\n        if (objectlist.length === 0) {\n            return [];\n        }\n\n        const promises = [];\n        objectlist.forEach((item) => {\n            const model = item.model;\n            const dbIds = item.selection;\n            const filter = {\n                list: {\n                    objectid: dbIds,\n                },\n            };\n\n            const pagination = {\n                offset: 0,\n                limit: dbIds.length,\n            };\n\n            const query = this.getQuery(filter, null, pagination).build();\n\n            const resourceNodes = model.getDocumentNode().search({ type: 'resource', role: 'graphics'});\n            if (!Array.isArray(resourceNodes) || resourceNodes.length === 0) {\n                return [];\n            }\n            const guid = resourceNodes[0].guid();\n            const urn = model.getData().urn;\n\n            promises.push(\n                new Promise((resolve, reject) => {\n                    this.requestProperties(urn, guid, query, resolve, reject);\n                })\n            );\n        });\n\n        return promises;\n    }\n\n    /**\n     * Sends a request to the ModelDerivative properties:query api.\n     * @param {String} urn - Model Urn\n     * @param {String} guid - resource guid in the model\n     * @param {Object} body - Query instance\n     * @param {Function} onSuccess - callback when the request succeeded\n     * @param {Function} onFailure - callback when the request failed\n     * @returns {null}\n     */\n    requestProperties(urn, guid, body, onSuccess, onFailure) {\n        if (!urn || !guid) {\n            return;\n        }\n\n        const loadContext = av.endpoint.initLoadContext({});\n        const url = urn.indexOf('urn:') !== 0 ? 'urn:' + urn : urn;\n        av.Private.ViewingService.getProperties(loadContext, url, guid, body, onSuccess, onFailure);\n    }\n}\nnamespace.PropertyQueryExtension = PropertyQueryExtension;\n\nav.theExtensionManager.registerExtension('Autodesk.PropertyQuery', PropertyQueryExtension);\n"],"sourceRoot":""}