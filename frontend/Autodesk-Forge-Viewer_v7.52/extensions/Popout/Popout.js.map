{"version":3,"file":"Popout/Popout.js","sources":["webpack://Autodesk.Extensions.[name]/webpack/bootstrap","webpack://Autodesk.Extensions.[name]/./extensions/Popout/index.js","webpack://Autodesk.Extensions.[name]/./extensions/Popout/thirdparty/popout.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./extensions/Popout/index.js\");\n","function _typeof(obj) {\"@babel/helpers - typeof\";if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {_typeof = function _typeof(obj) {return typeof obj;};} else {_typeof = function _typeof(obj) {return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;};}return _typeof(obj);}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}function _defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}function _createClass(Constructor, protoProps, staticProps) {if (protoProps) _defineProperties(Constructor.prototype, protoProps);if (staticProps) _defineProperties(Constructor, staticProps);return Constructor;}function _inherits(subClass, superClass) {if (typeof superClass !== \"function\" && superClass !== null) {throw new TypeError(\"Super expression must either be null or a function\");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });if (superClass) _setPrototypeOf(subClass, superClass);}function _setPrototypeOf(o, p) {_setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return _setPrototypeOf(o, p);}function _createSuper(Derived) {var hasNativeReflectConstruct = _isNativeReflectConstruct();return function _createSuperInternal() {var Super = _getPrototypeOf(Derived),result;if (hasNativeReflectConstruct) {var NewTarget = _getPrototypeOf(this).constructor;result = Reflect.construct(Super, arguments, NewTarget);} else {result = Super.apply(this, arguments);}return _possibleConstructorReturn(this, result);};}function _possibleConstructorReturn(self, call) {if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return self;}function _isNativeReflectConstruct() {if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;if (Reflect.construct.sham) return false;if (typeof Proxy === \"function\") return true;try {Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));return true;} catch (e) {return false;}}function _getPrototypeOf(o) {_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return _getPrototypeOf(o);}import { Popout, resetImageBlobUrls } from './thirdparty/popout';\n\nvar av = Autodesk.Viewing;\nvar avp = av.Private;\n\n/**\n                       * Extension to popout the viewer into child windows\n                       * \n                       * The extension id is: `Autodesk.Viewing.Popout`\n                       * \n                       * @example\n                       *  viewer.loadExtension('Autodesk.Viewing.Popout');\n                       * \n                       * @see {@link Autodesk.Viewing.Extension} for common inherited methods.\n                       * @memberof Autodesk.Viewing.Extensions\n                       * @alias Autodesk.Viewing.Extensions.PopoutExtension\n                       */var\nPopoutExtension = /*#__PURE__*/function (_av$Extension) {_inherits(PopoutExtension, _av$Extension);var _super = _createSuper(PopoutExtension);\n  /**\n                                                                                                                                                * @class\n                                                                                                                                                * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance.\n                                                                                                                                                * @param {object} options - Not used.\n                                                                                                                                                */\n  function PopoutExtension(viewer) {var _this;var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};_classCallCheck(this, PopoutExtension);\n    _this = _super.call(this, viewer, options);\n    _this._viewer = viewer;\n    _this._popoutInstance = null;\n    _this._viewerParentNode = null;\n    _this._onBeforeUnload = _this._onBeforeUnload.bind(_assertThisInitialized(_this));return _this;\n  }\n\n  /**\n     * Extension interface method - loads the extension\n     *\n     * @alias Autodesk.Viewing.Extensions.PopoutExtension#load\n     * @returns {boolean}\n     */_createClass(PopoutExtension, [{ key: \"load\", value: function load()\n    {\n      return true;\n    }\n\n    /**\n       * Extension interface method - unloads the extension\n       *\n       * @alias Autodesk.Viewing.Extensions.PopoutExtension#unload\n       * @returns {boolean}\n       */ }, { key: \"unload\", value: function unload()\n    {\n      return true;\n    }\n\n    /**\n       * Use this to pop the viewer out to an existing window\n       * \n       * @param {object} child - Already open window created with window.open()\n       * @param {string} elementid - The dom element id in the child where the viewer will be moved to\n       * @param {boolean} [copyStyles=true] - Flag to copy the styles from the current window to the child. \n       *                                      Set this to false if you intend to copy the styles yourself\n       * @param {boolean} [setupStyleObserver=true] -  Style observers clone dynamically added <style></style> (from extensions loading) into child.\n       *                                               This is required for extensions to work.\n       *                                               Set this to false if you intend to set up the cloning with mutation observers yourself\n       * \n       * @alias Autodesk.Viewing.Extensions.PopoutExtension#popoutToChild\n       */ }, { key: \"popoutToChild\", value: function popoutToChild(\n    child, elementid) {var copyStyles = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;var setupStyleObserver = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n      var viewer = this.viewer;\n      var logger = avp.logger;\n\n      // validate input\n      if (!child) {\n        logger.error('Invalid child');\n        return;\n      }\n\n      var elem = child.document.getElementById(elementid);\n      if (!elem) {\n        logger.error(\"Invalid element \".concat(elementid));\n        return;\n      }\n\n      if (!viewer.container) {\n        logger.error('Viewer is not part of DOM');\n        return;\n      }\n\n      if (this._isPoppedOut()) {\n        logger.info('Already popped out');\n        return;\n      }\n\n      this._popoutInstance = new Popout({ hidden: false, onBeforeUnload: this._onBeforeUnload });\n\n      // Copy all styles\n      copyStyles && this._popoutInstance.copyStyles(child);\n      // Set up style observers and close handlers\n      this._popoutInstance.setupChild(elem, child, setupStyleObserver);\n      // Popout\n      this._moveViewerTo(child, elementid);\n    }\n\n    /**\n       * Use this to pop the viewer out to a new blank window\n       * \n       * @param {object} [options] - windowFeature options\n       * @param {Function} [onBeforeUnload] - Called before the popout window is unloaded\n       * @param {Function} [onClose] - Called when popout window is closed\n       * @param {Function} [onBlocked] - Called when popup blockers block creating child window\n       * \n       * @alias Autodesk.Viewing.Extensions.PopoutExtension#popoutToBlank\n       */ }, { key: \"popoutToBlank\", value: function popoutToBlank(\n    options, onBeforeUnload, onClose, onBlocked) {var _this2 = this;\n      var viewer = this.viewer;\n      var logger = avp.logger;\n\n      if (!viewer.container) {\n        logger.error('Viewer is not part of DOM');\n        return;\n      }\n\n      if (this._isPoppedOut()) {\n        logger.info('Already popped out');\n        return;\n      }\n\n      // empty html body\n      var html = \"<!DOCTYPE html><html><head></head><body></body></html>\";\n\n      // Callback for onbeforeunloa, which handles closing the popout window\n      var onBeforeUnloadCb = function onBeforeUnloadCb() {for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {args[_key] = arguments[_key];}\n        // Call user's version first\n        if (onBeforeUnload) {\n          onBeforeUnload.apply(null, args);\n        }\n\n        // call ours\n        _this2._onBeforeUnload.apply(null, args);\n      };\n\n      // Create and show the popout\n      var props = {\n        options: options,\n        hidden: false,\n        html: html,\n        onBeforeUnload: onBeforeUnloadCb,\n        onClose: onClose,\n        onBlocked: onBlocked };\n\n      this._popoutInstance = new Popout(props);\n      this._popoutInstance.renderChildWindow();\n\n      // pop out\n      if (this._popoutInstance.child && !this._popoutInstance.child.closed) {\n        this._moveViewerTo(this._popoutInstance.child, this._popoutInstance.container.id);\n      }\n    }\n\n    /**\n       * Closes the popout window and moves the viewer back to the main window\n       *\n       * @alias Autodesk.Viewing.Extensions.PopoutExtension#popin\n       */ }, { key: \"popin\", value: function popin()\n    {\n      if (this._popoutInstance) {\n        this._popoutInstance.closeChildWindowIfOpened();\n      }\n    }\n\n    /**\n       * window.onbeforeunload callback\n       *\n       * @private\n       */ }, { key: \"_onBeforeUnload\", value: function _onBeforeUnload()\n    {\n      this._moveViewerBack();\n      this._popoutInstance = null;\n    }\n\n    /**\n       * Call this to pop the viewer into a child window\n       *\n       * For this to work,\n       *  1. The viewer's style.css link and other css added by the viewer  must be present in the child document's <head> tag and\n       *  2. A mutationobserver should be set up to clone the style elements into the child as they appear (from other extension loading)\n       *\n       * @param {object} child - popout window\n       * @param {*} elementid - the element id to append the viewer to\n       * @private\n       */ }, { key: \"_moveViewerTo\", value: function _moveViewerTo(\n    child, elementid) {\n      if (this._isPoppedOut()) {\n        avp.logger.info('Already popped out');\n        return;\n      }\n\n      // Move the viewer element\n      var container = child.document.getElementById(elementid);\n      if (container) {\n        // Store parent node so we can come back\n        this._viewerParentNode = this.viewer.container.parentNode;\n\n        // re-get previously revoked image urls\n        resetImageBlobUrls(this.viewer.container);\n\n        // Move viewer dom into new container\n        container.appendChild(this.viewer.container);\n\n        // Change viewers window\n        this.setWindow(child);\n      }\n    }\n\n    /**\n       * Moves the viewer back to the main window\n       *\n       * @private\n       */ }, { key: \"_moveViewerBack\", value: function _moveViewerBack()\n    {\n      if (!this._isPoppedOut()) {\n        avp.logger.info('Not popped out');\n        return;\n      }\n\n      // re-get previously revoked image urls\n      resetImageBlobUrls(this.viewer.container);\n\n      // Move viewer element from popout back into main window\n      this._viewerParentNode.appendChild(this.viewer.container);\n\n      // change viewers window from popout to main\n      this.setWindow(av.getGlobal());\n\n      // bring viewer back to original size\n      this.viewer.resize();\n    }\n\n    /**\n       * Returns true if viewer has been moved to a child window\n       *\n       * @private\n       */ }, { key: \"_isPoppedOut\", value: function _isPoppedOut()\n    {\n      return this.getWindow().opener === av.getGlobal();\n    } }]);return PopoutExtension;}(av.Extension);export { PopoutExtension as default };\n\n\nav.theExtensionManager.registerExtension('Autodesk.Viewing.Popout', PopoutExtension);","function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError(\"Cannot call a class as a function\");}}function _defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}function _createClass(Constructor, protoProps, staticProps) {if (protoProps) _defineProperties(Constructor.prototype, protoProps);if (staticProps) _defineProperties(Constructor, staticProps);return Constructor;}function ownKeys(object, enumerableOnly) {var keys = Object.keys(object);if (Object.getOwnPropertySymbols) {var symbols = Object.getOwnPropertySymbols(object);if (enumerableOnly) symbols = symbols.filter(function (sym) {return Object.getOwnPropertyDescriptor(object, sym).enumerable;});keys.push.apply(keys, symbols);}return keys;}function _objectSpread(target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i] != null ? arguments[i] : {};if (i % 2) {ownKeys(Object(source), true).forEach(function (key) {_defineProperty(target, key, source[key]);});} else if (Object.getOwnPropertyDescriptors) {Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));} else {ownKeys(Object(source)).forEach(function (key) {Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));});}}return target;}function _defineProperty(obj, key, value) {if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;}\n// MIT License\n\n// Copyright (c) Microsoft Corporation. All rights reserved.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE\n\n\n/**\n * This is a modified version of poput source code without react dependency\n * from https://github.com/microsoft/react-popout-component\n */\n\n\nvar av = Autodesk.Viewing;\nvar _window = av.getGlobal();\n\n/**\n                               * Generates feature string for window open\n                               */\nfunction generateWindowFeaturesString(optionsProp) {\n  var valueOf = function valueOf(val) {\n    if (typeof val === 'boolean') {\n      return val ? '1' : '0';\n    } else if (val) {\n      return String(val);\n    }\n  };\n\n  var options = {\n    left: 0,\n    top: 0,\n    height: 600,\n    width: 800,\n    location: false,\n    menubar: false,\n    resizable: false,\n    scrollbars: false,\n    status: false,\n    toolbar: false };\n\n\n  // merge options\n  options = _objectSpread(_objectSpread({}, options), optionsProp);\n\n  return Object.getOwnPropertyNames(options).\n  map(function (key) {return \"\".concat(key, \"=\").concat(valueOf(options[key]));}).\n  join(',');\n}\n\nfunction crossBrowserCloneNode(element, targetDocument) {\n  var cloned = targetDocument.createElement(element.tagName);\n  cloned.innerHTML = element.innerHTML;\n\n  if (element.hasAttributes()) {\n    var attribute;\n    for (var i = 0; i < element.attributes.length; i++) {\n      attribute = element.attributes[i];\n      cloned.setAttribute(attribute.name, attribute.value);\n    }\n  }\n\n  return cloned;\n}\n\nvar globalContext = {\n  id: '__$$VIEWER_POPOUT_COMPONENT$$__',\n\n  set: function set(key, value) {\n    _window[this.id] = _window[this.id] || {};\n    _window[this.id][key] = value;\n  },\n\n  get: function get(key) {\n    return _window[this.id] && _window[this.id][key];\n  } };\n\n\nvar popouts = {};\n\nvar monitors = {};\n\nvar delay = 250;\n\nfunction start(id /*: string*/) {\n  var monitor = function monitor() {\n    if (popouts[id] && popouts[id].props.onClose) {\n      if (!popouts[id].child || popouts[id].child.closed) {\n        stop(id);\n        popouts[id].props.onClose();\n        popouts[id].child = null;\n      } else {\n        monitors[id] = setTimeout(monitor, delay);\n      }\n    }\n  };\n\n  monitors[id] = setTimeout(monitor, delay);\n}\n\nfunction stop(id /*: string*/) {\n  if (monitors[id]) {\n    clearTimeout(monitors[id]);\n    delete monitors[id];\n  }\n}\n\nglobalContext.set('startMonitor', start);\n\n/** Added by LMV */\nglobalContext.set('dispose', function dispose(id) {\n  delete popouts[id];\n});\n\nfunction validateUrl(url /*: string*/) {\n  if (!url) {\n    return;\n  }\n\n  var parser = document.createElement('a');\n  parser.href = url;\n\n  var current = _window.location;\n\n  if (\n  parser.hostname && current.hostname != parser.hostname ||\n  parser.protocol && current.protocol != parser.protocol)\n  {\n    throw new Error(\"react-popup-component error: cross origin URLs are not supported (window=\".concat(\n\n    current.protocol, \"//\").concat(\n    current.hostname, \"; popout=\").concat(parser.protocol, \"//\").concat(parser.hostname, \")\"));\n\n  }\n}\n\nfunction validatePopupBlocker(child /*: Window*/) {\n  if (!child || child.closed || typeof child == 'undefined' || typeof child.closed == 'undefined') {\n    return null;\n  }\n\n  return child;\n}\n\nfunction isChildWindowOpened(child /*: Window | null*/) {\n  return child && !child.closed;\n}\n\nfunction getWindowName(name /*: string*/) {\n  return (\n    name ||\n    Math.random().\n    toString(12).\n    slice(2));\n\n}\n\nfunction forEachStyleElement(\nnodeList /*: NodeList*/,\ncallback /*: (element: HTMLElement, index?: number) => void*/,\nscope /*?: any*/)\n{\n  var element /*: HTMLElement*/;\n\n  for (var i = 0; i < nodeList.length; i++) {\n    element = nodeList[i] /* as HTMLElement*/;\n    if (element.tagName == 'STYLE') {\n      callback.call(scope, element, i);\n    }\n  }\n}\n\nfunction isBrowserIEOrEdge() {\n  var userAgent = typeof navigator != 'undefined' && navigator.userAgent ? navigator.userAgent : '';\n  return /Edge/.test(userAgent) || /Trident/.test(userAgent);\n}var\n\nPopout = /*#__PURE__*/function () {\n  function Popout(props) {_classCallCheck(this, Popout);\n    this.container = null;\n    this.setupAttempts = 0;\n    this.styleElement = null;\n    this.child = null;\n\n    /* props\n                       {\n                       html,\n                       url,\n                       options,\n                       name,\n                       onBlocked,\n                           hidden\n                       }\n                       */\n    this.props = props;\n    this.styleCount = 0;\n  }_createClass(Popout, [{ key: \"setupOnCloseHandler\", value: function setupOnCloseHandler(\n\n    id /*: string*/, child /*: Window*/) {var _this = this;\n      // For Edge, IE browsers, the document.head might not exist here yet. We will just simply attempt again when RAF is called\n      // For Firefox, on the setTimeout, the child window might actually be set to null after the first attempt if there is a popup blocker\n      if (this.setupAttempts >= 5) {\n        return;\n      }\n\n      if (child && child.document && child.document.head) {\n        var unloadScriptContainer = child.document.createElement('script');\n        var onBeforeUnloadLogic = \"\\n            window.onbeforeunload = function(e) {\\n                var result = window.opener.\".concat(\n\n        globalContext.id, \".onBeforeUnload.call(window, '\").concat(id, \"', e);\\n\\n                if (result) {\\n                    window.opener.\").concat(\n\n\n        globalContext.id, \".startMonitor.call(window.opener, '\").concat(id, \"');\\n\\n                    e.returnValue = result;\\n                    return result;\\n                } else {\\n                    window.opener.\").concat(\n\n\n\n\n        globalContext.id, \".onChildClose.call(window.opener, '\").concat(id, \"');\\n                }\\n\\n                // Added by LMV - free memory\\n                window.opener.\").concat(\n\n\n\n        globalContext.id, \".dispose.call(window.opener, '\").concat(id, \"');\\n            }\");\n\n\n        // Use onload for most URL scenarios to allow time for the page to load first\n        // Safari 11.1 is aggressive, so it will call onbeforeunload prior to the page being created.\n        unloadScriptContainer.innerHTML = \"\\n            window.onload = function(e) {\\n                \".concat(\n\n        onBeforeUnloadLogic, \"\\n            };\\n            \");\n\n\n\n        // For edge and IE, they don't actually execute the onload logic, so we just want the onBeforeUnload logic.\n        // If this isn't a URL scenario, we have to bind onBeforeUnload directly too.\n        if (isBrowserIEOrEdge() || !this.props.url) {\n          unloadScriptContainer.innerHTML = onBeforeUnloadLogic;\n        }\n\n        child.document.head.appendChild(unloadScriptContainer);\n\n        this.setupCleanupCallbacks();\n      } else {\n        this.setupAttempts++;\n        setTimeout(function () {return _this.setupOnCloseHandler(id, child);}, 50);\n      }\n    } }, { key: \"setupCleanupCallbacks\", value: function setupCleanupCallbacks()\n\n    {var _this2 = this;\n      // Close the popout if main window is closed.\n      window.addEventListener('unload', function (e) {return _this2.closeChildWindowIfOpened();});\n\n      globalContext.set('onChildClose', function (id /*: string*/) {\n        if (popouts[id] && popouts[id].props.onClose) {\n          popouts[id].props.onClose();\n        }\n      });\n\n      globalContext.set('onBeforeUnload', function (id /*: string*/, evt /*: BeforeUnloadEvent*/) {\n        if (popouts[id] && popouts[id].props.onBeforeUnload) {\n          return popouts[id].props.onBeforeUnload(evt);\n        }\n      });\n    } }, { key: \"setupStyleElement\", value: function setupStyleElement(\n\n    child /*: Window*/) {\n      this.styleElement = child.document.createElement('style');\n      this.styleElement.setAttribute('data-this-styles', 'true');\n      this.styleElement.type = 'text/css';\n\n      child.document.head.appendChild(this.styleElement);\n    } }, { key: \"injectHtml\", value: function injectHtml(\n\n    id /*: string*/, child /*: Window*/) {\n      var container /*: HTMLDivElement*/;\n\n      if (this.props.html) {\n        child.document.write(this.props.html);\n        this.copyStyles(child);\n        container = child.document.getElementById(id);\n        if (!container) {\n          container = child.document.createElement('div');\n          container.id = id;\n          child.document.body.appendChild(container);\n        }\n      } else {\n        var childHtml = '<!DOCTYPE html><html><head>';\n        for (var i = window.document.styleSheets.length - 1; i >= 0; i--) {\n          var styleSheet = window.document.styleSheets[i]; /* as CSSStyleSheet*/\n          try {\n            var cssText = styleSheet.cssText;\n            childHtml += \"<style>\".concat(cssText, \"</style>\");\n          } catch (_unused) {\n            // IE11 will throw a security exception sometimes when accessing cssText.\n            // There's no good way to detect this, so we capture the exception instead.\n          }\n        }\n        childHtml += \"</head><body><div id=\\\"\".concat(id, \"\\\"></div></body></html>\");\n        child.document.write(childHtml);\n        container = child.document.getElementById(id) /*! as HTMLDivElement*/;\n      }\n\n      // Create a document with the styles of the parent window first\n      this.setupStyleElement(child);\n\n      return container;\n    }\n\n    /** Added by LMV */ }, { key: \"copyStyles\", value: function copyStyles(\n    child) {\n      var head = child.document.head;\n\n      var cssText = '';\n      var rules = null;\n\n      for (var i = _window.document.styleSheets.length - 1; i >= 0; i--) {\n        var styleSheet = _window.document.styleSheets[i]; /* as CSSStyleSheet*/\n        try {\n          rules = styleSheet.cssRules;\n        } catch (_unused2) {\n          // We're primarily looking for a security exception here.\n          // See https://bugs.chromium.org/p/chromium/issues/detail?id=775525\n          // Try to just embed the style element instead.\n          var styleElement = child.document.createElement('link');\n          styleElement.type = styleSheet.type;\n          styleElement.rel = 'stylesheet';\n          styleElement.href = styleSheet.href;\n          head.appendChild(styleElement);\n        } finally {\n          if (rules) {\n            for (var j = 0; j < rules.length; j++) {\n              try {\n                cssText += rules[j].cssText;\n              } catch (_unused3) {\n                // IE11 will throw a security exception sometimes when accessing cssText.\n                // There's no good way to detect this, so we capture the exception instead.\n              }\n            }\n          }\n        }\n\n        rules = null;\n      }\n\n      var style = child.document.createElement('style');\n      style.innerHTML = cssText;\n\n      head.appendChild(style);\n    } }, { key: \"setupStyleObserver\", value: function setupStyleObserver(\n\n    child /*: Window*/) {\n      // Add style observer for legacy style node additions\n      var observer = new MutationObserver(function (mutations) {\n        mutations.forEach(function (mutation) {\n          if (mutation.type == 'childList') {\n            forEachStyleElement(mutation.addedNodes, function (element) {\n              child.document.head.appendChild(crossBrowserCloneNode(element, child.document));\n            });\n          }\n        });\n      });\n\n      var config = { childList: true };\n\n      observer.observe(document.head, config);\n    } }, { key: \"initializeChildWindow\", value: function initializeChildWindow(\n\n    id /*: string*/, child /*: Window*/) {\n      popouts[id] = this;\n\n      if (!this.props.url) {\n        var container /*: HTMLDivElement*/ = this.injectHtml(id, child);\n        this.setupStyleObserver(child);\n        this.setupOnCloseHandler(id, child);\n        return container;\n      } else {\n        this.setupOnCloseHandler(id, child);\n\n        return null;\n      }\n    }\n\n    /** Added by LMV */ }, { key: \"setupChild\", value: function setupChild(\n    element, child, setupStyleObserver) {\n      this.child = child;\n      this.container = element;\n      popouts[element.id] = this;\n\n      setupStyleObserver && this.setupStyleObserver(child);\n      this.setupOnCloseHandler(element.id, child);\n    } }, { key: \"openChildWindow\", value: function openChildWindow()\n\n    {\n      var options = generateWindowFeaturesString(this.props.options || {});\n\n      var name = getWindowName(this.props.name);\n\n      this.child = validatePopupBlocker(window.open(this.props.url || 'about:blank', name, options));\n\n      if (!this.child) {\n        if (this.props.onBlocked) {\n          this.props.onBlocked();\n        }\n        this.container = null;\n      } else {\n        var id = \"__\".concat(name, \"_container__\");\n        this.container = this.initializeChildWindow(id, this.child);\n      }\n    } }, { key: \"closeChildWindowIfOpened\", value: function closeChildWindowIfOpened()\n\n    {\n      if (isChildWindowOpened(this.child)) {\n        this.child.close();\n\n        // sometimes having the popup's dev console \n        // open may not close the popup\n        // calling close again should close it\n        this.child.close();\n\n        this.child = null;\n        if (this.props.onClose) {\n          this.props.onClose();\n        }\n      }\n    } }, { key: \"renderChildWindow\", value: function renderChildWindow()\n\n    {\n      validateUrl(this.props.url);\n\n      if (!this.props.hidden) {\n        if (!isChildWindowOpened(this.child)) {\n          this.openChildWindow();\n        }\n      } else {\n        this.closeChildWindowIfOpened();\n      }\n    } }]);return Popout;}();\n\n\n\n/** Added by LMV */\nfunction canvasFromImage(img) {\n  var canvas = img.ownerDocument.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  var ctx = canvas.getContext('2d');\n  ctx.drawImage(img, 0, 0);\n\n  return canvas;\n}\n\n/** Added by LMV */\nfunction resetImageBlobUrls(el) {\n\n  // all img descendants of el\n  var images = el.querySelectorAll('img');var _loop = function _loop(\n  i) {\n\n    var img = images[i];\n\n    // Skip non-blobs\n    if (img.src.indexOf('blob:') !== 0) {\n      return \"continue\";\n    }\n\n    img.onload = function () {\n      URL.revokeObjectURL(img.src);\n    };\n\n    // createObjectURLs from images\n    var canvas = canvasFromImage(img);\n    canvas.toBlob(function (blob) {\n      var url = URL.createObjectURL(blob);\n      img.src = url;\n    }, 'image/png');\n\n    // so we don't see console errors if image src contains\n    // previously revoked url\n    img.src = '';};for (var i = 0; i < images.length; ++i) {var _ret = _loop(i);if (_ret === \"continue\") continue;\n\n  }\n\n}\n\nexport { Popout, resetImageBlobUrls };"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtPA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}