{"version":3,"sources":["webpack://Autodesk.Extensions.[name]/webpack/bootstrap","webpack://Autodesk.Extensions.[name]/./node_modules/css-loader/lib/css-base.js","webpack://Autodesk.Extensions.[name]/./node_modules/style-loader/lib/addStyles.js","webpack://Autodesk.Extensions.[name]/./node_modules/style-loader/lib/urls.js","webpack://Autodesk.Extensions.[name]/./node_modules/resize-observer-polyfill/dist/ResizeObserver.es.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/Markups.css?b962","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/Markups.css","webpack://Autodesk.Extensions.[name]/./extensions/Markup/gui/MarkupsGui.css?e525","webpack://Autodesk.Extensions.[name]/./extensions/Markup/gui/MarkupsGui.css","webpack://Autodesk.Extensions.[name]/(webpack)/buildin/global.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupTypes.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/EditAction.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/StyleUtils.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupEvents.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/Markup.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetStyle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditMode.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateArrow.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateRectangle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetSize.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditorTextAutosize.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/DomElementStyle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditorTextInput.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteCallout.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateText.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateCircle.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateCloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupPen.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModePen.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateFreehand.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeletePolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetPolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModePolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupPolyLine.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreatePolyline.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeletePolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetPolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModePolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupPolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreatePolycloud.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateHighlight.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateDimension.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/DeleteStamp.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetStamp.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/EditModeStamp.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupStamp.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CreateStamp.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupsCoreUtils.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/EditActionGroup.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/EditActionManager.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/CloneMarkup.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-clipboard/Clipboard.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-input/InputHandler.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetPosition.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-actions/SetRotation.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/EditFrame.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupTool.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/EditModeManager.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/edit-modes/BuiltinEditModes.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/core/MarkupsCore.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/gui/MarkupsGui.js","webpack://Autodesk.Extensions.[name]/./extensions/Markup/Markup.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","useSourceMap","list","toString","this","map","item","content","cssMapping","btoa","sourceMapping","sourceMap","unescape","encodeURIComponent","JSON","stringify","sourceURLs","sources","source","sourceRoot","concat","join","cssWithMappingToString","mediaQuery","alreadyImportedModules","length","id","push","fn","memo","stylesInDom","isOldIE","window","document","all","atob","apply","arguments","getTarget","target","parent","querySelector","getElement","styleTarget","HTMLIFrameElement","contentDocument","head","e","singleton","singletonCounter","stylesInsertedAtTop","fixUrls","addStylesToDom","styles","options","domStyle","refs","j","parts","addStyle","listToStyles","newStyles","base","part","css","media","insertStyleElement","style","insertInto","Error","lastStyleElementInsertedAtTop","insertAt","nextSibling","insertBefore","appendChild","firstChild","before","removeStyleElement","parentNode","removeChild","idx","indexOf","splice","createStyleElement","createElement","undefined","attrs","type","nonce","getNonce","addAttrs","el","keys","forEach","setAttribute","obj","update","remove","result","transform","default","styleIndex","applyToSingletonTag","URL","createObjectURL","revokeObjectURL","Blob","link","rel","createLinkElement","updateLink","href","applyToTag","newObj","DEBUG","newList","mayRemove","textStore","replaceText","index","replacement","filter","Boolean","styleSheet","cssText","cssNode","createTextNode","childNodes","autoFixUrls","convertToAbsoluteUrls","blob","oldSrc","location","baseUrl","protocol","host","currentDir","pathname","replace","fullMatch","origUrl","newUrl","unquotedOrigUrl","trim","$1","test","MapShim","Map","getIndex","arr","some","entry","class_1","__entries__","configurable","set","delete","entries","has","clear","callback","ctx","_i","_a","isBrowser","global$1","global","Math","self","Function","requestAnimationFrame$1","requestAnimationFrame","setTimeout","Date","now","transitionKeys","mutationObserverSupported","MutationObserver","ResizeObserverController","connected_","mutationEventsAdded_","mutationsObserver_","observers_","onTransitionEnd_","refresh","delay","leadingCall","trailingCall","lastCallTime","resolvePending","proxy","timeoutCallback","timeStamp","throttle","addObserver","observer","connect_","removeObserver","observers","disconnect_","updateObservers_","activeObservers","gatherActive","hasActive","broadcastActive","addEventListener","observe","attributes","childList","characterData","subtree","removeEventListener","disconnect","_b","propertyName","getInstance","instance_","defineConfigurable","props","writable","getWindowOf","ownerDocument","defaultView","emptyRect","createRectInit","toFloat","parseFloat","getBordersSize","positions","reduce","size","position","getHTMLElementContentRect","clientWidth","clientHeight","getComputedStyle","paddings","positions_1","getPaddings","horizPad","left","right","vertPad","top","bottom","width","height","boxSizing","round","documentElement","isDocumentElement","vertScrollbar","horizScrollbar","abs","isSVGGraphicsElement","SVGGraphicsElement","SVGElement","getBBox","getContentRect","bbox","getSVGContentRect","x","y","ResizeObservation","broadcastWidth","broadcastHeight","contentRect_","isActive","rect","broadcastRect","ResizeObserverEntry","rectInit","Constr","contentRect","DOMRectReadOnly","ResizeObserverSPI","controller","callbackCtx","activeObservations_","observations_","TypeError","callback_","controller_","callbackCtx_","Element","observations","unobserve","clearActive","_this","observation","WeakMap","ResizeObserver","method","locals","g","MARKUP_TYPE_ARROW","MARKUP_TYPE_TEXT","MARKUP_TYPE_RECTANGLE","MARKUP_TYPE_CIRCLE","MARKUP_TYPE_CLOUD","MARKUP_TYPE_FREEHAND","MARKUP_TYPE_HIGHLIGHT","MARKUP_TYPE_POLYLINE","MARKUP_TYPE_POLYCLOUD","MARKUP_TYPE_CALLOUT","MARKUP_TYPE_DIMENSION","MARKUP_TYPE_STAMP","EditAction","editor","targetId","addToHistory","selectOnExecution","execute","actionManager","redo","undo","merge","action","isIdentity","createStyle","defaults","getStyleDefaultValues","attribute","values","copyStyle","destination","isStyleEqual","cloneStyle","clone","getFontSizes","normalWidth","getOpacities","defaultTransparent","normaStrokeWidth","getStrokeWidth","normaFontWidth","getFontWidth","EVENT_EDITMODE_CHANGED","EVENT_EDITMODE_ENTER","EVENT_EDITMODE_LEAVE","EVENT_MARKUP_SELECTED","EVENT_MARKUP_DRAGGING","EVENT_MARKUP_ENTER_EDITION","EVENT_MARKUP_CANCEL_EDITION","EVENT_MARKUP_DELETE_EDITION","EVENT_HISTORY_CHANGED","EVENT_EDITMODE_CREATION_BEGIN","EVENT_EDITMODE_CREATION_END","EVENT_MARKUP_DESELECT","EVENT_EDITFRAME_EDITION_START","EVENT_EDITFRAME_EDITION_END","av","Autodesk","Viewing","Markup","styleAttributes","viewer","setGlobalManager","globalManager","rotation","getDefaultStyle","highlightColor","constraintWidth","constraintHeight","constraintRotation","minWidth","minHeight","highlighted","selected","checkLineSegment","checkPolygon","renderToCanvasX","renderToCanvas","addTraitEventDispatcher","GlobalManagerMixin","proto","SetStyle","markup","newStyle","oldStyle","getStyle","destroy","unselect","setParent","div","shape","__proto__","overrides","getCloneOverrides","member","nodeType","cloneNode","GlobalManager","parse","cloneShape","hitarea","bindDomEvents","hammer","listeners","select","updateStyle","dispatchEvent","MarkupEvents","highlight","interactionsDisabled","setStyle","edit","cancel","deleteMarkup","getEditMode","console","warn","getClientPosition","positionFromMarkupsToClient","getClientSize","sizeFromMarkupsToClient","getBoundingRect","setRotation","parentRect","impl","getCanvasBoundingClientRect","boundRect","getBoundingClientRect","strokeWidth","offset","angle","getRotation","setPosition","setSize","isWidthConstrained","isHeightConstrained","isRotationConstrained","setMinWidth","setMinHeight","getMinWidth","getMinHeight","disableInteractions","disable","setStrokeWidth","constrainsToBounds","bounds","onMouseDown","event","editFrame","startDrag","generatePoint3d","idTarget","polygon","generateBoundingPolygon","checkLineSegmentAux","a","b","point2d","point3d","clientToWorld","point","xVertices","yVertices","midAB","THREE","Vector2","multiplyScalar","midAC","midDB","midDC","center","add","checkPolygonAux","generateBoundingBox","boundingBox","min","max","vertexCount","bbX0","Number","POSITIVE_INFINITY","bbY0","bbX1","NEGATIVE_INFINITY","bbY1","bbX","bbY","halfSize","lt","Vector3","rt","rb","lb","m1","Matrix4","makeTranslation","m2","makeRotationZ","multiply","applyMatrix4","Float32Array","setMetadata","setMouseDisabledWhenTouching","isFirst","onMouseDownBinded","isFinal","isTouchDevice","Hammer","Manager","recognizers","GestureRecognizers","singletap","handlePointerEventMouse","inputClass","isIE11","PointerEventInput","TouchInput","onSingleTapBinded","onHammerInputBinded","on","onMouseOutBinded","onMouseOverBinded","viewBox","getPath","getTransform","radiansToDegrees","constructor","EditMode","selectedMarkup","dragging","draggingAnnotationIniPosition","draggingMouseIniPosition","initialX","initialY","minSize","creating","CREATION_METHOD_DRAG","CREATION_METHOD_CLICK","CREATION_METHOD_CLICKS","creationMethod","getMarkup","DeleteArrow","arrow","createArrow","CreateArrow","tail","removeTraitEventDispatcher","fireEv","selectedId","setMarkup","markupId","creationBegin","creationEnd","isCancelling","isMinSizeValid","creationCancel","finishDragging","closeActionGroup","creationCancelled","cancelActionGroup","setSelection","bringToFront","isTextInputHelperActive","textInputHelper","setEditFrame","getSelection","cantUndo","tmp","startDragging","mousePosition","getMousePosition","getFinalMouseDraggingPosition","getBounds","finalX","finalY","input","makeSameXY","dx","dy","maxDelta","sign","notifyAllowNavigation","allows","onMouseMove","onMouseUp","onMouseDoubleClick","onSave","getDraggingPosition","isInsideBounds","useWithSnapping","model","is2d","SetArrow","newHead","newTail","oldHead","oldTail","applyState","MeasureCommon","EditModeArrow","MarkupTypes","MarkupArrow","addMarkupMetadata","createMarkupPathSvg","deleteArrow","lineSnapped","snapper","geomType","getGeometryType","SnapType","SNAP_VERTEX","SNAP_EDGE","SNAP_MIDPOINT","SNAP_CIRCLE_CENTER","getEdge","arrowMinSize","positionFromClientToMarkups","cos","PI","sin","constrain","beginActionGroup","arrowVector","lengthSq","normalize","arrowId","getId","final","isSnapped","start","project","vertices","end","z","parallel","nearestPointInPointToLine","k","pEnd","pStart","perpendicular","distanceTo","sizeFromClientToMarkups","xO","yO","xF","yF","vO","vF","vDir","sub","acos","dot","vFDir","vCenter","strokeColor","composeRGBAString","setAttributeToMarkupSvg","updateMarkupPathSvgHitarea","xo","yo","direction","metadata","String","sizeX","sizeY","sizeYOver3","tailW","headW","spikeOffset","addMarkup","removeMarkup","DeleteRectangle","rectangle","createRectangle","CreateRectangle","SetRectangle","newPosition","newSize","oldPosition","oldSize","EditModeRectangle","MarkupRectangle","deleteRectangle","pos","clientToMarkups","firstCorner","startZ","atan2","path","fillColor","w","h","createRectanglePath","DeleteText","text","createText","CreateText","getText","SetCallout","isFrameUsed","newText","oldText","newIsFrameUsed","oldIsFrameUsed","SetSize","newWidth","oldWidth","newHeight","oldHeight","callout","createEvent","Event","bubbles","evt","getGlobal","initEvent","assign","ta","nodeName","heightOffset","cachedHeight","pageResize","removeWindowEventListener","resize","overflow","overflowX","wordWrap","addWindowEventListener","getWindow","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","isNaN","init","changeOverflow","offsetWidth","originalHeight","overflows","scrollTop","node","getParentOverflows","_document","getDocument","docTop","endHeight","scrollHeight","_window","styleHeight","computed","actualHeight","offsetHeight","err","methods","RUNTIME_SUPPORTED","autosize","Array","DomElementStyle","reset","BROWSER_PREFIXES","EditorTextInput","parentDiv","singleLine","defaultText","maxLength","EVENT_TEXT_CHANGE","EVENT_TEXT_SET_ACTIVE","EVENT_TEXT_SET_INACTIVE","textArea","rows","dir","firstEdit","startingHeight","styleTextArea","measureDiv","dirty","styleString","allBrowsers","that","prefix","removeAttribute","isArray","getStyleString","elements","val","generateStyle","trimRight","lastNonSpace","charAt","substr","trimLeft","firstNonSpace","setInactive","setActive","textMarkup","placeholderText","i18n","translate","constrainToCanvas","initFromMarkup","isIOSDevice","txtArea","focus","dataBag","data","blur","onResizeBinded","frameWidth","frameHeight","xPos","yPos","updateStyleFirst","padding","getClientFontSize","lineHeightPercentage","lineHeight","setPosAndSize","container","temp","injectSizeValues","newPos","fontHeight","textAreaStyle","getTextValuesForMarkup","sizeUpdateRequired","active","activeMarkup","activeFirstEdit","textValues","getTextValues","lines","generateLines","acceptAndExit","newLines","ox","oy","onCameraChanged","str","linesBreaks","split","styleMeasureStr","maxLineLength","linesOutput","len","line","splitLine","output","remaining","done","innerText","getShorterLine","splitWord","iLastSpace","lastIndexOf","trailingWord","word","lenSoFar","okayWord","extraWord","EditModeCallout","helper","onHelperTextChange","onHelperSetActive","onHistoryChangeBinded","onHistoryChange","deleteCallout","DeleteCallout","clientFontSize","initialWidth","initialHeight","createCallout","CreateCallout","selectMarkup","databag","setIsHelperTextActive","setIsShapeVisible","textStyle","curSelection","updateTextBoxStyle","FONT_SIZE_SCALE","MarkupCallout","createSvgElement","textShape","createMarkupTextSvg","rectShape","createMarkupGroupSvg","currentText","currentTextLines","prevHighlight","isHelperTextActive","textString","setIsFilledFrameUsed","setText","stylesEqual","getTextLines","highlightChanged","editMode","duringEditMode","fontSize","fontFamily","fontWeight","fontStyle","rebuildTextSvg","textContainerTransform","getTextContainerTransform","textTransform","getTextTransform","setMarkupTextSvgTransform","updateMarkupTextSvgClipper","updateMarkupTextSvgHitarea","textHelperValues","yOffset","getLineHeight","tspan","textContent","hasRectShape","setIsFilledFrameVisible","isVisible","display","isframeused","margin","EDIT_FRAME_DEFAULT_MARGIN","SetText","EditModeText","deleteText","MarkupText","textDirty","textSize","updateMarkupTextSvgBackground","DeleteCircle","circle","createCircle","CreateCircle","SetCircle","EditModeCircle","MarkupCircle","deleteCircle","firstPosition","ellipseW","ellipseH","createEllipsePath","DeleteCloud","cloud","createCloud","CreateCloud","SetCloud","EditModeCloud","newStrokeWidth","newColor","oldStrokeWidth","oldColor","MarkupCloud","deleteCloud","radius","createArcTo","xRadius","yRadius","createCorner","corner","getSideParameters","x1","x2","diameter","count","xValueInset","yValueOffset","p1","p2","p3","hSidesParameters","vSidesParameters","cornerSizeX","cornerSizeY","cornerRadiusX","cornerRadiusY","halfStrokeWidth","sp","createTSide","createRSide","createBSide","createLSide","MarkupPen","EditModePen","smoothen","bufferSize","locations","isAbsoluteCoords","updatePath","slice","locationsCount","scaleX","scaleY","toFixed","locationA","locationB","DeleteFreehand","freehand","createFreehand","CreateFreehand","deletePen","movements","appendToBuffer","amendPath","lastX","lastY","removeFromAbsolutePath","addToAbsolutePath","setPen","absolutePath","clearSnapped","buffer","movementsLastIndex","createPen","createAbsolutePath","cameraWidth","camera","cameraHeight","xs","simplify","ys","error","absolutePathIndexes","numToRemove","points","shift","getAveragePoint","tmpBuffer","pt","totalX","totalY","SetFreehand","EditModeFreehand","MarkupFreehand","DeletePolyline","polyline","createPolyline","CreatePolyline","closed","SetPolyline","EditModePolyline","setPositionAndSize","minFn","collection","targets","maxFn","MarkupPolyline","deletePolyline","pop","lastIndex","lastMove","areMarkupsPointsInClientRange","DeletePolycloud","polycloud","createPolycloud","CreatePolycloud","SetPolycloud","EditModePolycloud","MarkupPolycloud","deletePolycloud","updateCorners","side","cornerA","cornerB","orientation","rA","rB","D","pointA","pointB","delta","sqrt","xS","xT","yS","yT","y1","y2","intersec","cross","vecAB","createSidePath","bodyCount","bodyRadius","bodyDiameter","createCornerPath","first","large","fstPoint","sndPoint","pointC","getOrientation","sides","sidesCount","vecBA","getSides","corners","sideA","sideB","getCorners","cornersCount","bodyA","bodyB","body","updateSides","DeleteHighlight","createHighlight","CreateHighlight","SetHighlight","EditModeHighlight","MarkupHighlight","DeleteDimension","dimension","createDimension","CreateDimension","secondAnchor","firstAnchor","SetDimension","newFirstAnchor","newSecondAnchor","oldFirstAnchor","oldSecondAnchor","_cursorPosition","EditModeDimension","measurement","Measurement","MeasurementTypes","MEASUREMENT_DISTANCE","measureExt","getExtension","abortDimensionMarkup","cancelEditModeChange","enterEditMode","sharedMeasureConfig","forceCalibrate","isLeaflet","isPdf","calibrationTool","isCalibrated","openCalibrationRequiredDialog","deleteDimension","updateTextBox","updateViewportId","getDistance","computeResult","picks","distanceXYZ","Private","convertUnits","getUnitString","units","calibrationFactor","formatValueWithUnits","precision","updateMeasurement","measurementNumber","pick","getPick","geomVertex","intersectPoint","copyResults","viewportId","setViewportId","pickFirstAnchor","clearAllPicks","dimensionId","viewportIndex2d","pickSecondAnchor","mouseDown","correctPerpendicularPicks","getSnapResultPosition","indicator","render","isRightClick","navigation","inverseProject","constrainAxis","isVisibleChar","keyCode","measureTextLine","RegExp","initialText","measureTextLines","handleKeyDown","KeyCode","ENTER","BACKSPACE","substring","handleKeyDownBinded","getTextAreaTransform","shouldFlip","MarkupDimension","preventReposition","degreesToRadians","lineSize","edgeH","textOffset","backgroundTransform","inverse","flip","segmentLength","DeleteStamp","stamp","createStamp","CreateStamp","SetStamp","EditModeStamp","svgData","deleteStamp","MarkupStamp","createShapeGroup","scriptSvgData","loadSvgData","group","svgString","svgNode","stringToSvgNode","getDimensions","innerHTML","getAttribute","styleChanged","customSvg","vb","strings","parseInt","avp","_gWindow","_gDocument","MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS","MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS","MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS","createElementNS","setSvgParentAttributes","svg","children","hitareaMargin","markupFill","markupStroke","strokeEnabled","fillEnabled","navigating","clipperId","getUniqueID","clipperUrl","clipper","background","clippedArea","color","addSvgMetadata","metadataNode","dataVersionNode","markupNode","removeAllMetadata","getElementsByTagName","nodes","svgChildren","transferChildNodes","nodeFrom","nodeInto","tmpArray","generateUUID","svgNodeToString","domNode","hitareas","removeHitareas","hitareaParent","childrenCount","XMLSerializer","serializeToString","hitareasCount","addHitareas","stringNode","DOMParser","parseFromString","client","listener","hasEventListener","li","typeListeners","worldToClient","snap","worldToViewport","viewportToClient","floor","clientX","clientY","depth","clientToViewport","unproject","viewportX","viewportY","metersToModel","meters","getUnitScale","radians","degrees","range","hideLmvUi","toolbar","setActiveNavigationTool","dismissLmvHudMessage","hideLmvPanels","hideLmvToolsAndPanels","restoreLmvUi","showLmvToolsAndPanels","hide","dockingPanels","panel","panelContainer","classList","contains","visibilityChanged","ext","displayViewCube","displayHomeButton","anim","getElementsByClassName","viewerContainer","viewerContainerChildrenCount","animator","keyFrameAnimator","isPaused","pauseCameraAnimations","pause","playButton","modelTools","getControl","setIcon","setToolTip","keepDismissing","HudMessage","dismiss","ignore","widthInPixels","createMarkupFromSVG","child","meta","isClosed","toLowerCase","getLocations","locStr","pointPair","getAttributeVector","posVec","strPos","getPosition","getSize","strRot","createMarkup","logger","getCurrentStyle","MarkupType","markupList","svgLayersMap","activeLayer","markups","hexRGBString","opacity","x0","y0","deviceRatio","devicePixelRatio","idTargetWidth","idTargetHeight","idTargetBuffer","check","verxtexCount","from","isInsidePolygon","bbW","bbH","endX","endY","createStyleSheet","sheet","addRuleToStyleSheet","selector","insertRule","addRule","measureStyle","measure","linesCount","relative","halfW","halfH","tmpSvg","markupGroup","img","Image","onload","drawImage","src","tolerance","highestQuality","getSqSegDist","sqTolerance","last","simplified","simplifyDPStep","maxSqDist","sqDist","simplifyDouglasPeucker","prevPoint","newPoints","simplifyRadialDist","EditActionGroup","actions","EditActionManager","historySize","undoStack","redoStack","open","close","actionsCount","isOpen","isEmpty","addAction","compact","actionA","actionB","getTargetId","CloneMarkup","getEditActionGroup","undoStackCount","isUndoStackEmpty","isRedoStackEmpty","getLastElementInUndoStack","Clipboard","pastePosition","copy","cut","paste","_mouseEnabled","_mousePrevValue","_lock","InputHandler","snapRotations","keepAspectRatio","onWheelBinded","onWheel","onTouchDragBinded","onTouchDrag","onTouchPanBinded","onTouchPan","onTouchPinchBinded","onTouchPinch","onSingleTap","onDoubleTapBinded","onDoubleTap","onMouseMoveBinded","onMouseUpBinded","onMouseDoubleClickBinded","onHammerInput","isMouseDown","processMouseEvent","shiftKey","convertEventHammerToMouse","pointers","SetPosition","attachTo","detachFrom","drag","doubletap","doubletap2","singletap2","press","pan","pinch","recognizeWith","requireFailure","enableMouseButtons","state","addDocumentEventListener","removeDocumentEventListener","isMobileDevice","leaveEditMode","off","enterViewMode","leaveViewMode","toolController","mousewheel","preventDefault","mousemove","onMouseDownRightClick","inFullscreen","activeElement","__clientToCanvasCoords","markupTool","handleButtonDown","onMouseUpRightClick","handleButtonUp","isMiddleClick","getTool","distributeGesture","callSnapperMouseMove","SetRotation","curAngle","newRotation","oldRotation","EditFrame","containingDiv","selectionLayer","createSelectionLayer","frameMargin","selection","element","resizing","handle","createSelectorBox","onHammerDragBinded","onHammerDrag","onHammerDoubleTapBinded","onHammerDoubleTap","handleSelectionBoxDragging","handleSelectionBoxResizing","handleSelectionDoubleClick","handleSelectionBoxRotating","pageX","pageY","visibility","togglePointerEvents","createDragPoint","setResizeCursor","className","createRotatePoint","createRotationBridge","rotationBridge","cursor","createDragPoints","isDragPoint","matchesSelectorAux","isRotatePoint","selectorBox","rotationHandle","updateSelectionBoxState","updateSelectorBoxPosition","toTranslate3d","transformOrigin","msTransform","webkitTransform","msTransformOrigin","webkitTransformOrigin","updateSelectorBoxDimensions","_onRepositionMouseDown","unload","doubleMargin","enable","enableResizeHandles","enableRotationHandle","_onRepositionMouseMove","_onRepositionMouseUp","isDragging","isResizing","isRotating","rotating","updateEditorInput","callSnapperMouseDown","_onRotationMouseDown","_onResizeMouseDown","_handleRightClickDown","initialRotation","initialHandlePosition","ignoreFirstMouseMove","setHandleSelected","isSelected","doubleClick","defaultPrevented","pointerEvents","getAngleBetweenPoints","domElem","matches","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","syntheticStart","MouseEvent","initialCursor","initialPosition","areAxisConstrained","axisConstrains","altKey","movement","initial","mouseX","mouseY","_onResizeMouseMove","_onResizeMouseUp","vector","undoRotation","localSpaceDelta","projectOnVector","nw","ne","sw","se","redoRotation","actualDelta","_onRotationMouseMove","_onRotationMouseUp","ceil","MarkupTool","ToolInterface","names","panTool","allowNav","coreExt","hotkeysEnabled","_ctrlDown","_shiftDown","allowNavigation","allow","setCoreExtension","setHotkeysEnabled","enabled","activate","viewerApi","deactivate","CONTROL","SHIFT","v","ESCAPE","onUserCancel","DELETE","F12","handleKeyUp","handleSingleClick","button","handleDoubleClick","handleSingleTap","handleDoubleTap","handleWheelInput","handleMouseMove","handleGesture","handleBlur","_editModes","theEditModeManager","clazz","ret","register","MarkupsCore","Extension","duringViewMode","onEditActionHistoryChanged","nextId","clipboard","initStrokeAndFontWidths","MODEL_ADDED_EVENT","CAMERA_CHANGE_EVENT","once","onCameraChangeBinded","onCameraChange","onViewerResizeBinded","onViewerResize","onMarkupSelectedBinded","onMarkupSelected","onMarkupEnterEditionBinded","onMarkupEnterEdition","onMarkupCancelEditionBinded","onMarkupCancelEdition","onMarkupDeleteEditionBinded","onMarkupDeleteEdition","onToolChangeBinded","onToolChange","onUnitsCalibrationStartsBinded","onUnitsCalibrationStarts","Events","UNITS_CALIBRATION_STARTS_EVENT","load","svgStyle","disableMarkupInteractions","toolClass","markupToolClass","changeMarkupTool","markupDisableHotkeys","loadExtension","Extensions","Snapping","Snapper","markupMode","registerTool","enableHotKeys","deregisterTool","editModeSvgLayerNode","initialStrokeWidth","initialFontWidth","toggleEditMode","layerId","disableLayerMarkups","layer","layerMarkups","show","parSvg","editModeLayerParentNode","editingLayer","svgParent","activateTool","defaultStyle","changeEditMode","clearOverlays","toggle","VIEWER_RESIZE_EVENT","reorderElements","onViewerRolloverObject","rolloverObject","unloadMarkupsAllLayers","editModeLayer","generateData","defaultLayer","tmpNode","metadataNodes","addedNode","generatePoints3d","main","markupsCount","renderer","readbackTargetId","collision","context","renderAllMarkups","getSvgViewBox","numberOfScreenshotsTaken","onMarkupScreenshotTaken","svgKeys","layersKeys","oldEditMode","isNavigationAllowed","isPerspective","cachedNavigationTool","getActiveNavigationTool","TOOL_CHANGE_EVENT","getName","defaultToolName","getDefaultNavigationToolName","toolName","navAllowed","setNavigationLockSettings","zoom","orbit","roll","fov","walk","gotoview","setNavigationLock","changeInputHandler","inputHandler","dontAddToHistory","layerObject","markupIndex","editLayerMarkups","removeMarkupIfExists","sendMarkupTo","sendToBack","bringForward","bringBackward","loadMarkups","markupString","svgLayerNode","createLayerNode","localName","svgParentNode","newSvgLayerNode","revertLayer","currentMarkups","layerSvg","unloadMarkups","numMarkups","unloadSvgLayerNode","hideMarkups","showMarkups","markupsToClient","vectorFromClientToMarkups","vectorFromMarkupsToClient","bb","matrixWorld","globalOffset","getData","matrixWorldInverse","getSnapPosition","getSnapResult","getCamera","containerBounds","getScreenViewport","eventHandled","ignoreNextMouseUp","theExtensionManager","registerExtension","MarkupsGui","domEvents","onEditModeEnter","onEditModeLeave","onEditModeChange","then","core","unhookAllEvents","destroyToolUi","destroyToolbarUI","onToolbarCreated","markupToolButton","UI","Button","onClick","TOOLBAR","MODELTOOLSID","addControl","getToolbar","removeFromParent","log","showToolsUi","hideToolsUi","domToolSelect","ignoreChangeEvent","optionList","selectedIndex","setStylesUi","createToolsUi","canNavigate","setControlVisibility","exitNavigationMode","domContent","domRoot","html","createEditModeOption","domStylesRoot","hookEvent","onToggleCollapse","onEditModeDone","enterNavigationMode","onUndoClick","onRedoClick","onDeleteClick","onCutClick","onCopyClick","onPasteClick","onDuplicateClick","onSelectEditMode","onStyleChange","locLabel","editModeType","EditModeClass","getClass","curr","styleKey","valueType","option","getUiForStyleKey","current","selectionIndex","optLine","valueEquals","isText","includes","value1","value2","visibleValue","eventStr","callbackFn","handler","matchesSelector","getStyleOptions","activeStatus","Core","Utils","markupType","eventType","thing","StyleUtils","Gui","Markups"],"mappings":"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","file":"Markup/Markup.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 829);\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getTarget = function (target, parent) {\n  if (parent){\n    return parent.querySelector(target);\n  }\n  return document.querySelector(target);\n};\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(target, parent) {\n                // If passing function in options, then use it for resolve \"head\" element.\n                // Useful for Shadow Root style i.e\n                // {\n                //   insertInto: function () { return document.querySelector(\"#foo\").shadowRoot }\n                // }\n                if (typeof target === 'function') {\n                        return target();\n                }\n                if (typeof memo[target] === \"undefined\") {\n\t\t\tvar styleTarget = getTarget.call(this, target, parent);\n\t\t\t// Special case to return head of iframe instead of iframe itself\n\t\t\tif (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n\t\t\t\ttry {\n\t\t\t\t\t// This will throw an exception if access to iframe is blocked\n\t\t\t\t\t// due to cross-origin restrictions\n\t\t\t\t\tstyleTarget = styleTarget.contentDocument.head;\n\t\t\t\t} catch(e) {\n\t\t\t\t\tstyleTarget = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmemo[target] = styleTarget;\n\t\t}\n\t\treturn memo[target]\n\t};\n})();\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = require(\"./urls\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton && typeof options.singleton !== \"boolean\") options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n        if (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else if (typeof options.insertAt === \"object\" && options.insertAt.before) {\n\t\tvar nextSibling = getElement(options.insertAt.before, target);\n\t\ttarget.insertBefore(style, nextSibling);\n\t} else {\n\t\tthrow new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\n\tif(options.attrs.nonce === undefined) {\n\t\tvar nonce = getNonce();\n\t\tif (nonce) {\n\t\t\toptions.attrs.nonce = nonce;\n\t\t}\n\t}\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction getNonce() {\n\tif (typeof __webpack_nonce__ === 'undefined') {\n\t\treturn null;\n\t}\n\n\treturn __webpack_nonce__;\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = typeof options.transform === 'function'\n\t\t ? options.transform(obj.css) \n\t\t : options.transform.default(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n","\n/**\n * When source maps are enabled, `style-loader` uses a link element with a data-uri to\n * embed the css on the page. This breaks all relative urls because now they are relative to a\n * bundle instead of the current page.\n *\n * One solution is to only use full urls, but that may be impossible.\n *\n * Instead, this function \"fixes\" the relative urls to be absolute according to the current page location.\n *\n * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.\n *\n */\n\nmodule.exports = function (css) {\n  // get current location\n  var location = typeof window !== \"undefined\" && window.location;\n\n  if (!location) {\n    throw new Error(\"fixUrls requires window.location\");\n  }\n\n\t// blank or null?\n\tif (!css || typeof css !== \"string\") {\n\t  return css;\n  }\n\n  var baseUrl = location.protocol + \"//\" + location.host;\n  var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\n\n\t// convert each url(...)\n\t/*\n\tThis regular expression is just a way to recursively match brackets within\n\ta string.\n\n\t /url\\s*\\(  = Match on the word \"url\" with any whitespace after it and then a parens\n\t   (  = Start a capturing group\n\t     (?:  = Start a non-capturing group\n\t         [^)(]  = Match anything that isn't a parentheses\n\t         |  = OR\n\t         \\(  = Match a start parentheses\n\t             (?:  = Start another non-capturing groups\n\t                 [^)(]+  = Match anything that isn't a parentheses\n\t                 |  = OR\n\t                 \\(  = Match a start parentheses\n\t                     [^)(]*  = Match anything that isn't a parentheses\n\t                 \\)  = Match a end parentheses\n\t             )  = End Group\n              *\\) = Match anything and then a close parens\n          )  = Close non-capturing group\n          *  = Match anything\n       )  = Close capturing group\n\t \\)  = Match a close parens\n\n\t /gi  = Get all matches, not the first.  Be case insensitive.\n\t */\n\tvar fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function(fullMatch, origUrl) {\n\t\t// strip quotes (if they exist)\n\t\tvar unquotedOrigUrl = origUrl\n\t\t\t.trim()\n\t\t\t.replace(/^\"(.*)\"$/, function(o, $1){ return $1; })\n\t\t\t.replace(/^'(.*)'$/, function(o, $1){ return $1; });\n\n\t\t// already a full url? no change\n\t\tif (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(unquotedOrigUrl)) {\n\t\t  return fullMatch;\n\t\t}\n\n\t\t// convert the url to a full url\n\t\tvar newUrl;\n\n\t\tif (unquotedOrigUrl.indexOf(\"//\") === 0) {\n\t\t  \t//TODO: should we add protocol?\n\t\t\tnewUrl = unquotedOrigUrl;\n\t\t} else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\n\t\t\t// path should be relative to the base url\n\t\t\tnewUrl = baseUrl + unquotedOrigUrl; // already starts with '/'\n\t\t} else {\n\t\t\t// path should be relative to current directory\n\t\t\tnewUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\"); // Strip leading './'\n\t\t}\n\n\t\t// send back the fixed url(...)\n\t\treturn \"url(\" + JSON.stringify(newUrl) + \")\";\n\t});\n\n\t// send back the fixed css\n\treturn fixedCss;\n};\n","/**\r\n * A collection of shims that provide minimal functionality of the ES6 collections.\r\n *\r\n * These implementations are not meant to be used outside of the ResizeObserver\r\n * modules as they cover only a limited range of use cases.\r\n */\r\n/* eslint-disable require-jsdoc, valid-jsdoc */\r\nvar MapShim = (function () {\r\n    if (typeof Map !== 'undefined') {\r\n        return Map;\r\n    }\r\n    /**\r\n     * Returns index in provided array that matches the specified key.\r\n     *\r\n     * @param {Array<Array>} arr\r\n     * @param {*} key\r\n     * @returns {number}\r\n     */\r\n    function getIndex(arr, key) {\r\n        var result = -1;\r\n        arr.some(function (entry, index) {\r\n            if (entry[0] === key) {\r\n                result = index;\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        return result;\r\n    }\r\n    return /** @class */ (function () {\r\n        function class_1() {\r\n            this.__entries__ = [];\r\n        }\r\n        Object.defineProperty(class_1.prototype, \"size\", {\r\n            /**\r\n             * @returns {boolean}\r\n             */\r\n            get: function () {\r\n                return this.__entries__.length;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        /**\r\n         * @param {*} key\r\n         * @returns {*}\r\n         */\r\n        class_1.prototype.get = function (key) {\r\n            var index = getIndex(this.__entries__, key);\r\n            var entry = this.__entries__[index];\r\n            return entry && entry[1];\r\n        };\r\n        /**\r\n         * @param {*} key\r\n         * @param {*} value\r\n         * @returns {void}\r\n         */\r\n        class_1.prototype.set = function (key, value) {\r\n            var index = getIndex(this.__entries__, key);\r\n            if (~index) {\r\n                this.__entries__[index][1] = value;\r\n            }\r\n            else {\r\n                this.__entries__.push([key, value]);\r\n            }\r\n        };\r\n        /**\r\n         * @param {*} key\r\n         * @returns {void}\r\n         */\r\n        class_1.prototype.delete = function (key) {\r\n            var entries = this.__entries__;\r\n            var index = getIndex(entries, key);\r\n            if (~index) {\r\n                entries.splice(index, 1);\r\n            }\r\n        };\r\n        /**\r\n         * @param {*} key\r\n         * @returns {void}\r\n         */\r\n        class_1.prototype.has = function (key) {\r\n            return !!~getIndex(this.__entries__, key);\r\n        };\r\n        /**\r\n         * @returns {void}\r\n         */\r\n        class_1.prototype.clear = function () {\r\n            this.__entries__.splice(0);\r\n        };\r\n        /**\r\n         * @param {Function} callback\r\n         * @param {*} [ctx=null]\r\n         * @returns {void}\r\n         */\r\n        class_1.prototype.forEach = function (callback, ctx) {\r\n            if (ctx === void 0) { ctx = null; }\r\n            for (var _i = 0, _a = this.__entries__; _i < _a.length; _i++) {\r\n                var entry = _a[_i];\r\n                callback.call(ctx, entry[1], entry[0]);\r\n            }\r\n        };\r\n        return class_1;\r\n    }());\r\n})();\n\n/**\r\n * Detects whether window and document objects are available in current environment.\r\n */\r\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined' && window.document === document;\n\n// Returns global object of a current environment.\r\nvar global$1 = (function () {\r\n    if (typeof global !== 'undefined' && global.Math === Math) {\r\n        return global;\r\n    }\r\n    if (typeof self !== 'undefined' && self.Math === Math) {\r\n        return self;\r\n    }\r\n    if (typeof window !== 'undefined' && window.Math === Math) {\r\n        return window;\r\n    }\r\n    // eslint-disable-next-line no-new-func\r\n    return Function('return this')();\r\n})();\n\n/**\r\n * A shim for the requestAnimationFrame which falls back to the setTimeout if\r\n * first one is not supported.\r\n *\r\n * @returns {number} Requests' identifier.\r\n */\r\nvar requestAnimationFrame$1 = (function () {\r\n    if (typeof requestAnimationFrame === 'function') {\r\n        // It's required to use a bounded function because IE sometimes throws\r\n        // an \"Invalid calling object\" error if rAF is invoked without the global\r\n        // object on the left hand side.\r\n        return requestAnimationFrame.bind(global$1);\r\n    }\r\n    return function (callback) { return setTimeout(function () { return callback(Date.now()); }, 1000 / 60); };\r\n})();\n\n// Defines minimum timeout before adding a trailing call.\r\nvar trailingTimeout = 2;\r\n/**\r\n * Creates a wrapper function which ensures that provided callback will be\r\n * invoked only once during the specified delay period.\r\n *\r\n * @param {Function} callback - Function to be invoked after the delay period.\r\n * @param {number} delay - Delay after which to invoke callback.\r\n * @returns {Function}\r\n */\r\nfunction throttle (callback, delay) {\r\n    var leadingCall = false, trailingCall = false, lastCallTime = 0;\r\n    /**\r\n     * Invokes the original callback function and schedules new invocation if\r\n     * the \"proxy\" was called during current request.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    function resolvePending() {\r\n        if (leadingCall) {\r\n            leadingCall = false;\r\n            callback();\r\n        }\r\n        if (trailingCall) {\r\n            proxy();\r\n        }\r\n    }\r\n    /**\r\n     * Callback invoked after the specified delay. It will further postpone\r\n     * invocation of the original function delegating it to the\r\n     * requestAnimationFrame.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    function timeoutCallback() {\r\n        requestAnimationFrame$1(resolvePending);\r\n    }\r\n    /**\r\n     * Schedules invocation of the original function.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    function proxy() {\r\n        var timeStamp = Date.now();\r\n        if (leadingCall) {\r\n            // Reject immediately following calls.\r\n            if (timeStamp - lastCallTime < trailingTimeout) {\r\n                return;\r\n            }\r\n            // Schedule new call to be in invoked when the pending one is resolved.\r\n            // This is important for \"transitions\" which never actually start\r\n            // immediately so there is a chance that we might miss one if change\r\n            // happens amids the pending invocation.\r\n            trailingCall = true;\r\n        }\r\n        else {\r\n            leadingCall = true;\r\n            trailingCall = false;\r\n            setTimeout(timeoutCallback, delay);\r\n        }\r\n        lastCallTime = timeStamp;\r\n    }\r\n    return proxy;\r\n}\n\n// Minimum delay before invoking the update of observers.\r\nvar REFRESH_DELAY = 20;\r\n// A list of substrings of CSS properties used to find transition events that\r\n// might affect dimensions of observed elements.\r\nvar transitionKeys = ['top', 'right', 'bottom', 'left', 'width', 'height', 'size', 'weight'];\r\n// Check if MutationObserver is available.\r\nvar mutationObserverSupported = typeof MutationObserver !== 'undefined';\r\n/**\r\n * Singleton controller class which handles updates of ResizeObserver instances.\r\n */\r\nvar ResizeObserverController = /** @class */ (function () {\r\n    /**\r\n     * Creates a new instance of ResizeObserverController.\r\n     *\r\n     * @private\r\n     */\r\n    function ResizeObserverController() {\r\n        /**\r\n         * Indicates whether DOM listeners have been added.\r\n         *\r\n         * @private {boolean}\r\n         */\r\n        this.connected_ = false;\r\n        /**\r\n         * Tells that controller has subscribed for Mutation Events.\r\n         *\r\n         * @private {boolean}\r\n         */\r\n        this.mutationEventsAdded_ = false;\r\n        /**\r\n         * Keeps reference to the instance of MutationObserver.\r\n         *\r\n         * @private {MutationObserver}\r\n         */\r\n        this.mutationsObserver_ = null;\r\n        /**\r\n         * A list of connected observers.\r\n         *\r\n         * @private {Array<ResizeObserverSPI>}\r\n         */\r\n        this.observers_ = [];\r\n        this.onTransitionEnd_ = this.onTransitionEnd_.bind(this);\r\n        this.refresh = throttle(this.refresh.bind(this), REFRESH_DELAY);\r\n    }\r\n    /**\r\n     * Adds observer to observers list.\r\n     *\r\n     * @param {ResizeObserverSPI} observer - Observer to be added.\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverController.prototype.addObserver = function (observer) {\r\n        if (!~this.observers_.indexOf(observer)) {\r\n            this.observers_.push(observer);\r\n        }\r\n        // Add listeners if they haven't been added yet.\r\n        if (!this.connected_) {\r\n            this.connect_();\r\n        }\r\n    };\r\n    /**\r\n     * Removes observer from observers list.\r\n     *\r\n     * @param {ResizeObserverSPI} observer - Observer to be removed.\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverController.prototype.removeObserver = function (observer) {\r\n        var observers = this.observers_;\r\n        var index = observers.indexOf(observer);\r\n        // Remove observer if it's present in registry.\r\n        if (~index) {\r\n            observers.splice(index, 1);\r\n        }\r\n        // Remove listeners if controller has no connected observers.\r\n        if (!observers.length && this.connected_) {\r\n            this.disconnect_();\r\n        }\r\n    };\r\n    /**\r\n     * Invokes the update of observers. It will continue running updates insofar\r\n     * it detects changes.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverController.prototype.refresh = function () {\r\n        var changesDetected = this.updateObservers_();\r\n        // Continue running updates if changes have been detected as there might\r\n        // be future ones caused by CSS transitions.\r\n        if (changesDetected) {\r\n            this.refresh();\r\n        }\r\n    };\r\n    /**\r\n     * Updates every observer from observers list and notifies them of queued\r\n     * entries.\r\n     *\r\n     * @private\r\n     * @returns {boolean} Returns \"true\" if any observer has detected changes in\r\n     *      dimensions of it's elements.\r\n     */\r\n    ResizeObserverController.prototype.updateObservers_ = function () {\r\n        // Collect observers that have active observations.\r\n        var activeObservers = this.observers_.filter(function (observer) {\r\n            return observer.gatherActive(), observer.hasActive();\r\n        });\r\n        // Deliver notifications in a separate cycle in order to avoid any\r\n        // collisions between observers, e.g. when multiple instances of\r\n        // ResizeObserver are tracking the same element and the callback of one\r\n        // of them changes content dimensions of the observed target. Sometimes\r\n        // this may result in notifications being blocked for the rest of observers.\r\n        activeObservers.forEach(function (observer) { return observer.broadcastActive(); });\r\n        return activeObservers.length > 0;\r\n    };\r\n    /**\r\n     * Initializes DOM listeners.\r\n     *\r\n     * @private\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverController.prototype.connect_ = function () {\r\n        // Do nothing if running in a non-browser environment or if listeners\r\n        // have been already added.\r\n        if (!isBrowser || this.connected_) {\r\n            return;\r\n        }\r\n        // Subscription to the \"Transitionend\" event is used as a workaround for\r\n        // delayed transitions. This way it's possible to capture at least the\r\n        // final state of an element.\r\n        document.addEventListener('transitionend', this.onTransitionEnd_);\r\n        window.addEventListener('resize', this.refresh);\r\n        if (mutationObserverSupported) {\r\n            this.mutationsObserver_ = new MutationObserver(this.refresh);\r\n            this.mutationsObserver_.observe(document, {\r\n                attributes: true,\r\n                childList: true,\r\n                characterData: true,\r\n                subtree: true\r\n            });\r\n        }\r\n        else {\r\n            document.addEventListener('DOMSubtreeModified', this.refresh);\r\n            this.mutationEventsAdded_ = true;\r\n        }\r\n        this.connected_ = true;\r\n    };\r\n    /**\r\n     * Removes DOM listeners.\r\n     *\r\n     * @private\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverController.prototype.disconnect_ = function () {\r\n        // Do nothing if running in a non-browser environment or if listeners\r\n        // have been already removed.\r\n        if (!isBrowser || !this.connected_) {\r\n            return;\r\n        }\r\n        document.removeEventListener('transitionend', this.onTransitionEnd_);\r\n        window.removeEventListener('resize', this.refresh);\r\n        if (this.mutationsObserver_) {\r\n            this.mutationsObserver_.disconnect();\r\n        }\r\n        if (this.mutationEventsAdded_) {\r\n            document.removeEventListener('DOMSubtreeModified', this.refresh);\r\n        }\r\n        this.mutationsObserver_ = null;\r\n        this.mutationEventsAdded_ = false;\r\n        this.connected_ = false;\r\n    };\r\n    /**\r\n     * \"Transitionend\" event handler.\r\n     *\r\n     * @private\r\n     * @param {TransitionEvent} event\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverController.prototype.onTransitionEnd_ = function (_a) {\r\n        var _b = _a.propertyName, propertyName = _b === void 0 ? '' : _b;\r\n        // Detect whether transition may affect dimensions of an element.\r\n        var isReflowProperty = transitionKeys.some(function (key) {\r\n            return !!~propertyName.indexOf(key);\r\n        });\r\n        if (isReflowProperty) {\r\n            this.refresh();\r\n        }\r\n    };\r\n    /**\r\n     * Returns instance of the ResizeObserverController.\r\n     *\r\n     * @returns {ResizeObserverController}\r\n     */\r\n    ResizeObserverController.getInstance = function () {\r\n        if (!this.instance_) {\r\n            this.instance_ = new ResizeObserverController();\r\n        }\r\n        return this.instance_;\r\n    };\r\n    /**\r\n     * Holds reference to the controller's instance.\r\n     *\r\n     * @private {ResizeObserverController}\r\n     */\r\n    ResizeObserverController.instance_ = null;\r\n    return ResizeObserverController;\r\n}());\n\n/**\r\n * Defines non-writable/enumerable properties of the provided target object.\r\n *\r\n * @param {Object} target - Object for which to define properties.\r\n * @param {Object} props - Properties to be defined.\r\n * @returns {Object} Target object.\r\n */\r\nvar defineConfigurable = (function (target, props) {\r\n    for (var _i = 0, _a = Object.keys(props); _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        Object.defineProperty(target, key, {\r\n            value: props[key],\r\n            enumerable: false,\r\n            writable: false,\r\n            configurable: true\r\n        });\r\n    }\r\n    return target;\r\n});\n\n/**\r\n * Returns the global object associated with provided element.\r\n *\r\n * @param {Object} target\r\n * @returns {Object}\r\n */\r\nvar getWindowOf = (function (target) {\r\n    // Assume that the element is an instance of Node, which means that it\r\n    // has the \"ownerDocument\" property from which we can retrieve a\r\n    // corresponding global object.\r\n    var ownerGlobal = target && target.ownerDocument && target.ownerDocument.defaultView;\r\n    // Return the local global object if it's not possible extract one from\r\n    // provided element.\r\n    return ownerGlobal || global$1;\r\n});\n\n// Placeholder of an empty content rectangle.\r\nvar emptyRect = createRectInit(0, 0, 0, 0);\r\n/**\r\n * Converts provided string to a number.\r\n *\r\n * @param {number|string} value\r\n * @returns {number}\r\n */\r\nfunction toFloat(value) {\r\n    return parseFloat(value) || 0;\r\n}\r\n/**\r\n * Extracts borders size from provided styles.\r\n *\r\n * @param {CSSStyleDeclaration} styles\r\n * @param {...string} positions - Borders positions (top, right, ...)\r\n * @returns {number}\r\n */\r\nfunction getBordersSize(styles) {\r\n    var positions = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        positions[_i - 1] = arguments[_i];\r\n    }\r\n    return positions.reduce(function (size, position) {\r\n        var value = styles['border-' + position + '-width'];\r\n        return size + toFloat(value);\r\n    }, 0);\r\n}\r\n/**\r\n * Extracts paddings sizes from provided styles.\r\n *\r\n * @param {CSSStyleDeclaration} styles\r\n * @returns {Object} Paddings box.\r\n */\r\nfunction getPaddings(styles) {\r\n    var positions = ['top', 'right', 'bottom', 'left'];\r\n    var paddings = {};\r\n    for (var _i = 0, positions_1 = positions; _i < positions_1.length; _i++) {\r\n        var position = positions_1[_i];\r\n        var value = styles['padding-' + position];\r\n        paddings[position] = toFloat(value);\r\n    }\r\n    return paddings;\r\n}\r\n/**\r\n * Calculates content rectangle of provided SVG element.\r\n *\r\n * @param {SVGGraphicsElement} target - Element content rectangle of which needs\r\n *      to be calculated.\r\n * @returns {DOMRectInit}\r\n */\r\nfunction getSVGContentRect(target) {\r\n    var bbox = target.getBBox();\r\n    return createRectInit(0, 0, bbox.width, bbox.height);\r\n}\r\n/**\r\n * Calculates content rectangle of provided HTMLElement.\r\n *\r\n * @param {HTMLElement} target - Element for which to calculate the content rectangle.\r\n * @returns {DOMRectInit}\r\n */\r\nfunction getHTMLElementContentRect(target) {\r\n    // Client width & height properties can't be\r\n    // used exclusively as they provide rounded values.\r\n    var clientWidth = target.clientWidth, clientHeight = target.clientHeight;\r\n    // By this condition we can catch all non-replaced inline, hidden and\r\n    // detached elements. Though elements with width & height properties less\r\n    // than 0.5 will be discarded as well.\r\n    //\r\n    // Without it we would need to implement separate methods for each of\r\n    // those cases and it's not possible to perform a precise and performance\r\n    // effective test for hidden elements. E.g. even jQuery's ':visible' filter\r\n    // gives wrong results for elements with width & height less than 0.5.\r\n    if (!clientWidth && !clientHeight) {\r\n        return emptyRect;\r\n    }\r\n    var styles = getWindowOf(target).getComputedStyle(target);\r\n    var paddings = getPaddings(styles);\r\n    var horizPad = paddings.left + paddings.right;\r\n    var vertPad = paddings.top + paddings.bottom;\r\n    // Computed styles of width & height are being used because they are the\r\n    // only dimensions available to JS that contain non-rounded values. It could\r\n    // be possible to utilize the getBoundingClientRect if only it's data wasn't\r\n    // affected by CSS transformations let alone paddings, borders and scroll bars.\r\n    var width = toFloat(styles.width), height = toFloat(styles.height);\r\n    // Width & height include paddings and borders when the 'border-box' box\r\n    // model is applied (except for IE).\r\n    if (styles.boxSizing === 'border-box') {\r\n        // Following conditions are required to handle Internet Explorer which\r\n        // doesn't include paddings and borders to computed CSS dimensions.\r\n        //\r\n        // We can say that if CSS dimensions + paddings are equal to the \"client\"\r\n        // properties then it's either IE, and thus we don't need to subtract\r\n        // anything, or an element merely doesn't have paddings/borders styles.\r\n        if (Math.round(width + horizPad) !== clientWidth) {\r\n            width -= getBordersSize(styles, 'left', 'right') + horizPad;\r\n        }\r\n        if (Math.round(height + vertPad) !== clientHeight) {\r\n            height -= getBordersSize(styles, 'top', 'bottom') + vertPad;\r\n        }\r\n    }\r\n    // Following steps can't be applied to the document's root element as its\r\n    // client[Width/Height] properties represent viewport area of the window.\r\n    // Besides, it's as well not necessary as the <html> itself neither has\r\n    // rendered scroll bars nor it can be clipped.\r\n    if (!isDocumentElement(target)) {\r\n        // In some browsers (only in Firefox, actually) CSS width & height\r\n        // include scroll bars size which can be removed at this step as scroll\r\n        // bars are the only difference between rounded dimensions + paddings\r\n        // and \"client\" properties, though that is not always true in Chrome.\r\n        var vertScrollbar = Math.round(width + horizPad) - clientWidth;\r\n        var horizScrollbar = Math.round(height + vertPad) - clientHeight;\r\n        // Chrome has a rather weird rounding of \"client\" properties.\r\n        // E.g. for an element with content width of 314.2px it sometimes gives\r\n        // the client width of 315px and for the width of 314.7px it may give\r\n        // 314px. And it doesn't happen all the time. So just ignore this delta\r\n        // as a non-relevant.\r\n        if (Math.abs(vertScrollbar) !== 1) {\r\n            width -= vertScrollbar;\r\n        }\r\n        if (Math.abs(horizScrollbar) !== 1) {\r\n            height -= horizScrollbar;\r\n        }\r\n    }\r\n    return createRectInit(paddings.left, paddings.top, width, height);\r\n}\r\n/**\r\n * Checks whether provided element is an instance of the SVGGraphicsElement.\r\n *\r\n * @param {Element} target - Element to be checked.\r\n * @returns {boolean}\r\n */\r\nvar isSVGGraphicsElement = (function () {\r\n    // Some browsers, namely IE and Edge, don't have the SVGGraphicsElement\r\n    // interface.\r\n    if (typeof SVGGraphicsElement !== 'undefined') {\r\n        return function (target) { return target instanceof getWindowOf(target).SVGGraphicsElement; };\r\n    }\r\n    // If it's so, then check that element is at least an instance of the\r\n    // SVGElement and that it has the \"getBBox\" method.\r\n    // eslint-disable-next-line no-extra-parens\r\n    return function (target) { return (target instanceof getWindowOf(target).SVGElement &&\r\n        typeof target.getBBox === 'function'); };\r\n})();\r\n/**\r\n * Checks whether provided element is a document element (<html>).\r\n *\r\n * @param {Element} target - Element to be checked.\r\n * @returns {boolean}\r\n */\r\nfunction isDocumentElement(target) {\r\n    return target === getWindowOf(target).document.documentElement;\r\n}\r\n/**\r\n * Calculates an appropriate content rectangle for provided html or svg element.\r\n *\r\n * @param {Element} target - Element content rectangle of which needs to be calculated.\r\n * @returns {DOMRectInit}\r\n */\r\nfunction getContentRect(target) {\r\n    if (!isBrowser) {\r\n        return emptyRect;\r\n    }\r\n    if (isSVGGraphicsElement(target)) {\r\n        return getSVGContentRect(target);\r\n    }\r\n    return getHTMLElementContentRect(target);\r\n}\r\n/**\r\n * Creates rectangle with an interface of the DOMRectReadOnly.\r\n * Spec: https://drafts.fxtf.org/geometry/#domrectreadonly\r\n *\r\n * @param {DOMRectInit} rectInit - Object with rectangle's x/y coordinates and dimensions.\r\n * @returns {DOMRectReadOnly}\r\n */\r\nfunction createReadOnlyRect(_a) {\r\n    var x = _a.x, y = _a.y, width = _a.width, height = _a.height;\r\n    // If DOMRectReadOnly is available use it as a prototype for the rectangle.\r\n    var Constr = typeof DOMRectReadOnly !== 'undefined' ? DOMRectReadOnly : Object;\r\n    var rect = Object.create(Constr.prototype);\r\n    // Rectangle's properties are not writable and non-enumerable.\r\n    defineConfigurable(rect, {\r\n        x: x, y: y, width: width, height: height,\r\n        top: y,\r\n        right: x + width,\r\n        bottom: height + y,\r\n        left: x\r\n    });\r\n    return rect;\r\n}\r\n/**\r\n * Creates DOMRectInit object based on the provided dimensions and the x/y coordinates.\r\n * Spec: https://drafts.fxtf.org/geometry/#dictdef-domrectinit\r\n *\r\n * @param {number} x - X coordinate.\r\n * @param {number} y - Y coordinate.\r\n * @param {number} width - Rectangle's width.\r\n * @param {number} height - Rectangle's height.\r\n * @returns {DOMRectInit}\r\n */\r\nfunction createRectInit(x, y, width, height) {\r\n    return { x: x, y: y, width: width, height: height };\r\n}\n\n/**\r\n * Class that is responsible for computations of the content rectangle of\r\n * provided DOM element and for keeping track of it's changes.\r\n */\r\nvar ResizeObservation = /** @class */ (function () {\r\n    /**\r\n     * Creates an instance of ResizeObservation.\r\n     *\r\n     * @param {Element} target - Element to be observed.\r\n     */\r\n    function ResizeObservation(target) {\r\n        /**\r\n         * Broadcasted width of content rectangle.\r\n         *\r\n         * @type {number}\r\n         */\r\n        this.broadcastWidth = 0;\r\n        /**\r\n         * Broadcasted height of content rectangle.\r\n         *\r\n         * @type {number}\r\n         */\r\n        this.broadcastHeight = 0;\r\n        /**\r\n         * Reference to the last observed content rectangle.\r\n         *\r\n         * @private {DOMRectInit}\r\n         */\r\n        this.contentRect_ = createRectInit(0, 0, 0, 0);\r\n        this.target = target;\r\n    }\r\n    /**\r\n     * Updates content rectangle and tells whether it's width or height properties\r\n     * have changed since the last broadcast.\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    ResizeObservation.prototype.isActive = function () {\r\n        var rect = getContentRect(this.target);\r\n        this.contentRect_ = rect;\r\n        return (rect.width !== this.broadcastWidth ||\r\n            rect.height !== this.broadcastHeight);\r\n    };\r\n    /**\r\n     * Updates 'broadcastWidth' and 'broadcastHeight' properties with a data\r\n     * from the corresponding properties of the last observed content rectangle.\r\n     *\r\n     * @returns {DOMRectInit} Last observed content rectangle.\r\n     */\r\n    ResizeObservation.prototype.broadcastRect = function () {\r\n        var rect = this.contentRect_;\r\n        this.broadcastWidth = rect.width;\r\n        this.broadcastHeight = rect.height;\r\n        return rect;\r\n    };\r\n    return ResizeObservation;\r\n}());\n\nvar ResizeObserverEntry = /** @class */ (function () {\r\n    /**\r\n     * Creates an instance of ResizeObserverEntry.\r\n     *\r\n     * @param {Element} target - Element that is being observed.\r\n     * @param {DOMRectInit} rectInit - Data of the element's content rectangle.\r\n     */\r\n    function ResizeObserverEntry(target, rectInit) {\r\n        var contentRect = createReadOnlyRect(rectInit);\r\n        // According to the specification following properties are not writable\r\n        // and are also not enumerable in the native implementation.\r\n        //\r\n        // Property accessors are not being used as they'd require to define a\r\n        // private WeakMap storage which may cause memory leaks in browsers that\r\n        // don't support this type of collections.\r\n        defineConfigurable(this, { target: target, contentRect: contentRect });\r\n    }\r\n    return ResizeObserverEntry;\r\n}());\n\nvar ResizeObserverSPI = /** @class */ (function () {\r\n    /**\r\n     * Creates a new instance of ResizeObserver.\r\n     *\r\n     * @param {ResizeObserverCallback} callback - Callback function that is invoked\r\n     *      when one of the observed elements changes it's content dimensions.\r\n     * @param {ResizeObserverController} controller - Controller instance which\r\n     *      is responsible for the updates of observer.\r\n     * @param {ResizeObserver} callbackCtx - Reference to the public\r\n     *      ResizeObserver instance which will be passed to callback function.\r\n     */\r\n    function ResizeObserverSPI(callback, controller, callbackCtx) {\r\n        /**\r\n         * Collection of resize observations that have detected changes in dimensions\r\n         * of elements.\r\n         *\r\n         * @private {Array<ResizeObservation>}\r\n         */\r\n        this.activeObservations_ = [];\r\n        /**\r\n         * Registry of the ResizeObservation instances.\r\n         *\r\n         * @private {Map<Element, ResizeObservation>}\r\n         */\r\n        this.observations_ = new MapShim();\r\n        if (typeof callback !== 'function') {\r\n            throw new TypeError('The callback provided as parameter 1 is not a function.');\r\n        }\r\n        this.callback_ = callback;\r\n        this.controller_ = controller;\r\n        this.callbackCtx_ = callbackCtx;\r\n    }\r\n    /**\r\n     * Starts observing provided element.\r\n     *\r\n     * @param {Element} target - Element to be observed.\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverSPI.prototype.observe = function (target) {\r\n        if (!arguments.length) {\r\n            throw new TypeError('1 argument required, but only 0 present.');\r\n        }\r\n        // Do nothing if current environment doesn't have the Element interface.\r\n        if (typeof Element === 'undefined' || !(Element instanceof Object)) {\r\n            return;\r\n        }\r\n        if (!(target instanceof getWindowOf(target).Element)) {\r\n            throw new TypeError('parameter 1 is not of type \"Element\".');\r\n        }\r\n        var observations = this.observations_;\r\n        // Do nothing if element is already being observed.\r\n        if (observations.has(target)) {\r\n            return;\r\n        }\r\n        observations.set(target, new ResizeObservation(target));\r\n        this.controller_.addObserver(this);\r\n        // Force the update of observations.\r\n        this.controller_.refresh();\r\n    };\r\n    /**\r\n     * Stops observing provided element.\r\n     *\r\n     * @param {Element} target - Element to stop observing.\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverSPI.prototype.unobserve = function (target) {\r\n        if (!arguments.length) {\r\n            throw new TypeError('1 argument required, but only 0 present.');\r\n        }\r\n        // Do nothing if current environment doesn't have the Element interface.\r\n        if (typeof Element === 'undefined' || !(Element instanceof Object)) {\r\n            return;\r\n        }\r\n        if (!(target instanceof getWindowOf(target).Element)) {\r\n            throw new TypeError('parameter 1 is not of type \"Element\".');\r\n        }\r\n        var observations = this.observations_;\r\n        // Do nothing if element is not being observed.\r\n        if (!observations.has(target)) {\r\n            return;\r\n        }\r\n        observations.delete(target);\r\n        if (!observations.size) {\r\n            this.controller_.removeObserver(this);\r\n        }\r\n    };\r\n    /**\r\n     * Stops observing all elements.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverSPI.prototype.disconnect = function () {\r\n        this.clearActive();\r\n        this.observations_.clear();\r\n        this.controller_.removeObserver(this);\r\n    };\r\n    /**\r\n     * Collects observation instances the associated element of which has changed\r\n     * it's content rectangle.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverSPI.prototype.gatherActive = function () {\r\n        var _this = this;\r\n        this.clearActive();\r\n        this.observations_.forEach(function (observation) {\r\n            if (observation.isActive()) {\r\n                _this.activeObservations_.push(observation);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Invokes initial callback function with a list of ResizeObserverEntry\r\n     * instances collected from active resize observations.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverSPI.prototype.broadcastActive = function () {\r\n        // Do nothing if observer doesn't have active observations.\r\n        if (!this.hasActive()) {\r\n            return;\r\n        }\r\n        var ctx = this.callbackCtx_;\r\n        // Create ResizeObserverEntry instance for every active observation.\r\n        var entries = this.activeObservations_.map(function (observation) {\r\n            return new ResizeObserverEntry(observation.target, observation.broadcastRect());\r\n        });\r\n        this.callback_.call(ctx, entries, ctx);\r\n        this.clearActive();\r\n    };\r\n    /**\r\n     * Clears the collection of active observations.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    ResizeObserverSPI.prototype.clearActive = function () {\r\n        this.activeObservations_.splice(0);\r\n    };\r\n    /**\r\n     * Tells whether observer has active observations.\r\n     *\r\n     * @returns {boolean}\r\n     */\r\n    ResizeObserverSPI.prototype.hasActive = function () {\r\n        return this.activeObservations_.length > 0;\r\n    };\r\n    return ResizeObserverSPI;\r\n}());\n\n// Registry of internal observers. If WeakMap is not available use current shim\r\n// for the Map collection as it has all required methods and because WeakMap\r\n// can't be fully polyfilled anyway.\r\nvar observers = typeof WeakMap !== 'undefined' ? new WeakMap() : new MapShim();\r\n/**\r\n * ResizeObserver API. Encapsulates the ResizeObserver SPI implementation\r\n * exposing only those methods and properties that are defined in the spec.\r\n */\r\nvar ResizeObserver = /** @class */ (function () {\r\n    /**\r\n     * Creates a new instance of ResizeObserver.\r\n     *\r\n     * @param {ResizeObserverCallback} callback - Callback that is invoked when\r\n     *      dimensions of the observed elements change.\r\n     */\r\n    function ResizeObserver(callback) {\r\n        if (!(this instanceof ResizeObserver)) {\r\n            throw new TypeError('Cannot call a class as a function.');\r\n        }\r\n        if (!arguments.length) {\r\n            throw new TypeError('1 argument required, but only 0 present.');\r\n        }\r\n        var controller = ResizeObserverController.getInstance();\r\n        var observer = new ResizeObserverSPI(callback, controller, this);\r\n        observers.set(this, observer);\r\n    }\r\n    return ResizeObserver;\r\n}());\r\n// Expose public methods of ResizeObserver.\r\n[\r\n    'observe',\r\n    'unobserve',\r\n    'disconnect'\r\n].forEach(function (method) {\r\n    ResizeObserver.prototype[method] = function () {\r\n        var _a;\r\n        return (_a = observers.get(this))[method].apply(_a, arguments);\r\n    };\r\n});\n\nvar index = (function () {\r\n    // Export existing implementation if available.\r\n    if (typeof global$1.ResizeObserver !== 'undefined') {\r\n        return global$1.ResizeObserver;\r\n    }\r\n    return ResizeObserver;\r\n})();\n\nexport default index;\n","\nvar content = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./Markups.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./Markups.css\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./Markups.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger:after{content:\\\"\\\";position:absolute;top:-15px;bottom:-15px;left:-15px;right:-15px}.adsk-viewing-viewer .autodesk-markups-extension-core-make-me-bigger.rotation-bridge:after{top:0;bottom:0px}.adsk-viewing-viewer .selector-box{position:absolute;border:1px dashed #0696D7;background:rgba(6,150,215,0.05);z-index:1;cursor:move;box-sizing:border-box}.adsk-viewing-viewer .selector-drag-point,.adsk-viewing-viewer .selector-rotate-point{position:absolute;height:8px;width:8px;border-radius:8px;background:#FFFFFF;border-color:rgba(107,120,127,0.7);border-width:1px;border-style:solid}.adsk-viewing-viewer .selector-rotate-point{top:calc(100% + 22px);left:calc(50% + 1px);transform:translate3d(-50%, 0px, 0px)}.adsk-viewing-viewer .selector-drag-point.selected,.adsk-viewing-viewer .selector-rotate-point.selected:not(.rotation-bridge){background:#0696D7;border-color:#0696D7}.adsk-viewing-viewer .rotation-bridge{position:absolute;background-color:rgba(0,0,0,0);height:30px;width:0px;top:100%;left:calc(50% + 1px);border:unset;border-left:1px dashed #0696D7}.adsk-viewing-viewer .selector-drag-point.sdp-handle-n{top:-6px;left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-s{top:calc(100% - 14px);left:calc(50% - 4px);position:relative}.adsk-viewing-viewer .selector-drag-point.sdp-handle-w{left:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-e{right:-6px;top:50%;transform:translate3d(0, -50%, 0)}.adsk-viewing-viewer .selector-drag-point.sdp-handle-nw{top:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-ne{top:-6px;right:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-sw{bottom:-6px;left:-6px}.adsk-viewing-viewer .selector-drag-point.sdp-handle-se{bottom:-6px;right:-6px}\\n\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./MarkupsGui.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./MarkupsGui.css\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/sass-loader/dist/cjs.js!./MarkupsGui.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".adsk-icon-markup:before{content:\\\"a\\\"}.lmv-markup-gui-toolbar{position:absolute;top:0;margin:5px 5px;color:#000000}.lmv-markup-gui-toolbar-content>*{margin:0 2px}.lmv-markup-gui-style-options{display:inline-block}\\n\", \"\"]);\n\n// exports\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\n// These are all the supported markup types.\n\n    export const MARKUP_TYPE_ARROW = \"arrow\";\n    export const MARKUP_TYPE_TEXT = \"label\";\n    export const MARKUP_TYPE_RECTANGLE = \"rectangle\";\n    export const MARKUP_TYPE_CIRCLE = \"ellipse\";\n    export const MARKUP_TYPE_CLOUD = \"cloud\";\n    export const MARKUP_TYPE_FREEHAND = \"freehand\";\n    export const MARKUP_TYPE_HIGHLIGHT = \"highlight\";\n    export const MARKUP_TYPE_POLYLINE = \"polyline\";\n    export const MARKUP_TYPE_POLYCLOUD = \"polycloud\";\n    export const MARKUP_TYPE_CALLOUT = \"callout\";\n    export const MARKUP_TYPE_DIMENSION = \"dimension\";\n    export const MARKUP_TYPE_STAMP = \"stamp\";","'use strict';\n\n    /**\n     * Base class for all markup edit actions.\n     *\n     * EditActions encapsulate {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}\n     * operations (such as creation, edition and deletion) that hook into the undo/redo system.\n     *\n     * The minimum set of methods to implement on an EditAction extension are:\n     * - execute()\n     * - undo()\n     * - redo()\n     *\n     * A good set of classes to check their implementation are:\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.CreateCircle|CreateCircle}.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.DeleteCircle|DeleteCircle}.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.SetCircle|SetCircle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     * @param {String} type - An identifier for the EditAction.\n     * @param {number} targetId - The id of the markup being affected.\n     */\n    export function EditAction(editor, type, targetId) {\n\n        this.type =  type;\n        this.editor = editor;\n        this.targetId = targetId;\n        this.addToHistory = true;\n        this.selectOnExecution = true;\n    }\n\n    /**\n     * Performs the action.\n     */\n    EditAction.prototype.execute = function() {\n\n        this.editor.actionManager.execute(this);\n    };\n\n    /**\n     * @abstract\n     */\n    EditAction.prototype.redo = function() {\n\n    };\n\n    /**\n     * @abstract\n     */\n    EditAction.prototype.undo = function() {\n\n    };\n\n    /**\n     * Provides a mechanism to merge consecutive actions of the same type.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.EditAction} action - Action to check if it can be merged with 'this'.\n     * @returns {boolean} Returns true if merge has been applied. Parameter will be discarded.\n     */\n    EditAction.prototype.merge = function(action) {\n\n        return false;\n    };\n\n    /**\n     * Provides a mechanism to check whether the action yields no results.\n     * @returns {boolean} Returns true if no changes happen with this action.\n     */\n    EditAction.prototype.isIdentity = function() {\n\n        return false;\n    };\n\n","\n/**\n * \n * @param {*} attributes \n * @param {*} editor \n */\nexport var createStyle = function(attributes, editor) {\n\n    var style = {};\n\n    for(var i = 0; i < attributes.length; ++i) {\n\n        style[attributes[i]] = null;\n    }\n\n    var defaults = getStyleDefaultValues(style, editor);\n\n    for(var i = 0; i < attributes.length; ++i) {\n\n        var attribute = attributes[i];\n        style[attribute] = defaults[attribute].values[defaults[attribute].default].value;\n    }\n\n    return style;\n};\n\n/**\n *\n * @param source\n * @param destination\n * @returns {*}\n */\nexport var copyStyle = function(source, destination) {\n\n    for(var attribute in destination) {\n        if (source.hasOwnProperty(attribute)) {\n            destination[attribute] = source[attribute];\n        }\n    }\n\n    return destination;\n};\n\n/**\n *\n * @param source\n * @param destination\n * @returns {*}\n */\nexport var isStyleEqual = function(source, destination) {\n\n    for(var attribute in destination) {\n        if (source.hasOwnProperty(attribute) && source[attribute] !== destination[attribute]) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\n/**\n *\n * @param source\n * @returns {{}}\n */\nexport var cloneStyle = function(source) {\n\n    var clone = {};\n\n    for(var attribute in source) {\n        clone[attribute] = source[attribute];\n    }\n\n    return clone;\n};\n\n/**\n *\n * @param style\n * @param editor\n * @returns {{}}\n */\nexport var getStyleDefaultValues = function(style, editor) {\n\n    function getWidths(normalWidth) {\n\n        return {\n            values: [\n                {name:'Thin', value: normalWidth / 3},\n                {name:'Normal', value: normalWidth},\n                {name:'Thick', value: normalWidth * 3},\n                {name:'Very Thick', value: normalWidth * 9}],\n            default: 1\n        };\n    }\n\n    function getLineJoins() {\n\n        return {\n            values: [\n                {name:'Miter', value: 'miter'},\n                {name:'Round', value: 'round'},\n                {name:'Bevel', value: 'bevel'}],\n            default: 0\n        };\n    }\n\n    function getFontSizes(normalWidth) {\n\n        return {\n            values: [\n                {name:'Thin', value: normalWidth / 2},\n                {name:'Normal', value: normalWidth},\n                {name:'Thick', value: normalWidth * 4}],\n            default: 1\n        };\n    }\n\n    function getColors() {\n\n        return {\n            values: [\n                {name:'red', value: '#ff0000'},\n                {name:'green', value: '#00ff00'},\n                {name:'blue', value: '#0000ff'},\n                {name:'white', value: '#ffffff'},\n                {name:'black', value: '#000000'},\n                {name:'yellow', value: '#ffff00'}],\n            default: 0\n        };\n    }\n\n    function getOpacities(defaultTransparent) {\n\n        return {\n            values: [\n                {name:'100%', value: 1.00},\n                {name:'75%', value:  0.75},\n                {name:'50%', value: 0.50},\n                {name:'25%', value: 0.25},\n                {name:'0%', value: 0.00}],\n            default: (defaultTransparent ? 4 : 0)\n        };\n    }\n\n    function getFontFamilies() {\n\n        // TODO: Localize?\n        // TODO: Validate fonts with design\n        // Source: http://www.webdesigndev.com/web-development/16-gorgeous-web-safe-fonts-to-use-with-css\n        return {\n            values:[\n                {name:'Arial', value: 'Arial'},\n                {name:'Arial Black', value: 'Arial Black'},\n                {name:'Arial Narrow', value: 'Arial Narrow'},\n                {name:'Century Gothic', value: 'Century Gothic'},\n                {name:'Courier New', value: 'Courier New'},\n                {name:'Georgia', value: 'Georgia'},\n                {name:'Impact', value: 'Impact'},\n                {name:'Lucida Console', value: 'Lucida Console'},\n                {name:'Tahoma', value: 'Tahoma'},\n                {name:'Verdana', value: 'Verdana'}\n            ],\n            default: 0\n        };\n    }\n\n    function getFontStyles() {\n        return {\n            values:[\n                {name:'Normal', value: 'normal'},\n                {name:'Italic', value: 'italic'}],\n            default: 0\n        };\n    }\n\n    function getFontWeights() {\n        return {\n            values:[\n                {name:'Normal', value: 'normal'},\n                {name:'Bold', value: 'bold'}],\n            default: 0};\n    }\n\n    function getSvgString() {\n        return {\n            values: [\n                {\n                    name: 'DefaultValue',\n                    value: '<svg height=\"100\" width=\"100\" viewBox=\"0 0 100 100\"><circle cx=\"50\" cy=\"50\" r=\"40\" stroke=\"black\" stroke-width=\"3\" fill=\"red\" /></svg>'\n                }\n            ],\n            default: 0\n        };\n    }\n\n    var values = cloneStyle(style);\n    var normaStrokeWidth = editor.getStrokeWidth();\n    var normaFontWidth = editor.getFontWidth();\n\n    for(var attribute in values) {\n\n        switch(attribute) {\n            case 'stroke-width':\n                values[attribute] = getWidths(normaStrokeWidth);\n                break;\n\n            case 'stroke-linejoin':\n                values[attribute] = getLineJoins();\n                break;\n\n            case 'font-size':\n                values[attribute] = getFontSizes(normaFontWidth);\n                break;\n\n            case 'font-family':\n                values[attribute] = getFontFamilies();\n                break;\n\n            case 'font-style':\n                values[attribute] = getFontStyles();\n                break;\n\n            case 'font-weight':\n                values[attribute] = getFontWeights();\n                break;\n\n            case 'stroke-color':\n            case 'fill-color':\n                values[attribute] = getColors();\n                break;\n\n            case 'stroke-opacity':\n                var defaultTransparent = false;\n                values[attribute] = getOpacities(defaultTransparent);\n                break;\n\n            case 'fill-opacity':\n                var defaultTransparent = true;\n                values[attribute] = getOpacities(defaultTransparent);\n                break;\n\n            case 'text-data':\n                values[attribute] = getSvgString();\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    return values;\n};\n","'use strict';\n\n    /**\n     * Fired whenever the drawing tool changes. For example, when the Arrow drawing\n     * tool changes into the Rectangle drawing tool.\n     * See {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#changeEditMode|MarkupsCore.changeEditMode()}\n     * for a list of all supported drawing tools (EditModes).\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_CHANGED\n     * @type {string}\n     */\n    export const EVENT_EDITMODE_CHANGED = \"EVENT_EDITMODE_CHANGED\";\n\n    /**\n     * Fired when Edit mode has been enabled, which allows the end user to start\n     * drawing markups over the Viewer canvas.\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|MarkupsCore.enterEditMode()}.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_ENTER\n     * @type {string}\n     */\n    export const EVENT_EDITMODE_ENTER = \"EVENT_EDITMODE_ENTER\";\n\n    /**\n     * Fired when Edit mode has been disabled, preventing the end user from\n     * drawing markups over the Viewer canvas.\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|MarkupsCore.leaveEditMode()}.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_EDITMODE_LEAVE\n     * @type {string}\n     */\n    export const EVENT_EDITMODE_LEAVE = \"EVENT_EDITMODE_LEAVE\";\n\n    /**\n     * Fired when a drawn markup has been selected by the end user with a click command.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_SELECTED\n     * @type {string}\n     */\n    export const EVENT_MARKUP_SELECTED = \"EVENT_MARKUP_SELECTED\";\n\n    /**\n     * Fired when a drawn markup is being dragged over the Viewer canvas.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DRAGGING\n     * @type {string}\n     */\n    export const EVENT_MARKUP_DRAGGING = \"EVENT_MARKUP_DRAGGING\";\n\n    /**\n     * Internal usage only.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_ENTER_EDITION\n     * @type {string}\n     * @private\n     */\n    export const EVENT_MARKUP_ENTER_EDITION = \"EVENT_MARKUP_ENTER_EDITION\";\n\n    /**\n     * Internal usage only.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_CANCEL_EDITION\n     * @type {string}\n     * @private\n     */\n    export const EVENT_MARKUP_CANCEL_EDITION = \"EVENT_MARKUP_CANCEL_EDITION\";\n\n    /**\n     * Internal usage only.\n     * \n     * @event Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#EVENT_MARKUP_DELETE_EDITION\n     * @type {string}\n     * @private\n     */\n    export const EVENT_MARKUP_DELETE_EDITION = \"EVENT_MARKUP_DELETE_EDITION\";\n\n\n    /**\n     * Fired whenever a new undo or redo action is available.\n     */\n    export const EVENT_HISTORY_CHANGED = \"EVENT_HISTORY_CHANGED\";\n\n    /**\n     * Fired when a markup creation begins. \n     * For example, as soon as the user starts dragging with the mouse\n     * to draw an arrow on the screen.\n     */\n    export const EVENT_EDITMODE_CREATION_BEGIN = \"EVENT_EDITMODE_CREATION_BEGIN\";\n\n    /**\n     * Fired when a markup has been created.\n     * For example, as soon as the user stops dragging and releases the\n     * mouse button to finish drawing an arrow on the screen\n     */\n    export const EVENT_EDITMODE_CREATION_END = \"EVENT_EDITMODE_CREATION_END\";\n\n    /**\n     * Fired when a markup is no longer selected.\n     */\n    export const EVENT_MARKUP_DESELECT = \"EVENT_MARKUP_DESELECT\";\n\n    /**\n     * The selected markup is being modified\n     */\n    export const EVENT_EDITFRAME_EDITION_START = \"EVENT_EDITFRAME_EDITION_START\";\n\n    /**\n     * The selected markup is no longer being modified\n     */\n    export const EVENT_EDITFRAME_EDITION_END = \"EVENT_EDITFRAME_EDITION_END\";","'use strict';\n\nimport { addTraitEventDispatcher, renderToCanvas, radiansToDegrees, \n         checkPolygon, checkLineSegment, isTouchDevice } from './MarkupsCoreUtils'\nimport { createStyle, copyStyle, cloneStyle } from './StyleUtils'\nimport * as MarkupEvents from './MarkupEvents'\n\n    var av = Autodesk.Viewing;\n\n    /**\n     * Base class for all markups.\n     *\n     * A Markup is a class that is capable of rendering itself as an Svg node.<br>\n     * It can also render itself into a canvas-2d context.\n     * Component within {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore} extension.\n     *\n     * Any class extending Markup should contain at least the following methods:\n     * - getEditMode()\n     * - set()\n     * - updateStyle()\n     * - setParent()\n     * - setRotation()\n     * - setSize()\n     * - setPosition()\n     * - renderToCanvas()\n     * - setMetadata()\n     *\n     * A good reference is the rectangle markup implementation available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupRectangle|MarkupRectangle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {number} id - Identifier, populated with return value of {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#getId getId()}.\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension\n     * @param {Array} styleAttributes - Attributes for customization. Related to {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#setStyle setStyle()}.\n     * @constructor\n     */\n    export function Markup(id, editor, styleAttributes) {\n\n        this.id = id;\n        this.type = \"\";\n        this.editor = editor;\n        this.viewer = editor.viewer;\n        this.setGlobalManager(this.viewer.globalManager);\n        this.position = {x: 0, y: 0};\n        this.size = {x:0, y:0};\n        this.rotation = 0;\n        this.style = createStyle(styleAttributes, this.editor);\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\n        this.highlightColor = '#0696D7';\n        this.constraintWidth = false;\n        this.constraintHeight = false;\n        this.constraintRotation = false;\n        this.minWidth = -10000;\n        this.minHeight = -10000;\n        this.highlighted = false;\n        this.selected = false;\n\n        // bind to this to pass this.globalManager\n        this.checkLineSegment = checkLineSegment.bind(this);\n        this.checkPolygon = checkPolygon.bind(this);\n        this.renderToCanvasX = renderToCanvas.bind(this);\n\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(Markup.prototype);\n    var proto = Markup.prototype;\n\n    proto.destroy = function () {\n\n        this.unselect();\n        this.setParent(null);\n    };\n\n    /**\n     * Specifies the parent layer which will contain the markup.\n     * @param {HTMLElement} parent\n     */\n    proto.setParent = function(parent) {\n\n        var div = this.shape;\n        div.parentNode && div.parentNode.removeChild(div);\n        parent && parent.appendChild(div);\n    };\n\n    /**\n     * Clones (deep-copy) the markup. Used internally by the copy/cut/paste mechanism in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore MarkupsCore}.\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} clone of the current markup\n     */\n    proto.clone = function() {\n\n        var clone = Object.create(this.__proto__);\n        var overrides = this.getCloneOverrides();\n\n        for (var name in this) {\n\n            if(!this.hasOwnProperty(name)) {\n                continue;\n            }\n\n            var member = this[name];\n\n            // Is there an override for this member?\n            if (overrides.hasOwnProperty(name)) {\n                clone[name] = overrides[name];\n                continue;\n            }\n\n            // Member is null or undefined?\n            if (member === null || member === undefined) {\n                clone[name] = member;\n                continue;\n            }\n\n            // Member has a clone function?\n            if (member['clone'] instanceof Function) {\n                clone[name] = member.clone();\n                continue;\n            }\n\n            // Is it a function?\n            if (member instanceof Function) {\n                clone[name] = member.bind(clone);\n                continue;\n            }\n\n            // Is it an html node?\n            if (member.nodeType) {\n                clone[name] = member.cloneNode(true);\n                continue;\n            }\n\n            // Is it the globalManager?\n            if (member instanceof av.GlobalManager) {\n                av.GlobalManagerMixin.call(clone);\n                clone.setGlobalManager(member);\n                continue;\n            }\n\n            // Just a plain object?\n            if (member instanceof Object) {\n                clone[name] = JSON.parse(JSON.stringify(member));\n                continue;\n            }\n\n            // Ok, it seems it's just a primitive type.\n            clone[name] = member;\n        }\n\n        this.cloneShape(clone);\n        return clone;\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape.markup = clone.shape.childNodes.item(0);\n        clone.shape.hitarea = clone.shape.childNodes.item(1);\n        clone.bindDomEvents();\n    };\n\n    /**\n     * Used internally by\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#clone clone()},\n     * provides a mechanism to avoid cloning specific attributes.<br>\n     * Developers only need to override this method when creating new Markup types.\n     * When overriding, first call the super() implementation and then include additional attribute/value pairs to it.\n     * @returns {Object} containing attributes that need not to be cloned.\n     */\n    proto.getCloneOverrides = function() {\n\n        return {\n            viewer: this.viewer,\n            editor: this.editor,\n            hammer: null,\n            listeners: {}\n        }\n    };\n\n    /**\n     * Used internally to select a markup.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_SELECTED.\n     */\n    proto.select = function () {\n\n        if (this.selected) {\n            return;\n        }\n\n        this.selected = true;\n        this.highlighted = false;\n        this.updateStyle();\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_SELECTED, markup: this});\n    };\n\n    /**\n     * Used internally to signal that the current markup has been unselected.<br>\n     * No event is fired.\n     */\n    proto.unselect = function() {\n\n        this.selected = false;\n    };\n\n    proto.highlight = function(highlight) {\n\n        if (this.interactionsDisabled) {\n            return;\n        }\n\n        this.highlighted = highlight;\n        this.updateStyle();\n    };\n\n    /**\n     * Returns a copy of the markup's style.\n     * @returns {Object}\n     */\n    proto.getStyle = function() {\n\n        return cloneStyle(this.style);\n    };\n\n    /**\n     * Used internally to set the style object. Triggers a re-render of the markup (Svg)\n     * @param {Object} style - Dictionary with key/value pairs\n     */\n    proto.setStyle = function(style) {\n\n        copyStyle(style, this.style);\n        this.updateStyle();\n    };\n\n    /**\n     * Used internally and implemented by specific Markup types to render themselves as Svg.\n     */\n    proto.updateStyle = function () {\n\n    };\n\n    /**\n     * Used internally to notify the markup that it is now being edited.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_ENTER_EDITION.\n     */\n    proto.edit = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_ENTER_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to signal that it is no longer being edited.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_CANCEL_EDITION.\n     */\n    proto.cancel = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to signal that the markup is being deleted.<br>\n     * Fires event Autodesk.Viewing.Extensions.Markups.Core.EVENT_MARKUP_DELETE_EDITION.\n     */\n    proto.deleteMarkup = function() {\n\n        this.dispatchEvent({type: MarkupEvents.EVENT_MARKUP_DELETE_EDITION, markup: this});\n    };\n\n    /**\n     * Used internally to get the {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode EditMode}\n     * associated with the current Markup.<br>\n     * Implemented by classes extending this one.\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.EditMode}\n     */\n    proto.getEditMode = function() {\n\n        console.warn('EditMode of markup type' + this.type + ' not defined.' );\n        return null;\n    };\n\n    /**\n     * Used internally to get the markup's position in browser pixel space.<br>\n     * Notice that (0,0) is top left.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientSize|getClientSize()}.\n     * @returns {*}\n     */\n    proto.getClientPosition = function() {\n\n        var position = this.position;\n        return this.editor.positionFromMarkupsToClient(position.x, position.y);\n    };\n\n    /**\n     * Used internally to get the markup's bounding rect in browser pixel space.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup#getClientPosition|getClientPosition()}.\n     * @returns {*}\n     */\n    proto.getClientSize = function () {\n\n        var size = this.size;\n        return this.editor.sizeFromMarkupsToClient(size.x, size.y);\n    };\n\n    /**\n     * Used internally to get the markup's bounding rect in browser pixel space, including the stroke width.<br>\n     * @returns {Object} a rectangle with right, top, left, bottom attributes\n     */\n    proto.getBoundingRect = function () {\n\n        var rotation = this.rotation;\n\n        if (rotation !== 0) { // Undo rotation to find a tight bounding rect\n            this.setRotation(0);\n        }\n\n        var parentRect = this.viewer.impl.getCanvasBoundingClientRect();\n\n        var boundRect = this.shape.markup.getBoundingClientRect();\n        var top = boundRect.top - parentRect.top;\n\n        var strokeWidth = this.style['stroke-width'] || 0;\n        var offset = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\n\n        if (rotation !== 0) {\n            this.setRotation(rotation);\n        }\n\n        return {\n            x: boundRect.left - parentRect.left - offset,\n            y: top - offset,\n            width: boundRect.width + 2*offset,\n            height: boundRect.height + 2*offset\n        };\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        this.rotation = angle;\n        this.updateStyle();\n    };\n\n    proto.getRotation = function () {\n\n        return this.rotation;\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function(x,y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.isWidthConstrained = function() {\n\n        return this.constraintWidth;\n    };\n\n    proto.isHeightConstrained = function() {\n\n        return this.constraintHeight;\n    };\n\n    proto.isRotationConstrained = function() {\n\n        return this.constraintRotation;\n    };\n\n    proto.setMinWidth = function(minWidth) {\n        this.minWidth = minWidth;\n    };\n\n    proto.setMinHeight = function(minHeight) {\n        this.minHeight = minHeight;\n    };\n\n    proto.getMinWidth = function() {\n        return this.minWidth;\n    };\n\n    proto.getMinHeight = function() {\n        return this.minHeight;\n    };\n\n    /**\n     * Used to disable highlight on annotations while a new annotation is being created.\n     * @param {Boolean} disable - Whether (mouse) interactions are enable.\n     */\n    proto.disableInteractions = function(disable) {\n\n        this.interactionsDisabled = disable;\n    };\n\n    /**\n     *\n     * @param width\n     */\n    proto.setStrokeWidth = function(width) {\n\n    };\n\n    proto.constrainsToBounds = function(bounds) {\n\n    };\n\n    proto.onMouseDown = function(event) {\n\n        if (this.interactionsDisabled) {\n            return;\n        }\n\n        this.select();\n        this.editor.editFrame.startDrag(event);\n    };\n\n    /**\n     *\n     * @param idTarget\n     * @returns *\n     */\n    proto.generatePoint3d = function(idTarget) {\n\n        var viewer = this.viewer;\n        var polygon = this.generateBoundingPolygon();\n        var self = this;\n\n        function checkLineSegmentAux(a, b) {\n\n            var point2d = self.checkLineSegment(a.x, a.y, b.x, b.y, idTarget);\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\n            return point3d && point3d.point;\n        }\n\n        function checkPolygonAux(polygon) {\n\n            var point2d = self.checkPolygon(polygon, idTarget);\n            var point3d = point2d && viewer.clientToWorld(point2d.x, point2d.y);\n            return point3d && point3d.point;\n        }\n\n        // Try to avoid expensive calculations by checking some lines segments first.\n        // If line check cannot find a point the costly one by area is used.\n        // A ----midAB---- B\n        // |               |\n        // |     center    |\n        // |               |\n        // C --------------D\n\n        var xVertices = polygon.xVertices;\n        var yVertices = polygon.yVertices;\n\n        var midAB = new THREE.Vector2(xVertices[0] + xVertices[1], yVertices[0] + yVertices[1]).multiplyScalar(0.5);\n        var midAC = new THREE.Vector2(xVertices[0] + xVertices[3], yVertices[0] + yVertices[3]).multiplyScalar(0.5);\n        var midDB = new THREE.Vector2(xVertices[2] + xVertices[1], yVertices[2] + yVertices[1]).multiplyScalar(0.5);\n        var midDC = new THREE.Vector2(xVertices[2] + xVertices[3], yVertices[2] + yVertices[3]).multiplyScalar(0.5);\n        var center = midAC.clone().add(midDB).multiplyScalar(0.5);\n\n        var point3d =\n            checkLineSegmentAux(center, midDB) ||\n            checkLineSegmentAux(center, midAC) ||\n            checkLineSegmentAux(center, midAB) ||\n            checkLineSegmentAux(center, midDC);\n\n        return point3d || checkPolygonAux(polygon);\n    };\n\n    /**\n     *\n     * @returns {{min: {x: number, y: number}, max: {x: number, y: number}}}\n     */\n    proto.generateBoundingBox = function() {\n\n        var boundingBox = {min: {x: 0,y: 0}, max: {x: 0, y: 0}};\n\n        // Get bounding box from markup bounding polygon.\n        var polygon = this.generateBoundingPolygon();\n\n        var vertexCount = polygon.vertexCount;\n        var xVertices = polygon.xVertices;\n        var yVertices = polygon.yVertices;\n\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < vertexCount; ++i) {\n\n            var bbX = xVertices[i];\n            var bbY = yVertices[i];\n\n            bbX0 = Math.min(bbX0, bbX);\n            bbY0 = Math.min(bbY0, bbY);\n            bbX1 = Math.max(bbX1, bbX);\n            bbY1 = Math.max(bbY1, bbY);\n        }\n\n        boundingBox.min.x = bbX0;\n        boundingBox.min.y = bbY0;\n        boundingBox.max.x = bbX1;\n        boundingBox.max.y = bbY1;\n\n        return boundingBox;\n    };\n\n    /**\n     *\n     * @returns {{vertexCount: number, xVertices: Float32Array, yVertices: Float32Array}}\n     */\n    proto.generateBoundingPolygon = function() {\n\n        var position = this.getClientPosition();\n        var halfSize = this.getClientSize();\n\n        halfSize.x *= 0.5;\n        halfSize.y *= 0.5;\n\n        var lt = new THREE.Vector3(-halfSize.x,-halfSize.y).add(position);\n        var rt = new THREE.Vector3( halfSize.x,-halfSize.y).add(position);\n        var rb = new THREE.Vector3( halfSize.x, halfSize.y).add(position);\n        var lb = new THREE.Vector3(-halfSize.x, halfSize.y).add(position);\n\n        if (this.rotation !== 0) {\n\n            var m1 = new THREE.Matrix4().makeTranslation(-position.x, -position.y, 0);\n            var m2 = new THREE.Matrix4().makeRotationZ(this.rotation);\n            var m3 = new THREE.Matrix4().makeTranslation(position.x, position.y, 0);\n            var transform = m3.multiply(m2).multiply(m1);\n\n            lt.applyMatrix4(transform);\n            rt.applyMatrix4(transform);\n            rb.applyMatrix4(transform);\n            lb.applyMatrix4(transform);\n        }\n\n        return { // packed for fast access in test algorithm.\n            vertexCount: 4,\n            xVertices : new Float32Array([lt.x, rt.x, rb.x, lb.x]),\n            yVertices : new Float32Array([lt.y, rt.y, rb.y, lb.y])\n        };\n    };\n\n    /**\n     * Implemented by extending classes.<br>\n     * Gets called automatically when\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore#generateData|generateData()}\n     * @returns {null|Element} - Either null (default) or the metadata Svg node\n     */\n    proto.setMetadata = function() {\n\n        return null; // No metadata is injected by default.\n    };\n\n    proto.setMouseDisabledWhenTouching = function(event) {\n\n        if (event.isFirst) {\n            this.shape.removeEventListener('mousedown', this.onMouseDownBinded);\n        } else if (event.isFinal) {\n            var _this = this;\n            setTimeout(function() {\n                _this.shape.addEventListener('mousedown', _this.onMouseDownBinded);\n            }, 10);\n        }\n    };\n\n    proto.bindDomEvents = function() {\n\n        if (isTouchDevice()) {\n\n            this.hammer = new av.Hammer.Manager(this.shape, {\n                recognizers: [\n                    av.GestureRecognizers.singletap\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\n            });\n\n            this.onSingleTapBinded = function(event) {\n\n                this.onMouseDown(event);\n            }.bind(this);\n\n            this.onHammerInputBinded = function(event) {\n\n                this.setMouseDisabledWhenTouching(event);\n            }.bind(this);\n\n            this.hammer.on('singletap', this.onSingleTapBinded);\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\n        }\n\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\n        this.onMouseOutBinded = function() {\n\n            this.highlight(false);\n        }.bind(this);\n\n        this.onMouseOverBinded = function() {\n\n            this.highlight(true);\n        }.bind(this);\n\n        this.shape.addEventListener('mousedown', this.onMouseDownBinded);\n        this.shape.addEventListener('mouseout', this.onMouseOutBinded);\n        this.shape.addEventListener('mouseover', this.onMouseOverBinded);\n    };\n\n    proto.renderToCanvas = function(ctx, viewBox, width, height, callback) {\n\n        this.renderToCanvasX(this.shape, viewBox, width, height, ctx, callback);\n    };\n\n    proto.getPath = function() {\n\n    };\n\n    proto.getTransform = function() {\n\n        return [\n            'translate(', this.position.x, ',', this.position.y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')'\n        ].join(' ');\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param style\n     * @constructor\n     */\n    export function SetStyle(editor, markup, style) {\n\n        EditAction.call(this, editor, 'SET-STYLE', markup.id);\n\n        this.newStyle = cloneStyle(style);\n        this.oldStyle = markup.getStyle();\n    }\n\n    SetStyle.prototype = Object.create(EditAction.prototype);\n    SetStyle.prototype.constructor = SetStyle;\n\n    var proto = SetStyle.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setStyle(this.newStyle);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setStyle(this.oldStyle);\n    };\n","'use strict';\n\nimport * as MarkupEvents from '../MarkupEvents'\nimport { createStyle, copyStyle } from '../StyleUtils'\nimport { addTraitEventDispatcher, removeTraitEventDispatcher, sign } from '../MarkupsCoreUtils'\nimport { SetStyle } from '../edit-actions/SetStyle'\n\nconst av = Autodesk.Viewing;\n\n    /**\n     * Base class for all markup edit modes.\n     *\n     * An EditMode is responsible for handling user input to create and edit a\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     *\n     * Any class extending Markup should contain at least the following methods:\n     * - deleteMarkup()\n     * - onMouseDown()\n     * - onMouseMove()\n     *\n     * A good reference is the Circle EditMode implementation available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle|EditModeCircle}.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor - Markups extension.\n     * @param {String} type - An identifier for the EditMode type. Not to be confused by the Markup's id.\n     * @param {Array} styleAttributes - Attributes for customization.\n     * @constructor\n     */\n    export function EditMode(editor, type, styleAttributes) {\n\n        this.editor = editor;\n        this.viewer = editor.viewer;\n        this.setGlobalManager(this.viewer.globalManager);\n        this.type = type;\n        this.selectedMarkup = null;\n        this.dragging = false;\n        this.draggingAnnotationIniPosition = null;\n        this.draggingMouseIniPosition = new THREE.Vector2();\n        this.initialX = 0;\n        this.initialY = 0;\n        this.minSize = 9; // In pixels\n        this.creating = false;\n        this.size = {x: 0, y: 0};\n        this.style = createStyle(styleAttributes, this.editor);\n        this.style = copyStyle(editor.getDefaultStyle(), this.style);\n\n        this.CREATION_METHOD_DRAG = 'CREATION_METHOD_DRAG';\n        this.CREATION_METHOD_CLICK = 'CREATION_METHOD_CLICK';\n        this.CREATION_METHOD_CLICKS = 'CREATION_METHOD_CLICKS';\n        this.creationMethod = this.CREATION_METHOD_DRAG;\n\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(EditMode.prototype);\n    var proto = EditMode.prototype;\n\n    proto.destroy = function() {\n\n        this.unselect();\n        removeTraitEventDispatcher(this);\n    };\n\n    proto.unselect = function() {\n\n        var fireEv = false;\n        var selectedMarkup = this.selectedMarkup;\n        var selectedId = null;\n\n        if (selectedMarkup) {\n            selectedId = selectedMarkup.id;\n            selectedMarkup.unselect();\n            this.selectedMarkup = null;\n            fireEv = true;\n        }\n\n        this.editor.editFrame.setMarkup(null);\n\n        if (fireEv) {\n            this.dispatchEvent({ type: MarkupEvents.EVENT_MARKUP_DESELECT, markupId: selectedId });\n        }\n    };\n\n    proto.creationBegin = function() {\n\n        if (this.creating) {\n            return;\n        }\n\n        this.creating = true;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN });\n    };\n\n    proto.creationEnd = function(isCancelling) {\n\n        if (!this.creating) {\n            return false;\n        }\n\n        if (this.creationMethod !== this.CREATION_METHOD_CLICK) {\n\n            if (this.selectedMarkup && !this.isMinSizeValid()) {\n\n                this.creationCancel();\n                isCancelling = true;\n            } else {\n\n                if (this.creationMethod === this.CREATION_METHOD_DRAG) {\n                    this.finishDragging();\n                }\n\n                if (this.selectedMarkup) {\n\n                    // Opened on mouse down.\n                    this.editor.closeActionGroup();\n                    this.selectedMarkup = null;\n                }\n            }\n        }\n\n        this.creating = false;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_CREATION_END, creationCancelled: !!isCancelling });\n        return true;\n    };\n\n    proto.creationCancel = function() {\n\n        this.editor.cancelActionGroup();\n        this.creationEnd(true);\n        this.selectedMarkup = null; // No need to call unselect\n    };\n\n    /**\n     *\n     * @param style\n     */\n    proto.setStyle = function(style) {\n\n        this.style = style;\n\n        var selectedMarkup = this.selectedMarkup;\n        if(!selectedMarkup) {\n            return;\n        }\n\n        var setStyle = new SetStyle(this.editor, selectedMarkup, style);\n        setStyle.execute();\n    };\n\n    proto.getStyle = function() {\n\n        return this.style;\n    };\n\n    proto.setSelection = function(markup) {\n\n        if (this.selectedMarkup !== markup) {\n            this.unselect();\n            markup && markup.select();\n        }\n\n        this.selectedMarkup = markup;\n\n        var editor = this.editor;\n        markup && editor.bringToFront(markup);\n\n        if (this.isTextInputHelperActive() && editor.editFrame.markup) {\n            this.textInputHelper.setEditFrame();\n        } else if (!this.creating) {\n            editor.editFrame.setMarkup(markup);\n        }\n    };\n\n    proto.getSelection = function() {\n\n        return this.selectedMarkup;\n    };\n\n    /**\n     *\n     * @param [markup] If provided deletes markup (has to have same type that the edit mode), otherwise deletes selected one.\n     * @param [cantUndo] If true to not add deletion to undo history.\n     * @returns {boolean}\n     */\n    proto.deleteMarkup = function (markup, cantUndo) {\n\n        return false;\n    };\n\n    /**\n     * Used by classes extending EditMode to validate the minimum size (in screen coordinates) of the markup.\n     * See minSize attribute\n     * @return {Boolean} Whether current size is valid for creating the markup\n     * @private\n     */\n    proto.isMinSizeValid = function() {\n\n        if (this.minSize !== 0) {\n\n            var tmp = this.editor.sizeFromMarkupsToClient(this.size.x, this.size.y);\n            return (tmp.x*tmp.x + tmp.y*tmp.y) >= (this.minSize * this.minSize);\n\n        }\n        return true;\n    };\n\n    /**\n     * @private\n     */\n    proto.startDragging = function() {\n\n        var selectedMarkup = this.selectedMarkup;\n        var mousePosition = this.editor.getMousePosition();\n\n        if (selectedMarkup) {\n\n            this.dragging = true;\n            this.draggingAnnotationIniPosition = selectedMarkup.getClientPosition();\n            this.draggingMouseIniPosition.set(mousePosition.x, mousePosition.y);\n        }\n    };\n\n    /**\n     * @private\n     */\n    proto.finishDragging = function() {\n\n        var dragging = this.dragging;\n        var selectedMarkup = this.selectedMarkup;\n\n        this.dragging = false;\n\n        if (selectedMarkup && dragging) {\n\n            selectedMarkup.finishDragging();\n        }\n    };\n\n    /**\n     *\n     * @returns {{x: number, y: number}}\n     */\n    proto.getFinalMouseDraggingPosition = function() {\n\n        var editor = this.editor;\n        var bounds = editor.getBounds();\n        var mousePosition = editor.getMousePosition();\n\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\n\n        if (finalX == initialX &&\n            finalY == initialY) {\n            finalX++;\n            finalY++;\n        }\n\n        // Make equal x/y when shift is down\n        if (editor.input.makeSameXY) {\n            var dx = Math.abs(finalX - initialX);\n            var dy = Math.abs(finalY - initialY);\n\n            var maxDelta = Math.max(dx, dy);\n\n            // These calculations have the opportunity to go beyond 'bounds'.\n            finalX = initialX + maxDelta * sign(finalX - initialX);\n            finalY = initialY + maxDelta * sign(finalY - initialY);\n        }\n\n        return { x:finalX, y:finalY };\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n    };\n\n    proto.onMouseMove = function (event) {\n        if (!this.selectedMarkup || !this.creating) {\n            return false;\n        }\n        return true;\n    };\n\n    proto.onMouseDown = function () {\n\n    };\n\n    /**\n     * Handler to mouse up events, used to start annotations creation.\n     * It will cancel the creation of a markup if its minSize conditions are not met.\n     *\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        if (this.creationMethod !== this.CREATION_METHOD_DRAG) {\n            return false;\n        }\n\n        return this.creationEnd();\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if (this.creationMethod !== this.CREATION_METHOD_CLICKS) {\n            return;\n        }\n\n        this.creationEnd();\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        if (this.creating) {\n            this.creationCancel();\n        }\n    };\n\n    /**\n     *\n     * @returns {{x: *, y: *}}\n     */\n    proto.getDraggingPosition = function () {\n\n        var mousePosition = this.editor.getMousePosition();\n\n        var dx = mousePosition.x - this.draggingMouseIniPosition.x;\n        var dy = mousePosition.y - this.draggingMouseIniPosition.y;\n\n        return {\n            x: this.draggingAnnotationIniPosition.x + dx,\n            y: this.draggingAnnotationIniPosition.y + dy\n        };\n    };\n\n    /**\n     *\n     * @param x\n     * @param y\n     * @param bounds\n     * @returns {boolean}\n     * @orivate\n     */\n    proto.isInsideBounds = function (x, y, bounds) {\n\n        return x >= bounds.x && x <= bounds.x + bounds.width &&\n               y >= bounds.y && y <= bounds.y + bounds.height;\n    };\n\n    /*\n     * Decides whether to use the snapper in the current edit mode or not.\n     * \n     * @returns {boolean}\n     */\n    proto.useWithSnapping = function () {\n        return this.viewer.model.is2d();\n    };\n\n    \n    proto.isTextInputHelperActive = function() {\n        return this.textInputHelper && this.textInputHelper.isActive();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateArrow } from './CreateArrow'\n\n    /**\n     *\n     * @param editor\n     * @param arrow\n     * @constructor\n     */\n    export function DeleteArrow(editor, arrow) {\n\n        // Confusing naming here. Arrow.tail is the starting point of the arrow,\n        // and arrow.head is the final point. In CreateArrow the head argument\n        // is the first point of the arrow and the tail argument is the second\n        // point of the argument. So construct CreateArrow with the tail before\n        // the head. \n        EditAction.call(this, editor, 'DELETE-ARROW', arrow.id);\n        this.createArrow = new CreateArrow(\n            editor,\n            arrow.id,\n            arrow.tail,\n            arrow.head,\n            arrow.getStyle());\n    }\n\n    DeleteArrow.prototype = Object.create(EditAction.prototype);\n    DeleteArrow.prototype.constructor = DeleteArrow;\n\n    var proto = DeleteArrow.prototype;\n\n    proto.redo = function() {\n\n        this.createArrow.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createArrow.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param arrow\n     * @param head\n     * @param tail\n     * @constructor\n     */\n    export function SetArrow(editor, arrow, head, tail) {\n\n        EditAction.call(this, editor, 'SET-ARROW', arrow.id);\n\n        this.newHead = {x: head.x, y: head.y};\n        this.newTail = {x: tail.x, y: tail.y};\n        this.oldHead = {x: arrow.head.x, y: arrow.head.y};\n        this.oldTail = {x: arrow.tail.x, y: arrow.tail.y};\n    }\n\n    SetArrow.prototype = Object.create(EditAction.prototype);\n    SetArrow.prototype.constructor = SetArrow;\n\n    var proto = SetArrow.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newHead, this.newTail);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldHead, this.oldTail);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newHead = action.newHead;\n            this.newTail = action.newTail;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, head, tail) {\n\n        var arrow = this.editor.getMarkup(targetId);\n        if(!arrow) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(arrow.head.x - head.x) >= epsilon || Math.abs(arrow.head.y - head.y) >= epsilon ||\n            Math.abs(arrow.tail.x - tail.x) >= epsilon || Math.abs(arrow.tail.y - tail.y) >= epsilon) {\n\n            // Confusing naming here. in arrow.set the first two numbers are\n            // the point you drag from and the second two are the point you\n            // drag to. So the head point is actually where the tail of the\n            // arrow is positioned and the tail point is the head is positioned.\n            arrow.set(head.x, head.y, tail.x, tail.y);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newHead.x === this.oldHead.x &&\n            this.newHead.y === this.oldHead.y &&\n            this.newTail.x === this.oldTail.x &&\n            this.newTail.y === this.oldTail.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteArrow } from '../edit-actions/DeleteArrow'\nimport { CreateArrow } from '../edit-actions/CreateArrow'\nimport { SetArrow } from '../edit-actions/SetArrow'\nimport * as MarkupTypes from '../MarkupTypes'\n\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeArrow(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_ARROW, styleAttributes);\n    }\n\n    EditModeArrow.prototype = Object.create(EditMode.prototype);\n    EditModeArrow.prototype.constructor = EditModeArrow;\n\n\n    var proto = EditModeArrow.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteArrow = new DeleteArrow(this.editor, markup);\n            deleteArrow.addToHistory = !cantUndo;\n            deleteArrow.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        this.size.x = 0;\n        this.size.y = 0;\n\n        // Snap to parallel/perpendicular of underlying vectors\n        this.lineSnapped = null;\n        if (editor.snapper) {\n            var geomType = editor.snapper.getGeometryType();\n            if (geomType === MeasureCommon.SnapType.SNAP_VERTEX || \n                geomType === MeasureCommon.SnapType.SNAP_EDGE || \n                geomType === MeasureCommon.SnapType.SNAP_MIDPOINT || \n                geomType === MeasureCommon.SnapType.SNAP_CIRCLE_CENTER) \n            {\n                this.lineSnapped = editor.snapper.getEdge();\n            }\n        }\n\n        // Calculate head and tail.\n        var arrowMinSize = this.style['stroke-width'] * 3.5;\n\n        var head = this.head = editor.positionFromClientToMarkups(this.initialX, this.initialY);\n        var tail = {\n            x: head.x + Math.cos( Math.PI * 0.25) * arrowMinSize,\n            y: head.y + Math.sin(-Math.PI * 0.25) * arrowMinSize\n        };\n        // Constrain head and tail inside working area.\n        var constrain = function(head, tail, size, bounds) {\n\n            if (this.isInsideBounds(tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.y = head.y + Math.sin( Math.PI * 0.25) * size;\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.x = head.x + Math.cos(-Math.PI * 0.25) * size;\n            if (this.isInsideBounds( tail.x, tail.y, bounds)) {\n                return;\n            }\n\n            tail.y = head.y + Math.sin(-Math.PI * 0.25) * size;\n\n        }.bind(this);\n\n        constrain( head, tail, arrowMinSize, editor.getBounds());\n\n        // Create arrow.\n        editor.beginActionGroup();\n\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\n\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\n            tail.x = head.x + arrowVector.x;\n            tail.y = head.y + arrowVector.y;\n        }\n\n        var arrowId = editor.getId();\n        var create = new CreateArrow(editor, arrowId, head, tail, this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(arrowId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n        var final = this.getFinalMouseDraggingPosition();\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        // Snap to parallel/perpendicular of underlying vectors\n        if (editor.snapper && !editor.snapper.isSnapped() && this.lineSnapped) {\n            var start = editor.project(this.lineSnapped.vertices[0]);\n            var end = editor.project(this.lineSnapped.vertices[1]);\n            var p = new THREE.Vector3(final.x, final.y, start.z);\n\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\n\n            // select an arbitrary point on the perpendicular line\n            var k = -(start.x - end.x) / (start.y - end.y);\n            var b = initialY - k * initialX;\n            var x = initialX + 1;\n            var y = k * x + b;\n            var pEnd = new THREE.Vector3(x, y, start.z);\n\n            var pStart = new THREE.Vector3(initialX, initialY, start.z);\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\n\n            // Snap to parallel of underlying vectors\n            if (parallel.distanceTo(p) <= 20) {\n                final.x = parallel.x;\n                final.y = parallel.y;\n            }\n            // Snap to perpendicular of underlying vectors\n            else if (perpendicular.distanceTo(p) <= 20) {\n                final.x = perpendicular.x;\n                final.y = perpendicular.y;\n            }\n        }\n\n        var head = this.head;\n        var tail = editor.positionFromClientToMarkups(final.x, final.y);\n\n        var arrowVector = new THREE.Vector2(tail.x - head.x, tail.y - head.y);\n        var arrowMinSize = selectedMarkup.style['stroke-width'] * 3.5;\n\n        if (arrowVector.lengthSq() < arrowMinSize * arrowMinSize) {\n\n            arrowVector = arrowVector.normalize().multiplyScalar(arrowMinSize);\n            tail.x = head.x + arrowVector.x;\n            tail.y = head.y + arrowVector.y;\n        }\n\n        this.size = editor.sizeFromClientToMarkups((final.x - initialX), (final.y - initialY));\n\n        var setArrow = new SetArrow(editor, selectedMarkup, head, tail);\n        setArrow.execute();\n        return true;\n    };","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, checkLineSegment, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeArrow } from './edit-modes/EditModeArrow'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupArrow(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n        this.checkLineSegment = checkLineSegment.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_ARROW;\n        this.constraintHeight = true;\n\n        // Create head and tail.\n        this.head = new THREE.Vector3();\n        this.tail = new THREE.Vector3();\n        this.size.y = this.style['stroke-width'] * 3;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupArrow.prototype = Object.create(Markup.prototype);\n    MarkupArrow.prototype.constructor = MarkupArrow;\n\n    var proto = MarkupArrow.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeArrow(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * Notice that for the arrow, the top left is the \"tail\" of the arrow and\n     * the bottom right is the \"head\" of it.\n     *\n     * @param {Number} xO - tail\n     * @param {Number} yO - tail\n     * @param {Number} xF - head\n     * @param {Number} yF - head\n     */\n    proto.set = function(xO, yO, xF, yF) {\n\n        var vO = new THREE.Vector2(xO, yO);\n        var vF = new THREE.Vector2(xF, yF);\n        var vDir = vF.clone().sub(vO).normalize();\n\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\n\n        var head = this.head;\n        var tail = this.tail;\n\n        head.set(xF, yF, 0);\n        tail.set(xO, yO, 0);\n\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        this.rotation = angle;\n\n        var xF = Math.cos(-angle);\n        var yF = Math.sin(-angle);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(this.size.x*0.5);\n\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.head.set(vF.x, vF.y, 0);\n        this.tail.set(vO.x, vO.y, 0);\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the namespace.SetSize edit action\n     * @param {{x: Number, y: Number}} position - arrow's center\n     * @param {Number} width - Arrow's length\n     * @param {Number} height - We ignore this one because we use the arrow's stroke width instead\n     */\n    proto.setSize = function(position, width, height) {\n\n        var xF = Math.cos(-this.rotation);\n        var yF = Math.sin(-this.rotation);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(width*0.5);\n\n        var vCenter = new THREE.Vector2(position.x, position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.head.set(vF.x, vF.y, 0);\n        this.tail.set(vO.x, vO.y, 0);\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n\n        this.updateStyle();\n    };\n\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var strokeWidth = style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var transform = this.getTransform();\n\n        this.size.y = strokeWidth * 3;\n        this.style['fill-color'] = style['stroke-color'];\n        this.style['fill-opacity'] = style['stroke-opacity'];\n\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function (x, y) {\n\n        var head = this.head;\n        var tail = this.tail;\n\n        var dx = head.x - tail.x;\n        var dy = head.y - tail.y;\n\n        var xo = x + dx * 0.5;\n        var yo = y + dy * 0.5;\n\n        head.x = xo;\n        head.y = yo;\n\n        tail.x = xo - dx;\n        tail.y = yo - dy;\n\n        this.position.x = tail.x + (head.x - tail.x) * 0.5;\n        this.position.y = tail.y + (head.y - tail.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    proto.generatePoint3d = function(idTarget) {\n\n        var head = this.editor.positionFromMarkupsToClient(this.head.x, this.head.y);\n        var tail = this.editor.positionFromMarkupsToClient(this.tail.x, this.tail.y);\n\n        var direction = head.clone().sub(tail).normalize();\n\n        var point2d = this.checkLineSegment(head.x, head.y, head.x + direction.x * 200, head.y + direction.y * 200, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n\n        return point3d && point3d.point;\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.head = [this.head.x, this.head.y].join(\" \");\n        metadata.tail = [this.tail.x, this.tail.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        // To build the arrow we need 7 points in total\n        // The 'default' arrow built here has the following characteristics:\n        //\n        // 1. It is built horizontally facing right\n        // 2. It's bounding rectangle has length: this.size.x\n        // 3. It's bounding rectangle has height: 2 * this.strokeWidth\n        // 4. The arrow tail's thickness is: this.strokeWidth\n        // 5. The arrow head's length is: 2/3 of (point 3)\n        // 6. The arrow head's thickness is: (point 3)\n        // 7. The arrow generated is centered in its local (0,0), meaning that\n        //    two points are placed with negative x values, and all other have\n        //    positive x values:\n        //\n        //                            (3)\\\n        //                              \\  \\\n        //             (1)-------------(2)   \\\n        //              |         (0)        (4)\n        //             (7)-------------(6)   /\n        //                              /  /\n        //                            (5)/\n        //\n\n        var sizeX = this.size.x;\n        var sizeY = this.size.y;\n        var sizeYOver3 = sizeY/3;\n        var strokeWidth = this.style['stroke-width'];\n        var tailW = sizeX - strokeWidth * 3;\n        var headW = sizeX - tailW;\n        var spikeOffset = strokeWidth * 0.3;\n\n        return [\n            'M', -sizeX * 0.5        , -sizeY * 0.5 + sizeYOver3,    // (1)\n            'l',  tailW              ,  0,                           // (2)\n            'l', -spikeOffset        , -sizeYOver3,                  // (3)\n            'l',  headW + spikeOffset,  sizeYOver3 * 1.5,            // (4)\n            'l', -headW - spikeOffset,  sizeYOver3 * 1.5,            // (5)\n            'l',  spikeOffset        , -sizeYOver3,                  // (6)\n            'l', -tailW              ,  0,                           // (7)\n            'z'\n        ];\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupArrow } from '../MarkupArrow'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     * @constructor\n     */\n    export function CreateArrow(editor, id, head, tail, style) {\n\n        EditAction.call(this, editor, 'CREATE-ARROW', id);\n\n        this.selectOnExecution = false;\n        this.tail = tail;\n        this.head = head;\n        this.style = cloneStyle(style);\n    }\n\n    CreateArrow.prototype = Object.create(EditAction.prototype);\n    CreateArrow.prototype.constructor = CreateArrow;\n\n    var proto = CreateArrow.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var arrow = new MarkupArrow(this.targetId, editor);\n\n        editor.addMarkup(arrow);\n\n        // Confusing naming here. in arrow.set the first two numbers are\n        // the point you drag from and the second two are the point you\n        // drag to. So the head point is actually where the tail of the\n        // arrow is positioned and the tail point is the head is positioned.\n\n        //TODO: In MarkupArrow \"set\" function has tail x, tail y, head x, head y but used here in the opposite way\n        arrow.set(this.head.x, this.head.y, this.tail.x, this.tail.y);\n        arrow.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateRectangle } from './CreateRectangle'\n\n    /**\n     *\n     * @param editor\n     * @param rectangle\n     * @constructor\n     */\n    export var DeleteRectangle = function(editor, rectangle) {\n\n        EditAction.call(this, editor, 'DELETE-RECTANGLE', rectangle.id);\n        this.createRectangle = new CreateRectangle(\n            editor,\n            rectangle.id,\n            rectangle.position,\n            rectangle.size,\n            rectangle.rotation,\n            rectangle.getStyle());\n    };\n\n    DeleteRectangle.prototype = Object.create(EditAction.prototype);\n    DeleteRectangle.prototype.constructor = DeleteRectangle;\n\n    var proto = DeleteRectangle.prototype;\n\n    proto.redo = function() {\n\n        this.createRectangle.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createRectangle.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param rectangle\n     * @param position\n     * @param size\n     * @constructor\n     */\n    export function SetRectangle(editor, rectangle, position, size) {\n\n        EditAction.call(this, editor, 'SET-RECTANGLE', rectangle.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: rectangle.position.x, y: rectangle.position.y};\n        this.oldSize = {x: rectangle.size.x, y: rectangle.size.y};\n    }\n\n    SetRectangle.prototype = Object.create(EditAction.prototype);\n    SetRectangle.prototype.constructor = SetRectangle;\n\n    var proto = SetRectangle.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var rectangle = this.editor.getMarkup(targetId);\n        if(!rectangle) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(rectangle.position.x - position.x) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon ||\n            Math.abs(rectangle.position.y - position.y) > epsilon || Math.abs(rectangle.size.y - size.y) > epsilon) {\n\n            rectangle.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return(\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteRectangle } from '../edit-actions/DeleteRectangle'\nimport { CreateRectangle } from '../edit-actions/CreateRectangle'\nimport { SetRectangle } from '../edit-actions/SetRectangle'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeRectangle(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_RECTANGLE, styleAttributes);\n    }\n\n    EditModeRectangle.prototype = Object.create(EditMode.prototype);\n    EditModeRectangle.prototype.constructor = EditModeRectangle;\n\n    var proto = EditModeRectangle.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteRectangle = new DeleteRectangle(this.editor, markup);\n            deleteRectangle.addToHistory = !cantUndo;\n            deleteRectangle.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        var pos = this.getFinalMouseDraggingPosition();\n        var final = editor.clientToMarkups(pos.x, pos.y);\n        var position = {x: (this.firstCorner.x + final.x) / 2, y: (this.firstCorner.y + final.y) / 2};\n\n        var width, height;\n        // Snap to parallel/perpendicular of underlying vectors\n        if (editor.snapper && this.lineSnapped) {\n            var start = editor.project(this.lineSnapped.vertices[0]);\n            var end = editor.project(this.lineSnapped.vertices[1]);\n\n            var startZ = start.z;\n\n            start = editor.clientToMarkups(start.x, start.y);\n            end = editor.clientToMarkups(end.x, end.y);\n\n            start = new THREE.Vector3(start.x, start.y, startZ);\n            end = new THREE.Vector3(end.x, end.y, startZ);\n\n            var p = new THREE.Vector3(final.x, final.y, startZ);\n\n            var parallel = MeasureCommon.nearestPointInPointToLine(p, start, end);\n            height = p.distanceTo(parallel);\n\n            // select an arbitrary point on the perpendicular line\n            var k = -(start.x - end.x) / (start.y - end.y);\n            var b = this.firstCorner.y - k * this.firstCorner.x;\n            var x = this.firstCorner.x + 1;\n            var y = k * x + b;\n            var pEnd = new THREE.Vector3(x, y, startZ);\n\n            var pStart = new THREE.Vector3(this.firstCorner.x, this.firstCorner.y, startZ);\n            var perpendicular = MeasureCommon.nearestPointInPointToLine(p, pStart, pEnd);\n            width = p.distanceTo(perpendicular);\n        }\n        else {\n            width = final.x - this.firstCorner.x;\n            height = final.y - this.firstCorner.y;\n        }\n\n        var size = this.size = {x: Math.abs(width), y: Math.abs(height)};\n\n        var setRectangle = new SetRectangle(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setRectangle.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstCorner = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Calculate rotation\n        var rotation = 0;\n        this.lineSnapped = null;\n        if (editor.snapper) {\n            // Snap to parallel/perpendicular of underlying vectors\n            var geomType = editor.snapper.getGeometryType();\n            if (geomType === MeasureCommon.SnapType.SNAP_EDGE) {\n                this.lineSnapped = editor.snapper.getEdge();\n                var start = editor.project(this.lineSnapped.vertices[0]);\n                var end = editor.project(this.lineSnapped.vertices[1]);\n                var dx = end.x - start.x;\n                var dy = end.y - start.y;\n                rotation = this.rotation = Math.atan2(dy, dx);\n            }\n        }\n\n        // Create rectangle.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateRectangle(\n            editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, createRectanglePath,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeRectangle } from './edit-modes/EditModeRectangle'\n\n    /**\n     * Rectangle markup.\n     *\n     * Implements a Rectangle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific markup type. Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.Markup\n     *\n     * @param {number} id\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     * @constructor\n     */\n    export function MarkupRectangle(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // Bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_RECTANGLE;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupRectangle.prototype = Object.create(Markup.prototype);\n    MarkupRectangle.prototype.constructor = MarkupRectangle;\n\n    var proto = MarkupRectangle.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeRectangle(this.editor);\n    };\n\n    /**\n     * Sets position and size in markup space coordinates\n     * @param {Object} position\n     * @param {Object} size\n     */\n    proto.set = function(position, size) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var strokeWidth = this.style['stroke-width'];\n\n        var w = this.size.x - strokeWidth;\n        var h = this.size.y - strokeWidth;\n        var x =-w * 0.5;\n        var y =-h * 0.5;\n\n        var path = [];\n        createRectanglePath(x, y, w, h, false, path);\n\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupRectangle } from '../MarkupRectangle'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     * @constructor\n     */\n    export function CreateRectangle(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-RECTANGLE', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateRectangle.prototype = Object.create(EditAction.prototype);\n    CreateRectangle.prototype.constructor = CreateRectangle;\n\n    var proto = CreateRectangle.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var rectangle = new MarkupRectangle(this.targetId, editor);\n\n        editor.addMarkup(rectangle);\n\n        rectangle.set(this.position, this.size);\n        rectangle.setRotation(this.rotation);\n        rectangle.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateText } from './CreateText'\n\n    /**\n     *\n     * @param editor\n     * @param text\n     * @constructor\n     */\n    export function DeleteText(editor, text) {\n\n        EditAction.call(this, editor, 'DELETE-TEXT', text.id);\n\n        var position = {x: text.position.x, y: text.position.y};\n        var size = {x: text.size.x, y: text.size.y};\n\n        this.createText = new CreateText(\n            editor,\n            text.id,\n            position,\n            size,\n            text.getText(),\n            text.getStyle());\n    }\n\n    DeleteText.prototype = Object.create(EditAction.prototype);\n    DeleteText.prototype.constructor = DeleteText;\n\n    var proto = DeleteText.prototype;\n\n    proto.redo = function() {\n\n        this.createText.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createText.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param size\n     * @param text\n     * @constructor\n     */\n    export function SetCallout(editor, markup, position, size, text, isFrameUsed) {\n\n        EditAction.call(this, editor, 'SET-CALLOUT', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\n        this.newText = text;\n        this.oldText = markup.getText();\n        this.newIsFrameUsed = isFrameUsed;\n        this.oldIsFrameUsed = markup.isFrameUsed;\n    }\n\n    SetCallout.prototype = Object.create(EditAction.prototype);\n    SetCallout.prototype.constructor = SetCallout;\n\n    var proto = SetCallout.prototype;\n\n    proto.redo = function() {\n\n        var callout = this.editor.getMarkup(this.targetId);\n        callout && callout.set(this.newPosition, this.newSize, this.newText, this.newIsFrameUsed);\n    };\n\n    proto.undo = function() {\n\n        var callout = this.editor.getMarkup(this.targetId);\n        callout && callout.set(this.oldPosition, this.oldSize, this.oldText, this.oldIsFrameUsed);\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param width\n     * @param height\n     * @constructor\n     */\n    export function SetSize(editor, markup, position, width, height) {\n\n        EditAction.call(this, editor, 'SET-SIZE', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newWidth = width;\n        this.oldWidth = markup.size.x;\n        this.newHeight = height;\n        this.oldHeight = markup.size.y;\n    }\n\n    SetSize.prototype = Object.create(EditAction.prototype);\n    SetSize.prototype.constructor = SetSize;\n\n    var proto = SetSize.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setSize(this.newPosition, this.newWidth, this.newHeight);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setSize(this.oldPosition, this.oldWidth, this.oldHeight);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newWidth = action.newWidth;\n            this.newHeight = action.newHeight;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        var identity =\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newWidth === this.oldWidth &&\n            this.newHeight === this.oldHeight;\n\n        return identity;\n    };\n","\n'use strict';\n\n/*!\n    Based on Autosize 4.0.0\n    license: MIT\n    http://www.jacklmoore.com/autosize\n*/\nvar map = typeof Map === \"function\" ? new Map() : (function () {\n    var keys = [];\n    var values = [];\n\n    return {\n        has: function has(key) {\n            return keys.indexOf(key) > -1;\n        },\n        get: function get(key) {\n            return values[keys.indexOf(key)];\n        },\n        set: function set(key, value) {\n            if (keys.indexOf(key) === -1) {\n                keys.push(key);\n                values.push(value);\n            }\n        },\n        'delete': function _delete(key) {\n            var index = keys.indexOf(key);\n            if (index > -1) {\n                keys.splice(index, 1);\n                values.splice(index, 1);\n            }\n        }\n    };\n})();\n\nvar createEvent = function createEvent(name) {\n    return new Event(name, { bubbles: true });\n};\ntry {\n    new Event('test');\n} catch (e) {\n    // IE does not support `new Event()`\n    createEvent = function (name) {\n        const _document = Autodesk.Viewing.getGlobal().document;\n        var evt = _document.createEvent('Event');\n        evt.initEvent(name, true, false);\n        return evt;\n    };\n}\n\nfunction assign(ta) {\n    if (!ta || !ta.nodeName || ta.nodeName !== 'TEXTAREA' || map.has(ta)) return;\n\n    var heightOffset = null;\n    var clientWidth = ta.clientWidth;\n    var cachedHeight = null;\n\n    const self = this;\n    function init() {\n        const _window = self.getWindow();\n        var style = _window.getComputedStyle(ta, null);\n\n        if (style.resize === 'vertical') {\n            ta.style.resize = 'none';\n        } else if (style.resize === 'both') {\n            ta.style.resize = 'horizontal';\n        }\n\n        if (style.boxSizing === 'content-box') {\n            heightOffset = -(parseFloat(style.paddingTop) + parseFloat(style.paddingBottom));\n        } else {\n            heightOffset = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);\n        }\n        // Fix when a textarea is not on document body and heightOffset is Not a Number\n        if (isNaN(heightOffset)) {\n            heightOffset = 0;\n        }\n\n        update();\n    }\n\n    function changeOverflow(value) {\n        {\n            // Chrome/Safari-specific fix:\n            // When the textarea y-overflow is hidden, Chrome/Safari do not reflow the text to account for the space\n            // made available by removing the scrollbar. The following forces the necessary text reflow.\n            var width = ta.style.width;\n            ta.style.width = '0px';\n            // Force reflow:\n            /* jshint ignore:start */\n            ta.offsetWidth;\n            /* jshint ignore:end */\n            ta.style.width = width;\n        }\n\n        ta.style.overflow = value;\n    }\n\n    function getParentOverflows(el) {\n        var arr = [];\n\n        while (el && el.parentNode && el.parentNode instanceof Element) {\n            if (el.parentNode.scrollTop) {\n                arr.push({\n                    node: el.parentNode,\n                    scrollTop: el.parentNode.scrollTop\n                });\n            }\n            el = el.parentNode;\n        }\n\n        return arr;\n    }\n\n    function resize() {\n        var originalHeight = ta.style.height;\n        var overflows = getParentOverflows(ta);\n        const _document = self.getDocument();\n        var docTop = _document.documentElement && _document.documentElement.scrollTop; // Needed for Mobile IE (ticket #240)\n\n        ta.style.height = '';\n\n        var endHeight = ta.scrollHeight + heightOffset;\n\n        if (ta.scrollHeight === 0) {\n            // If the scrollHeight is 0, then the element probably has display:none or is detached from the DOM.\n            ta.style.height = originalHeight;\n            return;\n        }\n\n        ta.style.height = endHeight + 'px';\n\n        // used to check if an update is actually necessary on window.resize\n        clientWidth = ta.clientWidth;\n\n        // prevents scroll-position jumping\n        overflows.forEach(function (el) {\n            // This condition is necessary for iOS 11, where you can't assign value to body.scrollTop\n            if (el.node.scrollTop !== el.scrollTop) {\n                el.node.scrollTop = el.scrollTop;\n            }\n        });\n\n        if (docTop) {\n            _document.documentElement.scrollTop = docTop;\n        }\n    }\n\n    function update() {\n        resize();\n\n        const _window = self.getWindow();\n        var styleHeight = Math.round(parseFloat(ta.style.height));\n        var computed = _window.getComputedStyle(ta, null);\n\n        // Using offsetHeight as a replacement for computed.height in IE, because IE does not account use of border-box\n        var actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(computed.height)) : ta.offsetHeight;\n\n        // The actual height not matching the style height (set via the resize method) indicates that\n        // the max-height has been exceeded, in which case the overflow should be allowed.\n        if (actualHeight !== styleHeight) {\n            if (computed.overflow === 'hidden') {\n                changeOverflow('scroll');\n                resize();\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\n            }\n        } else {\n            // Normally keep overflow set to hidden, to avoid flash of scrollbar as the textarea expands.\n            if (computed.overflow !== 'hidden') {\n                changeOverflow('hidden');\n                resize();\n                actualHeight = computed.boxSizing === 'content-box' ? Math.round(parseFloat(window.getComputedStyle(ta, null).height)) : ta.offsetHeight;\n            }\n        }\n\n        if (cachedHeight !== actualHeight) {\n            cachedHeight = actualHeight;\n            var evt = createEvent('autosize:resized');\n            try {\n                ta.dispatchEvent(evt);\n            } catch (err) {\n                // Firefox will throw an error on dispatchEvent for a detached element\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=889376\n            }\n        }\n    }\n\n    var pageResize = function pageResize() {\n        if (ta.clientWidth !== clientWidth) {\n            update();\n        }\n    };\n\n    var destroy = (function (style) {\n        self.removeWindowEventListener('resize', pageResize, false);\n        ta.removeEventListener('input', update, false);\n        ta.removeEventListener('keyup', update, false);\n        ta.removeEventListener('autosize:destroy', destroy, false);\n        ta.removeEventListener('autosize:update', update, false);\n\n        Object.keys(style).forEach(function (key) {\n            ta.style[key] = style[key];\n        });\n\n        map['delete'](ta);\n    }).bind(ta, {\n        height: ta.style.height,\n        resize: ta.style.resize,\n        overflow: ta.style.overflow,\n        overflowX: ta.style.overflowX,\n        wordWrap: ta.style.wordWrap\n    });\n\n    ta.addEventListener('autosize:destroy', destroy, false);\n\n    // IE9 does not fire onpropertychange or oninput for deletions,\n    // so binding to onkeyup to catch most of those events.\n    // There is no way that I know of to detect something like 'cut' in IE9.\n    if ('onpropertychange' in ta && 'oninput' in ta) {\n        ta.addEventListener('keyup', update, false);\n    }\n\n    self.addWindowEventListener('resize', pageResize, false);\n    ta.addEventListener('input', update, false);\n    ta.addEventListener('autosize:update', update, false);\n    ta.style.overflowX = 'hidden';\n    ta.style.wordWrap = 'break-word';\n\n    map.set(ta, {\n        destroy: destroy,\n        update: update\n    });\n\n    init();\n}\n\nfunction destroy(ta) {\n    var methods = map.get(ta);\n    if (methods) {\n        methods.destroy();\n    }\n}\n\nfunction update(ta) {\n    var methods = map.get(ta);\n    if (methods) {\n        methods.update();\n    }\n}\n\nfunction isRuntimeSupported() {\n    // Don't support Node.js and IE8 (or lower)\n    const _window = Autodesk.Viewing.getGlobal();\n    if (typeof window === 'undefined' || typeof window.getComputedStyle !== 'function')\n        return false;\n    return true;\n}\n\nconst RUNTIME_SUPPORTED = isRuntimeSupported();\n\n\nexport var autosize = function(el, options) {\n    const self = this;\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], function (x) {\n            return assign.bind(self)(x, options);\n        });\n    } \n    return el;\n};\n\nautosize.destroy = function(el) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], destroy);\n    }\n    return el;\n}\n\nautosize.update = function(el) {\n    if (RUNTIME_SUPPORTED && el) {\n        Array.prototype.forEach.call(el.length ? el : [el], update);\n    }\n    return el;\n}\n","'use strict';\n\n    /**\n     * Curring object which generate a string that can be used\n     * as a Dom element's 'style' value.\n     *\n     * @constructor\n     */\n    export function DomElementStyle() {\n\n        this.reset();\n    }\n\n    /*\n     * Constants\n     */\n    var BROWSER_PREFIXES = ['-ms-', '-webkit-', '-moz-', '-o-'];\n\n    var proto = DomElementStyle.prototype;\n\n    proto.reset = function() {\n\n        this.attributes = {};\n        this.dirty = false;\n        this.styleString = '';\n\n        return this;\n    };\n\n    /**\n     *\n     * @param {String} key\n     * @param {*} value\n     * @param {Object} [options]\n     * @param {Boolean} [options.allBrowsers] - Whether to add browser prefix to key\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomeElemStyle}\n     */\n    proto.setAttribute = function(key, value, options) {\n\n        this.attributes[key] = value;\n\n        if (options && options.allBrowsers) {\n            var that = this;\n            BROWSER_PREFIXES.forEach(function(prefix){\n                that.attributes[(prefix+key)] = value;\n            });\n        }\n        this.dirty = true; // Could be optimized\n        return this;\n    };\n\n    /**\n     * Removes one or more attributes\n     * @param {String|Array} key - Key or Keys to be removed\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle} this\n     */\n    proto.removeAttribute = function(key) {\n\n        if (!Array.isArray(key)) {\n            key = [key];\n        }\n\n        var self = this;\n        key.forEach(function(k) {\n            if (k in self.attributes) {\n                delete self.attributes[k];\n                self.dirty = true;\n            }\n        });\n        return this;\n    };\n\n    /**\n     * Gets the String representation of this style object\n     * @returns {string}\n     */\n    proto.getStyleString = function() {\n\n        if (this.dirty) {\n            this.styleString = generateStyle(this.attributes);\n            this.dirty = false;\n        }\n        return this.styleString;\n    };\n\n    /**\n     * Clones the current Object\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Utils.DomElemStyle}\n     */\n    proto.clone = function() {\n\n        var clone = new DomElementStyle();\n        var attributes = this.attributes;\n\n        for (var key in attributes) {\n            clone.setAttribute(key, attributes[key]);\n        }\n        return clone;\n    };\n\n    /**\n     * Generates the style value string. Non mutable function.\n     *\n     * @param {Object} attributes\n     * @private\n     */\n    function generateStyle(attributes) {\n\n        var elements = [];\n        for (var key in attributes) {\n            var val = attributes[key];\n            elements.push(key);\n            elements.push(':');\n            elements.push(val);\n            elements.push('; ');\n        }\n        return elements.join('');\n    }\n","'use strict';\n\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { autosize } from './EditorTextAutosize'\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\nimport { cloneStyle } from '../StyleUtils'\nimport { DomElementStyle } from '../DomElementStyle'\n\nconst av = Autodesk.Viewing;\n\n    /**\n     * Auxiliary class that handles all input for the Label Markup (MarkupText.js)\n     * It instantiates a TEXTAREA where the user can input text. When user input is\n     * disabled, the textarea gets hidden and further rendering is delegated to\n     * MarkupText.js\n     *\n     * @param {HTMLElement} parentDiv\n     * @param {Object} editor - Core Extension\n     * @constructor\n     */\n    export function EditorTextInput(parentDiv, editor, singleLine, defaultText, maxLength) {\n\n        this.parentDiv = parentDiv;\n        this.editor = editor;\n        this.setGlobalManager(editor.viewer.globalManager);\n\n        // Constants\n        this.EVENT_TEXT_CHANGE = 'EVENT_CO2_TEXT_CHANGE';\n        this.EVENT_TEXT_SET_ACTIVE = 'EVENT_CO2_TEXT_SET_ACTIVE';\n        this.EVENT_TEXT_SET_INACTIVE = 'EVENT_CO2_TEXT_SET_INACTIVE';\n\n        const _document = this.getDocument();\n        // The actual TextArea input\n        if (singleLine) {\n            this.textArea = _document.createElement('input');\n            this.textArea.setAttribute('type', 'text');\n        }\n        else {\n            this.textArea = _document.createElement('textarea');\n            this.textArea.rows = '1';\n            if (!Autodesk.Viewing.isIE11) { // auto parameter not available in IE11\n                this.textArea.dir = 'auto';\n            }\n        }\n\n        this.firstEdit = true;\n        this.defaultText = defaultText;\n        this.textArea.setAttribute('maxlength', maxLength); // TODO: Make constant? Change value?\n        this.textArea.setAttribute('data-i18n', defaultText);\n        this.startingHeight = 0;\n\n        autosize.bind(this)(this.textArea);\n\n        var ro = new ResizeObserver(function(entries, observer) {\n            this.setEditFrame();\n        }.bind(this));\n\n        ro.observe(this.textArea);\n\n        this.styleTextArea = new DomElementStyle(); // TODO: Move this to EditMode.\n        this.styleTextArea\n                .setAttribute('position', 'absolute')\n                .setAttribute('resize', 'none')\n                .setAttribute('box-sizing', 'border-box')\n                .setAttribute('-moz-box-sizing', 'border-box')\n                .setAttribute('-webkit-box-sizing', 'border-box')\n                .setAttribute('overflow', 'hidden')\n                .setAttribute('outline', 'none')\n                .setAttribute('border', 'none')\n                .setAttribute('z-index', '1')\n                .setAttribute('padding', '10px');\n\n        // Helper div to measure text width\n        this.measureDiv = _document.createElement('div');\n\n        // Become an event dispatcher\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(EditorTextInput.prototype);\n    var proto = EditorTextInput.prototype;\n\n    proto.destroy = function() {\n\n        this.setInactive();\n    };\n\n    /**\n     * Initializes itself given an Label Markup (textMarkup)\n     * @param {Object} textMarkup\n     * @param {Boolean} firstEdit - Whether the markup is being edited for the first time.\n     */\n    proto.setActive = function(textMarkup, firstEdit) {\n\n        if (this.textMarkup === textMarkup) {\n            return;\n        }\n\n        var placeholderText = Autodesk.Viewing.i18n.translate(this.defaultText);\n        this.textArea.setAttribute('placeholder', placeholderText);\n\n        this.setInactive();\n        this.parentDiv.appendChild(this.textArea);\n        this.textMarkup = textMarkup;\n        this.firstEdit = firstEdit || false;\n\n        this.constrainToCanvas = firstEdit;\n\n        this.initFromMarkup();\n\n        this.constrainToCanvas = false;\n\n        // On iOS this doesn't work quite well, the keyboard will dismiss after call focus programatically.\n        // http://stackoverflow.com/questions/32407185/wkwebview-cant-open-keyboard-for-input-field\n        if (!Autodesk.Viewing.isIOSDevice()) {\n          // Focus on next frame\n          var txtArea = this.textArea;\n          const _window = this.getWindow();\n          _window.requestAnimationFrame(function(){\n              txtArea.focus();\n          });\n        }\n\n        var dataBag = {\n            markup: this.textMarkup,\n            firstEdit: this.firstEdit,\n            isActive: true\n        };\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_ACTIVE, data: dataBag });\n    };\n\n    /**\n     * Closes the editor text input and goes back into normal markup edition mode.\n     */\n    proto.setInactive = function() {\n        var dataBag = {\n            markup: this.textMarkup,\n            isActive: false\n        };\n\n        // In iOS10, the keyboard always show on screen after tap screen out of text\n        // area or save markup to end text edit, call blur to make sure keyboard dismiss.\n        if (Autodesk.Viewing.isIOSDevice())\n        {\n            this.textArea.blur();\n        }\n\n        this.removeWindowEventListener('resize', this.onResizeBinded);\n\n        if (this.textMarkup) {\n            this.textMarkup = null;\n            this.parentDiv.removeChild(this.textArea);\n        }\n        this.style = null;\n\n        this.dispatchEvent({ type: this.EVENT_TEXT_SET_INACTIVE, data: dataBag });\n    };\n\n    proto.isActive = function() {\n\n        return !!this.textMarkup;\n    };\n\n    proto.setEditFrame = function() {\n        if (this.editor.editFrame.markup && this.textMarkup && this.editor.editFrame.markup === this.textMarkup) {\n            var frameWidth = parseFloat(this.textArea.style.width);\n            var frameHeight = parseFloat(this.textArea.style.height);\n\n            var position = this.textMarkup.getClientPosition();\n            var rotation = this.textMarkup.getRotation();\n\n            var xPos = position.x - (frameWidth / 2);\n            var yPos = position.y - (this.startingHeight / 2);\n\n            this.editor.editFrame.setSelection(xPos, yPos, frameWidth, frameHeight, rotation);\n        }\n    };\n\n    /**\n     * Applies Markup styles to TextArea used for editing.\n     * It also saves a copy of the style object.\n     * @private\n     */\n    proto.initFromMarkup = function(updateStyleFirst) {\n\n        var markup = this.textMarkup;\n        var position = markup.getClientPosition();\n        var size = markup.getClientSize();\n\n        // Text area padding is relative to the current font size\n        var padding = markup.getClientFontSize() / 2;\n\n        this.startingHeight = size.y;\n\n        var left = position.x - size.x * 0.5;\n        var top = position.y - size.y * 0.5;\n\n        var lineHeightPercentage = markup.lineHeight + \"%\";\n        this.styleTextArea.setAttribute('line-height', lineHeightPercentage);\n        this.styleTextArea.setAttribute('padding', padding + 'px');\n\n        this.setPosAndSize(left, top, size.x, size.y);\n        if (updateStyleFirst) {\n            this.setStyle(markup.getStyle());\n            this.textArea.value = markup.getText();\n        } else {\n            this.textArea.value = markup.getText();\n            this.setStyle(markup.getStyle());\n        }\n    };\n\n    proto.setPosAndSize = function(left, top, width, height) {\n        if (this.constrainToCanvas) {\n            // Check that it doesn't overflow out of the canvas\n            if (left + width >= this.editor.viewer.container.clientWidth) {\n                left = this.editor.viewer.container.clientWidth - (width + 10);\n            }\n            if (top + height >= this.editor.viewer.container.clientHeight) {\n                top = this.editor.viewer.container.clientHeight - (height + 10);\n            }\n\n            // Make sure text input left side always in the canvas area.\n            // Especially on iPhone6 & iPhone7\n            if (left < 5) {\n                left = 5;\n                width = this.editor.viewer.container.clientWidth - 10;\n            }\n        }\n\n        this.styleTextArea\n            // Size and position\n            .setAttribute('left', left + 'px')\n            .setAttribute('top', top + 'px')\n            .setAttribute('width', width + 'px')\n            .setAttribute('height', height + 'px');\n    };\n\n    proto.setStyle = function(style) {\n\n        if (this.style) {\n            // An already present style means that the user\n            // has changed the style using the UI buttons.\n            // We need to account for the user having changed the\n            // width/height of the TextArea. Since there is no event\n            // we can detect for it, we do it here.\n            var temp = {};\n            this.injectSizeValues(temp);\n            this.setPosAndSize(\n                temp.newPos.x - temp.width * 0.5,\n                temp.newPos.y - temp.height * 0.5,\n                temp.width, temp.height);\n        }\n        var fontHeight = this.editor.sizeFromMarkupsToClient(0, style['font-size']).y;\n        var strokeWidth = this.editor.sizeFromMarkupsToClient(0, style['stroke-width']).y;\n        var textAreaStyle = this.styleTextArea\n            // Visuals\n            .setAttribute('color', style['stroke-color'])\n            .setAttribute('outline', strokeWidth + 'px solid ' + style['stroke-color'])\n            .setAttribute('font-family', style['font-family'])\n            .setAttribute('font-size', fontHeight + 'px')\n            .setAttribute('font-weight', style['font-weight'])\n            .setAttribute('font-style', style['font-style'])\n            .getStyleString();\n        this.textArea.setAttribute('style', textAreaStyle);\n        this.style = cloneStyle(style);\n        autosize.update(this.textArea);\n    };\n\n    /**\n     * Helper function that, for a given markup with some text in it\n     * returns an Array of lines in it.\n     * @param {Object} markup\n     * @returns {{text, lines}|{text: String, lines: Array.<String>}}\n     */\n    proto.getTextValuesForMarkup = function(markup, sizeUpdateRequired) {\n        var active = this.isActive();\n        var activeMarkup = this.textMarkup;\n        var activeFirstEdit = this.firstEdit;\n\n        this.setActive(markup, false);\n        var textValues = this.getTextValues();\n\n        var dataBag = {\n            markup: markup,\n            textValues: textValues\n        };\n\n        if (active) {\n            this.setActive(activeMarkup, activeFirstEdit);\n        } else {\n            if (sizeUpdateRequired) {\n                this.injectSizeValues(dataBag);\n            }\n\n            this.setInactive();\n        }\n\n        return dataBag;\n    };\n\n    /**\n     * Returns the current text as one string and an array of lines\n     * of how the text is being rendered (1 string per line)\n     * @returns {{text: String, lines: Array.<String>}}\n     */\n    proto.getTextValues = function() {\n\n        var newText = this.textArea.value;\n        if (newText === this.defaultText) {\n            newText = '';\n        }\n        return {\n            text: newText,\n            lines: this.generateLines()\n        };\n    };\n\n    /**\n     * Function called by UI\n     */\n    proto.acceptAndExit = function() {\n\n        // If placeholder text, then remove.\n        var textValues = this.getTextValues();\n        var textMarkup = this.textMarkup;\n\n        var dataBag = {\n            markup: this.textMarkup,\n            style: this.style,\n            firstEdit: this.firstEdit,\n            newText: textValues.text,\n            newLines: textValues.lines\n        };\n        this.injectSizeValues(dataBag);\n\n        this.dispatchEvent({ type: this.EVENT_TEXT_CHANGE, data: dataBag });\n        this.setInactive();\n        textMarkup.updateStyle(true); // Hack: LMV-3628\n    };\n\n    /**\n     * Injects position, width and height of the textarea rect\n     * @param {Object} dataBag\n     * @private\n     */\n    proto.injectSizeValues = function(dataBag) {\n\n        // Explicit usage of parseFloat to remove the 'px' suffix.\n        var width = parseFloat(this.textArea.style.width);\n        var height = parseFloat(this.textArea.style.height);\n        var ox = parseFloat(this.textArea.style.left);\n        var oy = parseFloat(this.textArea.style.top);\n\n        dataBag.width = width;\n        dataBag.height = height;\n        dataBag.newPos = {\n            x: ox + (width * 0.5),\n            y: oy + (height * 0.5)\n        };\n    };\n\n    /**\n     * Handler for when the camera moves\n     * @param {Object} event - Camera moves event\n     * @private\n     */\n    proto.onCameraChanged = function(event) {\n        var str = this.textArea.value;\n        this.textMarkup.style = cloneStyle(this.style);\n        this.style = null; // TODO: Revisit this code because style changes are lost by doing this.\n        this.initFromMarkup(true);\n        this.textArea.value = str;\n        this.setEditFrame();\n    };\n\n    /**\n     * Grabs the text content of the textarea and returns\n     * an Array of lines.  Wrapped lines are returned as 2 lines.\n     */\n    proto.generateLines = function() {\n\n        // First, get lines separated by line breaks:\n        var textContent = this.textArea.value;\n        var linesBreaks = textContent.split(/\\r*\\n/);\n\n        var styleMeasureStr = this.styleTextArea.clone()\n            .removeAttribute(['top', 'left', 'width', 'height'])\n            .setAttribute('position','absolute')\n            .setAttribute('white-space','nowrap')\n            .setAttribute('float','left')\n            .setAttribute('visibility','hidden')\n            .getStyleString();\n        this.measureDiv.setAttribute('style', styleMeasureStr);\n        this.parentDiv.appendChild(this.measureDiv);\n\n        var maxLineLength = this.textArea.clientWidth - (2 * parseFloat(this.textArea.style.padding));\n\n        // Now check whether the lines are wrapped.\n        // If so, subdivide into other lines.\n        var linesOutput = [];\n\n        for (var i= 0, len = linesBreaks.length; i<len; ++i) {\n            var line = trimRight(linesBreaks[i]);\n\n            // Add a space in an empty line so it appears in the lines output\n            line = (line === '') ? ' ' : line;\n            this.splitLine(line, maxLineLength, linesOutput);\n        }\n\n        this.parentDiv.removeChild(this.measureDiv);\n        return linesOutput;\n    };\n\n    /**\n     * Given a String that represents one line of text that is\n     * longer than the max length a line is allowed, this method\n     * cuts text into several ones that are no longer than the max\n     * length.\n     *\n     * @param {String} text\n     * @param {Number} maxLength\n     * @param {Array} output\n     * @private\n     */\n    proto.splitLine = function(text, maxLength, output) {\n\n        // End condition\n        if (text === '') {\n            return;\n        }\n\n        var remaining = '';\n        var done = false;\n\n        while (!done){\n            this.measureDiv.innerText = text;\n            var lineLen = this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\n            if (lineLen <= maxLength) {\n                output.push(text);\n                this.splitLine(trimLeft(remaining), maxLength, output);\n                done = true;\n            } else {\n                // Need to try with a shorter word!\n                var parts = this.getShorterLine(text);\n                if (parts.length === 1) {\n                    // text is only one word that is way too long.\n                    this.splitWord(text, remaining, maxLength, output);\n                    done = true;\n                } else {\n                    text = parts[0];\n                    remaining = parts[1] + remaining;\n                }\n            }\n        }\n    };\n\n    /**\n     * Given a line of text such as \"hi there programmer\", it returns\n     * an array with 2 parts: [\"hi there\", \" programmer\"].\n     *\n     * It accounts for special cases with multi-spaces, such as for\n     * \"hi there  two-spaces\" returns [\"hi there\", \"  two-spaces\"]\n     *\n     * When there is only one word, it returns the whole word:\n     * \"JustOneWord\" returns [\"JustOneWord\"] (an array of 1 element)\n     *\n     * @param {String} line\n     * @returns {Array}\n     */\n    proto.getShorterLine = function(line) {\n\n        // TODO: Account for TABs\n        // Will probably never do unless a bug is reported.\n\n        var iLastSpace = line.lastIndexOf(' ');\n        if (iLastSpace === -1) {\n            return [line]; // This is a single word\n        }\n\n        // Else\n        // Iterate back removing additional spaces (multi spaces)\n        while (line.charAt(iLastSpace-1) === ' ') {\n            iLastSpace--\n        }\n\n        var trailingWord = line.substr(iLastSpace); // Contains the spaces\n        var shorterLine = line.substr(0,iLastSpace);\n        return [shorterLine, trailingWord];\n    };\n\n    /**\n     * Given a single word, splits it into multiple lines that fits in maxWidth\n     * @param {String} word\n     * @param {String} remaining\n     * @param {Number} maxLength\n     * @param {Array} output\n     */\n    proto.splitWord = function(word, remaining, maxLength, output) {\n\n        var lenSoFar = 1;\n        var fits = true;\n        while (fits) {\n\n            var part = word.substr(0,lenSoFar);\n            this.measureDiv.innerText = part;\n            var lineLen =  this.measureDiv.clientWidth - (2 * parseFloat(this.measureDiv.style.padding));\n\n            if (lineLen > maxLength) {\n\n                if (lenSoFar === 1) {\n                    // we can't split 1 character any longer.\n                    output.push(part);\n                    this.splitWord(word.substr(1), remaining, maxLength, output);\n                    return;\n                }\n\n                // It was fine until one less char //\n                var okayWord = word.substr(0,lenSoFar-1);\n                output.push(okayWord);\n                var extraWord = word.substr(lenSoFar-1);\n                this.splitLine(extraWord + remaining, maxLength, output);\n                return;\n            }\n\n            // Try one more character\n            lenSoFar++;\n\n            // Check if we are done with all characters\n            if (lenSoFar > word.length) {\n                // Okay it fits\n                output.push(word);\n                return;\n            }\n        }\n    };\n\n    function trimRight(text) {\n        if (text.length === 0) {\n            return \"\";\n        }\n        var lastNonSpace = text.length-1;\n        for (var i=lastNonSpace; i>=0; --i) {\n            if (text.charAt(i) !== ' ') {\n                lastNonSpace = i;\n                break;\n            }\n        }\n        return text.substr(0, lastNonSpace+1);\n    }\n\n    function trimLeft(text) {\n        if (text.length === 0) {\n            return \"\";\n        }\n        var firstNonSpace = 0;\n        for (var i=0; i<text.length; ++i) {\n            if (text.charAt(i) !== ' ') {\n                firstNonSpace = i;\n                break;\n            }\n        }\n        return text.substr(firstNonSpace);\n    }\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\nimport { CreateCallout } from '../edit-actions/CreateCallout'\nimport { SetCallout } from '../edit-actions/SetCallout'\nimport { SetStyle } from '../edit-actions/SetStyle'\nimport { SetSize } from '../edit-actions/SetSize'\nimport * as MarkupTypes from '../MarkupTypes'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditorTextInput } from './EditorTextInput'\n\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeCallout(editor) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-width',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CALLOUT, styleAttributes);\n\n        this.style['fill-opacity'] = 1.0;\n        this.style['fill-color'] = '#ffffff';\n\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 360);\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\n\n        this.textInputHelper = helper;\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n        this.minSize = 0; // No need to size it initially\n        this.creationMethod = this.CREATION_METHOD_CLICK;\n    }\n\n    EditModeCallout.prototype = Object.create(EditMode.prototype);\n    EditModeCallout.prototype.constructor = EditModeCallout;\n\n    var proto = EditModeCallout.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type === this.type) {\n            var deleteCallout = new DeleteCallout(this.editor, markup);\n            deleteCallout.addToHistory = !cantUndo;\n            deleteCallout.execute();\n            return true;\n        }\n        return false;\n    };\n\n    proto.setStyle = function(style) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n\n            this.textInputHelper.setStyle(style);\n        } else {\n            EditMode.prototype.setStyle.call(this, style);\n        }\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n        EditMode.prototype.destroy.call(this);\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     */\n    proto.onMouseDown = function() {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n        var initialWidth = clientFontSize * STARTING_WIDTH_FACTOR; // Find better way to initialize size.\n        var initialHeight = clientFontSize * 1;\n\n        // Center position.\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\n        var position = editor.positionFromClientToMarkups(\n            mousePosition.x + (initialWidth * 0.5),\n            mousePosition.y + (initialHeight * 0.5));\n\n        this.creationBegin();\n        editor.beginActionGroup();\n\n        // Given the initial width and font size, we assume that the text fits in one line.\n        var createCallout = new CreateCallout(\n            editor,\n            editor.getId(),\n            position,\n            size,\n            '',\n            this.style,\n            true);\n\n        createCallout.execute();\n        this.creationEnd();\n\n        this.selectedMarkup = editor.getMarkup(createCallout.targetId);\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n    };\n\n    proto.onMouseUp = function(event) {\n\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(markup);\n            this.editor.editFrame.setMarkup(markup);\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\n        }\n    };\n\n    proto.onHelperSetActive = function(event) {\n        var databag = event.data;\n        var markup = databag.markup;\n        if (markup) {\n            markup.setIsHelperTextActive(databag.isActive);\n            markup.setIsShapeVisible(!databag.isActive);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var textMarkup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var curSelection = this.selectedMarkup;\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n        // Deal with edge case first: Creating a Label without text\n        if (dataBag.newText === '') {\n            this.editor.cancelActionGroup();\n\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\n            deleteCallout.execute();\n\n            if (textMarkup !== curSelection) {\n                this.editor.selectMarkup(curSelection);\n            }\n\n            return;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateCallout action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            this.editor.beginActionGroup();\n        }\n\n        // Size change action //\n        var position = this.editor.positionFromClientToMarkups(\n            dataBag.newPos.x, dataBag.newPos.y\n        );\n        var size = this.editor.sizeFromClientToMarkups(\n            dataBag.width, dataBag.height\n        );\n        var setSize = new SetSize(\n            this.editor,\n            textMarkup,\n            position,\n            size.x,\n            size.y);\n        setSize.execute();\n\n        // Text change action //\n        var setCallout = new SetCallout(\n            this.editor,\n            textMarkup,\n            textMarkup.position,\n            textMarkup.size,\n            dataBag.newText,\n            textMarkup.isFrameUsed);\n        setCallout.execute();\n\n        var setStyle = new SetStyle(\n            this.editor,\n            textMarkup,\n            textStyle\n        );\n        setStyle.execute();\n\n        // However, we do need to close the action group at this point. For both cases.\n        this.editor.closeActionGroup();\n        this.editor.selectMarkup(curSelection);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            var firstEdit = this.textInputHelper.firstEdit;\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n\n            // Close action group if open (first edit).\n            if (firstEdit) {\n                this.editor.cancelActionGroup();\n            }\n\n            this.editor.selectMarkup(null);\n            this.selectedMarkup = null;\n        }\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupTextSvg, createMarkupPathSvg, createMarkupGroupSvg,\n    composeRGBAString, setAttributeToMarkupSvg, setMarkupTextSvgTransform,\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, updateMarkupPathSvgHitarea,\n    createSvgElement, addMarkupMetadata, radiansToDegrees, createRectanglePath,\n    EDIT_FRAME_DEFAULT_MARGIN } from './MarkupsCoreUtils'\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils'\nimport { EditModeCallout } from './edit-modes/EditModeCallout'\n\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\n    var FONT_SIZE_SCALE = 100;\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     * Callout Markup.\n     * @constructor\n     */\n    export function MarkupCallout(id, editor, size) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-width',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n        this.createSvgElement = createSvgElement.bind(this);\n\n\n        this.type = MarkupTypes.MARKUP_TYPE_CALLOUT;\n        this.textShape = createMarkupTextSvg();\n        this.rectShape = createMarkupPathSvg();\n        this.shape = createMarkupGroupSvg([this.rectShape, this.textShape]);\n        this.isFrameUsed = true;\n        this.constraintRotation = true;\n        this.constraintHeight = true;\n        this.constraintWidth = false;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.currentText = \"\";\n        this.currentTextLines = [\"\"];\n        this.prevHighlight = false;\n        this.isHelperTextActive = false;\n\n        // Note: We could have this property be a style property.\n        // However, there is no need for this property to be exposed to the user for alteration\n        // This value is a percentage of the font size used to offset vertically 2 text lines\n        // of the same paragraph.\n        // Notice that this value is used by EditorTextInput.js\n        this.lineHeight = 130;\n\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\n\n        this.bindDomEvents();\n    }\n\n    MarkupCallout.prototype = Object.create(Markup.prototype);\n    MarkupCallout.prototype.constructor = MarkupCallout;\n\n    var proto = MarkupCallout.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCallout(this.editor);\n    };\n\n    /**\n     *\n     * @param {Object} position\n     * @param {Object} size\n     * @param {String} textString\n     */\n    proto.set = function(position, size, textString, isFrameUsed) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.setIsFilledFrameUsed(isFrameUsed);\n        this.setText(textString);\n    };\n\n    proto.setSize = function(position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        var sizeUpdateRequired = true;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle(sizeUpdateRequired);\n        }\n    };\n\n    proto.setPosition = function(x, y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle();\n        }\n    };\n\n    proto.setStyle = function(style) {\n        var stylesEqual = isStyleEqual(style, this.style);\n\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    };\n\n    proto.setText = function(text) {\n\n        this.currentText = text;\n    };\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        return this.currentText;\n    };\n\n    /**\n     * Returns a shallow copy of the text lines used for rendering SVG text\n     * @returns {Array.<String>}\n     */\n    proto.getTextLines = function() {\n\n        return this.currentTextLines.concat();\n    };\n\n    proto.highlightChanged = function() {\n\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\n            var rect = this.rectShape;\n            var text = this.textShape;\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\n\n            if (this.isFrameUsed) {\n                setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\n            }\n\n            this.prevHighlight = true;\n            return false;\n        }\n\n        return true;\n    };\n\n    proto.updateTextBoxStyle = function() {\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n        }\n\n        editMode.updateTextBoxStyle();\n    };\n\n    proto.setIsHelperTextActive = function(isActive) {\n        this.isHelperTextActive = isActive;\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function(sizeUpdateRequired) {\n\n        if (this.highlightChanged()) {\n            this.prevHighlight = false;\n            var style = this.style;\n            var rect = this.rectShape;\n            var text = this.textShape;\n            var fontSize = this.style['font-size'];\n            var fontFamily = this.style['font-family'];\n            var fontWeight = this.style['font-weight'];\n            var fontStyle =  this.style['font-style'];\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            var strokeWidth = this.style['stroke-width'];\n\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\n\n            this.rebuildTextSvg(sizeUpdateRequired);\n\n            var editor = this.editor;\n            var textContainerTransform = this.getTextContainerTransform();\n            var textTransform = this.getTextTransform();\n\n            setAttributeToMarkupSvg(text, 'font-family', fontFamily);\n            setAttributeToMarkupSvg(text, 'font-size', fontSize * FONT_SIZE_SCALE);\n            setAttributeToMarkupSvg(text, 'fill', strokeColor);\n            setAttributeToMarkupSvg(text, 'font-weight', fontWeight);\n            setAttributeToMarkupSvg(text, 'font-style', fontStyle);\n\n            setMarkupTextSvgTransform(text, textContainerTransform, textTransform);\n            updateMarkupTextSvgClipper(text, this.size.x, this.size.y);\n            updateMarkupTextSvgHitarea(text, this.size.x, this.size.y, editor);\n\n            var path = this.getPath().join(' ');\n            var transform = this.getTransform();\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n\n            setAttributeToMarkupSvg(rect, 'd', path);\n            setAttributeToMarkupSvg(rect, 'stroke-width', strokeWidth);\n            setAttributeToMarkupSvg(rect, 'stroke', strokeColor);\n            setAttributeToMarkupSvg(rect, 'transform', transform);\n            setAttributeToMarkupSvg(rect, 'fill', fillColor);\n            updateMarkupPathSvgHitarea(rect, editor);\n        }\n    };\n\n    /**\n     * Re-creates SVG tags that render SVG text.\n     * Each line is placed around tspan tags which are vertically offset to each other.\n     */\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\n\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\n        // editMode needs to be set to load markups in view mode\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n            editMode.textInputHelper.textArea.value = this.currentText;\n            editMode.textInputHelper.setStyle(this.style);\n        }\n\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\n            return;\n        }\n\n        var style = cloneStyle(editMode.textInputHelper.style);\n        var text = editMode.textInputHelper.textArea.value;\n\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\n\n        this.currentTextLines = textHelperValues.textValues.lines;\n\n        if (textHelperValues.newPos) {\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\n\n            this.position.x = position.x;\n            this.position.y = position.y;\n            this.size.x = size.x;\n            this.size.y = size.y;\n        }\n\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\n            editMode.textInputHelper.textArea.value = text;\n            editMode.textInputHelper.setStyle(style);\n        }\n\n        var markup = this.createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        this.textShape.childNodes[0].removeChild(this.textShape.markup);\n        this.textShape.childNodes[0].appendChild(markup);\n        this.textShape.markup = markup;\n\n        // For each line, create a tspan, add as child and offset it vertically.\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\n\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\n        var dx = padding;\n        var dy = padding;\n\n        this.currentTextLines.forEach(function(line){\n\n            var tspan = this.createSvgElement('tspan');\n\n            tspan.setAttribute('x', dx);\n            tspan.setAttribute('y', dy);\n            tspan.textContent = line;\n\n            markup.appendChild(tspan);\n            dy += yOffset;\n        }.bind(this));\n    };\n\n    proto.setIsFilledFrameUsed = function(isFrameUsed) {\n\n        this.isFrameUsed = isFrameUsed;\n\n        var hasRectShape = this.rectShape.parentNode === this.shape;\n        if (isFrameUsed && !hasRectShape) {\n            this.shape.insertBefore(this.rectShape, this.shape.firstChild);\n        } else if (!isFrameUsed && hasRectShape) {\n            this.shape.removeChild(this.rectShape);\n        }\n    };\n\n    proto.setIsFilledFrameVisible = function(isVisible) {\n\n        this.rectShape.markup.style.display = (isVisible && this.isFrameUsed) ? 'block' : 'none';\n    };\n\n    proto.setIsShapeVisible = function(isVisible) {\n\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\n    };\n\n    proto.setMetadata = function() {\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.text = String(this.currentText);\n        metadata.isframeused = this.isFrameUsed ? 1 : 0;\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.getLineHeight = function() {\n        return this.style['font-size'];\n    };\n\n    proto.getTextContainerTransform = function() {\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(1,-1)'\n        ].join(' ');\n    };\n\n    proto.getTextTransform = function() {\n\n        var lineHeight = this.getLineHeight();\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\n        ].join(' ');\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.textShape = createMarkupTextSvg();\n        clone.rectShape = createMarkupPathSvg();\n        clone.shape = createMarkupGroupSvg([clone.rectShape, clone.textShape]);\n        clone.bindDomEvents();\n    };\n\n    proto.getPath = function() {\n        var strokeWidth = this.style['stroke-width'];\n\n        var w = this.size.x + strokeWidth;\n        var h = this.size.y + strokeWidth;\n        var x = -w * 0.5;\n        var y = -h * 0.5;\n\n        var path = [];\n        createRectanglePath(x, y, w, h, false, path);\n\n        return path;\n    };\n\n    proto.getBoundingRect = function() {\n\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        var strokeWidth = this.style['stroke-width'];\n        var width = this.editor.sizeFromMarkupsToClient(strokeWidth, 0).x;\n        var margin = width + EDIT_FRAME_DEFAULT_MARGIN;\n\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y,\n            margin: margin\n        }\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupCallout } from '../MarkupCallout'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param text\n     * @param style\n     * @constructor\n     */\n    export function CreateCallout(editor, id, position, size, text, style, isFrameUsed) {\n\n        EditAction.call(this, editor, 'CREATE-CALLOUT', id);\n\n        this.text = text;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.style = cloneStyle(style);\n        this.isFrameUsed = isFrameUsed;\n    }\n\n    CreateCallout.prototype = Object.create(EditAction.prototype);\n    CreateCallout.prototype.constructor = CreateCallout;\n\n    var proto = CreateCallout.prototype;\n\n    proto.redo = function () {\n\n        var editor = this.editor;\n        var position = this.position;\n        var size = this.size;\n\n        var callout = new MarkupCallout(this.targetId, editor, size);\n\n        editor.addMarkup(callout);\n\n        callout.setIsFilledFrameUsed(this.isFrameUsed);\n        callout.setText(this.text);\n        callout.setSize(position, size.x, size.y);\n        callout.setStyle(this.style);\n    };\n\n    proto.undo = function () {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        if (markup) {\n            this.editor.removeMarkup(markup);\n            markup.destroy();\n        }\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateCallout } from './CreateCallout'\n\n    /**\n     *\n     * @param editor\n     * @param text\n     * @constructor\n     */\n    export function DeleteCallout(editor, callout) {\n\n        EditAction.call(this, editor, 'DELETE-CALLOUT', callout.id);\n\n        var position = {x: callout.position.x, y: callout.position.y};\n        var size = {x: callout.size.x, y: callout.size.y};\n\n        this.createCallout = new CreateCallout(\n            editor,\n            callout.id,\n            position,\n            size,\n            callout.getText(),\n            callout.getStyle(),\n            callout.isFrameUsed);\n    }\n\n    DeleteCallout.prototype = Object.create(EditAction.prototype);\n    DeleteCallout.prototype.constructor = DeleteCallout;\n\n    var proto = DeleteCallout.prototype;\n\n    proto.redo = function() {\n\n        this.createCallout.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCallout.redo();\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param position\n     * @param size\n     * @param text\n     * @constructor\n     */\n    export function SetText(editor, markup, position, size, text) {\n\n        EditAction.call(this, editor, 'SET-TEXT', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldSize = {x: markup.size.x, y: markup.size.y};\n        this.newText = text;\n        this.oldText = markup.getText();\n    }\n\n    SetText.prototype = Object.create(EditAction.prototype);\n    SetText.prototype.constructor = SetText;\n\n    var proto = SetText.prototype;\n\n    proto.redo = function() {\n\n        var text = this.editor.getMarkup(this.targetId);\n        text && text.set(this.newPosition, this.newSize, this.newText);\n    };\n\n    proto.undo = function() {\n\n        var text = this.editor.getMarkup(this.targetId);\n        text && text.set(this.oldPosition, this.oldSize, this.oldText);\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteText } from '../edit-actions/DeleteText'\nimport { DeleteCallout } from '../edit-actions/DeleteCallout'\nimport { CreateText } from '../edit-actions/CreateText'\nimport { SetText } from '../edit-actions/SetText'\nimport { SetSize } from '../edit-actions/SetSize'\nimport { SetStyle } from '../edit-actions/SetStyle'\nimport * as MarkupTypes from '../MarkupTypes'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditorTextInput } from './EditorTextInput'\n\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeText(editor) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_TEXT, styleAttributes);\n\n        var helper = new EditorTextInput(this.viewer.container, this.editor, false, 'Text', 260);\n        helper.addEventListener(helper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_ACTIVE, this.onHelperSetActive.bind(this), false);\n        helper.addEventListener(helper.EVENT_TEXT_SET_INACTIVE, this.onHelperSetActive.bind(this), false);\n\n        this.textInputHelper = helper;\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n        this.minSize = 0; // No need to size it initially\n        this.creationMethod = this.CREATION_METHOD_CLICK;\n    }\n\n    EditModeText.prototype = Object.create(EditMode.prototype);\n    EditModeText.prototype.constructor = EditModeText;\n\n    var proto = EditModeText.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteText = new DeleteText(this.editor, markup);\n            deleteText.addToHistory = !cantUndo;\n            deleteText.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @param style\n     */\n    proto.setStyle = function(style) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n\n            this.textInputHelper.setStyle(style);\n        } else {\n            EditMode.prototype.setStyle.call(this, style);\n        }\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n        EditMode.prototype.destroy.call(this);\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     */\n    proto.onMouseDown = function() {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var clientFontSize = editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n        var initialWidth = clientFontSize * 15; // Find better way to initialize size.\n        var initialHeight = clientFontSize * 1;\n\n        // Center position.\n        var size = this.size = editor.sizeFromClientToMarkups(initialWidth, initialHeight);\n        var position = editor.positionFromClientToMarkups(\n            mousePosition.x + (initialWidth * 0.5),\n            mousePosition.y + (initialHeight * 0.5));\n\n        this.creationBegin();\n        editor.beginActionGroup();\n\n        // Given the initial width and font size, we assume that the text fits in one line.\n        var createText = new CreateText(\n            editor,\n            editor.getId(),\n            position,\n            size,\n            '',\n            this.style);\n\n        createText.execute();\n        this.creationEnd();\n\n        this.selectedMarkup = editor.getMarkup(createText.targetId);\n        this.textInputHelper && this.textInputHelper.setActive(this.selectedMarkup, true);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n\n    proto.onMouseUp = function(event) {\n\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(markup);\n            this.editor.editFrame.setMarkup(markup);\n            this.textInputHelper && this.textInputHelper.setActive(markup, false);\n        }\n    };\n\n    proto.onHelperSetActive = function(event) {\n        var databag = event.data;\n        var markup = databag.markup;\n        if (markup) {\n            markup.setIsHelperTextActive(databag.isActive);\n            markup.setIsShapeVisible(!databag.isActive);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var textMarkup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var curSelection = this.selectedMarkup;\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n        // Deal with edge case first: Creating a Label without text\n        if (dataBag.newText === '') {\n            this.editor.cancelActionGroup();\n\n            var deleteCallout = new DeleteCallout(this.editor, textMarkup);\n            deleteCallout.execute();\n\n            if (textMarkup !== curSelection) {\n                this.editor.selectMarkup(curSelection);\n            }\n\n            return;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateText action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            this.editor.beginActionGroup();\n        }\n\n        // Size change action //\n        var position = this.editor.positionFromClientToMarkups(\n            dataBag.newPos.x, dataBag.newPos.y\n        );\n        var size = this.editor.sizeFromClientToMarkups(\n            dataBag.width, dataBag.height\n        );\n        var setSize = new SetSize(\n            this.editor,\n            textMarkup,\n            position,\n            size.x,\n            size.y);\n        setSize.execute();\n\n        // Text change action //\n        var setText = new SetText(\n            this.editor,\n            textMarkup,\n            textMarkup.position,\n            textMarkup.size,\n            dataBag.newText);\n        setText.execute();\n\n        var setStyle = new SetStyle(\n            this.editor,\n            textMarkup,\n            textStyle\n        );\n        setStyle.execute();\n\n        // However, we do need to close the action group at this point. For both cases.\n        this.editor.closeActionGroup();\n        this.editor.selectMarkup(curSelection);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.textInputHelper && this.textInputHelper.isActive()) {\n            var firstEdit = this.textInputHelper.firstEdit;\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n\n            // Close action group if open (first edit).s\n            if (firstEdit) {\n                this.editor.cancelActionGroup();\n            }\n\n            this.editor.selectMarkup(null);\n            this.selectedMarkup = null;\n        }\n    };\n\n    proto.updateTextBoxStyle = function() {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.onCameraChanged();\n        }\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { composeRGBAString, setAttributeToMarkupSvg, addMarkupMetadata, radiansToDegrees,\n    createMarkupTextSvg, setMarkupTextSvgTransform, updateMarkupTextSvgBackground,\n    updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea, createSvgElement } from './MarkupsCoreUtils'\nimport { cloneStyle, isStyleEqual, copyStyle } from './StyleUtils'\nimport { EditModeText } from './edit-modes/EditModeText'\n\n    // LMV ViewerLMV-2170 [Markup] [PDF] Text markup missing/cutoff for normal sized text.\n    // If the font size of an SVG text is too small, the text is not rendered independently of its final screen size.\n    // To solve the issue we multiply font size by 100 and scale down the text in its transform.\n    var FONT_SIZE_SCALE = 100;\n\n    var STARTING_WIDTH_FACTOR = 6;\n\n    /**\n     * Text Markup.\n     * @constructor\n     */\n    export function MarkupText(id, editor, size) {\n\n        var styleAttributes = [\n            'font-size',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'fill-opacity',\n            'font-family',\n            'font-style',\n            'font-weight'\n        ];\n\n        Markup.call(this, id, editor, styleAttributes);\n\n        // Bind to this to pass globalManager\n        this.createSvgElement = createSvgElement.bind(this);\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_TEXT;\n        this.shape = createMarkupTextSvg();\n        this.constraintRotation = true;\n        this.constraintHeight = true;\n        this.constraintWidth = false;\n        this.size.x = size.x;\n        this.size.y = size.y;\n        this.currentText = \"\";\n        this.currentTextLines = [\"\"];\n        this.textDirty = true;\n        this.textSize = {x: 0, y: 0};\n        this.prevHighlight = false;\n        this.isHelperTextActive = false;\n\n        // Note: We could have this property be a style property.\n        // However, there is no need for this property to be exposed to the user for alteration\n        // This value is a percentage of the font size used to offset vertically 2 text lines\n        // of the same paragraph.\n        // Notice that this value is used by EditorTextInput.js\n        this.lineHeight = 130;\n\n        this.minWidth = this.getClientFontSize() * STARTING_WIDTH_FACTOR;\n\n        this.bindDomEvents();\n    }\n\n    MarkupText.prototype = Object.create(Markup.prototype);\n    MarkupText.prototype.constructor = MarkupText;\n\n    var proto = MarkupText.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeText(this.editor);\n    };\n\n    /**\n     *\n     * @param {String} position\n     * @param {String} size\n     * @param {String} textString\n     */\n    proto.set = function(position, size, textString) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = size.x;\n        this.size.y = size.y;\n\n        this.setText(textString);\n    };\n\n    proto.setSize = function(position, width, height) {\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n        this.size.y = height;\n\n        var sizeUpdateRequired = true;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle(sizeUpdateRequired);\n        }\n    };\n\n    proto.setPosition = function(x, y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        if (this.isHelperTextActive) {\n            this.updateTextBoxStyle();\n        } else {\n            this.updateStyle();\n        }\n    };\n\n    proto.setStyle = function(style) {\n\n        var stylesEqual = isStyleEqual(style, this.style);\n\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    };\n\n    /**\n     *\n     * @param {String} text\n     */\n    proto.setText = function(text) {\n\n        this.currentText = text;\n    };\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        return this.currentText;\n    };\n\n    /**\n     * Returns a shallow copy of the text lines used for rendering SVG text\n     * @returns {Array.<String>}\n     */\n    proto.getTextLines = function() {\n\n        return this.currentTextLines.concat();\n    };\n\n    proto.highlightChanged = function() {\n\n        if (this.highlighted && this.highlighted !== this.prevHighlight) {\n            var shape = this.shape;\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n\n            this.prevHighlight = true;\n            return false;\n        }\n\n        return true;\n    };\n\n    proto.updateTextBoxStyle = function() {\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n        }\n\n        editMode.updateTextBoxStyle();\n    };\n\n    proto.setIsHelperTextActive = function(isActive) {\n        this.isHelperTextActive = isActive;\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function(sizeUpdateRequired) {\n\n        if (this.highlightChanged()) {\n            this.prevHighlight = false;\n            var style = this.style;\n            var shape = this.shape;\n            var fontSize = this.style['font-size'];\n            var fontFamily = this.style['font-family'];\n            var fontWeight = this.style['font-weight'];\n            var fontStyle = this.style['font-style'];\n            var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n            var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n\n            // FONT_SIZE_SCALE is used to scale up fontSize, but it is only needed in cases where the font size is too small\n            FONT_SIZE_SCALE = (fontSize > 1) ? 1 : 100;\n\n            this.rebuildTextSvg(sizeUpdateRequired);\n\n            setAttributeToMarkupSvg(shape, 'font-family', fontFamily);\n            setAttributeToMarkupSvg(shape, 'font-size', fontSize * FONT_SIZE_SCALE);\n            setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n            setAttributeToMarkupSvg(shape, 'font-weight', fontWeight);\n            setAttributeToMarkupSvg(shape, 'font-style', fontStyle);\n\n            var editor = this.editor;\n            var transform = this.getTransform();\n            var textTransform = this.getTextTransform();\n\n            setMarkupTextSvgTransform(shape, transform, textTransform);\n            updateMarkupTextSvgBackground(shape, this.size.x, this.size.y, fillColor);\n            updateMarkupTextSvgClipper(shape, this.size.x, this.size.y);\n            updateMarkupTextSvgHitarea(shape, this.size.x, this.size.y, editor);\n        }\n    };\n\n    /**\n     * Re-creates SVG tags that render SVG text.\n     * Each line is placed around tspan tags which are vertically offset to each other.\n     */\n    proto.rebuildTextSvg = function(sizeUpdateRequired) {\n\n        // TODO: Remove the need to get text values from an object in edit mode, should be a function.\n        // editMode needs to be set to load markups in view mode\n        var editMode = this.editor.duringEditMode && this.editor.editMode;\n\n        if (!editMode || editMode.type !== this.type) {\n            editMode = this.getEditMode();\n            editMode.textInputHelper.textArea.value = this.currentText;\n            editMode.textInputHelper.setStyle(this.style);\n        }\n\n        if (editMode.textInputHelper.textMarkup && editMode.textInputHelper.textMarkup !== this) {\n            return;\n        }\n\n        var style = cloneStyle(editMode.textInputHelper.style);\n        var text = editMode.textInputHelper.textArea.value;\n\n        var textHelperValues = editMode.textInputHelper.getTextValuesForMarkup(this, sizeUpdateRequired);\n\n        this.currentTextLines = textHelperValues.textValues.lines;\n\n        if (textHelperValues.newPos) {\n            var position = this.editor.positionFromClientToMarkups(textHelperValues.newPos.x, textHelperValues.newPos.y);\n            var size = this.editor.sizeFromClientToMarkups(textHelperValues.width, textHelperValues.height);\n\n            this.position.x = position.x;\n            this.position.y = position.y;\n            this.size.x = size.x;\n            this.size.y = size.y;\n        }\n\n        if (editMode.selectedMarkup !== this && !editMode.textInputHelper.firstEdit) {\n            editMode.textInputHelper.textArea.value = text;\n            editMode.textInputHelper.setStyle(style);\n        }\n\n        var markup = this.createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        this.shape.childNodes[0].removeChild(this.shape.markup);\n        this.shape.childNodes[0].appendChild(markup);\n        this.shape.markup = markup;\n\n        // For each line, create a tspan, add as child and offset it vertically.\n        var yOffset = this.getLineHeight() * FONT_SIZE_SCALE * (this.lineHeight / 100);\n\n        var padding = (this.getLineHeight() * FONT_SIZE_SCALE) / 2;\n        var dx = padding;\n        var dy = padding;\n\n        this.currentTextLines.forEach(function(line){\n\n            var tspan = this.createSvgElement('tspan');\n\n            tspan.setAttribute('x', dx);\n            tspan.setAttribute('y', dy);\n            tspan.textContent = line;\n\n            markup.appendChild(tspan);\n            dy += yOffset;\n        }.bind(this));\n    };\n\n    proto.setIsShapeVisible = function(isVisible) {\n\n        this.shape.style.display = (isVisible) ? 'block' : 'none';\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.text = String(this.currentText);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.getLineHeight = function() {\n\n        return this.style['font-size'];\n    };\n\n    proto.getTransform = function() {\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(1,-1)'\n        ].join(' ');\n    };\n\n    proto.getTextTransform = function() {\n\n        var lineHeight = this.getLineHeight();\n\n        var x = this.position.x - this.size.x * 0.5;\n        var y = this.position.y + this.size.y * 0.5 - lineHeight;\n\n        return [\n            'translate(', x, ',', y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'scale(' + (1/FONT_SIZE_SCALE) + ',' + (-1/FONT_SIZE_SCALE) + ')'\n        ].join(' ');\n    };\n\n    proto.cloneShape = function(clone) {\n\n        clone.shape = createMarkupTextSvg();\n        clone.bindDomEvents();\n    };\n\n    proto.getBoundingRect = function() {\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y\n        }\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupText } from '../MarkupText'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param text\n     * @param style\n     * @constructor\n     */\n    export function CreateText(editor, id, position, size, text, style ) {\n\n        EditAction.call(this, editor, 'CREATE-TEXT', id);\n\n        this.text = text;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.style = cloneStyle(style);\n    }\n\n    CreateText.prototype = Object.create(EditAction.prototype);\n    CreateText.prototype.constructor = CreateText;\n\n    var proto = CreateText.prototype;\n\n    proto.redo = function () {\n\n        var editor = this.editor;\n        var position = this.position;\n        var size = this.size;\n\n        var text = new MarkupText(this.targetId, editor, size);\n\n        editor.addMarkup(text);\n\n        text.set(position, size, this.text);\n        text.setStyle(this.style);\n    };\n\n    proto.undo = function () {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        if (markup) {\n            this.editor.removeMarkup(markup);\n            markup.destroy();\n        }\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateCircle } from './CreateCircle'\n\n    /**\n     * Markup delete circle action.\n     * \n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for deleting a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup deletion.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param circle\n     */\n    export function DeleteCircle(editor, circle) {\n\n        EditAction.call(this, editor, 'DELETE-CIRCLE', circle.id);\n        this.createCircle = new CreateCircle(\n            editor,\n            circle.id,\n            circle.position,\n            circle.size,\n            circle.rotation,\n            circle.getStyle());\n    }\n\n    DeleteCircle.prototype = Object.create(EditAction.prototype);\n    DeleteCircle.prototype.constructor = DeleteCircle;\n\n    var proto = DeleteCircle.prototype;\n\n    proto.redo = function() {\n\n        this.createCircle.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCircle.redo();\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     * Markup set circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for editing properties of a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup edition.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param circle\n     * @param position\n     * @param size\n     */\n    export function SetCircle(editor, circle, position, size) {\n\n        EditAction.call(this, editor, 'SET-CIRCLE', circle.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: circle.position.x, y: circle.position.y};\n        this.oldSize = {x: circle.size.x, y: circle.size.y};\n    }\n\n    SetCircle.prototype = Object.create(EditAction.prototype);\n    SetCircle.prototype.constructor = SetCircle;\n\n    var proto = SetCircle.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var circle = this.editor.getMarkup(targetId);\n        if(!circle) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(circle.position.x - position.x) > epsilon || Math.abs(circle.size.y - size.y) > epsilon ||\n            Math.abs(circle.position.y - position.y) > epsilon || Math.abs(circle.size.y - size.y) > epsilon) {\n\n            circle.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteCircle } from '../edit-actions/DeleteCircle'\nimport { CreateCircle } from '../edit-actions/CreateCircle'\nimport { SetCircle } from '../edit-actions/SetCircle'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     * Markup circle edit mode.\n     *\n     * Implements a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.EditMode|EditMode}.\n     * Included in documentation as an example of how to create\n     * an EditMode for a specific markup type. Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditMode\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor\n     */\n    export function EditModeCircle(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CIRCLE, styleAttributes);\n    }\n\n    EditModeCircle.prototype = Object.create(EditMode.prototype);\n    EditModeCircle.prototype.constructor = EditModeCircle;\n\n    var proto = EditModeCircle.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteCircle = new DeleteCircle(this.editor, markup);\n            deleteCircle.addToHistory = !cantUndo;\n            deleteCircle.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        var final = this.getFinalMouseDraggingPosition();\n        final = editor.clientToMarkups(final.x, final.y);\n\n        var sizeX = Math.abs(this.firstPosition.x - final.x);\n        var sizeY = Math.abs(this.firstPosition.y - final.y);\n\n        var position = {x: (this.firstPosition.x + final.x) * 0.5, y: (this.firstPosition.y + final.y) * 0.5};\n        var size = this.size = {x: sizeX, y: sizeY};\n\n        var setCircle = new SetCircle(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setCircle.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create circle.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateCircle(\n            editor,\n            markupId,\n            position,\n            size,\n            0,\n            this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg, \n        updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeCircle } from './edit-modes/EditModeCircle'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupCircle(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_CIRCLE;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupCircle.prototype = Object.create(Markup.prototype);\n    MarkupCircle.prototype.constructor = MarkupCircle;\n\n    var proto = MarkupCircle.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCircle(this.editor);\n    };\n\n    proto.set = function(position, size) {\n\n        this.setSize(position, size.x, size.y);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var size = this.size;\n        if (size.x === 1 || size.y === 1) {\n            return [''];\n        }\n\n        var strokeWidth = this.style['stroke-width'];\n\n        var ellipseW = size.x - strokeWidth;\n        var ellipseH = size.y - strokeWidth;\n\n        var ellipseX = -0.5*ellipseW;\n        var ellipseY = 0;\n\n        var path = [];\n        createEllipsePath(ellipseX, ellipseY, ellipseW, ellipseH, false, path);\n\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupCircle } from '../MarkupCircle'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     * Markup create circle action.\n     *\n     * Implements an {@link Autodesk.Viewing.Extensions.Markups.Core.EditAction|EditAction}\n     * for creating a Circle {@link Autodesk.Viewing.Extensions.Markups.Core.Markup|Markup}.\n     * Included in documentation as an example of how to create\n     * a specific EditAction that deals with Markup creation.\n     * Developers are encourage to look into this class's source code and copy\n     * as much code as they need. Find link to source code below.\n     *\n     * @tutorial feature_markup\n     * @constructor\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @extends Autodesk.Viewing.Extensions.Markups.Core.EditAction\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     */\n    export function CreateCircle(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-CIRCLE', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateCircle.prototype = Object.create(EditAction.prototype);\n    CreateCircle.prototype.constructor = CreateCircle;\n\n    var proto = CreateCircle.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var circle = new MarkupCircle(this.targetId, editor);\n\n        editor.addMarkup(circle);\n\n        circle.setSize(this.position, this.size.x, this.size.y);\n        circle.setRotation(this.rotation);\n        circle.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateCloud } from './CreateCloud'\n\n    /**\n     *\n     * @param editor\n     * @param cloud\n     * @constructor\n     */\n    export function DeleteCloud(editor, cloud) {\n\n        EditAction.call(this, editor, 'DELETE-CLOUD', cloud.id);\n        this.createCloud = new CreateCloud(\n            editor,\n            cloud.id,\n            cloud.position,\n            cloud.size,\n            cloud.rotation,\n            cloud.getStyle());\n    }\n\n    DeleteCloud.prototype = Object.create(EditAction.prototype);\n    DeleteCloud.prototype.constructor = DeleteCloud;\n\n    var proto = DeleteCloud.prototype;\n\n    proto.redo = function() {\n\n        this.createCloud.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createCloud.redo();\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param cloud\n     * @param position\n     * @param size\n     * @constructor\n     */\n    export function SetCloud(editor, cloud, position, size) {\n\n        EditAction.call(this, editor, 'SET-CLOUD', cloud.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: cloud.position.x, y: cloud.position.y};\n        this.oldSize = {x: cloud.size.x, y: cloud.size.y};\n    }\n\n    SetCloud.prototype = Object.create(EditAction.prototype);\n    SetCloud.prototype.constructor = SetCloud;\n\n    var proto = SetCloud.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.targetId, this.newPosition, this.newSize, this.newStrokeWidth, this.newColor);\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.targetId, this.oldPosition, this.oldSize, this.oldStrokeWidth, this.oldColor);\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(targetId, position, size) {\n\n        var cloud = this.editor.getMarkup(targetId);\n        if(!cloud) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        var epsilon = 0.0001;\n\n        if (Math.abs(cloud.position.x - position.x) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon ||\n            Math.abs(cloud.position.y - position.y) > epsilon || Math.abs(cloud.size.y - size.y) > epsilon) {\n\n            cloud.set(position, size);\n        }\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return (\n            this.newPosition.x === this.oldPosition.x &&\n            this.newPosition.y === this.oldPosition.y &&\n            this.newSize.x === this.oldSize.x &&\n            this.newSize.y === this.oldSize.y);\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteCloud } from '../edit-actions/DeleteCloud'\nimport { CreateCloud } from '../edit-actions/CreateCloud'\nimport { SetCloud } from '../edit-actions/SetCloud'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeCloud(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_CLOUD, styleAttributes);\n    }\n\n    EditModeCloud.prototype = Object.create(EditMode.prototype);\n    EditModeCloud.prototype.constructor = EditModeCloud;\n\n    var proto = EditModeCloud.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteCloud = new DeleteCloud(this.editor, markup);\n            deleteCloud.addToHistory = !cantUndo;\n            deleteCloud.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        var pos = this.getFinalMouseDraggingPosition();\n        var final = editor.clientToMarkups(pos.x, pos.y);\n        var position = { x: (this.firstPosition.x + final.x) / 2, y: (this.firstPosition.y + final.y) / 2 };\n        var size = this.size = { x: Math.abs(final.x - this.firstPosition.x), y: Math.abs(final.y - this.firstPosition.y) };\n        var setCloud = new SetCloud(\n            editor,\n            selectedMarkup,\n            position,\n            size);\n\n        setCloud.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        // Calculate center and size.\n        var position = this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create Cloud.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreateCloud(\n            editor,\n            markupId,\n            position,\n            size,\n            0,\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, addMarkupMetadata, createEllipsePath } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeCloud } from './edit-modes/EditModeCloud'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupCloud(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-linejoin', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_CLOUD;\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupCloud.prototype = Object.create(Markup.prototype);\n    MarkupCloud.prototype.constructor = MarkupCloud;\n\n    var proto = MarkupCloud.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeCloud(this.editor);\n    };\n\n    /**\n     * Sets position and size in markup space coordinates.\n     * @param {Object} position\n     * @param {Object} size\n     */\n    proto.set = function(position, size) {\n\n        this.setSize(position, size.x, size.y);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = composeRGBAString(style['fill-color'], style['fill-opacity']);\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    /**\n     * Helper function that creates intermediate points given the\n     * current position and size.\n     * @returns {Array}\n     */\n    proto.getPath = function() {\n\n        var position = this.position;\n        var size = this.size;\n        var strokeWidth = this.style['stroke-width'];\n        var radius = strokeWidth * 2;\n\n        function createArcTo(x, y, xRadius, yRadius, path) {\n\n            path.push('a');\n            path.push(xRadius);\n            path.push(yRadius);\n            path.push(0);\n            path.push(1);\n            path.push(1);\n            path.push(x);\n            path.push(y);\n\n            return path;\n        }\n\n        function createCorner(corner, xRadius, yRadius, strokeWidth, path) {\n\n            switch(corner) {\n\n                case 'LT':\n                    return createArcTo( xRadius,-yRadius, xRadius, yRadius, path);\n                    break;\n\n                case 'RT':\n                    return createArcTo( xRadius, yRadius, xRadius, yRadius, path);\n                    break;\n\n                case 'RB':\n                    return createArcTo(-xRadius, yRadius, xRadius, yRadius, path);\n                    break;\n\n                case 'LB':\n                    return createArcTo(-xRadius,-yRadius, xRadius, yRadius, path);\n                    break;\n            }\n        }\n\n        function getSideParameters(x1, x2, radius, strokeWidth) {\n\n            var diameter = radius * 2;\n            var length = Math.abs(x2 - x1 - strokeWidth);\n            var count = Math.round(length / diameter);\n\n            diameter += (length - diameter * count) / count;\n            radius = diameter * 0.5;\n\n            var xValueInset = diameter * 0.05;\n            var yValueOffset = radius * 3.5 / 3.0;\n\n            return {\n                count: count,\n                radius: radius,\n                diameter: diameter,\n                p1: {x: xValueInset, y: -yValueOffset },\n                p2: {x: diameter - xValueInset, y: -yValueOffset},\n                p3: {x: diameter, y: 0}\n            };\n        }\n\n        function createTSide(hSidesParameters, path){\n\n            var sp = hSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n\n                path.push('c');\n                path.push(sp.p1.x);\n                path.push(sp.p1.y);\n                path.push(sp.p2.x);\n                path.push(sp.p2.y);\n                path.push(sp.p3.x);\n                path.push(sp.p3.y);\n            }\n\n            return path;\n        }\n\n        function createRSide(vSidesParameters, path){\n\n            var sp = vSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(-sp.p1.y);\n                path.push(sp.p1.x);\n                path.push(-sp.p2.y);\n                path.push(sp.p2.x);\n                path.push(-sp.p3.y);\n                path.push(sp.p3.x);\n            }\n\n            return path;\n        }\n\n        function createBSide(hSidesParameters, path){\n\n            var sp = hSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(-sp.p1.x);\n                path.push(-sp.p1.y);\n                path.push(-sp.p2.x);\n                path.push(-sp.p2.y);\n                path.push(-sp.p3.x);\n                path.push(-sp.p3.y);\n            }\n\n            return path;\n        }\n\n        function createLSide(vSidesParameters, path){\n\n            var sp = vSidesParameters;\n            for(var i = 0; i < sp.count; ++i) {\n                path.push('c');\n                path.push(sp.p1.y);\n                path.push(-sp.p1.x);\n                path.push(sp.p2.y);\n                path.push(-sp.p2.x);\n                path.push(sp.p3.y);\n                path.push(-sp.p3.x);\n            }\n\n            return path;\n        }\n\n        var l = position.x;\n        var t = position.y;\n        var r = position.x + size.x;\n        var b = position.y + size.y;\n\n        var minSize = radius * 5;\n        var path = [];\n\n        if (size.x < minSize || size.y < minSize) {\n\n            var w = size.x - strokeWidth;\n            var h = size.y - strokeWidth;\n            var x = -w * 0.5;\n            var y = 0;\n\n            createEllipsePath(x, y, w, h, false, path);\n        } else {\n\n            var hSidesParameters = getSideParameters(l, r, radius, strokeWidth);\n            var vSidesParameters = getSideParameters(t, b, radius, strokeWidth);\n\n            var cornerSizeX = hSidesParameters.diameter;\n            var cornerSizeY = vSidesParameters.diameter;\n            var cornerRadiusX = hSidesParameters.radius;\n            var cornerRadiusY = vSidesParameters.radius;\n\n            hSidesParameters = getSideParameters(l + cornerSizeX, r - cornerSizeX, radius, strokeWidth);\n            vSidesParameters = getSideParameters(t + cornerSizeY, b - cornerSizeY, radius, strokeWidth);\n\n            var halfStrokeWidth = strokeWidth * 0.5;\n            var x =-size.x * 0.5 + halfStrokeWidth + cornerRadiusX;\n            var y =-size.y * 0.5 + halfStrokeWidth + cornerRadiusY * 2;\n\n            path.push('M');\n            path.push(x);\n            path.push(y);\n\n            createCorner('LT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createTSide(hSidesParameters, path);\n            createCorner('RT', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createRSide(vSidesParameters, path);\n            createCorner('RB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createBSide(hSidesParameters, path);\n            createCorner('LB', cornerRadiusX, cornerRadiusY, strokeWidth, path);\n            createLSide(vSidesParameters, path);\n        }\n\n        path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupCloud } from '../MarkupCloud'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param style\n     * @constructor\n     */\n    export function CreateCloud(editor, id, position, size, rotation, style) {\n\n        EditAction.call(this, editor, 'CREATE-CLOUD', id);\n\n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n    }\n\n    CreateCloud.prototype = Object.create(EditAction.prototype);\n    CreateCloud.prototype.constructor = CreateCloud;\n\n    var proto = CreateCloud.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var cloud = new MarkupCloud(this.targetId, editor);\n\n        editor.addMarkup(cloud);\n\n        cloud.set(this.position, this.size);\n        cloud.setRotation(this.rotation);\n        cloud.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n","'use strict';\n\nimport { Markup } from './Markup'\nimport { createMarkupPathSvg, setAttributeToMarkupSvg, updateMarkupPathSvgHitarea,\n    composeRGBAString, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\n\n    /**\n     * Base class for Pen Markup rendering (currently freehand and highlighter)\n     *\n     * Derived classes must implement getEditMode()\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPen(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupPen.prototype = Object.create(Markup.prototype);\n    MarkupPen.prototype.constructor = MarkupPen;\n\n    var proto = MarkupPen.prototype;\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     *\n     * @param position\n     * @param size\n     * @param locations\n     */\n    proto.set = function(position, size, locations, isAbsoluteCoords) {\n\n        this.rotation = 0; // Reset angle //\n        this.isAbsoluteCoords = isAbsoluteCoords;\n        if (this.isAbsoluteCoords) {\n            this.updatePath(locations);\n        } else {\n            this.locations = locations.slice(0);\n\n            this.size.x = (size.x === 0) ? 1 : size.x;\n            this.size.y = (size.y === 0) ? 1 : size.y;\n\n            this.setSize(position, size.x, size.y);\n            this.updateStyle();\n        }\n    };\n\n    proto.setPosition = function(x,y) {\n\n        this.position.x = x;\n        this.position.y = y;\n\n        var shape = this.shape;\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = 'none';\n\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke-linejoin', 'round');\n        setAttributeToMarkupSvg(shape, 'stroke-linecap', 'round');\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n\n        this.updatePath(path);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.updatePath = function(path) {\n        var shape = this.shape;\n        var transform = this.isAbsoluteCoords ? 'scale(1)' : this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        setAttributeToMarkupSvg(shape, 'd', path);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var path = [];\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        if (locationsCount > 1) {\n\n            path.push('M');\n            path.push(+(locations[0].x).toFixed(6));\n            path.push(+(locations[0].y).toFixed(6));\n\n            for (var i = 1; i < locationsCount; ++i) {\n\n                var locationA = locations[i - 1];\n                var locationB = locations[i];\n\n                path.push('l');\n                path.push(+(locationB.x - locationA.x).toFixed(6));\n                path.push(+(locationB.y - locationA.y).toFixed(6));\n            }\n        }\n\n        return path;\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { simplify } from '../MarkupsCoreUtils'\n\n    /**\n     * Base class for editing Pen tools (currently freehand and highlighter)\n     *\n     * Any class extending EditModePen should contain at least the following methods:\n     * - createPen()\n     * - deletePen()\n     * - setPen()\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePen(editor, type, styleAttributes) {\n        EditMode.call(this, editor, type, styleAttributes);\n\n        this.smoothen = true;\n        this.bufferSize = 8;\n    }\n\n    EditModePen.prototype = Object.create(EditMode.prototype);\n\n    var proto = EditModePen.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type === this.type) {\n            var deleteMarkup = this.deletePen(markup);\n            deleteMarkup.addToHistory = !cantUndo;\n            deleteMarkup.execute();\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n\n        var location = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n        if (this.smoothen) {\n            this.appendToBuffer(location);\n            this.amendPath();\n        } else {\n            var dx = this.lastX - mousePosition.x;\n            var dy = this.lastY - mousePosition.y;\n            var moveTol = 25; // 5^2, compare to square to avoid using square root of distance\n\n            if (movements.length > 1 && (dx*dx + dy*dy) < moveTol) {\n                movements[movements.length - 1] = location;\n                this.removeFromAbsolutePath(1);\n            } else {\n                movements.push(location);\n                this.lastX = mousePosition.x;\n                this.lastY = mousePosition.y;\n            }\n\n            this.addToAbsolutePath([location]);\n        }\n\n        var setPen = this.setPen(this.position, this.size, this.absolutePath, true);\n        setPen.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        var editor = this.editor;\n\n        editor.snapper && editor.snapper.clearSnapped();\n        var mousePosition = editor.getMousePosition();\n\n        this.lastX = this.initialX = mousePosition.x;\n        this.lastY = this.initialY = mousePosition.y;\n\n        //set the starting point\n        var position = this.position = editor.clientToMarkups(this.initialX, this.initialY);\n        this.movements = [position];\n        if (this.smoothen) {\n            this.buffer = []; // Reset buffer\n            this.movementsLastIndex = null;\n            this.appendToBuffer(position);\n        }\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        // Create pen.\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = this.createPen(markupId, position, size, 0, [{x: 0, y: 0 }]);\n\n        create.execute();\n\n        this.createAbsolutePath(position);\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    proto.onMouseUp = function() {\n\n        if (!this.creating) {\n            EditMode.prototype.onMouseUp.call(this);\n            return;\n        }\n\n        var movements = this.movements;\n        var cameraWidth = this.viewer.impl.camera.right - this.viewer.impl.camera.left;\n        var cameraHeight = this.viewer.impl.camera.top - this.viewer.impl.camera.bottom;\n        var cameraDiagSq = cameraWidth*cameraWidth + cameraHeight*cameraHeight;\n\n        movements = simplify(movements, cameraDiagSq * 0.00000001, true);\n\n        var xs = movements.map(function(item) { return item.x });\n        var ys = movements.map(function(item) { return item.y });\n\n        var l = Math.min.apply(null, xs);\n        var t = Math.min.apply(null, ys);\n        var r = Math.max.apply(null, xs);\n        var b = Math.max.apply(null, ys);\n\n        var width = r - l;  // Already in markup coords space\n        var height = b - t; // Already in markup coords space\n\n        var position = {\n            x: l + width * 0.5,\n            y: t + height * 0.5\n        };\n        var size = this.size = {x: width, y: height};\n\n        // Adjust points to relate from the shape's center\n        var locations = movements.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n\n        var setPen = this.setPen(position, size, locations, false);\n        setPen.execute();\n\n        EditMode.prototype.onMouseUp.call(this);\n    };\n\n    proto.createPen = function() {\n        console.error('createPen not implemented');\n    };\n\n    proto.deletePen = function() {\n        console.error('deletePen not implemented');\n    };\n\n    proto.setPen = function() {\n        console.error('setPen not implemented');\n    };\n\n    proto.useWithSnapping = function () {\n        return false;\n    };\n\n    proto.createAbsolutePath = function(point) {\n\n        this.absolutePath = 'M' + +(point.x).toFixed(6) + ' ' + +(point.y).toFixed(6);\n        this.absolutePathIndexes = [0];\n    };\n\n    proto.removeFromAbsolutePath = function(numToRemove) {\n\n        numToRemove = Math.min(numToRemove, this.absolutePathIndexes.length);\n        if (numToRemove > 0) {\n            this.absolutePath = this.absolutePath.slice(0, this.absolutePathIndexes[this.absolutePathIndexes.length - numToRemove]);\n            this.absolutePathIndexes.splice(this.absolutePathIndexes.length - numToRemove);\n        }\n    };\n\n    proto.addToAbsolutePath = function(points) {\n\n       for (var i = 0; i < points.length; i++) {\n            this.absolutePathIndexes.push(this.absolutePath.length);\n            this.absolutePath += ' L' + +(points[i].x).toFixed(6) + ' ' + +(points[i].y).toFixed(6);\n        }\n    };\n\n    proto.appendToBuffer = function(point) {\n\n        this.buffer.push(point);\n        while (this.buffer.length > this.bufferSize) {\n            this.buffer.shift();\n        }\n    };\n\n    proto.amendPath = function() {\n\n        var point = this.getAveragePoint(0);\n        if (point) {\n            if (this.movementsLastIndex) {\n                this.removeFromAbsolutePath(this.movements.length - this.movementsLastIndex);\n                this.movements.splice(this.movementsLastIndex);\n            }\n\n            // Add the smoothed part of the path that will not change\n            var tmpBuffer = [point];\n            this.movementsLastIndex = this.movements.length + 1;\n\n            // Get the last part of the path (close to the current mouse position)\n            // This part will change if the mouse moves again\n            for (var offset = 2; offset < this.buffer.length; offset += 2) {\n                var pt = this.getAveragePoint(offset);\n                tmpBuffer.push(pt);\n            }\n\n            this.addToAbsolutePath(tmpBuffer);\n\n            // Set the complete current path coordinates\n            this.movements.push.apply(this.movements, tmpBuffer);\n\n        }\n    };\n\n    // Calculate the average point, starting at offset in the buffer\n    proto.getAveragePoint = function(offset) {\n\n        var len = this.buffer.length;\n        if (len % 2 === 1 || len >= this.bufferSize) {\n            var totalX = 0;\n            var totalY = 0;\n            var pt;\n            var count = 0;\n            for (var i = offset; i < len; i++) {\n                count++;\n                pt = this.buffer[i];\n                totalX += pt.x;\n                totalY += pt.y;\n            }\n            return {\n                x: totalX / count,\n                y: totalY / count\n            }\n        }\n        return null;\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateFreehand } from './CreateFreehand'\n\n    /**\n     *\n     * @param editor\n     * @param freehand\n     * @constructor\n     */\n    export function DeleteFreehand(editor, freehand) {\n        EditAction.call(this, editor, 'DELETE-FREEHAND', freehand.id);\n        this.createFreehand = new CreateFreehand(\n            editor,\n            freehand.id,\n            freehand.position,\n            freehand.size,\n            freehand.rotation,\n            freehand.locations,\n            freehand.getStyle());\n    }\n\n    DeleteFreehand.prototype = Object.create(EditAction.prototype);\n    DeleteFreehand.prototype.constructor = DeleteFreehand;\n\n    var proto = DeleteFreehand.prototype;\n\n    proto.redo = function() {\n\n        this.createFreehand.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createFreehand.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param freehand\n     * @param position\n     * @param size\n     * @param locations\n     * @constructor\n     */\n    export function SetFreehand(editor, freehand, position, size, locations, isAbsoluteCoords) {\n\n        EditAction.call(this, editor, 'SET-FREEHAND', freehand.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\n        this.isAbsoluteCoords = isAbsoluteCoords;\n\n        // No need to save old data\n    }\n\n    SetFreehand.prototype = Object.create(EditAction.prototype);\n    SetFreehand.prototype.constructor = SetFreehand;\n\n    var proto = SetFreehand.prototype;\n\n    proto.redo = function() {\n\n        var freehand = this.editor.getMarkup(this.targetId);\n        if (!freehand) {\n            return;\n        }\n\n        freehand.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\n            this.position = action.position;\n            this.size = action.size;\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n","'use strict';\n\nimport { EditModePen } from './EditModePen'\nimport { DeleteFreehand } from '../edit-actions/DeleteFreehand'\nimport { CreateFreehand } from '../edit-actions/CreateFreehand'\nimport { SetFreehand } from '../edit-actions/SetFreehand'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeFreehand(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_FREEHAND, styleAttributes);\n    }\n\n    EditModeFreehand.prototype = Object.create(EditModePen.prototype);\n    EditModeFreehand.prototype.constructor = EditModeFreehand;\n\n    var proto = EditModeFreehand.prototype;\n\n    proto.createPen = function(markupId, position, size, rotation, locations) {\n        return new CreateFreehand(this.editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            locations,\n            this.style);\n    };\n\n    proto.deletePen = function(markup) {\n        return new DeleteFreehand(this.editor, markup);\n    };\n\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\n        return new SetFreehand(this.editor,\n            this.selectedMarkup,\n            position,\n            size,\n            locations,\n            isAbsoluteCoords);\n    };\n\n","'use strict';\n\nimport { MarkupPen } from './MarkupPen'\nimport * as MarkupTypes from './MarkupTypes'\nimport { EditModeFreehand } from './edit-modes/EditModeFreehand'\n\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupFreehand(id, editor) {\n\n        MarkupPen.call(this, id, editor);\n        this.type = MarkupTypes.MARKUP_TYPE_FREEHAND;\n    }\n\n    MarkupFreehand.prototype = Object.create(MarkupPen.prototype);\n    MarkupFreehand.prototype.constructor = MarkupFreehand;\n\n    var proto = MarkupFreehand.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeFreehand(this.editor);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupFreehand } from '../MarkupFreehand'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param style\n     * @constructor\n     */\n    export function CreateFreehand(editor, id, position, size, rotation, locations, style) {\n\n        EditAction.call(this, editor, 'CREATE-FREEHAND', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.slice(0);\n        this.style = cloneStyle(style);\n    }\n\n    CreateFreehand.prototype = Object.create(EditAction.prototype);\n    CreateFreehand.prototype.constructor = CreateFreehand;\n\n    var proto = CreateFreehand.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var freehand = new MarkupFreehand(this.targetId, editor);\n\n        editor.addMarkup(freehand);\n\n        freehand.set(this.position, this.size, this.movements, false);\n        freehand.setRotation(this.rotation);\n        freehand.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreatePolyline } from './CreatePolyline'\n\n    /**\n     *\n     * @param editor\n     * @param polyline\n     * @constructor\n     */\n    export function DeletePolyline(editor, polyline) {\n\n        EditAction.call(this, editor, 'DELETE-POLYLINE', polyline.id);\n        this.createPolyline = new CreatePolyline(\n            editor,\n            polyline.id,\n            polyline.position,\n            polyline.size,\n            polyline.rotation,\n            polyline.locations,\n            polyline.getStyle(),\n            polyline.closed);\n    }\n\n    DeletePolyline.prototype = Object.create(EditAction.prototype);\n    DeletePolyline.prototype.constructor = DeletePolyline;\n\n    var proto =  DeletePolyline.prototype;\n\n    proto.redo = function() {\n\n        this.createPolyline.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createPolyline.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param polyline\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     * @constructor\n     */\n    export function SetPolyline(editor, polyline, position, size, locations, closed) {\n\n        EditAction.call(this, editor, 'SET-POLYLINE', polyline.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = locations.concat();\n        this.closed = closed;\n\n        // No need to save old data\n    }\n\n    SetPolyline.prototype = Object.create(EditAction.prototype);\n    SetPolyline.prototype.constructor = SetPolyline;\n\n    var proto = SetPolyline.prototype;\n\n    proto.redo = function() {\n\n        var polyline = this.editor.getMarkup(this.targetId);\n        if(!polyline) {\n            return;\n        }\n\n        polyline.set(this.position, this.size, this.locations, this.closed);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.locations.concat();\n            this.position = action.position;\n            this.size = action.size;\n            this.closed = action.closed;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeletePolyline } from '../edit-actions/DeletePolyline'\nimport { CreatePolyline } from '../edit-actions/CreatePolyline'\nimport { SetPolyline } from '../edit-actions/SetPolyline'\nimport * as MarkupTypes from '../MarkupTypes'\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\n\n    var SNAP_RANGE = 25;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePolyline(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYLINE, styleAttributes);\n\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\n        this.movements = [];\n    }\n\n    EditModePolyline.prototype = Object.create(EditMode.prototype);\n    EditModePolyline.prototype.constructor = EditModePolyline;\n\n    var proto = EditModePolyline.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var movements = this.movements;\n            if (this.creating && movements.length >= 2) {\n                movements.pop();\n                movements.pop();\n                var lastIndex = movements.length - 1;\n                if (lastIndex >= 0) {\n                    // duplicate last location\n                    var lastMove = movements[lastIndex];\n                    movements.push(lastMove);\n                    var locations = setPositionAndSize(movements, this);\n                    var setPolyline = new SetPolyline(\n                        this.editor,\n                        markup,\n                        this.position,\n                        this.size,\n                        locations);\n\n                    setPolyline.execute();\n                }\n            }\n            else {\n                var deletePolyline = new DeletePolyline(this.editor, markup);\n                deletePolyline.addToHistory = !cantUndo;\n                deletePolyline.execute();\n                this.creationEnd();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        this.dragging = true;\n\n        var movements = this.movements;\n        movements.splice(movements.length-1, 1);\n\n        var mousePosition = editor.getMousePosition();\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        // Close polyline if user clicks close to initial point.\n        if (movements.length >= 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n        }\n\n        movements.push(mousePosition);\n\n        var locations = setPositionAndSize(movements, this);\n        var setPolyline = new SetPolyline(\n            editor,\n            selectedMarkup,\n            this.position,\n            this.size,\n            locations);\n\n        setPolyline.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        if (this.creating) {\n            return;\n        }\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n        this.movements = [mousePosition, mousePosition];\n\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreatePolyline(\n            editor,\n            markupId,\n            mousePosition,\n            size,\n            0,\n            [{x:0, y:0}],\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseUp = function() {\n\n        EditMode.prototype.onMouseUp.call(this);\n\n        if(!this.creating) {\n            return;\n        }\n\n        this.dragging = false;\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n        var closed = false;\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        if (movements.length > 1 &&\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\n            return;\n        }\n\n        // Close polyline if user clicks close to initial point.\n        if (movements.length > 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n            closed = true;\n        }\n\n        movements.splice(movements.length-1, 1);\n\n        if (!closed) {\n            movements.push(mousePosition);\n            movements.push(mousePosition);\n        }\n\n        var polyline = this.selectedMarkup;\n        var locations = setPositionAndSize(movements, polyline);\n        var setPolyline = new SetPolyline(\n            editor,\n            polyline,\n            polyline.position,\n            polyline.size,\n            locations,\n            closed);\n\n        setPolyline.execute();\n\n        if (closed) {\n            this.creationEnd();\n        }\n    };\n\n    proto.destroy = function() {\n        this.onMouseDoubleClick();\n        EditMode.prototype.creationEnd.call(this);\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        // To pass isMinSizeValid,\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\n        if (this.selectedMarkup) {\n            this.size.x = this.selectedMarkup.size.x;\n            this.size.y = this.selectedMarkup.size.y;\n        }\n\n        EditMode.prototype.creationEnd.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if(!this.creating) {\n           return;\n        }\n\n        var movements = this.movements;\n        movements.splice(Math.max(0, movements.length-1));\n\n        if (movements.length < 2 ) {\n\n            this.creationCancel();\n        } else {\n\n            var polyline = this.selectedMarkup;\n            var locations = setPositionAndSize(movements, polyline);\n            var setPolyline = new SetPolyline(\n                this.editor,\n                polyline,\n                polyline.position,\n                polyline.size,\n                locations,\n                this.closed);\n\n            setPolyline.execute();\n            this.creationEnd();\n        }\n    };\n\n    function setPositionAndSize(locations, markup) {\n\n        // determine the position of the top-left and bottom-right points\n        var minFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.min.apply(null, targets);\n        };\n\n        var maxFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.max.apply(null, targets);\n        };\n\n        var l = minFn(locations, 'x');\n        var t = minFn(locations, 'y');\n        var r = maxFn(locations, 'x');\n        var b = maxFn(locations, 'y');\n        var w = r - l;\n        var h = b - t;\n\n        markup.size = {x: w, y: h};\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\n\n        // Adjust points to relate from the shape's center\n        var position = markup.position;\n        return locations.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n    }\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModePolyline } from './edit-modes/EditModePolyline'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPolyline(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_POLYLINE;\n        this.shape = createMarkupPathSvg('path');\n\n        this.bindDomEvents();\n    }\n\n    MarkupPolyline.prototype = Object.create(Markup.prototype);\n    MarkupPolyline.prototype.constructor = MarkupPolyline;\n\n    var proto = MarkupPolyline.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModePolyline(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     *\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     */\n    proto.set = function(position, size, locations, closed) {\n\n        this.rotation = 0; // Reset angle //\n        this.locations = locations.concat();\n\n        this.size.x = (size.x === 0) ? 1 : size.x;\n        this.size.y = (size.y === 0) ? 1 : size.y;\n\n        this.closed = closed;\n\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    };\n\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd',  this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        var path = [];\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        if (locationsCount === 0) {\n            return ' ';\n        }\n\n        path.push('M');\n        path.push(locations[0].x);\n        path.push(locations[0].y);\n\n        for (var i = 1; i < locationsCount; ++i) {\n\n            var locationA = locations[i - 1];\n            var locationB = locations[i];\n\n            path.push('l');\n            path.push(locationB.x - locationA.x);\n            path.push(locationB.y - locationA.y);\n        }\n\n        this.closed && path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupPolyline } from '../MarkupPolyLine'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param closed\n     * @param style\n     * @constructor\n     */\n    export function CreatePolyline(editor, id, position, size, rotation, locations, style, closed) {\n\n        EditAction.call(this, editor, 'CREATE-POLYLINE', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.concat();\n        this.closed = closed;\n        this.style = cloneStyle(style);\n    }\n\n    CreatePolyline.prototype = Object.create(EditAction.prototype);\n    CreatePolyline.prototype.constructor = CreatePolyline;\n\n    var proto = CreatePolyline.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var polyline = new MarkupPolyline(this.targetId, editor);\n\n        editor.addMarkup(polyline);\n\n        polyline.set(this.position, this.size, this.movements, this.closed);\n        polyline.setRotation(this.rotation);\n        polyline.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreatePolycloud } from './CreatePolycloud'\n\n    /**\n     *\n     * @param editor\n     * @param polycloud\n     * @constructor\n     */\n    export function DeletePolycloud(editor, polycloud) {\n\n        EditAction.call(this, editor, 'DELETE-POLYCLOUD', polycloud.id);\n        this.createPolycloud = new CreatePolycloud(\n            editor,\n            polycloud.id,\n            polycloud.position,\n            polycloud.size,\n            polycloud.rotation,\n            polycloud.locations,\n            polycloud.getStyle(),\n            polycloud.closed);\n    }\n\n    DeletePolycloud.prototype = Object.create(EditAction.prototype);\n    DeletePolycloud.prototype.constructor = DeletePolycloud;\n\n    var proto =  DeletePolycloud.prototype;\n\n    proto.redo = function() {\n\n        this.createPolycloud.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createPolycloud.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param polycloud\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     * @constructor\n     */\n    export function SetPolycloud(editor, polycloud, position, size, locations, closed) {\n\n        EditAction.call(this, editor, 'SET-POLYCLOUD', polycloud.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = locations.concat();\n        this.closed = closed;\n\n        // No need to save old data\n    }\n\n    SetPolycloud.prototype = Object.create(EditAction.prototype);\n    SetPolycloud.prototype.constructor = SetPolycloud;\n\n    var proto = SetPolycloud.prototype;\n\n    proto.redo = function() {\n\n        var polycloud = this.editor.getMarkup(this.targetId);\n        if(!polycloud) {\n            return;\n        }\n\n        polycloud.set(this.position, this.size, this.locations, this.closed);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.locations.concat();\n            this.position = action.position;\n            this.size = action.size;\n            this.closed = action.closed;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeletePolycloud } from '../edit-actions/DeletePolycloud'\nimport { CreatePolycloud } from '../edit-actions/CreatePolycloud'\nimport { SetPolycloud } from '../edit-actions/SetPolycloud'\nimport * as MarkupTypes from '../MarkupTypes'\nimport { areMarkupsPointsInClientRange } from '../MarkupsCoreUtils'\n\n    var SNAP_RANGE = 25;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModePolycloud(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_POLYCLOUD, styleAttributes);\n\n        this.creationMethod = this.CREATION_METHOD_CLICKS;\n        this.movements = [];\n    }\n\n    EditModePolycloud.prototype = Object.create(EditMode.prototype);\n    EditModePolycloud.prototype.constructor = EditModePolycloud;\n\n    var proto = EditModePolycloud.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var movements = this.movements;\n            if (this.creating && movements.length >= 2) {\n                movements.pop();\n                movements.pop();\n                var lastIndex = movements.length - 1;\n                if (lastIndex >= 0) {\n                    // duplicate last location\n                    var lastMove = movements[lastIndex];\n                    movements.push(lastMove);\n                    var locations = setPositionAndSize(movements, this);\n                    var setPolycloud = new SetPolycloud(\n                        this.editor,\n                        markup,\n                        this.position,\n                        this.size,\n                        locations);\n\n                    setPolycloud.execute();\n                }\n            }\n            else {\n                var deletePolycloud = new DeletePolycloud(this.editor, markup);\n                deletePolycloud.addToHistory = !cantUndo;\n                deletePolycloud.execute();\n                this.creationEnd();\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        var selectedMarkup = this.selectedMarkup;\n\n        var editor = this.editor;\n\n        this.dragging = true;\n\n        var movements = this.movements;\n        movements.splice(movements.length-1, 1);\n\n        var mousePosition = editor.getMousePosition();\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        // Close polycloud if user clicks close to initial point.\n        if (movements.length >= 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n        }\n\n        movements.push(mousePosition);\n\n        var locations = setPositionAndSize(movements, this);\n        var setPolycloud = new SetPolycloud(\n            editor,\n            selectedMarkup,\n            this.position,\n            this.size,\n            locations);\n\n        setPolycloud.execute();\n        return true;\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function() {\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n\n        if (this.creating) {\n            return;\n        }\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        var size = this.size = editor.sizeFromClientToMarkups(1, 1);\n        this.movements = [mousePosition, mousePosition];\n\n        editor.beginActionGroup();\n\n        var markupId = editor.getId();\n        var create = new CreatePolycloud(\n            editor,\n            markupId,\n            mousePosition,\n            size,\n            0,\n            [{x: 0, y: 0 }],\n            this.style);\n\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    };\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        EditMode.prototype.onMouseUp.call(this);\n\n        if(!this.creating) {\n            return;\n        }\n\n        this.dragging = false;\n\n        // Creation process.\n        var editor = this.editor;\n        var mousePosition = editor.getMousePosition();\n        var movements = this.movements;\n        var closed = false;\n\n        mousePosition = editor.clientToMarkups(mousePosition.x, mousePosition.y);\n\n        if (movements.length > 1 &&\n            areMarkupsPointsInClientRange(movements[movements.length-2], mousePosition, SNAP_RANGE, this.editor)) {\n            return;\n        }\n\n        // Close polycloud if user clicks close to initial point.\n        if (movements.length > 2 &&\n            areMarkupsPointsInClientRange(movements[0], mousePosition, SNAP_RANGE, this.editor)) {\n            mousePosition = movements[0]; // Snap!\n            closed = true;\n        }\n\n        movements.splice(movements.length-1, 1);\n\n        if (!closed) {\n            movements.push(mousePosition);\n            movements.push(mousePosition);\n        }\n\n        var polycloud = this.selectedMarkup;\n        var locations = setPositionAndSize(movements, polycloud);\n        var setPolycloud = new SetPolycloud(\n            editor,\n            polycloud,\n            polycloud.position,\n            polycloud.size,\n            locations,\n            closed);\n\n        setPolycloud.execute();\n\n        if (closed) {\n            this.creationEnd();\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if(!this.creating) {\n            return;\n        }\n\n        var movements = this.movements;\n        movements.splice(Math.max(0, movements.length-1));\n\n        if (movements.length < 2 ) {\n\n            this.creationCancel();\n        } else {\n\n            var polycloud = this.selectedMarkup;\n            var locations = setPositionAndSize(movements, polycloud);\n            var setPolycloud = new SetPolycloud(\n                this.editor,\n                polycloud,\n                polycloud.position,\n                polycloud.size,\n                locations,\n                true);\n\n            setPolycloud.execute();\n            this.creationEnd();\n        }\n    };\n\n    proto.destroy = function() {\n        this.onMouseDoubleClick();\n        EditMode.prototype.creationEnd.call(this);\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        // To pass isMinSizeValid,\n        // probably that test should be done with the markup size (not the recorded by the edit mode).\n        if (this.selectedMarkup) {\n            this.size.x = this.selectedMarkup.size.x;\n            this.size.y = this.selectedMarkup.size.y;\n        }\n        \n        EditMode.prototype.creationEnd.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.closed = false;\n        this.movements = [];\n        this.dragging = false;\n        this.creating = false;\n    };\n\n    function setPositionAndSize(locations, markup) {\n\n        // determine the position of the top-left and bottom-right points\n        var minFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.min.apply(null, targets);\n        };\n\n        var maxFn = function(collection, key){\n            var targets = collection.map(function(item){\n                return item[key];\n            });\n            return Math.max.apply(null, targets);\n        };\n\n        var strokeWidth = markup.style['stroke-width'];\n        var radius = strokeWidth * 2 + strokeWidth * 0.5;\n\n        var l = minFn(locations, 'x') - radius;\n        var t = minFn(locations, 'y') - radius;\n        var r = maxFn(locations, 'x') + radius;\n        var b = maxFn(locations, 'y') + radius;\n        var w = r - l;\n        var h = b - t;\n\n        markup.size = {x: w, y: h};\n        markup.position = {x: l + w * 0.5, y: t + h * 0.5};\n\n        // Adjust points to relate from the shape's center\n        var position = markup.position;\n        return locations.map(function(point){\n            return {\n                x: point.x - position.x,\n                y: point.y - position.y\n            };\n        });\n    }\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString, setAttributeToMarkupSvg,\n    updateMarkupPathSvgHitarea, addMarkupMetadata } from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModePolycloud } from './edit-modes/EditModePolycloud'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupPolycloud(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color','stroke-opacity', 'fill-color', 'fill-opacity'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n\n        this.type = MarkupTypes.MARKUP_TYPE_POLYCLOUD;\n        this.locations = [];\n        this.shape = createMarkupPathSvg();\n\n        this.bindDomEvents();\n    }\n\n    MarkupPolycloud.prototype = Object.create(Markup.prototype);\n    MarkupPolycloud.prototype.constructor = MarkupPolycloud;\n\n    var proto = MarkupPolycloud.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModePolycloud(this.editor);\n    };\n\n    /**\n     *\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * @param position\n     * @param size\n     * @param locations\n     * @param closed\n     */\n    proto.set = function(position, size, locations, closed) {\n\n        this.rotation = 0; // Reset angle //\n        this.locations = locations.concat();\n\n        this.size.x = (size.x === 0) ? 1 : size.x;\n        this.size.y = (size.y === 0) ? 1 : size.y;\n\n        this.closed = closed;\n\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    };\n\n    /**\n     * Applies data values into DOM element style/attribute(s)\n     *\n     */\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var path = this.getPath().join(' ');\n\n        var strokeWidth = this.style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var fillColor = this.closed ? composeRGBAString(style['fill-color'], style['fill-opacity']) : 'none';\n        var transform = this.getTransform();\n\n        setAttributeToMarkupSvg(shape, 'd', path);\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', fillColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetSize edit action\n     * @param {{x: Number, y: Number}} position\n     * @param {Number} width\n     * @param {Number} height\n     */\n    proto.setSize = function (position, width, height) {\n\n        width = (width === 0 ? 1 : width);\n        height = (height === 0 ? 1 : height);\n\n        var locations = this.locations;\n        var locationsCount = locations.length;\n\n        var scaleX = width / this.size.x;\n        var scaleY = height / this.size.y;\n\n        for(var i = 0; i < locationsCount; ++i) {\n\n            var point = locations[i];\n\n            point.x *= scaleX;\n            point.y *= scaleY;\n        }\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n\n        this.size.x = width;\n        this.size.y = height;\n\n        this.updateStyle();\n    };\n\n    proto.setMetadata = function() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n        metadata.locations = this.locations.map(function(point){\n            return [point.x, point.y].join(\" \");\n        }).join(\" \");\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n    proto.getPath = function() {\n\n        function getOrientation(locations) {\n\n            switch (locations.length) {\n\n                case 0:\n                case 1:\n                    return 1;\n                case 2:\n\n                    var fstPoint = locations[0];\n                    var sndPoint = locations[1];\n\n                    return fstPoint.y > sndPoint.y ? 1 : -1;\n                default:\n\n                    var pointA = locations[0];\n                    var pointB = locations[1];\n                    var pointC = locations[2];\n\n                    var orientation =\n                        (pointB.x - pointA.x) * (pointB.y + pointA.y) +\n                        (pointC.x - pointB.x) * (pointC.y + pointB.y);\n\n                    return orientation < 0 ? 1 : -1;\n            }\n        }\n\n        function getSides(locations, closed) {\n\n            var locationsCount = locations.length;\n\n            var sides = [];\n            var sidesCount = locationsCount - (closed ? 0 : 1);\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var locationA = locations[i];\n                var locationB = locations[(i+1)%locationsCount];\n\n                var dx = locationB.x - locationA.x;\n                var dy = locationB.y - locationA.y;\n\n                var length = Math.sqrt(dx * dx + dy * dy);\n\n                sides.push({\n                    index: i,\n                    pointA: new THREE.Vector3(locationA.x, locationA.y, 0),\n                    pointB: new THREE.Vector3(locationB.x, locationB.y, 0),\n                    vecAB:  new THREE.Vector3(dx / length, dy / length, 0),\n                    vecBA:  new THREE.Vector3(-dx / length, -dy / length, 0),\n                    length: length\n                });\n            }\n\n            return sides;\n        }\n\n        function updateCorners(side, cornerA, cornerB, orientation) {\n            var rA = cornerA.radius;\n            var rB = cornerB.radius;\n            var D = side.length;\n\n            if (rA > 0 && rB > 0 && rA + rB > D && Math.abs(rA - rB) < D) {\n                // Corner arcs overlap, so correct them by finding the circle-circle intersection\n                var a = side.pointA.x;\n                var b = side.pointA.y;\n                var c = side.pointB.x;\n                var d = side.pointB.y;\n\n                var delta = 0.25 * Math.sqrt((D + rA + rB) * (D + rA - rB) * (D - rA + rB) * (-D + rA + rB));\n                var xS = (a + c) / 2 + (c - a) * (rA*rA - rB*rB) / (2*D*D);\n                var xT = 2*(b - d) / (D*D) * delta;\n                var yS = (b + d) / 2 + (d - b) * (rA*rA - rB*rB) / (2*D*D);\n                var yT = 2*(a - c) / (D*D) * delta;\n                var x1 = xS + xT;\n                var x2 = xS - xT;\n                var y1 = yS - yT;\n                var y2 = yS + yT;\n                var testPointOnCircle = Math.abs((x1 - a) * (x1 - a) + (y1 - b) * (y1 - b) - rA * rA);\n                if (testPointOnCircle > 0.0000001) {\n                    var tmp = y1;\n                    y1 = y2;\n                    y2 = tmp;\n                }\n\n                var intersec = new THREE.Vector3(x1, y1, 0);\n                var intersecSide = Math.sign(intersec.clone().sub(side.pointA).cross(side.vecAB).z);\n                if (intersecSide !== orientation) {\n                    intersec.set(x2, y2, 0);\n                }\n\n                cornerA.pointB = intersec.clone();\n                cornerB.pointA = intersec.clone();\n\n                return true;\n            }\n\n            return false;\n        }\n\n        function updateSides(sides, corners, radius, orientation) {\n\n            var diameter = radius * 2;\n            var sidesCount = sides.length;\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var side = sides[i];\n                var cornerA = corners[i];\n                var cornerB = corners[(i+1)%sidesCount];\n\n                side.bodyA = side.vecAB.clone().multiplyScalar(cornerA.radius).add(side.pointA);\n                side.bodyB = side.vecBA.clone().multiplyScalar(cornerB.radius).add(side.pointB);\n\n                if (updateCorners(side, cornerA, cornerB, orientation)) {\n                    side.body = 0;\n                    side.bodyDiameter = side.bodyCount = 0;\n                } else {\n                    side.body = side.bodyB.clone().sub(side.bodyA).length();\n                    side.bodyCount = Math.round(side.body / diameter);\n                    if (side.bodyCount === 0 && side.body > 0.5*radius) {\n                        side.bodyCount = 1;\n                    }\n                    side.bodyDiameter = diameter + (side.body - diameter * side.bodyCount) / side.bodyCount;\n                }\n\n                side.bodyRadius = side.bodyDiameter * 0.5;\n            }\n        }\n\n        function getCorners(sides, radius, closed) {\n\n            var corners = [];\n            var sidesCount = sides.length;\n\n            for(var i = 0; i < sidesCount; ++i) {\n\n                var sideA = sides[i !== 0 ? i-1 : sidesCount-1];\n                var sideB = sides[i];\n                var large = sideA.vecBA.clone().cross(sideB.vecAB).z < 0;\n\n                var sidesTooShort = sideA.length < radius || sideB.length < radius;\n                if (sidesTooShort || (i === 0 && !closed)) {\n\n                    corners.push({\n                        pointA: sideB.pointA.clone(),\n                        pointB: sideB.pointA.clone(),\n                        radius: 0,\n                        large: false\n                    });\n                } else {\n\n                    corners.push({\n                        pointA: sideB.pointA.clone().add(sideA.vecBA.clone().multiplyScalar(radius)),\n                        pointB: sideB.pointA.clone().add(sideB.vecAB.clone().multiplyScalar(radius)),\n                        radius: radius,\n                        large: large\n                    });\n                }\n            }\n\n            return corners;\n        }\n\n        function createSidePath(side, orientation, path) {\n\n            var count = side.bodyCount;\n            if (count === 0) {\n                return;\n            }\n\n            var radius = side.bodyRadius;\n            var diameter = side.bodyDiameter;\n\n            var xValueInset = diameter * 0.05;\n            var yValueOffset = radius * 3.5 / 3.0;\n\n            var p1 = new THREE.Vector3(xValueInset, orientation * -yValueOffset);\n            var p2 = new THREE.Vector3(diameter - xValueInset, orientation * -yValueOffset);\n            var p3 = new THREE.Vector3(diameter, 0);\n\n            var angle = Math.acos(side.vecAB.x) * (side.vecAB.y < 0 ? -1 : 1);\n            var rotation = new THREE.Matrix4().makeRotationZ(angle);\n\n            p1.applyMatrix4(rotation);\n            p2.applyMatrix4(rotation);\n            p3.applyMatrix4(rotation);\n\n            for (var i = 0; i < count; ++i) {\n\n                path.push('c');\n                path.push(p1.x);\n                path.push(p1.y);\n                path.push(p2.x);\n                path.push(p2.y);\n                path.push(p3.x);\n                path.push(p3.y);\n            }\n        }\n\n        function createCornerPath(corner, first, orientation, path) {\n\n            if (first) {\n\n                path.push('M');\n                path.push(corner.pointA.x);\n                path.push(corner.pointA.y);\n            }\n\n            var large = orientation === 1 ? corner.large : !corner.large;\n\n            if (corner.radius !== 0) {\n\n                path.push('a');\n                path.push(corner.radius);\n                path.push(corner.radius);\n                path.push(0);\n                path.push(large ? 1 : 0);\n                path.push(orientation === 1 ? 1 : 0);\n                path.push(corner.pointB.x - corner.pointA.x);\n                path.push(corner.pointB.y - corner.pointA.y);\n            }\n            return path;\n        }\n\n\n        var strokeWidth = this.style['stroke-width'];\n        var radius = strokeWidth * 2;\n        var orientation = getOrientation(this.locations);\n        var closed = this.closed;\n        var path = [];\n\n        var sides = getSides(this.locations, closed);\n        var corners = getCorners(sides, radius, closed);\n        var cornersCount = corners.length;\n\n        updateSides(sides, corners, radius, orientation);\n\n        for(var i = 0; i < cornersCount; ++i) {\n\n            createCornerPath(corners[i], i === 0, orientation, path);\n            createSidePath(sides[i], orientation, path);\n        }\n\n        closed && path.push('z');\n        return path;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupPolycloud } from '../MarkupPolycloud'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param closed\n     * @param style\n     * @constructor\n     */\n    export function CreatePolycloud(editor, id, position, size, rotation, locations, style, closed) {\n\n        EditAction.call(this, editor, 'CREATE-POLYCLOUD', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.concat();\n        this.style = cloneStyle(style);\n        this.closed = closed;\n    }\n\n    CreatePolycloud.prototype = Object.create(EditAction.prototype);\n    CreatePolycloud.prototype.constructor = CreatePolycloud;\n\n    var proto = CreatePolycloud.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var polyline = new MarkupPolycloud(this.targetId, editor);\n\n        editor.addMarkup(polyline);\n\n        polyline.set(this.position, this.size, this.movements, this.closed);\n        polyline.setRotation(this.rotation);\n        polyline.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateHighlight } from './CreateHighlight'\n\n    /**\n     *\n     * @param editor\n     * @param highlight\n     * @constructor\n     */\n    export function DeleteHighlight(editor, highlight) {\n        EditAction.call(this, editor, 'DELETE-HIGHLIGHT', highlight.id);\n        this.createHighlight = new CreateHighlight(\n            editor,\n            highlight.id,\n            highlight.position,\n            highlight.size,\n            highlight.rotation,\n            highlight.locations,\n            highlight.getStyle());\n    }\n\n    DeleteHighlight.prototype = Object.create(EditAction.prototype);\n    DeleteHighlight.prototype.constructor = DeleteHighlight;\n\n    var proto = DeleteHighlight.prototype;\n\n    proto.redo = function() {\n\n        this.createHighlight.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createHighlight.redo();\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param highlight\n     * @param position\n     * @param size\n     * @param locations\n     * @constructor\n     */\n    export function SetHighlight(editor, highlight, position, size, locations, isAbsoluteCoords) {\n\n        EditAction.call(this, editor, 'SET-HIGHLIGHT', highlight.id);\n\n        this.position = position;\n        this.size = size;\n        this.locations = isAbsoluteCoords ? locations : locations.slice(0);\n        this.isAbsoluteCoords = isAbsoluteCoords;\n\n        // No need to save old data\n    }\n\n    SetHighlight.prototype = Object.create(EditAction.prototype);\n    SetHighlight.prototype.constructor = SetHighlight;\n\n    var proto = SetHighlight.prototype;\n\n    proto.redo = function() {\n\n        var highlight = this.editor.getMarkup(this.targetId);\n        if (!highlight) {\n            return;\n        }\n\n        highlight.set(this.position, this.size, this.locations, this.isAbsoluteCoords);\n    };\n\n    proto.undo = function() {\n        // No need for undo.\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.locations = action.isAbsoluteCoords ? action.locations : action.locations.slice(0);\n            this.position = action.position;\n            this.size = action.size;\n            this.isAbsoluteCoords = action.isAbsoluteCoords;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return false; // No need to optimize, always false.\n    };\n\n","'use strict';\n\nimport { EditModePen } from './EditModePen'\nimport { DeleteHighlight } from '../edit-actions/DeleteHighlight'\nimport { CreateHighlight } from '../edit-actions/CreateHighlight'\nimport { SetHighlight } from '../edit-actions/SetHighlight'\nimport * as MarkupTypes from '../MarkupTypes'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeHighlight(editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity'];\n        EditModePen.call(this, editor, MarkupTypes.MARKUP_TYPE_HIGHLIGHT, styleAttributes);\n\n        var normaStrokeWidth = editor.getStrokeWidth();\n        this.style['stroke-opacity'] = 0.50;\n        this.style['stroke-color'] = '#ffff00';\n        this.style['stroke-width'] = 4 * normaStrokeWidth; // Very Thick\n    }\n\n    EditModeHighlight.prototype = Object.create(EditModePen.prototype);\n    EditModeHighlight.prototype.constructor = EditModeHighlight;\n\n    var proto = EditModeHighlight.prototype;\n\n    proto.createPen = function(markupId, position, size, rotation, locations) {\n        return new CreateHighlight(this.editor,\n            markupId,\n            position,\n            size,\n            rotation,\n            locations,\n            this.style);\n    };\n\n    proto.deletePen = function(markup) {\n        return new DeleteHighlight(this.editor, markup);\n    };\n\n    proto.setPen = function(position, size, locations, isAbsoluteCoords) {\n        return new SetHighlight(this.editor,\n            this.selectedMarkup,\n            position,\n            size,\n            locations,\n            isAbsoluteCoords);\n    };\n\n","'use strict';\n\nimport { MarkupPen } from './MarkupPen'\nimport * as MarkupTypes from './MarkupTypes'\nimport { EditModeHighlight } from './edit-modes/EditModeHighlight'\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupHighlight(id, editor) {\n\n        MarkupPen.call(this, id, editor);\n        this.type = MarkupTypes.MARKUP_TYPE_HIGHLIGHT;\n    }\n\n    MarkupHighlight.prototype = Object.create(MarkupPen.prototype);\n    MarkupHighlight.prototype.constructor = MarkupHighlight;\n\n    var proto = MarkupHighlight.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeHighlight(this.editor);\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupHighlight } from '../MarkupHighlight'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param position\n     * @param size\n     * @param rotation\n     * @param locations\n     * @param style\n     * @constructor\n     */\n    export function CreateHighlight(editor, id, position, size, rotation, locations, style) {\n\n        EditAction.call(this, editor, 'CREATE-HIGHLIGHT', id);\n\n        this.selectOnExecution = false;\n        this.position = position;\n        this.size = size;\n        this.rotation = rotation;\n        this.movements = locations.slice(0);\n        this.style = cloneStyle(style);\n    }\n\n    CreateHighlight.prototype = Object.create(EditAction.prototype);\n    CreateHighlight.prototype.constructor = CreateHighlight;\n\n    var proto = CreateHighlight.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var highlight = new MarkupHighlight(this.targetId, editor);\n\n        editor.addMarkup(highlight);\n\n        highlight.set(this.position, this.size, this.movements, false);\n        highlight.setRotation(this.rotation);\n        highlight.setStyle(this.style);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateDimension } from './CreateDimension'\n\n    /**\n     *\n     * @param editor\n     * @param dimension\n     * @constructor\n     */\n    export function DeleteDimension(editor, dimension) {\n\n        // Confusing naming here. Dimension.secondAnchor is the starting point of the dimension,\n        // and dimension.firstAnchor is the final point. In CreateDimension the firstAnchor argument\n        // is the first point of the dimension and the secondAnchor argument is the second\n        // point of the argument. So construct CreateDimension with the secondAnchor before\n        // the firstAnchor. \n        EditAction.call(this, editor, 'DELETE-DIMENSION', dimension.id);\n        this.createDimension = new CreateDimension(\n            editor,\n            dimension.id,\n            dimension.secondAnchor,\n            dimension.firstAnchor,\n            dimension.currentText,\n            dimension.getStyle());\n    }\n\n    DeleteDimension.prototype = Object.create(EditAction.prototype);\n    DeleteDimension.prototype.constructor = DeleteDimension;\n\n    var proto = DeleteDimension.prototype;\n\n    proto.redo = function() {\n\n        this.createDimension.undo();\n    };\n\n    proto.undo = function() {\n\n        this.createDimension.redo();\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param dimension\n     * @param firstAnchor\n     * @param secondAnchor\n     * @constructor\n     */\n    export function SetDimension(editor, dimension, firstAnchor, secondAnchor, text) {\n\n        EditAction.call(this, editor, 'SET-DIMENSION', dimension.id);\n\n        this.newFirstAnchor = {x: firstAnchor.x, y: firstAnchor.y};\n        this.newSecondAnchor = {x: secondAnchor.x, y: secondAnchor.y};   \n        this.oldFirstAnchor = {x: dimension.firstAnchor.x, y: dimension.firstAnchor.y};\n        this.oldSecondAnchor = {x: dimension.secondAnchor.x, y: dimension.secondAnchor.y}; \n        this.newText = text;\n        this.oldText = dimension.currentText;\n    }\n\n    SetDimension.prototype = Object.create(EditAction.prototype);\n    SetDimension.prototype.constructor = SetDimension;\n\n    var proto = SetDimension.prototype;\n\n    proto.redo = function() {\n\n        this.applyState(this.newFirstAnchor, this.newSecondAnchor, this.newText);    \n\n    };\n\n    proto.undo = function() {\n\n        this.applyState(this.oldFirstAnchor, this.oldSecondAnchor, this.oldText);\n\n    };\n\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newFirstAnchor = action.newFirstAnchor;\n            this.newSecondAnchor = action.newSecondAnchor;\n            this.newText = action.newText;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     *\n     * @private\n     */\n    proto.applyState = function(firstAnchor, secondAnchor, text) {\n\n        var dimension = this.editor.getMarkup(this.targetId);\n\n        if(!dimension) {\n            return;\n        }\n\n        dimension.set(firstAnchor.x, firstAnchor.y, secondAnchor.x, secondAnchor.y, text);\n\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return ((this.newText === this.oldText) && (\n            !this.newFirstAnchor || !this.newSecondAnchor ||\n            this.newFirstAnchor.x === this.oldFirstAnchor.x &&\n            this.newFirstAnchor.y === this.oldFirstAnchor.y &&\n            this.newSecondAnchor.x === this.oldSecondAnchor.x &&\n            this.newSecondAnchor.y === this.oldSecondAnchor.y));\n    };\n","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteDimension } from '../edit-actions/DeleteDimension'\nimport { CreateDimension } from '../edit-actions/CreateDimension'\nimport { SetDimension } from '../edit-actions/SetDimension'\nimport { SetStyle } from '../edit-actions/SetStyle'\nimport * as MarkupTypes from '../MarkupTypes'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditorTextInput } from './EditorTextInput'\nimport { measureTextLines, radiansToDegrees } from '../MarkupsCoreUtils'\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n    \n    var MAX_LETTERS = 15;\n    var SPACE = '\\u00A0'; // Non-breaking space\n    var _cursorPosition;\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function EditModeDimension(editor) {\n\n        var self = this;\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\n        EditMode.call(this, editor, MarkupTypes.MARKUP_TYPE_DIMENSION, styleAttributes);\n\n        this.onHistoryChangeBinded = this.onHistoryChange.bind(this);\n\n        this.measurement = new MeasureCommon.Measurement(MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE);\n        var viewer = this.viewer;\n        var measureExt = viewer.getExtension('Autodesk.Measure');\n        \n        function abortDimensionMarkup() {\n            self.cancelEditModeChange = true;\n            editor.enterEditMode(); // Selects default edit mode.\n        }\n\n        if (!measureExt) {\n            console.error('Demension markup cant work without measure extension. Please load measure extension first');\n            abortDimensionMarkup();\n        }\n\n        this.sharedMeasureConfig = measureExt.sharedMeasureConfig;\n        \n        // If PDF, force calibration\n        if ((measureExt.forceCalibrate || viewer.model.isLeaflet() || viewer.model.isPdf(true)) && !measureExt.calibrationTool.isCalibrated()) {\n            measureExt.openCalibrationRequiredDialog('dimension');\n            abortDimensionMarkup();\n        }\n    }\n\n    EditModeDimension.prototype = Object.create(EditMode.prototype);\n    EditModeDimension.prototype.constructor = EditModeDimension;\n\n    var proto = EditModeDimension.prototype;\n\n    proto.deleteMarkup = function(markup, cantUndo) {\n\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteDimension = new DeleteDimension(this.editor, markup);\n            deleteDimension.addToHistory = !cantUndo;\n            deleteDimension.execute();\n            this.creating = false;\n            this.dragging = false;\n            return true;\n        }\n        return false;\n    };\n\n    proto.updateTextBoxStyle = function(style) {\n        if (this.isTextInputHelperActive()) {\n            if (!style) {\n                style = this.textInputHelper.textMarkup.getStyle();\n            }\n\n            this.textInputHelper.setStyle(style);\n            this.updateTextBox(this.textInputHelper.textMarkup);\n        }\n    };\n\n    proto.setStyle = function(style) {\n\n        EditMode.prototype.setStyle.call(this, style);\n        this.updateTextBoxStyle(style);\n\n    };\n\n    proto.notifyAllowNavigation = function(allows) {\n\n        if (allows && this.isTextInputHelperActive()) {\n            this.textInputHelper.acceptAndExit();\n        }\n    };\n\n    proto.creationBegin = function() {\n        EditMode.prototype.creationBegin.call(this);\n    };\n\n    proto.creationEnd = function() {\n\n        this.dragging = false;\n        EditMode.prototype.creationEnd.call(this);\n    };\n\n    proto.isMinSizeValid = function() {\n\n        if (this.minSize !== 0) {\n            var tmp = this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x, this.selectedMarkup.size.y);\n            return (tmp.x*tmp.x) >= (this.minSize * this.minSize);\n        }\n\n        return true;\n    };\n\n    proto.creationCancel = function() {\n\n        EditMode.prototype.creationCancel.call(this);\n\n        this.creating = false;\n        this.dragging = false;\n\n    };\n\n    proto.destroy = function() {\n\n        if (this.textInputHelper) {\n\n            if (this.textInputHelper.isActive()) {\n                this.textInputHelper.acceptAndExit();\n            }\n\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n\n            this.textInputHelper.destroy();\n            this.textInputHelper = null;\n        }\n\n        this.updateViewportId();\n\n        EditMode.prototype.destroy.call(this);\n    };\n\n    proto.getDistance = function() {\n\n        var distance = null;\n\n        this.measurement.computeResult(this.measurement.picks, this.viewer);\n\n        if (this.viewer.model && this.measurement.distanceXYZ) {\n            var d = Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(), this.sharedMeasureConfig.units, this.sharedMeasureConfig.calibrationFactor, this.measurement.distanceXYZ);\n            return Autodesk.Viewing.Private.formatValueWithUnits(d, this.sharedMeasureConfig.units, 3, this.sharedMeasureConfig.precision);\n        }\n\n        return distance;\n    };\n\n    proto.updateMeasurement = function(measurementNumber) {\n        var editor = this.editor;\n\n        var pick = this.measurement.getPick(measurementNumber);\n        \n        if (_cursorPosition) {\n            pick.geomType = MeasureCommon.SnapType.SNAP_VERTEX;\n            pick.geomVertex = _cursorPosition;\n            pick.intersectPoint = _cursorPosition;\n        } else {\n            editor.snapper.copyResults(pick);\n        }\n\n        return pick;\n    };\n\n    proto.updateViewportId = function(viewportId) {\n        if (this.viewer.model && this.viewer.model.is2d()) {\n            if (!viewportId) {\n                this.viewer.impl.updateViewportId(0);\n                this.editor.snapper.setViewportId(null);\n            }\n            else {\n                // Pass viewport Id to LineShader to make all other geometries with different viewport transparent\n                this.viewer.impl.updateViewportId(viewportId);\n                this.editor.snapper.setViewportId(viewportId);  \n            \n            }\n        }\n    };\n\n    proto.pickFirstAnchor = function() {\n        var editor = this.editor;\n        this.measurement.clearAllPicks();\n        var mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n\n        this.firstAnchor = editor.positionFromClientToMarkups(this.initialX, this.initialY);\n\n        editor.beginActionGroup();\n\n        var dimensionId = editor.getId();\n        var create = new CreateDimension(editor, dimensionId, this.firstAnchor, null, this.currentText, this.style);\n        create.execute();\n\n        this.selectedMarkup = editor.getMarkup(dimensionId);\n        this.creationBegin();\n        \n        var pick = this.updateMeasurement(1);\n        this.updateViewportId(pick.viewportIndex2d);\n    };\n\n    proto.pickSecondAnchor = function(mouseDown) {\n\n        var editor = this.editor;\n        var selectedMarkup = this.selectedMarkup;\n\n        this.secondAnchor = this.getFinalMouseDraggingPosition();\n\n        this.updateMeasurement(2);\n\n        // Correct Perpendicular\n        if (MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1), this.measurement.getPick(2), this.viewer, editor.snapper)){\n            var newPos = MeasureCommon.getSnapResultPosition(this.measurement.getPick(2), this.viewer);\n            this.secondAnchor = editor.project(newPos);\n            editor.snapper.indicator.render();\n        }\n\n        var secondAnchor = editor.positionFromClientToMarkups(this.secondAnchor.x, this.secondAnchor.y);\n\n        this.size.x = selectedMarkup.size.x;\n        this.size.y = selectedMarkup.size.y;\n\n        selectedMarkup.currentText = this.getDistance();         \n\n        var setDimension = new SetDimension(editor, selectedMarkup, this.firstAnchor, secondAnchor, selectedMarkup.currentText);\n        setDimension.execute();\n\n        var setStyle = new SetStyle(editor, selectedMarkup, this.style);\n        setStyle.execute();\n\n        // Open 'Add Length' textbox if no measurement has being taken.\n        if (mouseDown && !selectedMarkup.currentText && this.isMinSizeValid()) {\n            selectedMarkup.currentText = '';\n            this.editor.selectMarkup(null);\n            this.updateTextBox(selectedMarkup);\n        } \n    };\n\n\n    /**\n     * Handler to mouse down events, used to start markups creation.\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        // Right click - do nothing.\n        if (Autodesk.Viewing.Private.isRightClick(event, this.viewer.navigation)) {\n            return;\n        }\n\n        _cursorPosition = null;\n\n        // Textbox is open.\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.acceptAndExit();\n            return;\n        }\n\n        EditMode.prototype.onMouseDown.call(this);\n\n        // User selected an already created markup.\n        if (this.selectedMarkup && !this.creating) {\n            return;\n        }\n        \n        var isSnapped = this.editor.snapper.isSnapped();\n\n        // Picked first point.\n        if (!this.selectedMarkup && !this.creating && isSnapped) {\n            this.pickFirstAnchor();\n        }\n\n        // Picked second point.\n        else if (this.selectedMarkup && this.creating) {\n\n            if (isSnapped) {\n                this.pickSecondAnchor(true);   \n            } else {\n                this.deleteMarkup(this.selectedMarkup, true);\n                this.creating = true;\n            }\n\n            this.updateViewportId();\n            this.creationEnd();\n        }\n    };\n\n    proto.onMouseUp = function(event) {\n\n        if (this.dragging) {\n            this.onMouseDown(event);   \n            this.dragging = false; \n        }\n    };\n\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     * @param {MouseEvent} event Mouse event.\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        _cursorPosition = null;\n\n        if(!this.selectedMarkup || !this.creating) {\n            return;\n        }\n\n        this.dragging = true;\n        this.pickSecondAnchor(false);\n    };\n\n    proto.getFinalMouseDraggingPosition = function() {\n\n        var editor = this.editor;\n        var bounds = editor.getBounds();\n        var mousePosition = editor.getMousePosition();\n\n        if (!editor.snapper.isSnapped()) {\n            if (editor.viewer.model && editor.viewer.model.is2d()) {\n                _cursorPosition = MeasureCommon.inverseProject(mousePosition, editor.viewer);\n            }\n        }\n\n        var initialX = this.initialX;\n        var initialY = this.initialY;\n\n        var finalX = Math.min(Math.max(bounds.x, mousePosition.x), bounds.x + bounds.width);\n        var finalY = Math.min(Math.max(bounds.y, mousePosition.y), bounds.y + bounds.height);\n\n        if (finalX == initialX &&\n            finalY == initialY) {\n            finalX++;\n            finalY++;\n        }\n\n        // Make straight line when shift key is down.\n        if (editor.input.constrainAxis && editor.viewer.model.is2d()) {\n            var dx = Math.abs(finalX - initialX);\n            var dy = Math.abs(finalY - initialY);\n\n            if (dx > dy) {\n                finalY = initialY;\n            } \n            else {\n                finalX = initialX;\n            }\n\n            editor.snapper.onMouseMove({ x:finalX, y:finalY });\n            \n            if (editor.snapper.isSnapped()) {\n                editor.snapper.copyResults(this.measurement.getPick(2));\n                _cursorPosition = null;\n            } else {\n                _cursorPosition = MeasureCommon.inverseProject({ x:finalX, y:finalY }, editor.viewer);\n            }\n        }\n\n        return { x:finalX, y:finalY };\n    };\n\n    proto.isVisibleChar = function(keyCode) {\n\n    return  ((keyCode > 47 && keyCode < 58)  || // number keys\n            (keyCode == 32)                  || // spacebar\n            (keyCode > 64 && keyCode < 91)   || // letter keys\n            (keyCode > 95 && keyCode < 112)  || // numpad keys\n            (keyCode > 185 && keyCode < 193) || // ;=,-./` (in order)\n            (keyCode > 218 && keyCode < 223));   // [\\]' (in order)\n    };\n\n    proto.measureTextLine = function(text, markup, editor) {\n\n        text = text.replace(new RegExp(' ', 'g'), SPACE);\n        text = text.length === 0 ? markup.initialText : text;\n        return measureTextLines([text + '|'], this.style, editor)[0];\n\n    };\n\n    proto.handleKeyDown = function (e) {\n        var textInputHelper = this.textInputHelper;\n        \n        if (e.keyCode === Autodesk.Viewing.KeyCode.ENTER) {\n            return;\n        }\n\n        var markup = textInputHelper.textMarkup;\n        var text = textInputHelper.textArea.value;\n\n        if (e.keyCode === Autodesk.Viewing.KeyCode.BACKSPACE) {\n            text = text.substring(0, text.length-1);\n        }\n\n        if (text.length < MAX_LETTERS && this.isVisibleChar(e.keyCode)) {\n            text = text + e.key;            \n        }\n\n        var size = this.measureTextLine(text, markup, this.editor);\n                \n        this.updateTextBox(markup, size);\n    };\n\n    proto.updateTextBox = function(markup, size) {\n\n        if (!this.textInputHelper) {\n            this.textInputHelper = new EditorTextInput(this.viewer.container, this.editor, true, markup.initialText, MAX_LETTERS);\n            this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE, this.onHelperTextChange.bind(this), false);\n            this.handleKeyDownBinded = this.handleKeyDown.bind(this);\n        }\n\n        markup.text.style.display = 'none';\n        \n        if (!size) {\n            size = this.measureTextLine(this.textInputHelper.textArea.value, markup, this.editor);\n        }\n\n        var transform = this.getTextAreaTransform(markup, size);\n\n        this.textInputHelper.styleTextArea.setAttribute('text-align', 'center');\n        \n        this.textInputHelper.setActive(markup, false);\n\n        \n        // Override textArea attributes\n        this.textInputHelper.textArea.style.position = 'static';\n        this.textInputHelper.textArea.style.padding = '0';\n        this.textInputHelper.textArea.style.width = size.width + 'px';\n        this.textInputHelper.textArea.style.height = size.height + 'px';\n        this.textInputHelper.textArea.style.transform = transform; // Maybe need to add 'allBrowsers' support\n\n        this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n        this.editor.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);    \n        this.textInputHelper.textArea.removeEventListener('keydown', this.handleKeyDownBinded);\n        this.textInputHelper.textArea.addEventListener('keydown', this.handleKeyDownBinded);    \n        \n    };\n\n    proto.getTextAreaTransform = function(markup, size) {\n\n        var position = markup.getClientPosition();\n        var rotation = radiansToDegrees(markup.rotation) % 360;\n\n        if (rotation > 90 && rotation <= 270 && markup.shouldFlip()) {\n            rotation = 180 + rotation;\n        }\n    \n        return [\n            'translate(', (position.x - (size.width/2)) + 'px,',(position.y - this.viewer.container.clientHeight - size.height) + 'px)',\n            'rotate(', rotation + 'deg)',\n            'translate(0px,', size.height +'px)'\n        ].join(' ');\n    };\n\n    proto.onMouseDoubleClick = function(markup) {\n\n        if (markup === this.selectedMarkup) {\n            this.editor.selectMarkup(null);\n            this.updateTextBox(markup);\n        }\n    };\n\n    proto.onHelperTextChange = function(event) {\n\n        var dataBag = event.data;\n        var markup = dataBag.markup;\n        var textStyle = dataBag.style;\n        var editor = this.editor;\n\n        markup.text.style.display = 'block';\n\n        if (dataBag.newText === '') {\n            dataBag.newText = markup.initialText;\n        }\n\n        // When the text is created for the first time, an action group\n        // is already created and it includes the CreateText action.\n        // Thus, no need to begin another action group.\n        if (!dataBag.firstEdit) {\n            editor.beginActionGroup();\n        }\n\n        var setStyle = new SetStyle(editor, markup, textStyle);\n        setStyle.execute();\n\n        var setDimension = new SetDimension(editor, markup, markup.firstAnchor, markup.secondAnchor, dataBag.newText);\n        setDimension.execute();\n\n        editor.closeActionGroup();\n        editor.selectMarkup(null);\n    };\n\n    /**\n     * We want to make sure that the Input Helper gets removed from the screen\n     * whenever the user attempts to perform an undo or redo action.\n     * @param {Event} event\n     * @private\n     */\n    proto.onHistoryChange = function(event) {\n        if (this.isTextInputHelperActive()) {\n            this.textInputHelper.textMarkup.text.style.display = 'block';\n            this.editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            this.textInputHelper.setInactive();\n        }\n    };\n\n    /**\n     * Notify the markup that the displayed markups are being saved so edit mode can finish current editions.\n     */\n    proto.onSave = function() {\n\n        EditMode.prototype.onSave.call(this);\n\n        // Close input helper if it's open.\n        if (this.isTextInputHelperActive()) {\n            var editor = this.editor;\n            editor.actionManager.removeEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onHistoryChangeBinded);\n            var markup = this.textInputHelper.textMarkup;\n            this.textInputHelper.acceptAndExit();\n            markup.text.style.display = 'block';\n        }\n    };\n\n    proto.useWithSnapping = function () {\n        return true;\n    };\n\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, createMarkupTextSvg, composeRGBAString, addMarkupMetadata,\n    radiansToDegrees, degreesToRadians, measureTextLines, setMarkupTextSvgTransform,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, createSvgElement, checkLineSegment,\n    updateMarkupTextSvgBackground, updateMarkupTextSvgClipper, updateMarkupTextSvgHitarea \n} from './MarkupsCoreUtils'\nimport { cloneStyle } from './StyleUtils'\nimport { EditModeDimension } from './edit-modes/EditModeDimension'\n\n    var DIMENSION_MARKUP_HEIGHT = 10;\n    var TEXT_OFFSET = 2;\n    var DEFAULT_TEXT = 'Add Length';\n    var BACKGROUND_COLOR = 'none';//'#ffffff';\n\n    /**\n     *\n     * @param id\n     * @param editor\n     * @constructor\n     */\n    export function MarkupDimension(id, editor) {\n\n        var styleAttributes = ['stroke-width', 'stroke-color', 'stroke-opacity', 'font-size', 'font-family', 'font-style', 'font-weight'];\n        Markup.call(this, id, editor, styleAttributes);\n\n        this.type = MarkupTypes.MARKUP_TYPE_DIMENSION;\n        this.constraintHeight = true;\n        this.constraintWidth = true;\n\n        // bind to this to pass this.globalManager\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n        this.createSvgElement = createSvgElement.bind(this);\n        this.checkLineSegment = checkLineSegment.bind(this);\n        this.measureTextLines = measureTextLines.bind(this);\n\n        \n        this.firstAnchor = new THREE.Vector3();\n        this.secondAnchor = new THREE.Vector3();\n        this.shape = createMarkupPathSvg();\n        this.text = createMarkupTextSvg();\n        this.shape.appendChild(this.text);\n        this.textSize = {x: 0, y: 0};\n        this.initialText = DEFAULT_TEXT;\n        this.currentText = ' ';\n\n        if (!this.viewer.model.is2d()) {\n            this.preventReposition = true;\n            this.constraintRotation = true;\n        }\n\n        this.bindDomEvents();\n    }\n\n    MarkupDimension.prototype = Object.create(Markup.prototype);\n    MarkupDimension.prototype.constructor = MarkupDimension;\n\n    var proto = MarkupDimension.prototype;\n\n    proto.getEditMode = function() {\n\n        return new EditModeDimension(this.editor);\n    };\n\n    /**\n     * Sets top-left and bottom-right values in client space coordinates (2d).\n     * Notice that for the Dimension, the top left is the \"secondAnchor\" of the Dimension and\n     * the bottom right is the \"firstAnchor\" of it.\n     *\n     * @param {Number} xO - secondAnchor\n     * @param {Number} yO - secondAnchor\n     * @param {Number} xF - firstAnchor\n     * @param {Number} yF - firstAnchor\n     */\n    proto.set = function(xO, yO, xF, yF, text) {\n\n        var vO = new THREE.Vector2(xO, yO);\n        var vF = new THREE.Vector2(xF, yF);\n        var vDir = vF.clone().sub(vO).normalize();\n\n        this.size.x = vO.distanceTo(vF); // TODO: Clamp min length\n        this.rotation = Math.acos(vDir.dot(new THREE.Vector2(1,0)));\n        this.rotation = yF > yO ? (Math.PI*2)-this.rotation : this.rotation;\n\n        var firstAnchor = this.firstAnchor;\n        var secondAnchor = this.secondAnchor;\n\n        firstAnchor.set(xF, yF, 0);\n        secondAnchor.set(xO, yO, 0);\n\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\n\n        this.currentText = text;\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the rotation of the markup to the given angle.\n     * This gets called by the Autodesk.Viewing.Extensions.Markups.Core.SetRotation edit action\n     *\n     * @param {Number} angle\n     */\n    proto.setRotation = function(angle) {\n\n        if (radiansToDegrees(angle) === 90) {\n            angle = degreesToRadians(-90);\n        }\n\n        this.rotation = angle;\n\n        var xF = Math.cos(-angle);\n        var yF = Math.sin(-angle);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(this.size.x*0.5);\n\n        var vCenter = new THREE.Vector2(this.position.x, this.position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.firstAnchor.set(vF.x, vF.y, 0);\n        this.secondAnchor.set(vO.x, vO.y, 0);\n\n        this.updateStyle();\n    };\n\n    /**\n     * Changes the position and size of the markup.\n     * This gets called by the namespace.SetSize edit action\n     * @param {{x: Number, y: Number}} position - Dimension's center\n     * @param {Number} width - Dimension's length\n     * @param {Number} height - We ignore this one because we use the Dimension's stroke width instead\n     */\n    proto.setSize = function(position, width, height) {\n\n        var xF = Math.cos(-this.rotation);\n        var yF = Math.sin(-this.rotation);\n        var vFDir = new THREE.Vector2(xF, yF); // already normalized\n        vFDir.multiplyScalar(width*0.5);\n\n        var vCenter = new THREE.Vector2(position.x, position.y);\n        var vO = vCenter.clone().sub(vFDir);\n        var vF = vCenter.clone().add(vFDir);\n\n        this.firstAnchor.set(vF.x, vF.y, 0);\n        this.secondAnchor.set(vO.x, vO.y, 0);\n\n        this.position.x = position.x;\n        this.position.y = position.y;\n        this.size.x = width;\n\n        this.updateStyle();\n    };\n\n    /**\n     * Helper method that returns the font size in client space coords.\n     * @returns {Number}\n     */\n    proto.getClientFontSize = function() {\n\n        return this.editor.sizeFromMarkupsToClient(0, this.style['font-size']).y;\n    };\n\n    proto.updateStyle = function() {\n\n        var style = this.style;\n        var shape = this.shape;\n        var strokeWidth = style['stroke-width'];\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var transform = this.getTransform();\n\n        this.rebuildTextSvg(this.currentText);\n\n        setAttributeToMarkupSvg(shape, 'd', this.getPath().join(' '));\n        setAttributeToMarkupSvg(shape, 'stroke-width', strokeWidth / 2);\n        setAttributeToMarkupSvg(shape, 'stroke', strokeColor);\n        setAttributeToMarkupSvg(shape, 'fill', strokeColor);\n        setAttributeToMarkupSvg(shape, 'transform', transform);\n        updateMarkupPathSvgHitarea(shape, this.editor);\n    };\n\n    proto.rebuildTextSvg = function(value) {\n        var style = this.style;\n        var strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(style['stroke-color'], style['stroke-opacity']);\n        var strokeWidth = style['stroke-width'];\n        var backgroundColor = (value === ' ') ? 'none' : BACKGROUND_COLOR;\n\n        var markup = this.createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n        markup.setAttribute('alignment-baseline', 'middle');\n\n        var text = this.text;\n        var editor = this.editor;\n\n        text.childNodes[0].removeChild(text.markup);\n        text.childNodes[0].appendChild(markup);\n        text.markup = markup;\n\n        var tspan = this.createSvgElement('tspan');\n        tspan.textContent = value;\n        markup.appendChild(tspan);\n\n        var lineSize = this.measureTextLines([value], style, editor)[0]; // Only one line for measurement\n        var textSize = this.textSize = editor.sizeFromClientToMarkups(lineSize.width, lineSize.height);\n        \n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2;\n        var textOffset = TEXT_OFFSET * strokeWidth / 2;\n        var offset = (textSize.x + (2 * strokeWidth) >= this.size.x) ? textOffset + edgeH / 2 : textOffset; // If the line is too short for the given text, put it under.\n\n        this.size.y = edgeH + textSize.y + offset;\n\n        var textTransform = this.getTextTransform((4/5 * textSize.y) +  offset, true); // Text height is Always 4/5 of the entire label height.\n        var backgroundTransform = this.getTextTransform(textSize.y + offset, false);\n\n        setAttributeToMarkupSvg(text, 'font-family', style['font-family']);\n        setAttributeToMarkupSvg(text, 'font-size', style['font-size']);\n        setAttributeToMarkupSvg(text, 'font-weight', style['font-weight']);\n        setAttributeToMarkupSvg(text, 'font-style', style['font-style']);\n        setAttributeToMarkupSvg(text, 'text-rendering', 'auto');\n        setAttributeToMarkupSvg(text, 'fill', strokeColor);\n        setMarkupTextSvgTransform(text, backgroundTransform, textTransform); \n        updateMarkupTextSvgBackground(text, textSize.x, textSize.y, backgroundColor);\n        updateMarkupTextSvgClipper(text, textSize.x, textSize.y);\n        updateMarkupTextSvgHitarea(text, textSize.x, textSize.y, editor);\n    };\n\n    proto.shouldFlip = function(){\n        return (this.firstAnchor.x < this.secondAnchor.x);\n    };\n\n    proto.getTextTransform = function(offset, inverse) {\n\n        var flip = this.shouldFlip() ? -1 : 1;\n\n        inverse = inverse ? -1 : 1;\n\n        if (radiansToDegrees(this.rotation) === 90) {\n            this.rotation = degreesToRadians(-90);\n        }\n\n        return [\n            'translate(', this.position.x , ',', this.position.y, ')',\n            'rotate(', radiansToDegrees(-this.rotation), ')',\n            'translate(', -flip * this.textSize.x / 2, ',', -flip*offset, ')',\n            'scale(' + flip + ',' + flip*inverse + ')'\n        ].join(' ');\n    };\n\n    /**\n     * Used by the EditFrame to move the markup in Client Space coordinates\n     * @param {Number} x - New X location for the markup. Notice that markups are centered on this value.\n     * @param {Number} y - New Y location for the markup. Notice that markups are centered on this value.\n     */\n    proto.setPosition = function (x, y) {\n\n        var firstAnchor = this.firstAnchor;\n        var secondAnchor = this.secondAnchor;\n\n        var dx = firstAnchor.x - secondAnchor.x;\n        var dy = firstAnchor.y - secondAnchor.y;\n\n        var xo = x + dx * 0.5;\n        var yo = y + dy * 0.5;\n\n        firstAnchor.x = xo;\n        firstAnchor.y = yo;\n\n        secondAnchor.x = xo - dx;\n        secondAnchor.y = yo - dy;\n\n        this.position.x = secondAnchor.x + (firstAnchor.x - secondAnchor.x) * 0.5;\n        this.position.y = secondAnchor.y + (firstAnchor.y - secondAnchor.y) * 0.5;\n\n        this.updateStyle();\n    };\n\n    proto.generatePoint3d = function(idTarget) {\n\n        var firstAnchor = this.editor.positionFromMarkupsToClient(this.firstAnchor.x, this.firstAnchor.y);\n        var secondAnchor = this.editor.positionFromMarkupsToClient(this.secondAnchor.x, this.secondAnchor.y);\n\n        var direction = firstAnchor.clone().sub(secondAnchor).normalize();\n\n        var point2d = this.checkLineSegment(firstAnchor.x, firstAnchor.y, firstAnchor.x + direction.x * 200, firstAnchor.y + direction.y * 200, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n\n        return point3d && point3d.point;\n    };\n\n    proto.setMetadata = function() {\n\n        this.text.setAttribute('pointer-events', 'none');\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.firstAnchor = [this.firstAnchor.x, this.firstAnchor.y].join(\" \");\n        metadata.secondAnchor = [this.secondAnchor.x, this.secondAnchor.y].join(\" \");\n        metadata.text = String(this.currentText);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    };\n\n\n    /**\n     * Returns the raw string value\n     * @returns {String}\n     */\n    proto.getText = function() {\n\n        // if the current text is 'Add Length', you want the textbox will be empty when the user open it.\n        return (this.currentText === this.initialText) ? '' : this.currentText;\n    };\n\n    proto.getPath = function() {\n\n        //   1_                            _4\n        //   | |                          | |\n        //   | |2                        3| |\n        //  0|  --------------------------  |\n        //   |  --------------------------  |\n        //   | |7                       6 | |\n        //   |_|          TEXT            |_|\n        //   8                             5\n        \n        var strokeWidth = this.style['stroke-width'];\n        var segmentLength = this.size.x - strokeWidth / 2; // segment length (p2 to p3 length)\n        var edgeH = DIMENSION_MARKUP_HEIGHT * strokeWidth / 2; // Edge height (p1 to p8 length)\n\n        return [\n            'M', -segmentLength * 0.5           ,    0              ,   // 0\n            'l', 0                              ,    edgeH / 2      ,   // 1\n            'l', 0                              ,    -edgeH / 2     ,   // 2\n            'l', segmentLength                  ,    0              ,   // 3\n            'l', 0                              ,    edgeH / 2      ,   // 4\n            'l', 0                              ,    -edgeH         ,   // 5\n            'l', 0                              ,    edgeH / 2      ,   // 6\n            'l', -segmentLength                 ,    0              ,   // 7\n            'l', 0                              ,    -edgeH / 2     ,   // 8\n            'z'\n        ];\n    };\n\n    proto.cloneShape = function(clone) {\n        \n        clone.shape = createMarkupPathSvg();\n        clone.text = createMarkupTextSvg();\n        clone.shape.appendChild(clone.text);\n        clone.bindDomEvents();\n    };\n\n    proto.getBoundingRect = function() {\n        var pos = this.getClientPosition();\n        var size = this.getClientSize();\n        return {\n            x: pos.x - size.x / 2,\n            y: pos.y - size.y / 2,\n            width: size.x,\n            height: size.y\n        }\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupDimension } from '../MarkupDimension'\nimport { cloneStyle } from '../StyleUtils'\n\n    /**\n     * @constructor\n     */\n    export function CreateDimension(editor, id, firstAnchor, secondAnchor, text, style) {\n\n        EditAction.call(this, editor, 'CREATE-DIMENSION', id);\n\n        this.selectOnExecution = false;\n        this.secondAnchor = secondAnchor;\n        this.firstAnchor = firstAnchor;\n        this.text = text;\n        this.style = cloneStyle(style);\n    }\n\n    CreateDimension.prototype = Object.create(EditAction.prototype);\n    CreateDimension.prototype.constructor = CreateDimension;\n\n    var proto = CreateDimension.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var dimension = new MarkupDimension(this.targetId, editor);\n\n        editor.addMarkup(dimension);\n\n        // Don't display the dimension markup when there is only one Anchor (First click, before mouse move).\n        if (this.secondAnchor) {\n            dimension.set(this.firstAnchor.x, this.firstAnchor.y, this.secondAnchor.x, this.secondAnchor.y, this.text);\n            dimension.setStyle(this.style);\n        }        \n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { CreateStamp } from './CreateStamp'\n\nexport { DeleteStamp }\n\nclass DeleteStamp extends EditAction {\n     constructor(editor, stamp) { \n        super(editor, 'DELETE-STAMP', stamp.id);\n\n        this.createStamp = new CreateStamp(\n            editor,\n            stamp.id,\n            stamp.position,\n            stamp.size,\n            stamp.rotation,\n            stamp.getStyle()\n        );\n    }\n\n    redo() {\n        this.createStamp.undo();\n    }\n\n    undo() {\n        this.createStamp.redo();\n    }\n}","'use strict';\n\nimport { EditAction } from './EditAction'\n\nexport { SetStamp }\n\nclass SetStamp extends EditAction {\n    constructor(editor, stamp, position, size) {\n        super(editor, 'SET-STAMP', stamp.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.newSize = {x: size.x, y: size.y};\n        this.oldPosition = {x: stamp.position.x, y: stamp.position.y};\n        this.oldSize = {x: stamp.size.x, y: stamp.size.y};\n    }\n\n    redo() {\n        this.applyState(this.targetId, this.newPosition, this.newSize);\n    }\n\n    undo() {\n        this.applyState(this.targetId, this.oldPosition, this.oldSize);\n    }\n\n    merge(action) {\n        if (this.targetId === action.targetId && this.type === action.type) {\n            this.newPosition = action.newPosition;\n            this.newSize = action.newSize;\n            return true;\n        }\n        \n        return false;\n    }\n\n    applyState(targetId, position, size) {\n        const stamp = this.editor.getMarkup(targetId);\n        if (!stamp) {\n            return;\n        }\n\n        // Different stroke widths make positions differ at sub-pixel level.\n        const epsilon = 0.0001;\n        if (\n            Math.abs(stamp.position.x - position.x) > epsilon\n            || Math.abs(stamp.position.y - position.y) > epsilon\n            || Math.abs(stamp.size.x - size.x) > epsilon\n            || Math.abs(stamp.size.y - size.y) > epsilon\n        ) {\n            stamp.set(position, size);\n        }\n    }\n\n    isIdentity() {\n        return (\n            this.newPosition.x === this.oldPosition.x\n            && this.newPosition.y === this.oldPosition.y\n            && this.newSize.x === this.oldSize.x\n            && this.newSize.y === this.newSize.y\n        )\n    }\n}","'use strict';\n\nimport { EditMode } from './EditMode'\nimport { DeleteStamp } from '../edit-actions/DeleteStamp'\nimport { CreateStamp } from '../edit-actions/CreateStamp'\nimport { SetStamp } from '../edit-actions/SetStamp'\nimport * as MarkupTypes from '../MarkupTypes'\n\nexport { EditModeStamp };\n\nclass EditModeStamp extends EditMode {\n    constructor(editor, svgData) {\n        var styleAttributes = [\n            'text-data'\n        ];\n        super(editor, MarkupTypes.MARKUP_TYPE_STAMP, styleAttributes);\n        this.svgData = svgData;\n    }\n\n    deleteMarkup(markup, cantUndo) {\n        markup = markup || this.selectedMarkup;\n        if (markup && markup.type == this.type) {\n            var deleteStamp = new DeleteStamp(this.editor, markup);\n            deleteStamp.addToHistory = !cantUndo;\n            deleteStamp.execute();\n            return true;\n        }\n        return false;\n    }\n\n    onMouseMove(event) {\n        if (!EditMode.prototype.onMouseMove.call( this, event )) {\n            return false;\n        }\n\n        const { selectedMarkup, editor } = this; \n\n        let final = this.getFinalMouseDraggingPosition();\n        final = editor.clientToMarkups(final.x, final.y);\n        let position = {\n            x: (this.firstPosition.x + final.x) / 2,\n            y: (this.firstPosition.y + final.y) / 2\n        };\n        let size = this.size = {\n            x: Math.abs(final.x - this.firstPosition.x),\n            y: Math.abs(final.y - this.firstPosition.y)\n        };\n\n        const action = new SetStamp(editor, selectedMarkup, position, size);\n        action.execute();\n        return true;\n    }\n\n    onMouseDown() {\n        EditMode.prototype.onMouseDown.call(this);\n\n        if (this.selectedMarkup) {\n            return;\n        }\n\n        const editor = this.editor;\n        let mousePosition = editor.getMousePosition();\n\n        this.initialX = mousePosition.x;\n        this.initialY = mousePosition.y;\n        this.firstPosition = editor.clientToMarkups(this.initialX, this.initialY);\n        this.size = editor.sizeFromClientToMarkups(1, 1);\n\n        editor.beginActionGroup();\n        const markupId = editor.getId();\n        const action = new CreateStamp(editor, markupId, this.firstPosition, this.size, 0, this.style, this.svgData);\n        action.execute();\n        \n        // maybe this isn't being called right, that would explain it\n        this.selectedMarkup = editor.getMarkup(markupId);\n        this.creationBegin();\n    }\n}\n","'use strict';\n\nimport { Markup } from './Markup'\nimport * as MarkupTypes from './MarkupTypes'\nimport { createMarkupPathSvg, composeRGBAString,\n    setAttributeToMarkupSvg, updateMarkupPathSvgHitarea, addMarkupMetadata,\n    stringToSvgNode, \n    createSvgElement} from './MarkupsCoreUtils'\nimport { cloneStyle, copyStyle, isStyleEqual } from './StyleUtils'\nimport { EditModeStamp } from './edit-modes/EditModeStamp';\n\nexport { MarkupStamp };\n\nclass MarkupStamp extends Markup {\n    /** \n     * @param {number} id \n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore} editor \n     */\n    constructor(id, editor, svgData) {\n        const styleAttributes = [\n            'text-data'\n        ];\n        super(id, editor, styleAttributes);\n        this.type = MarkupTypes.MARKUP_TYPE_STAMP;\n        this.addMarkupMetadata = addMarkupMetadata.bind(this);\n    \n        this.createShapeGroup();\n\n        this.scriptSvgData = svgData;\n        this.loadSvgData();\n    \n        this.bindDomEvents();\n    }\n\n    createShapeGroup() {\n        /* \n        * shape\n        *    group\n        *      customSvg\n        *    hitarea (aka markup)\n        */\n        this.shape = createSvgElement('g');\n        this.shape.group = createSvgElement('g');\n        this.shape.appendChild(this.shape.group);\n        \n        let hitarea = createSvgElement('path');\n        hitarea.setAttribute('id', \"hitarea\");\n        hitarea.setAttribute('fill', \"none\");\n        this.shape.appendChild(hitarea);\n\n        this.shape.hitarea = hitarea;\n        this.shape.markup = hitarea;\n    }\n\n    loadSvgData() {\n        let svgString = this.scriptSvgData || this.style['text-data'];\n        let svgNode = stringToSvgNode(svgString);\n\n        // null if parsing fails, so exit\n        if (svgNode === null) {\n            console.warn(\"SVG data \" + svgString + \" is invalid, skipping shape update\");\n            return;\n        }\n\n        let [width, height] = this.getDimensions(svgNode);\n\n        // update the bounding box when the SVG is changed\n        let path = `M 0 0 l ${width} 0 l 0 ${height} l ${-width} 0 z`;\n        this.shape.hitarea.setAttribute('d', path);\n\n        this.shape.group.innerHTML = svgNode.innerHTML;\n\n        // This is to standardize things:\n        // width and height are 1 unit\n        // position is in the centre\n        // have to flip things because of y axis going upwards\n        this.shape.group.setAttribute('transform', `translate( -0.5 , 0.5 ) scale( ${1/width} , ${-1/height} )`)\n        // then copy to the hitarea because it's outside the SVG\n        this.shape.hitarea.setAttribute('transform', this.shape.group.getAttribute('transform'));\n    }\n\n    getEditMode() {\n        return new EditModeStamp(this.editor);\n    }\n\n    set(position, size) {\n        this.setSize(position, size.x, size.y);\n        this.updateStyle();\n    }\n\n    updateStyle(styleChanged) {\n        const strokeColor = this.highlighted ? this.highlightColor : composeRGBAString(this.style['stroke-color'], this.style['stroke-opacity']);\n        this.shape.hitarea.setAttribute('stroke', strokeColor);\n\n        // This only provides translation and rotation, not scale\n        const transform = this.getTransform() + ` scale( ${this.size.x} , ${this.size.y} )`;\n        this.shape.setAttribute('transform', transform);\n\n        if (styleChanged) {\n            this.loadSvgData();\n        }\n    }\n\n    getDimensions(customSvg) {\n        let vb = customSvg.getAttribute('viewBox');\n        if (!vb) {\n            // if no viewbox is specified, check for width and height\n            let width = customSvg.getAttribute('width') || 100;\n            let height = customSvg.getAttribute('height') || 100;\n            return [width, height]\n        }\n        let strings = vb.split(' ')\n        let width = parseInt(strings[2]);\n        let height = parseInt(strings[3]);\n\n        return [width, height];\n    }\n\n    setMetadata() {\n\n        var metadata = cloneStyle(this.style);\n\n        metadata.type = this.type;\n        metadata.position = [this.position.x, this.position.y].join(\" \");\n        metadata.size = [this.size.x, this.size.y].join(\" \");\n        metadata.rotation = String(this.rotation);\n\n        return this.addMarkupMetadata(this.shape, metadata);\n    }\n\n    setStyle(style) {\n        let stylesEqual = isStyleEqual(style, this.style);\n        if (!stylesEqual) {\n            copyStyle(style, this.style);\n        }\n\n        this.updateStyle(!stylesEqual);\n    }\n}\n","'use strict';\n\nimport { EditAction } from './EditAction'\nimport { MarkupStamp } from '../MarkupStamp'\nimport { cloneStyle } from '../StyleUtils'\n\nexport { CreateStamp }\n\n    /**\n     * @constructor\n     * \n     * @param editor \n     * @param id \n     * @param position \n     * @param size \n     * @param style \n     * @param {string} svg\n     */\n\nclass CreateStamp extends EditAction {\n    constructor(editor, id, position, size, rotation, style, svgData) {\n        super(editor, 'CREATE-STAMP', id);\n    \n        this.selectOnExecution = false;\n        this.position = {x: position.x, y: position.y};\n        this.size = {x: size.x, y: size.y};\n        this.rotation = rotation;\n        this.style = cloneStyle(style);\n        this.svgData = svgData;\n    }\n\n    redo() {\n        const stamp = new MarkupStamp(this.targetId, this.editor, this.svgData);\n    \n        this.editor.addMarkup(stamp);\n    \n        stamp.setSize(this.position, this.size.x, this.size.y);\n        stamp.setRotation(this.rotation);\n        stamp.setStyle(this.style);\n    }\n    \n    undo() {\n        const markup = this.editor.getMarkup(this.targetId);\n        this.editor.removeMarkup(markup);\n    }\n}\n\n","import * as MarkupType from '../core/MarkupTypes'\nimport { CreateArrow } from './edit-actions/CreateArrow'\nimport { CreateRectangle } from './edit-actions/CreateRectangle'\nimport { CreateText } from './edit-actions/CreateText'\nimport { CreateCallout } from './edit-actions/CreateCallout'\nimport { CreateCircle } from './edit-actions/CreateCircle'\nimport { CreateCloud } from './edit-actions/CreateCloud'\nimport { CreateFreehand } from './edit-actions/CreateFreehand'\nimport { CreatePolyline } from './edit-actions/CreatePolyline'\nimport { CreatePolycloud } from './edit-actions/CreatePolycloud'\nimport { CreateHighlight } from './edit-actions/CreateHighlight'\nimport { CreateDimension } from './edit-actions/CreateDimension'\nimport { DomElementStyle } from './DomElementStyle'\nimport { CreateStamp } from './edit-actions/CreateStamp';\n\n\n    var av = Autodesk.Viewing;\n    var avp = Autodesk.Viewing.Private;\n\n    const _gWindow = av.getGlobal();\n    const _gDocument = _gWindow.document;\n\n    // Change these constants to alter the default sizes in pixels of strokes and fonts.\n    export var MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS = 1;\n    export var MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS = 10;\n    export var MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS = 15;\n    export var EDIT_FRAME_DEFAULT_MARGIN = 7;\n\n    /**\n     * // isTouchDevice is an LMV function. Hammer is included by LMV as well\n     * @returns {boolean}\n     */\n    export var isTouchDevice = function() {\n        // isTouchDevice() is an LMV function.\n        // Hammer (a touch detection lib) is packaged with LMV as well\n        if (av.isTouchDevice && typeof Hammer === \"function\") {\n            return av.isTouchDevice();\n        }\n        return false;\n    };\n\n    //// SVG  //////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param type\n     * @returns {Element}\n     */\n    export var createSvgElement = function(type) {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS\n        var namespace = 'http://www.w3.org/2000/svg';\n        return  _document.createElementNS(namespace, type);\n    };\n\n    /**\n     *\n     * @param {Element} svg - an SVGElement\n     * @returns {Element} svg param is returned back\n     */\n    export var setSvgParentAttributes = function(svg) {\n\n        // See: https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course\n        svg.setAttribute('version', '1.1'); // Notice that this is the SVG version, not the \"MARKUP DATA VERSION\"!\n        svg.setAttribute('baseProfile', 'full');\n        svg.setAttribute('layer-order-id', 'markups-svg');\n        return svg;\n    };\n\n    export var createMarkupGroupSvg = function(children) {\n        children = children || [];\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'default');\n        svg.setAttribute('pointer-events', 'none');\n\n        for (var i = 0; i < children.length; i++) {\n            svg.appendChild(children[i]);\n        }\n\n        return svg;\n    };\n\n    export var createMarkupPathSvg = function() {\n\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'inherit');\n        svg.setAttribute('pointer-events', 'none');\n\n        var markup = createSvgElement('path');\n        markup.setAttribute('id', 'markup');\n\n        var hitarea = createSvgElement('path');\n        hitarea.setAttribute('id', 'hitarea');\n        hitarea.setAttribute('fill', 'transparent');\n        hitarea.setAttribute('stroke', 'transparent');\n\n        svg.markup = markup;\n        svg.hitarea = hitarea;\n\n        svg.appendChild(markup);\n        svg.appendChild(hitarea);\n\n        return svg;\n    };\n\n    export var setAttributeToMarkupSvg = function(svg, attribute, value) {\n\n        svg.markup.setAttribute(attribute, value);\n    };\n\n    export var updateMarkupPathSvgHitarea = function(svg, editor) {\n\n        var markup = svg.markup;\n        var hitarea = svg.hitarea;\n\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\n        hitareaMargin += parseFloat(markup.getAttribute('stroke-width')) + hitareaMargin;\n\n        var markupFill = markup.getAttribute('fill');\n        var markupStroke = markup.getAttribute('stroke');\n        var strokeEnabled = markupStroke !== '' && markupStroke !== 'none';\n        var fillEnabled = markupFill !== '' && markupFill !== 'none';\n\n        hitarea.setAttribute('d', markup.getAttribute('d'));\n        hitarea.setAttribute('stroke-width', hitareaMargin);\n        hitarea.setAttribute('transform', markup.getAttribute('transform'));\n\n        if (editor.duringEditMode && !editor.navigating) {\n            if (strokeEnabled && fillEnabled) {\n                svg.setAttribute('pointer-events', 'painted');\n                return;\n            }\n\n            if (strokeEnabled) {\n                svg.setAttribute('pointer-events', 'stroke');\n                return;\n            }\n\n            if (fillEnabled) {\n                svg.setAttribute('pointer-events', 'fill');\n                return;\n            }\n        }\n\n        svg.setAttribute('pointer-events', 'none');\n    };\n    \n    export var createMarkupTextSvg = function() {\n\n        var svg = createSvgElement('g');\n        svg.setAttribute('cursor', 'default');\n\n        var clipperId = 'markup-clipper-' + getUniqueID();\n        var clipperUrl = 'url(#' + clipperId + ')';\n\n        var clipper = createSvgElement('clipPath');\n        clipper.setAttribute('id', clipperId);\n        clipper.removeAttribute('pointer-events');\n        clipper.rect = createSvgElement('rect');\n        clipper.appendChild(clipper.rect);\n\n        var background = createSvgElement('rect');\n        background.setAttribute('id', 'markup-background');\n        background.removeAttribute('pointer-events');\n\n        var markup = createSvgElement('text');\n        markup.setAttribute('id', 'markup');\n\n        var hitarea = createSvgElement('rect');\n        hitarea.setAttribute('id', 'hitarea');\n        hitarea.setAttribute('fill', 'transparent');\n        hitarea.setAttribute('stroke', 'none');\n        hitarea.setAttribute('stroke-width', '0');\n\n        var clippedArea = createSvgElement('g');\n        clippedArea.setAttribute('clip-path', clipperUrl);\n        clippedArea.appendChild(clipper);\n        clippedArea.appendChild(background);\n        clippedArea.appendChild(markup);\n\n        svg.appendChild(clippedArea);\n        svg.appendChild(hitarea);\n\n        svg.clipper = clipper;\n        svg.background = background;\n        svg.markup = markup;\n        svg.hitarea = hitarea;\n\n        return svg;\n    };\n\n    export var setMarkupTextSvgTransform = function(svg, transform, textTransform) {\n\n        svg.clipper.rect.setAttribute('transform', transform);\n        svg.background.setAttribute('transform', transform);\n        svg.markup.setAttribute('transform', textTransform);\n        svg.hitarea.setAttribute('transform', transform);\n    };\n\n    export var updateMarkupTextSvgHitarea = function(svg, w, h, editor) {\n\n        var hitarea = svg.hitarea;\n        var hitareaMargin = editor.sizeFromClientToMarkups(0, MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;\n\n        hitarea.setAttribute('x', -hitareaMargin);\n        hitarea.setAttribute('y', -hitareaMargin);\n        hitarea.setAttribute('width', w + hitareaMargin * 2);\n        hitarea.setAttribute('height', h + hitareaMargin * 2);\n        svg.setAttribute(\"pointer-events\", editor.navigating ? \"none\" : \"painted\");\n    };\n\n    export var updateMarkupTextSvgBackground = function(svg, w, h, color) {\n\n        var background = svg.background;\n\n        background.setAttribute('x', 0);\n        background.setAttribute('y', 0);\n        background.setAttribute('width', w);\n        background.setAttribute('height', h);\n        background.setAttribute('fill', color);\n    };\n\n    export var updateMarkupTextSvgClipper = function(svg, w, h) {\n\n        var clipper = svg.clipper;\n\n        clipper.rect.setAttribute('x', 0);\n        clipper.rect.setAttribute('y', 0);\n        clipper.rect.setAttribute('width', w);\n        clipper.rect.setAttribute('height', h);\n    };\n\n    /**\n     * Helper function that injects metadata for the whole Markup document.\n     * Metadata includes: version.\n     * @param {Element} svg - an SVGElement\n     * @param {Object} metadata - Dictionary with attributes\n     */\n    export var addSvgMetadata = function(svg ,metadata) {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\n        var dataVersionNode = _document.createElement('markup_document');\n\n        metadataNode.appendChild(dataVersionNode);\n\n        // NOTE: We could iterate over the properties, but we don't because these are the only ones supported\n        dataVersionNode.setAttribute(\"data-model-version\", metadata[\"data-model-version\"]); // Version. For example: \"1\"\n\n        svg.insertBefore(metadataNode, svg.firstChild);\n        return metadataNode;\n    };\n\n    /**\n     * Helper function that injects metadata for specific markup svg nodes.\n     * @param {Element} markupNode - an SVGElement for the markup\n     * @param {Object} metadata - Dictionary where all key/value pairs are added as metadata entries.\n     * @returns {Element}\n     */\n    export var addMarkupMetadata = function(markupNode, metadata) {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n\n        var metadataNode = _document.createElementNS('http://www.w3.org/2000/svg', 'metadata');\n        var dataVersionNode = _document.createElement('markup_element');\n\n        metadataNode.appendChild(dataVersionNode);\n        for (var key in metadata) {\n            if (metadata.hasOwnProperty(key)) {\n                dataVersionNode.setAttribute(key, metadata[key]);\n            }\n        }\n\n        markupNode.insertBefore(metadataNode, markupNode.firstChild);\n        return metadataNode;\n    };\n\n    /**\n     * Removes al metadata nodes from an Svg node structure.\n     * Method will remove all metadata nodes from children nodes as well.\n     * @param svgNode\n     */\n    export var removeAllMetadata = function(svgNode) {\n\n        if (svgNode.getElementsByTagName) {\n            var nodes = svgNode.getElementsByTagName(\"metadata\");\n            for (var i=0; i<nodes.length; ++i) {\n                var metadataNode = nodes[i];\n                metadataNode.parentNode && metadataNode.parentNode.removeChild(metadataNode);\n            }\n        }\n\n        // Transverse children nodes\n        var svgChildren = svgNode.children || svgNode.childNodes;\n        if (svgChildren) {\n            for (i=0; i<svgChildren.length; ++i) {\n                removeAllMetadata(svgChildren[i]);\n            }\n        }\n    };\n\n    /**\n     * Utility function that transfers children from an Html/Svg node into another one.\n     * @param nodeFrom - The node instance from where children will be taken.\n     * @param nodeInto - The node that's going to parent the transferred children.\n     */\n    export var transferChildNodes = function(nodeFrom, nodeInto) {\n\n        var svgChildren = nodeFrom.children || nodeFrom.childNodes;\n        var tmpArray = [];\n        for (var i=0; i<svgChildren.length; ++i){\n            tmpArray.push(svgChildren[i]); // Avoid appendChild\n        }\n        tmpArray.forEach(function(node){\n            nodeInto.appendChild(node);\n        });\n    };\n\n    /**\n     * Generate a unique id.\n     * @returns {string}\n     */\n    export var getUniqueID = function() {\n        return THREE.Math.generateUUID();\n    };\n\n\n    /**\n     * Serializes an SVG node into a String.\n     * @param domNode\n     * @returns {string}\n     */\n    export var svgNodeToString = function(domNode){\n\n        function removeHitareas(svg, hitareas) {\n\n            var hitarea = svg.hitarea;\n            var hitareaParent = hitarea && hitarea.parentNode;\n\n            if (hitareaParent) {\n\n                hitareas.push({hitarea: hitarea, parent: hitareaParent});\n                hitareaParent.removeChild(hitarea);\n            }\n\n            var children = svg.childNodes;\n            var childrenCount = children.length;\n\n            for(var i = 0; i < childrenCount; ++i) {\n                removeHitareas(children.item(i), hitareas);\n            }\n        }\n\n        function addHitareas(hitareas) {\n\n            var hitareasCount = hitareas.length;\n            for(var i = 0; i < hitareasCount; ++i) {\n\n                var hitarea = hitareas[i];\n                hitarea.parent.appendChild(hitarea.hitarea);\n            }\n        }\n\n        var result;\n        try {\n            var hitareas = [];\n            removeHitareas(domNode, hitareas);\n\n            var xmlSerializer = new XMLSerializer();\n            result = xmlSerializer.serializeToString(domNode);\n\n            addHitareas(hitareas);\n\n        } catch (err) {\n            result = '';\n            console.warn('svgNodeToString failed to generate string representation of domNode.');\n        }\n        return result;\n    };\n\n    export var stringToSvgNode = function(stringNode){\n\n        var node = null;\n        try {\n            var domParser = new DOMParser();\n            var doc = domParser.parseFromString(stringNode, \"text/xml\");\n            node = doc.firstChild; // We should only be getting 1 child anyway.\n        } catch (err) {\n            node = null;\n            console.warn('stringToSvgNode failed to generate an HTMLElement from its string representation.');\n        }\n        return node;\n    };\n\n    /**\n     * Injects functions and members to a client object which will\n     * receive the ability to dispatch events.\n     * Mechanism is the same as in Autodesk.Viewing.Viewer.\n     *\n     * Note: All of the code here comes from Autodesk.Viewing.Viewer\n     *\n     * @param {Object} client - Object that will become an event dispatcher.\n     */\n    export var addTraitEventDispatcher = function(client) {\n\n        // Inject member variable\n        client.listeners = {};\n\n        // Inject functions\n        client.addEventListener = function(type, listener) {\n            if (typeof this.listeners[type] == \"undefined\"){\n                this.listeners[type] = [];\n            }\n            this.listeners[type].push(listener);\n        };\n        client.hasEventListener = function (type, listener) {\n            if (this.listeners === undefined) return false;\n            var listeners = this.listeners;\n            if (listeners[ type ] !== undefined && listeners[ type ].indexOf(listener) !== -1) {\n                return true;\n            }\n            return false;\n        };\n        client.removeEventListener = function(type, listener) {\n            if (this.listeners[type] instanceof Array){\n                var li = this.listeners[type];\n                for (var i=0, len=li.length; i < len; i++){\n                    if (li[i] === listener){\n                        li.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        };\n        client.dispatchEvent = function(event) {\n            if (typeof event == \"string\"){\n                event = { type: event };\n            }\n            if (!event.target){\n                event.target = this;\n            }\n\n            if (!event.type){\n                throw new Error(\"event type unknown.\");\n            }\n\n            if (this.listeners[event.type] instanceof Array) {\n                var typeListeners = this.listeners[event.type].slice();\n                for (var i=0; i < typeListeners.length; i++) {\n                    typeListeners[i].call(this, event);\n                }\n            }\n        };\n    };\n\n    /**\n     * Removes the EventDispatcher trait\n     *\n     * @param {Object} client\n     */\n    export var removeTraitEventDispatcher = function(client) {\n\n        try {\n            delete client.listeners;\n            delete client.addEventListener;\n            delete client.hasEventListener;\n            delete client.removeEventListener;\n            delete client.dispatchEvent;\n        } catch (e) {\n            // nothing\n        }\n    };\n\n    //// Math  /////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     * Calculates the pixel position in client space coordinates of a point in world space.\n     * @param {THREE.Vector3} point Point in world space coordinates.\n     * @param viewer\n     * @param snap Round values to closest pixel center.\n     * @returns {THREE.Vector3} Point transformed and projected into client space coordinates.\n     */\n    export var worldToClient = function(point, viewer, snap) {\n\n        var p = worldToViewport(point, viewer);\n        var result = viewportToClient(p.x, p.y, viewer);\n        result.z = 0;\n\n        // snap to the center of the\n        if (snap) {\n            result.x = Math.floor(result.x) + 0.5;\n            result.y = Math.floor(result.y) + 0.5;\n        }\n\n        return result;\n    };\n\n    export var clientToWorld = function(clientX, clientY, depth, viewer) {\n\n        var point = clientToViewport(clientX, clientY, viewer);\n        point.z = depth;\n\n        point.unproject(viewer.impl.camera);\n        return point;\n    };\n\n    export var clientToViewport = function(clientX, clientY, viewer) {\n\n        return viewer.impl.clientToViewport(clientX, clientY);\n    };\n\n    export var viewportToClient = function(viewportX, viewportY, viewer) {\n\n        return viewer.impl.viewportToClient(viewportX, viewportY);\n    };\n\n    /**\n     * Calculates the world position of a point in client space coordinates.\n     * @param {Object} point - { x:Number, y:Number, z:Number }\n     * @param {Object} viewer - LMV instance\n     * @returns {THREE.Vector3}\n     */\n    export var worldToViewport = function(point, viewer) {\n\n        var p = new THREE.Vector3();\n\n        p.x = point.x;\n        p.y = point.y;\n        p.z = point.z;\n\n        p.project(viewer.impl.camera);\n        return p;\n    };\n\n    export var metersToModel = function(meters, viewer) {\n\n        var modelToMeter = viewer.model.getUnitScale();\n        var meterToModel = 1 / modelToMeter;\n\n        return meterToModel * meters;\n    };\n\n    export var radiansToDegrees = function (radians) {\n\n        return radians * (180 / Math.PI);\n    };\n\n    export var degreesToRadians = function(degrees) {\n\n        return degrees * (Math.PI / 180);\n    };\n\n    /**\n     *\n     * @param value\n     * @returns {number}\n     */\n    export var sign = function (value) {\n\n        return (value >= 0) ? 1 : -1;\n    };\n\n    /**\n     *\n     * @param pointA\n     * @param pointB\n     * @param range\n     * @param editor\n     * @returns {boolean}\n     */\n    export var areMarkupsPointsInClientRange = function(pointA, pointB, range, editor){\n\n        range = editor.sizeFromClientToMarkups(0, range).y;\n\n        var dx = pointA.x - pointB.x;\n        var dy = pointA.y - pointB.y;\n\n        return range * range >= dx * dx + dy * dy;\n    };\n\n    //// LMV ui ////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    export var hideLmvUi = function(viewer) {\n\n        // If the viewer is no gui, then there is nothing to hide\n        if(!viewer.toolbar) {\n            return;\n        }\n\n        // Exit other tools and hide HudMessages.\n        viewer.setActiveNavigationTool();\n\n        dismissLmvHudMessage();\n        hideLmvPanels(true, viewer);\n        hideLmvToolsAndPanels(viewer);\n    };\n\n    export var restoreLmvUi = function(viewer) {\n\n        // If the viewer is no gui, then there is nothing to hide\n        if(!viewer.toolbar) {\n            return;\n        }\n\n        dismissLmvHudMessage();\n        hideLmvPanels(false, viewer);\n        showLmvToolsAndPanels(viewer);\n    };\n\n    /**\n     *\n     * @param hide\n     * @param viewer\n     */\n    export var hideLmvPanels = function(hide, viewer) {\n\n        var dockingPanels = viewer.dockingPanels;\n\n        // Panels may not be present when dealing with an instance of Viewer3D.js\n        // (as opposed to an instance of GuiViewer3D.js)\n        if (!dockingPanels) return;\n\n        for (var i = 0; i < dockingPanels.length; ++i) {\n\n            var panel = dockingPanels[i];\n            var panelContainer = panel.container;\n\n            if (panelContainer.classList.contains(\"dockingPanelVisible\")) {\n                panelContainer.style.display = hide ? \"none\" : \"block\";\n\n                // Call the visibility changed notification if any additional\n                // stuff needs to be done (update the date i.e. PropertyPanel, etc).\n                panel.visibilityChanged();\n            }\n        }\n    };\n\n    /**\n     * Shows panels and tools in the viewer.\n     * @param viewer\n     */\n    export var showLmvToolsAndPanels = function(viewer) {\n\n        // Restore view cube.\n        if(viewer && viewer.model && !viewer.model.is2d()) {\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\n                ext.displayViewCube(true, false);\n                ext.displayHomeButton(true);\n            }); \n        }\n\n        // TODO: Find or ask for a better way to restore this buttons.\n        const _document = viewer.getDocument();\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\n\n        if (anim.length > 0) {\n            anim[0].style.display = '';\n        }\n\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\n        if (viewer.toolbar) {\n            var viewerContainer = viewer.toolbar.container;\n            var viewerContainerChildrenCount = viewerContainer.children.length;\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\n                viewerContainer.children[i].style.display = \"\";\n            }\n        }\n    };\n\n    /**\n     * Hides panels and tools in the viewer.\n     * @param viewer\n     */\n    export var hideLmvToolsAndPanels = function(viewer) {\n\n        // Hide Panels and tools.\n        if (viewer && viewer.model && !viewer.model.is2d()) {\n            viewer.getExtension(\"Autodesk.ViewCubeUi\", function(ext) {\n                ext.displayViewCube(false, false);\n                ext.displayHomeButton(false);\n            });\n            \n        }\n\n        const _document = viewer.getDocument();\n        // TODO: Find or ask for a better way to hide this buttons.\n        var anim = _document.getElementsByClassName('toolbar-animation-subtoolbar');\n\n        if (anim.length > 0) {\n            anim[0].style.display = 'none';\n\n            var animator = viewer.impl.keyFrameAnimator;\n            if (animator && !animator.isPaused) {\n                animator.pauseCameraAnimations();\n                animator.pause();\n\n                var playButton = viewer.modelTools.getControl('toolbar-animationPlay');\n                if (playButton) {\n                    playButton.setIcon('toolbar-animation-pause-icon');\n                    playButton.setToolTip('Pause');\n                }\n            }\n        }\n\n        // toolbar is absent when dealing with an instance of Viewer3D (instead of GuiViewer3D)\n        if (viewer.toolbar) {\n            var viewerContainer = viewer.toolbar.container;\n            var viewerContainerChildrenCount = viewerContainer.children.length;\n            for(var i = 0; i < viewerContainerChildrenCount; ++i) {\n                viewerContainer.children[i].style.display = \"none\";\n            }\n        }\n    };\n\n    /**\n     * Dismisses all LMV HudMessages\n     */\n    export var dismissLmvHudMessage = function() {\n\n        // Using try/catch block since we are accessing the Private namespace of LMV.\n        try {\n            var keepDismissing = true;\n            while (keepDismissing) {\n                keepDismissing = Autodesk.Viewing.Private.HudMessage.dismiss();\n            }\n        } catch (ignore) {\n            // Failing to show the message is an okay fallback scenario\n            console.warn(\"[CO2]Failed to dismiss LMV HudMessage\");\n        }\n    };\n\n    //// Styles ////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    export var getStrokeWidth = function(widthInPixels, editor) {\n\n        var size = editor.sizeFromClientToMarkups(0, widthInPixels);\n        return size.y;\n    };\n\n    /**\n     * Creates markups from a parsed svg string child\n     * @param child - child of a parsed SVG string\n     * @param editor - MarkupsCore\n     * @returns {*} Markup Object\n     */\n    export var createMarkupFromSVG = function(child, editor) {\n        // var self = this;\n        if (!child.childNodes[0]) {\n            return null;\n        }\n\n        var meta = child.childNodes[0].childNodes[0] || '';\n\n        var getCurrentStyle = function(editor, metadata) {\n\n            var source = ['stroke-width', 'stroke-color', 'stroke-opacity', 'fill-color', 'fill-opacity',\n                'font-family', 'font-size','font-style','font-weight','stroke-linejoin'];\n            var style = {};\n            for (var i=0; i < source.length; i++) {\n                var value = metadata.getAttribute(source[i]);\n                if(value == null) {\n                    continue;\n                }\n                switch (source[i]) {\n                    case 'font-size':\n                    case 'stroke-width':\n                    case 'stroke-opacity':\n                    case 'fill-opacity':\n                        style[source[i]] = parseFloat(value);\n                        break;\n                    case 'stroke-linejoin':\n                        break;\n                    case 'font-family':\n                    case 'font-style':\n                    case 'font-weight':\n                    case 'stroke-color':\n                    case 'text-data':\n                    case 'fill-color':\n                        style[source[i]] = value;\n                        break;\n                    default:\n                        avp.logger.warn('Style not recognized.');\n                        break;\n                }\n            }\n            return style;\n        };\n\n        var isClosed = function() {\n            var path = child.childNodes[1] || '';\n            var closed = false;\n            if (typeof path !== 'string'){\n                var d = path.getAttribute('d').split(' ');\n                if (d[d.length-1].toLowerCase() === 'z'){\n                    closed = true;\n                }\n            }\n            return closed;\n        };\n\n        var getLocations = function() {\n            var locations = [];\n            var locStr = meta.getAttribute('locations').split(\" \") || '';\n\n            for(var i=0; i< locStr.length; i+=2) {\n                var pointPair = {x:parseFloat(locStr[i]), y:parseFloat(locStr[i+1])};\n                locations.push( pointPair )\n            }\n            return locations;\n        };\n\n        var getAttributeVector = function(attribute) {\n            var posVec = new THREE.Vector3();\n            var value = meta.getAttribute(attribute) || meta.getAttribute(attribute.toLowerCase());\n            var strPos = value.split(\" \");\n            posVec.x = parseFloat(strPos[0]);\n            posVec.y = parseFloat(strPos[1]);\n            return posVec;\n        };\n\n        var getPosition = function() {\n            return getAttributeVector('position');\n        };\n\n        var getSize = function() {\n            return getAttributeVector('size');\n        };\n\n        var getRotation = function() {\n            var strRot = meta.getAttribute('rotation') || '';\n            return parseFloat(strRot);\n        };\n\n        var getText = function() {\n            return meta.getAttribute('text') || '';\n        };\n\n        var getIsFrameUsed = function() {\n            return !!parseInt(meta.getAttribute('isframeused'));\n        };\n\n        if (typeof meta !== 'string') {\n            // get the type of the child\n            var position, size, rotation, locations, tail, head, closed, text, firstAnchor, secondAnchor;\n            var id = editor.getId();\n            var style = getCurrentStyle(editor, meta);\n            var type = meta.getAttribute('type') || '';\n            var createMarkup;\n            switch(type) {\n                case MarkupType.MARKUP_TYPE_ARROW:\n                    tail = getAttributeVector('tail');\n                    head = getAttributeVector('head');\n                    createMarkup = new CreateArrow(editor, id, tail, head, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_RECTANGLE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateRectangle(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_TEXT:\n                    position = getPosition();\n                    size = getSize();\n                    text = getText();\n                    createMarkup = new CreateText(editor, id, position, size, text, style );\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CALLOUT:\n                    position = getPosition();\n                    size = getSize();\n                    text = getText();\n                    var isFrameUsed = getIsFrameUsed();\n                    createMarkup = new CreateCallout(editor, id, position, size, text, style, isFrameUsed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CIRCLE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateCircle(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_CLOUD:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateCloud(editor, id, position, size, rotation, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_FREEHAND:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    createMarkup = new CreateFreehand(editor, id, position, size, rotation, locations, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_POLYLINE:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    closed = isClosed();\n                    createMarkup = new CreatePolyline(editor, id, position, size, rotation, locations, style, closed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_POLYCLOUD:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    closed = isClosed();\n                    createMarkup = new CreatePolycloud(editor, id, position, size, rotation, locations, style, closed);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_HIGHLIGHT:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    locations = getLocations();\n                    createMarkup = new CreateHighlight(editor, id, position, size, rotation, locations, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_DIMENSION:\n                    firstAnchor = getAttributeVector('firstAnchor');\n                    secondAnchor = getAttributeVector('secondAnchor');\n                    text = getText();\n                    createMarkup = new CreateDimension(editor, id, firstAnchor, secondAnchor, text, style);\n                    break;\n\n                case MarkupType.MARKUP_TYPE_STAMP:\n                    position = getPosition();\n                    size = getSize();\n                    rotation = getRotation();\n                    createMarkup = new CreateStamp(editor, id, position, size, rotation, style, child);\n                    break;\n\n                default:\n                    createMarkup = null;\n                    break;\n            }\n            if (createMarkup){\n                createMarkup.addToHistory = false;\n                createMarkup.execute();\n                var markupList = editor.svgLayersMap[editor.activeLayer].markups;\n\n                for(var i = 0; i < markupList.length; ++i) {\n                    if (markupList[i].id === id) {\n                        return markupList[i];\n                    }\n                }\n            }\n            return null;\n        }\n    };\n    \n\n    export var composeRGBAString = function(hexRGBString, opacity) {\n\n        if(!hexRGBString || !opacity || opacity <= 0) {\n            return 'none';\n        }\n\n        return ['rgba(' +\n            parseInt('0x' + hexRGBString.substr(1,2)), ',',\n            parseInt('0x' + hexRGBString.substr(3,2)), ',',\n            parseInt('0x' + hexRGBString.substr(5,2)), ',', opacity, ')'].join('');\n    };\n\n    //// Id Target Collision ///////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param x0\n     * @param y0\n     * @param x1\n     * @param y1\n     * @param idTarget\n     */\n    export var checkLineSegment = function(x0, y0, x1, y1, idTarget) {\n\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\n        var deviceRatio = _window.devicePixelRatio || 1;\n\n        x0 *= deviceRatio;\n        y0 *= deviceRatio;\n        x1 *= deviceRatio;\n        y1 *= deviceRatio;\n\n        var idTargetWidth = idTarget.width;\n        var idTargetHeight = idTarget.height;\n        var idTargetBuffer = idTarget.buffer;\n\n        x0 = Math.round(x0);\n        x1 = Math.round(x1);\n        y0 = Math.round(idTargetHeight - y0);\n        y1 = Math.round(idTargetHeight - y1);\n\n        function point(x, y) {\n\n            x = Math.round(x);\n            y = Math.round(y);\n\n            var dx = 0;\n            var dy = 0;\n\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\n                dy += check(x,y+j) ? j : 0;\n            }\n\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\n                dx += check(x+i,y) ? i : 0;\n            }\n\n            return {\n                x: Math.round(x / deviceRatio + dx),\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\n        }\n\n        function check(x, y) {\n\n            // Probably better to clip line at the beginning.\n            if (x < 0 || x >= idTargetWidth ||\n                y < 0 || y >= idTargetHeight) {\n                return false;\n            }\n\n            var index = (y * idTargetWidth + x) *4;\n            return (\n                idTargetBuffer[index  ] !== 0xFF ||\n                idTargetBuffer[index+1] !== 0xFF ||\n                idTargetBuffer[index+2] !== 0xFF);\n        }\n\n        // DDA Line algorithm\n        var dx = (x1 - x0);\n        var dy = (y1 - y0);\n\n        var m = dx !== 0 ? dy / dx : 1;\n        var x = x0;\n        var y = y0;\n\n        if (dx !== 0 && Math.abs(m) <= 1) {\n\n            if (x0 <= x1) {\n                for (; x <= x1; ++x, y += m) {\n                    if (check(x, Math.round(y))) {\n                        return point(x, y);\n                    }\n                }\n            } else {\n                for (; x >= x1; --x, y -= m) {\n                    if (check(x, Math.round(y))) {\n                        return point(x, y);\n                    }\n                }\n            }\n        } else {\n\n            m = dx !== 0 ? 1/m : 0;\n            if (y0 <= y1) {\n                for (; y <= y1; ++y, x += m) {\n                    if (check(Math.round(x), y)) {\n                        return point(x, y);\n                    }\n                }\n            } else {\n                for (; y >= y1; --y, x -= m) {\n                    if (check(Math.round(x), y)) {\n                        return point(x, y);\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     *\n     * @param polygon\n     * @param idTarget\n     */\n    export var checkPolygon = function(polygon, idTarget) {\n\n        // Return if incorrect parameters.\n        if(!polygon || polygon.verxtexCount < 3 || !idTarget) {\n            return null;\n        }\n\n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\n        var deviceRatio = _window.devicePixelRatio || 1;\n\n        var idTargetWidth = idTarget.width;\n        var idTargetHeight = idTarget.height;\n        var idTargetBuffer = idTarget.buffer;\n\n        var vertexCount = polygon.vertexCount;\n        var xVertices = Float32Array.from(polygon.xVertices); // Clone to scale by device pixel ratio and to\n        var yVertices = Float32Array.from(polygon.yVertices); // change y coordinates to OpenGL style.\n\n        function point(x, y) {\n\n            var dx = 0;\n            var dy = 0;\n\n            for(var j = -deviceRatio; j <= deviceRatio; j+=deviceRatio*2){\n                dy += check(x,y+j) ? j : 0;\n            }\n\n            for(var i = -deviceRatio; i <= deviceRatio; i+=deviceRatio*2){\n                dx += check(x+i,y) ? i : 0;\n            }\n\n            return {\n                x: Math.round(x / deviceRatio) + dx,\n                y: Math.round((idTargetHeight - y) / deviceRatio - dy)};\n        }\n\n        function check(x, y) {\n\n            if (x < 0 || x >= idTargetWidth ||\n                y < 0 || y >= idTargetHeight) {\n                return false;\n            }\n\n            var index = (y * idTargetWidth + x) * 4;\n            return (\n                idTargetBuffer[index  ] !== 0xFF ||\n                idTargetBuffer[index+1] !== 0xFF ||\n                idTargetBuffer[index+2] !== 0xFF) && isInsidePolygon(x, y);\n        }\n\n        function isInsidePolygon(x, y) {\n\n            var result = false;\n            var vertexCount = polygon.vertexCount;\n            for(var i = 0, j = vertexCount-1; i < vertexCount; j = i++) {\n\n                if (((yVertices[i] > y) != (yVertices[j] > y)) &&\n                     (x < (xVertices[j] - xVertices[i]) * (y - yVertices[i]) / (yVertices[j] - yVertices[i]) + xVertices[i]) ) {\n                    result = !result;\n                }\n            }\n            return result;\n        }\n\n        // Change coordinates to OpenGL style and calculate polygon's bounding box.\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(var i = 0; i < vertexCount; ++i) {\n\n            var bbX = xVertices[i] = xVertices[i] * deviceRatio;\n            var bbY = yVertices[i] = idTargetHeight - yVertices[i] * deviceRatio;\n\n            bbX0 = Math.min(bbX0, bbX);\n            bbY0 = Math.min(bbY0, bbY);\n            bbX1 = Math.max(bbX1, bbX);\n            bbY1 = Math.max(bbY1, bbY);\n        }\n\n        if (bbX1 < 0 || bbX0 > idTargetWidth ||\n            bbY1 < 0 || bbY0 > idTargetHeight) {\n            return null;\n        }\n\n        var bbW = Math.round(bbX1 - bbX0);\n        var bbH = Math.round(bbY1 - bbY0);\n\n        var bbCenterX = Math.round((bbX0 + bbX1)*0.5);\n        var bbCenterY = Math.round((bbY0 + bbY1)*0.5);\n\n        // Check\n        var x = bbCenterX;\n        var y = bbCenterY;\n\n        var w = 1;\n        var h = 1;\n\n        do {\n\n            var endX = x + w;\n            var endY = y + h;\n\n            for(; x < endX; ++x) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            for(; y < endY; ++y) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            if (w < bbW) {\n                endX = x - ++w; ++w;\n            } else {\n                endX = x - w;\n            }\n\n            if (h < bbH) {\n                endY = y - ++h; ++h;\n            } else {\n                endY = y - h;\n            }\n\n            for(; x > endX; --x) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n\n            for(; y > endY; --y) {\n                if (check(x,y)) {\n                    return point(x,y);\n                }\n            }\n        } while(w < bbW || h < bbH);\n     };\n\n    //// CSS ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @returns {*}\n     */\n    export var createStyleSheet = function() {\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        var style = _document.createElement(\"style\");\n\n        // This is WebKit hack.\n        style.appendChild(_document.createTextNode(\"\"));\n        _document.head.appendChild(style);\n\n        return style.sheet;\n    };\n\n    /**\n     *\n     * @param styleSheet\n     * @param selector\n     * @param styles\n     * @param index\n     */\n    export var addRuleToStyleSheet = function(styleSheet, selector, styles, index) {\n\n        if(\"insertRule\" in styleSheet) {\n            styleSheet.insertRule(selector + \"{\" + styles + \"}\", index);\n        }\n        else if(\"addRule\" in styleSheet) {\n            styleSheet.addRule(selector, styles, index);\n        }\n    };\n\n    //// SVG ///////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param lines\n     * @param style\n     * @param editor\n     */\n    export var measureTextLines = function(lines, style, editor) {\n\n        // Measure div style is line style with some custom layout properties.\n        var fontSize = editor.sizeFromMarkupsToClient(0, style['font-size']).y;\n\n        var measureStyle = new DomElementStyle()\n            .setAttribute('font-family', style['font-family'])\n            .setAttribute('font-size', fontSize + 'px')\n            .setAttribute('font-weight', style['font-weight'] ? 'bold' : '')\n            .setAttribute('font-style', style['font-style'] ? 'italic' : '')\n\n            .removeAttribute(['top', 'left', 'width', 'height', 'overflow-y'])\n            .setAttribute('position','absolute')\n            .setAttribute('white-space','nowrap')\n            .setAttribute('float','left')\n            .setAttribute('visibility','hidden')\n            .getStyleString();\n\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        // Create measure div.\n        var measure = _document.createElement('div');\n\n        measure.setAttribute('style', measureStyle);\n        editor.viewer.container.appendChild(measure);\n\n        // Measure.\n        var result = [];\n\n        var linesCount = lines.length;\n        for(var i = 0; i < linesCount; ++i) {\n\n            measure.innerText = lines[i];\n            result.push({\n                line: lines[i],\n                width: measure.clientWidth,\n                height: measure.clientHeight\n            });\n        }\n\n        // Remove measure div and return result.\n        editor.viewer.container.removeChild(measure);\n        return result;\n    };\n\n    export var createArcTo = function(x, y, xRadius, yRadius, relative, path) {\n\n        path.push(relative ? 'a' : 'A');\n        path.push(xRadius);\n        path.push(yRadius);\n        path.push(0);\n        path.push(1);\n        path.push(1);\n        path.push(x);\n        path.push(y);\n\n        return path;\n    };\n\n    export var createEllipsePath = function (x, y, w, h, relative, path) {\n\n        var halfW = w * 0.5;\n        var halfH = h * 0.5;\n\n        path.push(relative ? 'm' : 'M');\n        path.push(x);\n        path.push(y);\n\n        createArcTo(w, 0, halfW, halfH, true, path);\n        createArcTo(-w, 0, halfW, halfH, true, path);\n\n        path.push('z');\n    };\n\n    export var createRectanglePath = function (x, y, w, h, relative, path) {\n\n        path.push(relative ? 'm' : 'M');\n        path.push(x);\n        path.push(y);\n        path.push('l');\n        path.push(w);\n        path.push(0);\n        path.push('l');\n        path.push(0);\n        path.push(h);\n        path.push('l');\n        path.push(-w);\n        path.push(0);\n        path.push('z');\n    };\n\n    export var renderToCanvas = function(svg, viewBox, width, height, ctx, callback) {\n\n        // Creating a new svg element, that will be drawn into the canvas.\n        var tmpSvg = createSvgElement('svg');\n        \n        if (!av.isIE11) {\n            tmpSvg.setAttribute('xmlns','http://www.w3.org/2000/svg');    \n        }\n\n        tmpSvg.setAttribute('width',width);\n        tmpSvg.setAttribute('height',height);\n        tmpSvg.setAttribute('viewBox',viewBox);\n        tmpSvg.setAttribute('transform', 'scale(1,-1)');\n        \n        var markupGroup = svg.parentNode.cloneNode(true);\n\n        // Adding the markup itself to the temp SVG\n        tmpSvg.appendChild(markupGroup);\n        \n        const _window = (this && this.getWindow && this.getWindow()) || _gWindow;\n        const _document = (this && this.getDocument && this.getDocument()) || _gDocument;\n        // Get the SVG as string\n        var temp = _document.createElement('div');\n        var node = tmpSvg.cloneNode(true);\n        temp.appendChild(node);\n        var data = temp.innerHTML;\n        \n        tmpSvg = temp = node = null;\n\n        var img = new Image();\n\n        img.onload = function() {\n            ctx.drawImage(img, 0, 0);\n            callback();\n        };\n\n        img.src = 'data:image/svg+xml;base64,' + _window.btoa(unescape( encodeURIComponent( data )));\n    };\n\n    /*\n     Taken from Simplify.js, a high-performance JS polyline simplification library\n     (c) 2013, Vladimir Agafonkin\n     mourner.github.io/simplify-js\n    */\n   export var simplify = function(points, tolerance, highestQuality) {\n\n        if (points.length <= 2) return points;\n\n        // square distance between 2 points\n        function getSqDist(p1, p2) {\n\n            var dx = p1.x - p2.x,\n                dy = p1.y - p2.y;\n\n            return dx * dx + dy * dy;\n        }\n\n        // square distance from a point to a segment\n        function getSqSegDist(p, p1, p2) {\n\n            var x = p1.x,\n                y = p1.y,\n                dx = p2.x - x,\n                dy = p2.y - y;\n\n            if (dx !== 0 || dy !== 0) {\n\n                var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n\n                if (t > 1) {\n                    x = p2.x;\n                    y = p2.y;\n\n                } else if (t > 0) {\n                    x += dx * t;\n                    y += dy * t;\n                }\n            }\n\n            dx = p.x - x;\n            dy = p.y - y;\n\n            return dx * dx + dy * dy;\n        }\n        // rest of the code doesn't care about point format\n\n        // basic distance-based simplification\n        function simplifyRadialDist(points, sqTolerance) {\n\n            var prevPoint = points[0],\n                newPoints = [prevPoint],\n                point;\n\n            for (var i = 1, len = points.length; i < len; i++) {\n                point = points[i];\n\n                if (getSqDist(point, prevPoint) > sqTolerance) {\n                    newPoints.push(point);\n                    prevPoint = point;\n                }\n            }\n\n            if (prevPoint !== point) newPoints.push(point);\n\n            return newPoints;\n        }\n\n        function simplifyDPStep(points, first, last, sqTolerance, simplified) {\n            var maxSqDist = sqTolerance,\n                index;\n\n            for (var i = first + 1; i < last; i++) {\n                var sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n                if (sqDist > maxSqDist) {\n                    index = i;\n                    maxSqDist = sqDist;\n                }\n            }\n\n            if (maxSqDist > sqTolerance) {\n                if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);\n                simplified.push(points[index]);\n                if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);\n            }\n        }\n\n        // simplification using Ramer-Douglas-Peucker algorithm\n        function simplifyDouglasPeucker(points, sqTolerance) {\n            var last = points.length - 1;\n\n            var simplified = [points[0]];\n            simplifyDPStep(points, 0, last, sqTolerance, simplified);\n            simplified.push(points[last]);\n\n            return simplified;\n        }\n\n        // both algorithms combined for awesome performance\n        var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\n\n        points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\n        points = simplifyDouglasPeucker(points, sqTolerance);\n\n        return points;\n    }\n\n","'use strict';\n\n    /**\n     * This class will group actions edit actions that should be executed as a whole.\n     * When a group is open actions can be added to it, similar actions will be merged into one during this process.\n     * This class is not intended to be used by users, it's a helper class of EditActionManager.\n     * @constructor\n     */\n    export function EditActionGroup() {\n\n        this.actions = [];\n        this.closed = true;\n    }\n\n    var proto = EditActionGroup.prototype;\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.open = function() {\n\n        if(!this.closed) {\n            return false;\n        }\n\n        this.closed = false;\n        return true;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.close = function() {\n\n        if (this.closed) {\n            return false;\n        }\n\n        this.closed = true;\n        return true;\n    };\n\n    /**\n     *\n     * @returns {number} targetId\n     */\n    proto.undo = function() {\n\n        var actions = this.actions;\n        var actionsMaxIndex = actions.length - 1;\n\n        var targetId = -1;\n        for(var i = actionsMaxIndex; i >= 0; --i) {\n\n            var action =  actions[i];\n            action.undo();\n\n            if (action.targetId !== -1) {\n                targetId = action.targetId;\n            }\n        }\n\n        return targetId;\n    };\n\n    /**\n     *\n     * @returns {number} targetId\n     */\n    proto.redo = function() {\n\n        var actions = this.actions;\n        var actionsCount = actions.length;\n\n        var targetId = -1;\n        for(var i = 0; i < actionsCount; ++i) {\n\n            var action =  actions[i];\n            action.redo();\n\n            if (action.targetId !== -1) {\n                targetId = action.targetId;\n            }\n        }\n\n        return targetId;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isOpen = function() {\n\n        return !this.closed;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isClosed = function() {\n\n        return this.closed;\n    };\n\n    /**\n     *\n     * @returns {boolean}\n     */\n    proto.isEmpty = function() {\n\n        return this.actions.length === 0;\n    };\n\n    /**\n     *\n     * @param {EditAction} action\n     */\n    proto.addAction = function(action) {\n\n        if (this.closed) {\n            return false;\n        }\n\n        this.actions.push(action);\n        this.compact();\n\n        return true;\n    };\n\n    /**\n     * @private\n     */\n    proto.compact = function() {\n\n        var actions = this.actions;\n        var actionsCount = actions.length;\n\n        for(var i = 0; i < actionsCount; ++i) {\n\n            // If an action does nothing, remove it.\n            var actionA = actions[i];\n            if (actionA.isIdentity()) {\n                actions.splice(i, 1);\n                --actionsCount;\n                --i;\n                continue;\n            }\n\n            // If an action can be merged, merge it.\n            for (var j = i + 1; j < actionsCount; ++j) {\n\n                var actionB = actions[j];\n                if (actionA.type === actionB.type &&\n                    actionA.merge(actionB)) {\n                    actions.splice(j, 1);\n                    --actionsCount;\n                    --i;\n                    break;\n                }\n            }\n        }\n    };\n\n    proto.getTargetId = function() {\n      var actions = this.actions;\n      var actionsCount = actions.length;\n      var targetId = -1;\n      for(var i = 0; i < actionsCount; ++i) {\n        var action =  actions[i];\n        if (action.targetId !== -1) {\n          targetId = action.targetId;\n        }\n      }\n      return targetId;\n    }","'use strict';\n\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\nimport * as MarkupEvents from '../MarkupEvents'\nimport { EditActionGroup } from './EditActionGroup'\n\n    /**\n     *\n     * @param historySize\n     * @constructor\n     */\n    export function EditActionManager(historySize) {\n\n        this.historySize = historySize;\n\n        this.undoStack = [];\n        this.redoStack = [];\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = EditActionManager.prototype;\n\n    /**\n     *\n     * @param action\n     */\n    proto.execute = function(action) {\n\n        var redoStack = this.redoStack;\n        var undoStack = this.undoStack;\n\n        redoStack.splice(0, redoStack.length);\n\n        action.redo();\n\n        var group = this.getEditActionGroup();\n        if (group.isOpen()) {\n            group.addAction(action);\n        } else {\n            group.open();\n            group.addAction(action);\n            group.close();\n        }\n\n        if (undoStack.length > this.historySize) {\n            undoStack.splice(0,1);\n        }\n\n        var targetId = action.selectOnExecution ? action.targetId : -1;\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'execute', targetId: targetId}});\n    };\n\n    proto.beginActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n        var group = null;\n\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\n\n            group = this.getEditActionGroup();\n            group.open();\n        } else {\n            console.warn('Markups - Undo/Redo - Action edit group already open.');\n        }\n    };\n\n    proto.closeActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n\n        if (undoStackCount === 0) {\n\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\n            return;\n        }\n\n        var group = undoStack[undoStackCount-1];\n        if(!group.close()) {\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\n        }\n\n        if (group.isEmpty()) {\n            undoStack.pop();\n        }\n    };\n\n    proto.cancelActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n\n        if (undoStackCount === 0) {\n\n            console.warn('Markups - Undo/Redo - There is no action edit group to close.');\n            return;\n        }\n\n        var group = undoStack[undoStackCount-1];\n        if(!group.close()) {\n            console.warn('Markups - Undo/Redo - Action edit group already closed.');\n            return;\n        }\n\n        group.undo();\n        undoStack.pop();\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action: 'cancel', targetId: -1}});\n    };\n\n    proto.undo = function() {\n\n        var undoStack = this.undoStack;\n        var redoStack = this.redoStack;\n\n        if (undoStack.length === 0) {\n            return;\n        }\n\n        var group = undoStack.pop();\n        var targetId = group.undo();\n\n        redoStack.push(group);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'undo', targetId: targetId}});\n    };\n\n    proto.redo = function() {\n\n        var undoStack = this.undoStack;\n        var redoStack = this.redoStack;\n\n        if (redoStack.length === 0) {\n            return;\n        }\n\n        var group = redoStack.pop();\n        var targetId = group.redo();\n\n        undoStack.push(group);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'redo', targetId: targetId}});\n    };\n\n    proto.clear = function() {\n\n        this.undoStack.splice(0, this.undoStack.length);\n        this.redoStack.splice(0, this.redoStack.length);\n\n        this.dispatchEvent(\n            {type: MarkupEvents.EVENT_HISTORY_CHANGED, data: {action:'clear', targetId: -1}});\n    };\n\n    proto.isUndoStackEmpty = function() {\n\n        return this.undoStack.length === 0;\n    };\n\n    proto.isRedoStackEmpty = function() {\n\n        return this.redoStack.length === 0;\n    };\n\n    proto.getLastElementInUndoStack = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = undoStack.length;\n        return undoStack[undoStackCount-1];\n    }\n\n    /**\n     *\n     * @return action\n     * @private\n     */\n    proto.getEditActionGroup = function() {\n\n        var undoStack = this.undoStack;\n        var undoStackCount = this.undoStack.length;\n\n        var group = null;\n\n        if (undoStackCount === 0 || undoStack[undoStackCount-1].isClosed()) {\n            group = new EditActionGroup();\n            undoStack.push(group);\n        } else {\n            group = undoStack[undoStackCount-1];\n        }\n\n        return group;\n    };\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param id\n     * @param markup\n     * @param position\n     * @constructor\n     */\n    export function CloneMarkup(editor, id, markup, position) {\n\n        EditAction.call(this, editor, 'CLONE-MARKUP', id);\n\n        this.clone = markup.clone();\n        this.clone.id = id;\n        this.position = {x: position.x, y: position.y};\n    }\n\n    CloneMarkup.prototype = Object.create(EditAction.prototype);\n    CloneMarkup.prototype.constructor = CloneMarkup;\n\n    var proto = CloneMarkup.prototype;\n\n    proto.redo = function() {\n\n        var editor = this.editor;\n        var clone = this.clone;\n        var position = this.position;\n\n        if (editor.getMarkup(this.targetId)) {\n            return;\n        }\n\n        var markup = clone.clone();\n        markup.setPosition(position.x, position.y);\n\n        editor.addMarkup(markup);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && this.editor.removeMarkup(markup);\n    };\n\n\n","'use strict';\n\nimport { CloneMarkup } from '../edit-actions/CloneMarkup'\nimport { addTraitEventDispatcher } from '../MarkupsCoreUtils'\n\n    /**\n     *\n     * @param editor\n     * @constructor\n     */\n    export function Clipboard(editor) {\n\n        this.editor = editor;\n        this.content = null;\n        this.pastePosition = {x:0, y: 0};\n\n        addTraitEventDispatcher(this);\n    }\n\n    var proto = Clipboard.prototype;\n\n    proto.copy = function() {\n\n        var selectedMarkup = this.editor.getSelection();\n        if(!selectedMarkup) {\n            return;\n        }\n\n        this.content = selectedMarkup.clone();\n        this.pastePosition.x = selectedMarkup.position.x;\n        this.pastePosition.y = selectedMarkup.position.y;\n    };\n\n    proto.cut = function() {\n\n        var selectedMarkup = this.editor.getSelection();\n        if(!selectedMarkup) {\n            return;\n        }\n\n        this.copy();\n        this.editor.deleteMarkup(selectedMarkup);\n    };\n\n    proto.paste = function() {\n\n        var content = this.content;\n        if(!content) {\n            return;\n        }\n\n        var editor = this.editor;\n        var position = this.pastePosition;\n        var delta = editor.sizeFromClientToMarkups(20, 20);\n\n        position.x += delta.x;\n        position.y -= delta.y;\n\n        var cloneMarkup = new CloneMarkup(editor, editor.getId(), content, position);\n        cloneMarkup.execute();\n    };\n","'use strict';\n\nimport { isTouchDevice } from '../MarkupsCoreUtils'\n\n    var av = Autodesk.Viewing;\n    var avp = av.Private;\n\n    var _mouseEnabled = false;\n    var _mousePrevValue = false;\n    var _lock = false;\n\n    export function InputHandler() {\n\n        this.editor = null;\n        this.mousePosition = {x:0, y:0};\n        this.makeSameXY = false; // TODO: FIND a better way to name and communicate these.\n        this.snapRotations = false;\n        this.keepAspectRatio = false;\n        this.constrainAxis = false;\n        this.duringEditMode = false;\n\n        this.onWheelBinded = this.onWheel.bind(this);\n        this.onTouchDragBinded = this.onTouchDrag.bind(this);\n        this.onTouchPanBinded = this.onTouchPan.bind(this);\n        this.onTouchPinchBinded = this.onTouchPinch.bind(this);\n        this.onSingleTapBinded = this.onSingleTap.bind(this);\n        this.onDoubleTapBinded = this.onDoubleTap.bind(this);\n        this.onMouseMoveBinded = this.onMouseMove.bind(this);\n        this.onMouseUpBinded = this.onMouseUp.bind(this);\n        this.onMouseDownBinded = this.onMouseDown.bind(this);\n        this.onMouseDoubleClickBinded = this.onMouseDoubleClick.bind(this);\n        this.onHammerInputBinded = this.onHammerInput.bind(this);\n        this.isMouseDown = false;\n    }\n\n    av.GlobalManagerMixin.call(InputHandler.prototype);\n    var proto = InputHandler.prototype;\n\n    proto.attachTo = function(editor) {\n\n        this.editor && this.detachFrom(this.editor);\n        this.editor = editor;\n\n        if (isTouchDevice()) {\n\n            this.hammer = new av.Hammer.Manager(editor.svg, {\n                recognizers: [\n                    av.GestureRecognizers.drag,\n                    av.GestureRecognizers.doubletap,\n                    av.GestureRecognizers.doubletap2,\n                    av.GestureRecognizers.singletap,\n                    av.GestureRecognizers.singletap2,\n                    av.GestureRecognizers.press,\n                    av.GestureRecognizers.pan,\n                    av.GestureRecognizers.pinch\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\n            });\n\n            this.hammer.get('doubletap2').recognizeWith('doubletap');\n            this.hammer.get('singletap2').recognizeWith('singletap');\n            this.hammer.get('singletap').requireFailure('doubletap');\n        }\n    };\n\n    proto.onHammerInput = function(event) {\n\n        this.setMouseDisabledWhenTouching(event);\n    };\n\n    proto.setMouseDisabledWhenTouching = function(event) {\n\n        if (event.isFirst && !_lock) {\n            this.enableMouseButtons(false);\n            _lock = true;\n        } else if (event.isFinal) {\n            var _this = this;\n            setTimeout(function() {\n                _this.enableMouseButtons(_mousePrevValue);\n                _lock = false;\n            }, 10);\n        }\n    };\n\n    proto.enableMouseButtons = function(state) {\n\n        if (state && !_mouseEnabled)\n        {\n            this.editor.svg.addEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.addEventListener('dblclick', this.onMouseDoubleClickBinded);\n            this.editor.svg.addEventListener('wheel', this.onWheelBinded);\n            this.editor.svg.addEventListener('DOMMouseScroll', this.onWheelBinded); // Firefox\n            \n            // The mouseup and mousemove listeners are at the document level to handle the case where\n            // mouse was held inside the canvas and released outside. \n            // When this happens, we don't want the editing to be in a hung state and cancel it\n            this.addDocumentEventListener('mousemove', this.onMouseMoveBinded);\n            this.addDocumentEventListener('mouseup', this.onMouseUpBinded);\n        }\n        else if (!state && _mouseEnabled)\n        {\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\n            this.editor.svg.removeEventListener('wheel', this.onWheelBinded);\n            this.editor.svg.removeEventListener('DOMMouseScroll', this.onWheelBinded);\n            this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\n            this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\n\n        }\n\n        _mousePrevValue = _mouseEnabled;\n        _mouseEnabled = state;\n    };\n\n    proto.detachFrom = function(editor) {\n\n        this.hammer && this.hammer.destroy();\n\n        this.removeDocumentEventListener('mousemove', this.onMouseMoveBinded);\n        this.removeDocumentEventListener('mouseup', this.onMouseUpBinded);\n\n        if (this.editor) {\n            this.editor.svg.removeEventListener('mousedown', this.onMouseDownBinded);\n            this.editor.svg.removeEventListener('dblclick', this.onMouseDoubleClickBinded);\n        }\n\n        this.editor = editor;\n    };\n\n    proto.enterEditMode = function() {\n        if (this.duringEditMode) {\n            return;\n        }\n\n        if (this.hammer) {\n            this.hammer.on('dragstart dragmove dragend', this.onTouchDragBinded);\n            this.hammer.on('panstart panmove panend', this.onTouchPanBinded);\n            this.hammer.on('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\n            this.hammer.on('singletap', this.onSingleTapBinded);\n            this.hammer.on('singletap2', this.onSingleTapBinded);\n            this.hammer.on('doubletap', this.onDoubleTapBinded);\n            this.hammer.on('doubletap2', this.onDoubleTapBinded);\n            this.hammer.on('hammer.input', this.onHammerInputBinded);\n\n\t\t\tthis.hammer.get('drag').requireFailure('pinch');\n            this.hammer.get('drag').requireFailure('pan');\n        }\n\n        if (!av.isMobileDevice()) {\n            this.enableMouseButtons(true);\n        }\n\n        this.duringEditMode = true;\n    };\n\n    proto.leaveEditMode = function() {\n        if (!this.duringEditMode) {\n            return;\n        }\n\n        if (this.hammer) {\n            this.hammer.off('dragstart dragmove dragend', this.onTouchDragBinded);\n\t\t\tthis.hammer.off('panstart panmove panend', this.onTouchPanBinded);\n            this.hammer.off('pinchstart pinchmove pinchend', this.onTouchPinchBinded);\n            this.hammer.off('singletap', this.onSingleTapBinded);\n            this.hammer.off('singletap2', this.onSingleTapBinded);\n            this.hammer.off('doubletap', this.onDoubleTapBinded);\n            this.hammer.off('doubletap2', this.onDoubleTapBinded);\n            this.hammer.off('hammer.input', this.onHammerInputBinded);\n        }\n\n        if (!av.isMobileDevice()) {\n            this.enableMouseButtons(false);\n        }\n\n        this.duringEditMode = false;\n    };\n\n    proto.enterViewMode = function() {\n\n    };\n\n    proto.leaveViewMode = function() {\n\n    };\n\n    proto.getMousePosition = function() {\n\n        return {x: this.mousePosition.x, y: this.mousePosition.y};\n    };\n\n    proto.onWheel = function(event) {\n\n        if (!av.isMobileDevice()) {\n            this.editor.viewer.toolController.mousewheel(event);\n        }\n\n        event.preventDefault();\n    };\n\n    proto.onMouseMove = function(event) {\n\n        processMouseEvent(this, event);\n\n        if (!av.isMobileDevice() && this.editor.viewer.container.contains(event.target)) {\n            this.editor.viewer.toolController.mousemove(event);\n        }\n\n        if (this.editor.onMouseMove(event)) {\n            // editor handled the event\n            event.preventDefault();\n        }\n    };\n\n\n    proto.onMouseDownRightClick = function(event) {\n\n        const _document = this.getDocument();\n        // Don't do blur in full screen (IE issue)\n        if (!(av.isIE11 && av.inFullscreen(_document))) {\n            _document.activeElement && _document.activeElement.blur && _document.activeElement.blur();\n        }\n\n        var controller = this.editor.viewer.toolController;\n        controller.__clientToCanvasCoords(event);\n\n        this.editor.markupTool.handleButtonDown(event, 2);\n    };\n\n    proto.onMouseUpRightClick = function(event) {\n\n        var controller = this.editor.viewer.toolController;\n        controller.__clientToCanvasCoords(event);\n\n        this.editor.markupTool.handleButtonUp(event, 2);\n    };\n\n    proto.onMouseDown = function(event) {\n\n        processMouseEvent(this, event);\n\n        // Panning when right clicking\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.onMouseDownRightClick(event);\n            return;\n        }\n        \n        this.isMouseDown = true;\n        this.editor.onMouseDown(event);\n        event.preventDefault();\n    };\n\n    proto.onMouseUp = function(event) {\n\n        processMouseEvent(this, event);\n\n        if (!av.isMobileDevice() && this.editor.viewer.container.contains(event.target) && \n             (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))\n           ) {\n            this.onMouseUpRightClick(event);\n            return;\n        }\n\n        this.isMouseDown = false;\n        if (this.editor.onMouseUp(event)) {\n            // editor handled the event\n            event.preventDefault();\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        processMouseEvent(this, event);\n        this.editor.onMouseDoubleClick(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchDrag = function(event) {\n\n        convertEventHammerToMouse(event);\n        switch (event.type) {\n          case 'dragstart':\n                this.onMouseDown(event);\n                break;\n            case 'dragmove':\n                this.onMouseMove(event);\n                break;\n           case 'dragend':\n                this.onMouseUp(event);\n                break;\n        }\n        event.preventDefault();\n    };\n\n    proto.onTouchPan = function(event) {\n\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchPinch = function(event) {\n\n        processMouseEvent(this, event);\n\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        \n        this.mousePosition.x = this.mousePosition.y = null;\n        this.editor.callSnapperMouseMove();\n\n        event.preventDefault();\n    };\n\n    proto.onSingleTap = function(event) {\n\n        convertEventHammerToMouse(event);\n\n        this.onMouseDown(event);\n        this.onMouseUp(event);\n        event.preventDefault();\n    };\n\n    proto.onDoubleTap = function(event) {\n\n        convertEventHammerToMouse(event);\n        this.onMouseDoubleClick(event);\n        event.preventDefault();\n    };\n\n    function processMouseEvent(input, event) {\n\n        var rect = input.editor.svg.getBoundingClientRect();\n\n        input.makeSameXY = event.shiftKey;\n        input.snapRotations = event.shiftKey;\n        input.keepAspectRatio = event.shiftKey;\n        input.constrainAxis = event.shiftKey;\n\n        input.mousePosition.x = event.clientX - rect.left;\n        input.mousePosition.y = event.clientY - rect.top;\n    }\n\n    function convertEventHammerToMouse(event) {\n\n        // Convert Hammer touch-event X,Y into mouse-event X,Y.\n        event.shiftKey = false;\n        event.clientX = event.pointers[0].clientX;\n        event.clientY = event.pointers[0].clientY;\n    }\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    export function SetPosition(editor, markup, position) {\n\n        EditAction.call(this, editor, 'SET-POSITION', markup.id);\n\n        this.newPosition = {x: position.x, y: position.y};\n        this.oldPosition = {x: markup.position.x, y: markup.position.y};\n    }\n\n    SetPosition.prototype = Object.create(EditAction.prototype);\n    SetPosition.prototype.constructor = SetPosition;\n\n    var proto = SetPosition.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setPosition(this.newPosition.x, this.newPosition.y);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setPosition(this.oldPosition.x, this.oldPosition.y);\n    };\n\n    /**\n     *\n     * @param action\n     * @returns {boolean}\n     */\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newPosition = action.newPosition;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        var newPosition = this.newPosition;\n        var oldPosition = this.oldPosition;\n\n        return newPosition.x === oldPosition.x && newPosition.y === oldPosition.y;\n    };\n\n","'use strict';\n\nimport { EditAction } from './EditAction'\n\n    /**\n     *\n     * @param editor\n     * @param markup\n     * @param angle\n     * @constructor\n     */\n    export function SetRotation(editor, markup, angle) {\n\n        EditAction.call(this, editor, 'SET-ROTATION', markup.id);\n\n        var curAngle = markup.getRotation();\n\n        this.newRotation = {angle: angle};\n        this.oldRotation = {angle: curAngle};\n    }\n\n    SetRotation.prototype = Object.create(EditAction.prototype);\n    SetRotation.prototype.constructor = SetRotation;\n\n    var proto = SetRotation.prototype;\n\n    proto.redo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setRotation(this.newRotation.angle);\n    };\n\n    proto.undo = function() {\n\n        var markup = this.editor.getMarkup(this.targetId);\n        markup && markup.setRotation(this.oldRotation.angle);\n    };\n\n    /**\n     *\n     * @param action\n     * @returns {boolean}\n     */\n    proto.merge = function(action) {\n\n        if (this.targetId === action.targetId &&\n            this.type === action.type) {\n\n            this.newRotation = action.newRotation;\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * @returns {boolean}\n     */\n    proto.isIdentity = function() {\n\n        return this.newRotation.angle === this.oldRotation.angle;\n    };\n\n","'use strict';\n\nimport { EDIT_FRAME_DEFAULT_MARGIN, \n         addTraitEventDispatcher, isTouchDevice, degreesToRadians } from './MarkupsCoreUtils'\nimport * as MarkupEvents from './MarkupEvents'\nimport { CloneMarkup } from './edit-actions/CloneMarkup'\nimport { SetPosition } from './edit-actions/SetPosition'\nimport { SetSize } from './edit-actions/SetSize'\nimport { SetRotation } from './edit-actions/SetRotation'\n\n     var av = Autodesk.Viewing;\n     var avp = Autodesk.Viewing.Private;\n\n    /**\n     * A component to handle the selection of markups.\n     *\n     *\n     *      Sample\n     *\n     *      var containingDiv = document.getElementById('containingDiv3d-app-wrapper');\n     *      var selectionComponent = new EditFrame(containingDiv);\n     *      selectionComponent.setSelection(100, 100, 300, 150, 0);\n     *\n     * @param {HTMLElement} containingDiv The container where the selection layer will live.\n     * @param {Object} editor\n     * @constructor\n     */\n    export function EditFrame(containingDiv, editor) {\n\n        this.containingDiv = containingDiv;\n        this.editor = editor;\n        this.setGlobalManager(this.editor.viewer.globalManager);\n        this.selectionLayer = createSelectionLayer.bind(this)();\n\n        this.frameMargin = EDIT_FRAME_DEFAULT_MARGIN;\n\n        this.selection = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            rotation: 0,\n            element: null,\n            active: false,\n            dragging: false,\n            resizing: false,\n            //a dictionary of all the drag points\n            //the key for each drag point will be its cardinal/ordinal direction\n            handle: {}\n        };\n\n        createSelectorBox.bind(this)();\n\n        if (isTouchDevice()) {\n            this.hammer = new av.Hammer.Manager(this.selectionLayer, {\n                recognizers: [\n                    av.GestureRecognizers.drag,\n                    av.GestureRecognizers.doubletap,\n                    av.GestureRecognizers.doubletap2,\n                    av.GestureRecognizers.pan,\n                    av.GestureRecognizers.pinch\n                ],\n                handlePointerEventMouse: false,\n                inputClass: av.isIE11 ? av.Hammer.PointerEventInput : av.Hammer.TouchInput\n            });\n\n            this.onHammerDragBinded = this.onHammerDrag.bind(this);\n            this.onHammerDoubleTapBinded = this.onHammerDoubleTap.bind(this);\n            this.onTouchPanBinded = this.onTouchPan.bind(this);\n            this.onTouchPinchBinded = this.onTouchPinch.bind(this);\n\n            this.hammer.on(\"dragstart dragmove dragend\", this.onHammerDragBinded);\n            this.hammer.on(\"doubletap\", this.onHammerDoubleTapBinded);\n            this.hammer.on(\"doubletap2\", this.onHammerDoubleTapBinded);\n            this.hammer.on(\"panstart panmove panend\", this.onTouchPanBinded);\n            this.hammer.on(\"pinchstart pinchmove pinchend\", this.onTouchPinchBinded);\n\n            this.hammer.get('drag').requireFailure('pinch');\n            this.hammer.get('drag').requireFailure('pan');\n        }\n\n        handleSelectionBoxDragging.bind(this)();\n        handleSelectionBoxResizing.bind(this)();\n        handleSelectionDoubleClick.bind(this)();\n        handleSelectionBoxRotating.bind(this)();\n\n        //add the selection into the container given to us\n        this.containingDiv.appendChild(this.selectionLayer);\n\n        addTraitEventDispatcher(this);\n    }\n\n    av.GlobalManagerMixin.call(EditFrame.prototype);\n    var proto = EditFrame.prototype;\n\n    proto.unload = function() {\n\n        this.containingDiv.removeChild(this.selectionLayer);\n        this.selectionLayer = null;\n    };\n    /**\n     * Draws a selection box with the given attributes\n     *\n     * @param {number} x - The x coordinate to place the selection box\n     * @param {number} y - The y coordinate to place the selection box\n     * @param {number} width - The width of the selection box\n     * @param {number} height - The height of the selection box\n     * @param {number} rotation - The amount of degrees to rotate the selection box\n     */\n    proto.setSelection = function (x, y, width, height, rotation) {\n\n        var margin = this.frameMargin;\n        var doubleMargin = margin * 2;\n\n        updateSelectorBoxDimensions.bind(this)(width + doubleMargin, height + doubleMargin);\n        updateSelectorBoxPosition.bind(this)(x - margin, y - margin, rotation);\n        updateSelectionBoxState.bind(this)(true); //activate the selection box\n        this.selectionLayer.style.visibility = 'visible';\n    };\n\n    /**\n     * Displays the selection box based on the position, dimension, and rotation of a given markup\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - the markup that should appear as selected\n     */\n    proto.setMarkup = function (markup) {\n\n        this.hammer && this.hammer.set({enable: markup !== null});\n        this.markup = markup;\n\n        updateSelectionBoxState.bind(this)(false);\n\n        if (markup) {\n            var boundingBox = markup.getBoundingRect();\n            var rotation = markup.getRotation();\n            this.frameMargin = boundingBox.margin !== undefined ? boundingBox.margin : EDIT_FRAME_DEFAULT_MARGIN;\n\n            this.setSelection(boundingBox.x, boundingBox.y, boundingBox.width, boundingBox.height, rotation);\n\n            this.enableResizeHandles();\n            this.enableRotationHandle();\n\n            if (markup.preventReposition) {\n                this.selectionLayer.firstChild.style.cursor = '';\n            }\n            else {\n                this.selectionLayer.firstChild.style.cursor = 'move';\n            }\n        }\n    };\n\n    proto.startDrag = function (event) {\n\n        if (this.markup && this.markup.preventReposition) return;\n\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\n        this._onRepositionMouseDown(event, this.editor.getMousePosition());\n    };\n\n     proto.isActive = function() {\n        return this.selection.active;\n     };\n\n    proto.isDragging = function () {\n\n        return this.selection.dragging;\n    };\n\n    proto.isResizing = function () {\n\n        return this.selection.resizing;\n    };\n\n    proto.isRotating = function () {\n\n        return this.selection.rotating;\n    };\n\n    proto.onMouseMove = function (event) {\n\n        //dummy fn\n    };\n\n    proto.onMouseUp = function (event) {\n        //dummy fn\n    };\n\n    proto.onWheel = function (event) {\n        this.editor.viewer.toolController.mousewheel(event);\n    };\n\n    proto.onTouchPan = function(event) {\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n    proto.onTouchPinch = function(event) {\n        var gestureHandler = this.editor.viewer.toolController.getTool(\"gestures\");\n        gestureHandler.distributeGesture(event);\n        event.preventDefault();\n    };\n\n     proto.onHammerDrag = function(event) {\n\n         function updateEditorInput(input, parent, event) {\n\n             //TODO: Change this when refactoring input in edit frame.\n             var rect = parent.getBoundingClientRect();\n             input.mousePosition.x = event.pageX - rect.left;\n             input.mousePosition.y = event.pageY - rect.top;\n         }\n\n        //console.log('EditFrame drag ' + event.type);\n         convertEventHammerToMouse(event);\n         switch (event.type) {\n             case 'dragstart':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.editor.callSnapperMouseDown();\n                 // Check whether to translate, rotate or resize\n                 if (isRotatePoint(event.target)) {\n                     // Rotate\n                     this._onRotationMouseDown(event);\n                 } else if (isDragPoint(event.target)) {\n                     // Resize\n                     this._onResizeMouseDown(event);\n                 } else {\n                     this.startDrag(event);\n                 }\n                 event.preventDefault();\n                 break;\n             case 'dragmove':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.editor.callSnapperMouseMove();\n                 this.onMouseMove(event);\n                 event.preventDefault();\n                 break;\n             case 'dragend':\n                 updateEditorInput(this.editor.input, this.editor.svg, event);\n                 this.onMouseUp(event);\n                 event.preventDefault();\n                 break;\n         }\n     };\n\n    proto.onHammerDoubleTap = function(event) {\n\n        function updateEditorInput(input, parent, event) {\n\n            //TODO: Change this when refactoring input in edit frame.\n            var rect = parent.getBoundingClientRect();\n            input.mousePosition.x = event.pageX - rect.left;\n            input.mousePosition.y = event.pageY - rect.top;\n        }\n\n        convertEventHammerToMouse(event);\n        updateEditorInput(this.editor.input, this.editor.svg, event);\n\n        this.selection.dragging = false;\n        this.editor.editMode && this.editor.editMode.onMouseDoubleClick(this.markup);\n    };\n\n    proto.enableResizeHandles = function () {\n\n        var markup = this.markup;\n        var handle;\n\n        if (markup.isHeightConstrained() || markup.isWidthConstrained()) {\n            //hide all the handles\n            for (var direction in this.selection.handle) {\n                handle = this.selection.handle[direction];\n                if(handle) handle.style.display = 'none';\n            }\n\n            //show only the resize points that are allowed\n            if (!markup.isHeightConstrained()) {\n                this.selection.handle['n'].style.display = 'block';\n                this.selection.handle['s'].style.display = 'block';\n            }\n            if (!markup.isWidthConstrained()) {\n                this.selection.handle['w'].style.display = 'block';\n                this.selection.handle['e'].style.display = 'block';\n            }\n        } else {\n            //no constraints, show all resize handles\n            for (var direction in this.selection.handle) {\n                handle = this.selection.handle[direction];\n                if(handle) handle.style.display = 'block';\n            }\n        }\n    };\n\n    proto.enableRotationHandle = function () {\n\n        var markup = this.markup;\n        var display = markup.isRotationConstrained() ? 'none' : 'block';\n        this.selection.rotationHandle.style.display = display;\n        this.selection.rotationBridge.style.display = display;\n    };\n\n     function convertEventHammerToMouse(event) {\n         // Convert Hammer touch-event X,Y into mouse-event X,Y.\n         event.pageX = event.pointers[0].clientX;\n         event.pageY = event.pointers[0].clientY;\n     }\n\n    /**\n     * Creates an element spanning the full height and width of its parent.\n     * It serves as our surface to draw the selection box.\n     *\n     * @return {HTMLElement}\n     */\n    function createSelectionLayer() {\n\n        const _document = this.getDocument();\n        var selectionLayer = _document.createElement('div');\n        selectionLayer.style.position = 'absolute';\n        selectionLayer.style.top = 0;\n        selectionLayer.style.bottom = 0;\n        selectionLayer.style.left = 0;\n        selectionLayer.style.right = 0;\n        //don't let the selection box be visible outside the selection layer\n        selectionLayer.style.overflow = 'hidden';\n        selectionLayer.style.visibility = 'hidden';\n        togglePointerEvents(selectionLayer, false);\n        return selectionLayer;\n    }\n\n    /**\n     * Creates a single drag point with the corresponding styles\n     *\n     * @param {number} diameter - The size of the drag point\n     * @param {string} position - The cardinal(n, s, w, e) or ordinal(nw, nw, sw, se) direction of the point\n     * @return {HTMLElement}\n     */\n    function createDragPoint(position) {\n\n        const _document = this.getDocument();\n        var point = _document.createElement('div');\n\n        setResizeCursor(point, position);\n        point.className = 'selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-' + position;\n        point.classList.add('adsk-viewing-viewer');\n        point.setAttribute('data-sdp-handle', position);\n\n        return point;\n    }\n\n    function createRotatePoint () {\n        const _document = this.getDocument();\n        var point = _document.createElement('div');\n        point.classList.add('adsk-viewing-viewer');\n        point.classList.add('selector-rotate-point');\n        point.classList.add('autodesk-markups-extension-core-make-me-bigger');\n        setResizeCursor(point, 'w');\n\n        return point;\n    }\n\n    function createRotationBridge() {\n        const _document = this.getDocument();\n        var rotationBridge = _document.createElement('div');\n        rotationBridge.classList.add('adsk-viewing-viewer');\n        rotationBridge.classList.add('selector-rotate-point');\n        rotationBridge.classList.add('autodesk-markups-extension-core-make-me-bigger');\n        rotationBridge.classList.add('rotation-bridge');\n        setResizeCursor(rotationBridge, 'w');\n\n        return rotationBridge;\n    }\n\n    function setResizeCursor (element, direction) {\n\n        var cursor;\n        switch(direction) {\n            case 'n':\n            case 's':\n                cursor = 'ns-resize';\n                break;\n            case 'w':\n            case 'e':\n                cursor = 'ew-resize';\n                break;\n            case 'ne':\n            case 'sw':\n                cursor = 'nesw-resize';\n                break;\n            case 'nw':\n            case 'se':\n                cursor = 'nwse-resize';\n                break;\n        }\n        element.style.cursor = cursor;\n    }\n\n    /**\n     * Creates the 8 drag points of the selection box.\n     *\n     * @this EditFrame\n     */\n    function createDragPoints(selector) {\n\n        ['n', 's', 'w', 'e', 'nw', 'ne', 'sw', 'se'].forEach(function (direction) {\n            //store the drag point and put it in the DOM\n            this.selection.handle[direction] = createDragPoint.call(this, direction);\n            selector.appendChild(this.selection.handle[direction]);\n        }.bind(this));\n    }\n\n    /**\n     * Determines if an element is a drag point\n     *\n     * @return {boolean}\n     */\n    function isDragPoint(element) {\n\n        return matchesSelectorAux(element, '.selector-drag-point');\n    }\n\n    /**\n     * Determines if an element is a rotate point\n     *\n     * @return {boolean}\n     */\n    function isRotatePoint(element) {\n\n        return matchesSelectorAux(element, '.selector-rotate-point');\n    }\n\n    /**\n     * Creates the element that will be used as the selection box. It also\n     * takes care of adding the drag handles\n     *\n     * @return {HTMLElement} - the selection box\n     * @this EditFrame\n     */\n    function createSelectorBox() {\n\n        const _document = this.getDocument();\n        var selectorBox = _document.createElement('div');\n        togglePointerEvents(selectorBox, true);\n        selectorBox.classList.add('selector-box');\n\n        this.selection.rotationBridge = createRotationBridge.bind(this)();\n        selectorBox.appendChild(this.selection.rotationBridge);\n\n        this.selection.rotationHandle = createRotatePoint.bind(this)();\n        selectorBox.appendChild(this.selection.rotationHandle);\n\n        createDragPoints.bind(this)(selectorBox);\n\n        //store the selector box\n        this.selection.element = selectorBox;\n\n        if (!av.isMobileDevice()) {\n            this.onWheelBinded = this.onWheel.bind(this);\n            this.selection.element.addEventListener('wheel', this.onWheelBinded);\n            this.selection.element.addEventListener('DOMMouseScroll', this.onWheelBinded); // firefox\n        }\n\n        //add the selection box to the selection layer\n        this.selectionLayer.appendChild(this.selection.element);\n\n        //we are just creating the box, start it out hidden\n        updateSelectionBoxState.bind(this)(false);\n\n        return selectorBox;\n    }\n\n    /**\n     * Utility to create the CSS translate3d value from a given 2d point\n     *\n     * @param {number} x - coordinate\n     * @param {number} y - coordinate\n     * @return {string}\n     */\n    function toTranslate3d(x, y) {\n\n        return 'translate3d(' + x + 'px,' + y + 'px,0)';\n    }\n\n\n    /**\n     * Updates the display state of the selection box\n     *\n     * @param {boolean} active - The new state of the the selection box\n     * @this EditFrame\n     */\n    function updateSelectionBoxState(active) {\n\n        this.selection.active = active;\n        this.selection.element.style.display = active ? 'block' : 'none';\n    }\n\n    /**\n     * Updates the position and rotation of the selection box.\n     *\n     * @param {number} x - The x coordinate to place the selection box\n     * @param {number} y - The y coordinate to place the selection box\n     * @param {number} rotation - The amount of degrees to rotate the selection box\n     * @this EditFrame\n     */\n    function updateSelectorBoxPosition(x, y, rotation) {\n\n        this.selection.x = x;\n        this.selection.y = y;\n        this.selection.rotation = rotation;\n        var size = this.markup.getBoundingRect();\n        //TODO: consider DomElementStyle\n\n        size.width += this.frameMargin * 2;\n        size.height += this.frameMargin * 2;\n\n        var transform = toTranslate3d(x, y) + ' rotate(' + rotation + 'rad)';\n        var transformOrigin = (size.width / 2) + 'px ' + (size.height / 2) + 'px';\n\n        this.selection.element.style.msTransform =\n            this.selection.element.style.webkitTransform =\n            this.selection.element.style.transform = transform;\n        this.selection.element.style.msTransformOrigin =\n            this.selection.element.style.webkitTransformOrigin =\n            this.selection.element.style.transformOrigin = transformOrigin;\n    }\n\n    /**\n     * Updates the dimensions of the selection box (width and height).\n     *\n     * @param {number} width - The new width of the selection box\n     * @param {number} height - The new height of the selection box\n     * @this EditFrame\n     */\n    function updateSelectorBoxDimensions(width, height) {\n\n        this.selection.width = width;\n        this.selection.height = height;\n        this.selection.element.style.width = width + 'px';\n        this.selection.element.style.height = height + 'px';\n    }\n\n    /**\n     * Attaches all the necessary listeners to handle a drag action.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionBoxDragging () {\n\n        this.selection.element.addEventListener('mousedown', this._onRepositionMouseDown.bind(this));\n    }\n\n    /**\n     * Handles panning when right clicking down\n     * @param event\n     * @returns {boolean} returns true if the event was handled\n     * @private\n     */\n    proto._handleRightClickDown = function(event) {\n\n        if (!av.isMobileDevice() && (avp.isRightClick(event, this.editor.viewer.navigation) || avp.isMiddleClick(event))) {\n            this.editor.input.onMouseDownRightClick(event);\n            return true;\n        }\n\n        return false;\n    };\n\n    var ignoreFirstMouseMove = false;\n    proto._onRepositionMouseDown = function (event, cursor) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        // Return for markups that are not allowed to be repositioned.\n        if (this.markup && this.markup.preventReposition) return;\n\n        // ignore the first mouse move for the Microsoft Surface\n        ignoreFirstMouseMove = !av.isMobileDevice() && av.isTouchDevice();\n        //a synthetic start means that the event was triggered manually and not as a\n        //result of a mousedown on the edit frame\n        const _window = this.getWindow();\n        var syntheticStart = !(event instanceof _window.MouseEvent);\n\n        //during a real mousedown, ignore events originating from a resizing handle\n        if (!syntheticStart && (isDragPoint(event.target) || isRotatePoint(event.target))) return;\n\n        //get the cursor position\n        cursor = syntheticStart ?  cursor : this.editor.getMousePosition();\n\n        //store the initial cursor and axis constrains\n        this.initialCursor = cursor;\n        this.initialPosition = this.markup.getClientPosition();\n        this.areAxisConstrained = false;\n        this.axisConstrains = new THREE.Vector2(1,1);\n\n        //update the function that will handle the mousemove and mouseup events\n        this.onMouseMove = this._onRepositionMouseMove.bind(this);\n        this.onMouseUp = this._onRepositionMouseUp.bind(this);\n\n        if (this.selection.dragging)\n            return;\n\n        this.selection.dragging = true;\n        this.editor.beginActionGroup();\n\n        //if alt down I drop a clone.\n        if (event && event.altKey) {\n            var editor = this.editor;\n            var cloneMarkup = new CloneMarkup(editor, editor.getId(), this.markup, this.markup.position);\n            cloneMarkup.execute();\n        }\n\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Moving around\n    };\n\n    proto._onRepositionMouseMove = function(event) {\n\n        // This check is needed for selecting markups on devices that have touch screen + mouse (eg: Microsoft Surface)\n        if (ignoreFirstMouseMove) {\n            ignoreFirstMouseMove = false;\n            return false;\n        }\n        //ignore mousemove events if the dragging state hasn't been activated\n        if (!this.selection.dragging || !this.markup || this.markup.preventReposition) return false;\n\n        //get the position of the cursor relative to selection layer\n        var cursor = this.editor.getMousePosition();\n\n        //constrain axis if shift key is down.\n        var constrainAxis = this.editor.input.constrainAxis;\n        if (this.areAxisConstrained !== constrainAxis) {\n            this.areAxisConstrained = constrainAxis;\n            this.axisConstrains = constrainAxis ? new THREE.Vector2(0, 0) : new THREE.Vector2(1,1);\n\n            this.initialPosition.x += cursor.x - this.initialCursor.x;\n            this.initialPosition.y += cursor.y - this.initialCursor.y;\n\n            this.initialCursor.x = cursor.x;\n            this.initialCursor.y = cursor.y;\n        }\n\n        //determine how many pixel we have to shift the\n        //selection box to keep the cursor on the drag point\n        var movement = {\n            x: cursor.x - this.initialCursor.x,\n            y: cursor.y - this.initialCursor.y\n        };\n\n        var deadZone = 15;\n        if (this.axisConstrains.x === 0 && this.axisConstrains.y === 0) {\n\n            if (Math.abs(movement.x) > deadZone) {\n                this.axisConstrains.x = 1;\n                movement.x += movement.x < 0 ?  deadZone : -deadZone;\n            } else\n            if (Math.abs(movement.y) > deadZone) {\n                this.axisConstrains.y = 1;\n                movement.y += movement.y < 0 ?  deadZone : -deadZone;\n            }\n        }\n\n        var x = this.initialPosition.x + movement.x * this.axisConstrains.x;\n        var y = this.initialPosition.y + movement.y * this.axisConstrains.y;\n\n        updateSelectorBoxPosition.bind(this)(x, y, this.selection.rotation);\n\n        //tell the markup to start transforming\n        //the markup expects an (x, y) coordinate that\n        //uses an origin at the center, adjust our x, y because\n        //our origin starts at the top left\n        var position = this.editor.positionFromClientToMarkups(x, y);\n        var setPosition = new SetPosition(this.editor, this.markup, position);\n        setPosition.execute();\n        return true;\n    };\n\n    proto._onRepositionMouseUp = function () {\n\n        if (this.markup && this.markup.preventReposition) return;\n\n        this.last = null;\n\n        //this should never be called after the mouse up because we are no longer repositioning\n        this.onMouseMove = function () {/*do nothing*/};\n        this.onMouseUp = function () {/*do nothing*/};\n\n        if(!this.selection.dragging) {\n            return;\n        }\n\n        this.editor.closeActionGroup();\n        this.selection.dragging = false;\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Moving around\n    };\n\n    proto._onResizeMouseDown = function (event) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        var target = event.target;\n\n        //is the target where the mousedown occurred a drag point\n        if (!isDragPoint(target)) {\n            return;\n        }\n\n        //keep a reference to the point where the drag started\n        this.selection.handle.resizing = target;\n        //figure out which direction this point should resize\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\n        //set the cursor position for the entire layer\n        this.containingDiv.style.cursor = direction + '-resize';\n\n        var cursor = this.editor.getMousePosition();\n\n        var position = this.markup.getClientPosition();\n        var size = this.markup.getBoundingRect();\n\n        //store the center\n        this.initial = {\n            x: position.x,\n            y: position.y,\n            width: size.width,\n            height: size.height,\n            mouseX: cursor.x,\n            mouseY: cursor.y\n        };\n\n        this.onMouseMove = this._onResizeMouseMove.bind(this);\n        this.onMouseUp = this._onResizeMouseUp.bind(this);\n\n        if (this.selection.resizing) {\n            return;\n        }\n\n        this.selection.resizing = true;\n        this.editor.beginActionGroup();\n\n        setHandleSelected(event.target, true);\n\n        //notify the markup that dragging has started\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Resizing\n    };\n\n    proto._onResizeMouseMove = function (event) {\n\n        if (!this.selection.resizing) return false;\n\n        var cursor = this.editor.getMousePosition();\n        var initial = this.initial;\n\n        var movement = {\n            x: cursor.x - initial.mouseX,\n            y: cursor.y - initial.mouseY\n        };\n\n        var vector = new THREE.Vector3(movement.x, movement.y, 0);\n        var undoRotation = new THREE.Matrix4().makeRotationZ(-this.selection.rotation);\n        movement = vector.applyMatrix4(undoRotation);\n\n        var x = initial.x,\n            y = initial.y,\n            width = initial.width,\n            height = initial.height;\n\n        var localSpaceDelta = new THREE.Vector3();\n\n        //get the direction of the arrow being dragged\n        var direction = this.selection.handle.resizing.getAttribute('data-sdp-handle');\n\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\n        // If shift is pressed, figure aspect ratio is maintained.\n        if (this.editor.input.keepAspectRatio && ['nw', 'ne', 'sw', 'se'].indexOf(direction) !== -1) {\n\n            var delta = new THREE.Vector3(movement.x, movement.y, 0);\n            switch (direction){\n                case 'nw': movement.set(-initial.width,-initial.height, 0); break;\n                case 'ne': movement.set( initial.width,-initial.height, 0); break;\n                case 'sw': movement.set( initial.width,-initial.height, 0); break;\n                case 'se': movement.set( initial.width, initial.height, 0); break;\n            }\n            movement.normalize();\n            movement = delta.projectOnVector(movement);\n        }\n\n        var translations = {\n            n: function () {\n                height -= movement.y;\n                localSpaceDelta.y = movement.y;\n            },\n            s: function () {\n                height += movement.y;\n                localSpaceDelta.y = movement.y;\n            },\n            w: function () {\n                width -= movement.x;\n                localSpaceDelta.x = movement.x;\n            },\n            e: function () {\n                width += movement.x;\n                localSpaceDelta.x = movement.x;\n            },\n            nw: function () {\n                this.n();\n                this.w();\n            },\n            ne: function () {\n                this.n();\n                this.e();\n            },\n            sw: function () {\n                this.s();\n                this.w();\n            },\n            se: function () {\n                this.s();\n                this.e();\n            }\n        };\n\n        translations[direction]();\n\n        // Check if new size is smaller than min width or height\n        if (width <= this.markup.getMinWidth() || height <= this.markup.getMinHeight()) return;\n\n        var redoRotation = new THREE.Matrix4().makeRotationZ(this.selection.rotation);\n        var actualDelta = localSpaceDelta.applyMatrix4(redoRotation);\n\n        var newPos = this.editor.positionFromClientToMarkups(\n            x + (actualDelta.x * 0.5),\n            y + (actualDelta.y * 0.5));\n\n        var newSize = this.editor.sizeFromClientToMarkups(width, height);\n\n        var setSize = new SetSize(this.editor, this.markup, newPos, newSize.x, newSize.y);\n        setSize.execute();\n        return true;\n    };\n\n    function setHandleSelected (handle, isSelected) {\n        if (isSelected) {\n            handle.classList.add('selected');\n        } else {\n            handle.classList.remove('selected');\n        }\n    }\n\n    proto._onResizeMouseUp = function (event) {\n        this.selection.resizing = false;\n        this.selection.handle.resizing = null;\n        this.containingDiv.style.cursor = '';\n\n        for (var direction in this.selection.handle) {\n            if (this.selection.handle[direction]) {\n                setHandleSelected(this.selection.handle[direction], false);\n            }\n        }\n\n\n        this.editor.closeActionGroup();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Resizing\n\n        //this should never be called after the mouse up because we are no longer resizing\n        this.onMouseMove = function () {/*do nothing*/\n        };\n        this.onMouseUp = function () {/*do nothing*/\n        };\n    };\n\n\n    /**\n     * Attaches all the necessary listeners to handle a resizing action.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionBoxResizing() {\n        this.selectionLayer.addEventListener('mousedown', this._onResizeMouseDown.bind(this));\n    }\n\n    function handleSelectionBoxRotating () {\n\n        this.selection.element.addEventListener('mousedown', this._onRotationMouseDown.bind(this));\n    }\n\n    var initialRotation;\n    var initialHandlePosition;\n\n    proto._onRotationMouseDown = function (event) {\n\n        if (this._handleRightClickDown(event))\n            return;\n\n        //ignore anything not coming from the rotation point\n        if (!isRotatePoint(event.target)) return;\n\n        this.editor.beginActionGroup();\n        this.selection.rotating = true;\n\n        //store the initial cursor\n        initialHandlePosition = this.editor.getMousePosition();\n\n        initialRotation = this.selection.rotation || 0;\n\n        //update the function that will handle the mousemove and mouseup events\n        this.onMouseMove = this._onRotationMouseMove.bind(this);\n        this.onMouseUp = this._onRotationMouseUp.bind(this);\n\n        setHandleSelected(event.target, true);\n\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_START }); // Rotating\n    };\n\n     proto._onRotationMouseMove = function (event) {\n\n        //ignore mousemove events if the dragging state hasn't been activated\n        if (!this.selection.rotating) return false;\n\n        var cursor = this.editor.getMousePosition();\n        var position = this.markup.getClientPosition();\n\n        var r = getAngleBetweenPoints(position, cursor);\n        var r2 = getAngleBetweenPoints(position, initialHandlePosition);\n        var rotation = r - r2 + initialRotation;\n\n        // TODO: Make a mechanism to configure and use this feature from Markups Core.\n        if (this.editor.input.snapRotations) {\n            var snap = degreesToRadians(22.5);\n            rotation = Math.ceil(rotation / snap) * snap;\n        }\n\n         //pass rotation as degrees\n         updateSelectorBoxPosition.bind(this)(this.selection.x, this.selection.y, rotation);\n\n        //convert to radians\n        var setRotation = new SetRotation(this.editor, this.markup, rotation);\n        setRotation.execute();\n        return true;\n    };\n\n    proto._onRotationMouseUp = function (event) {\n\n        this.selection.rotating = false;\n        initialRotation = null;\n        initialHandlePosition = null;\n        setHandleSelected(this.selection.rotationHandle, false);\n        this.editor.closeActionGroup();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITFRAME_EDITION_END }); // Rotating\n    };\n\n    /**\n     * Attaches double click listener and pass events to markup, markups such as text use it to enter text edit\n     * mode.\n     *\n     * @this EditFrame\n     */\n    function handleSelectionDoubleClick() {\n\n        var doubleClick = function (event) {\n            if (event.defaultPrevented) {\n                return;\n            }\n            this.selection.dragging = false;\n            var editMode = this.editor.editMode;\n            editMode && editMode.onMouseDoubleClick(this.markup);\n        }.bind(this);\n\n        var selectorBoxWrapper = this.selectionLayer;\n        selectorBoxWrapper.addEventListener('dblclick', doubleClick);\n    }\n\n    function togglePointerEvents(element, state) {\n\n        element.style.pointerEvents = state ? 'auto' : 'none';\n    }\n\n    function getAngleBetweenPoints (p1, p2) {\n\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    }\n\n     function matchesSelectorAux(domElem, selector) {\n         if (domElem.matches) return domElem.matches(selector); //Un-prefixed\n         if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\n         if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\n         if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\n         return false;\n     }\n","'use strict';\n\n    var avp = Autodesk.Viewing.Private;\n\n    export function MarkupTool() {\n\n        Autodesk.Viewing.ToolInterface.call(this);\n        this.names = [\"markups.core\"];\n        this.panTool = null;\n        this.allowNav = false;\n        this.is2d = false;\n\n        this.coreExt = null;\n        this.hotkeysEnabled = true;\n\n        var _ctrlDown = false;\n        var _shiftDown = false;\n\n        // Non-ToolInterface methods //\n\n        this.allowNavigation = function(allow) {\n            this.allowNav = allow;\n        };\n        this.setCoreExtension = function(coreExt) {\n            this.coreExt = coreExt;\n        };\n        this.setHotkeysEnabled = function(enabled) {\n            this.hotkeysEnabled = enabled;\n        };\n\n\n        // ToolInterface methods //\n\n        this.activate = function(name, viewerApi) {\n            this.panTool = viewerApi.toolController.getTool(\"pan\");\n            if (this.panTool) {\n                this.panTool.activate(\"pan\"); // TODO: What if we want \"zoom\" here?\n            }\n\n            this.is2d = viewerApi.model.is2d();\n            this.viewer = viewerApi;\n        };\n\n        this.deactivate = function(name) {\n            if (this.panTool) {\n                this.panTool.deactivate(\"pan\");\n            }\n        };\n\n        this.handleKeyDown = function(event, keyCode) {\n\n            if (!this.coreExt.editMode) {\n                return false;\n            }\n\n            if (!this.hotkeysEnabled) {\n                return true; // Consume event\n            }\n\n            // Don't propagate key handling down to tool //\n\n            switch (keyCode) {\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = true; break;\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = true; break;\n\n                case Autodesk.Viewing.KeyCode.x: _ctrlDown && !this.allowNav && this.coreExt.cut(); break;\n                case Autodesk.Viewing.KeyCode.c: _ctrlDown && !this.allowNav && this.coreExt.copy(); break;\n                case Autodesk.Viewing.KeyCode.v: _ctrlDown && !this.allowNav && this.coreExt.paste(); break;\n                case Autodesk.Viewing.KeyCode.d:\n                    if (_ctrlDown && !this.allowNav) {\n                        // Duplicate\n                        this.coreExt.copy();\n                        this.coreExt.paste();\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.z:\n                    if (_ctrlDown && !_shiftDown && !this.allowNav) {\n                        this.coreExt.undo();\n                    }\n                    else if (_ctrlDown && _shiftDown && !this.allowNav) {\n                        this.coreExt.redo(); // Also support Ctrl+Y\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.y: _ctrlDown && !this.allowNav && this.coreExt.redo(); break; // Also support ctrl+shift+z\n                case Autodesk.Viewing.KeyCode.ESCAPE: this.coreExt.onUserCancel(); break;\n\n                case Autodesk.Viewing.KeyCode.BACKSPACE: // Fall through\n                case Autodesk.Viewing.KeyCode.DELETE:\n                    var selectedMarkup = this.coreExt.getSelection();\n                    if (selectedMarkup) {\n                        this.coreExt.deleteMarkup(selectedMarkup);\n                    }\n                    break;\n                case Autodesk.Viewing.KeyCode.F12:\n                    return false; // To allow opening developer console.\n                    break;\n                default: break;\n            }\n\n            return true; // Consume event\n        };\n        this.handleKeyUp = function(event, keyCode) {\n\n            if (!this.coreExt.editMode) {\n                return false;\n            }\n\n            if (!this.hotkeysEnabled) {\n                return true; // Consume event\n            }\n\n            // Don't propagate key handling down to tool\n\n            switch (keyCode) {\n                case Autodesk.Viewing.KeyCode.CONTROL: _ctrlDown = false; break;\n                case Autodesk.Viewing.KeyCode.SHIFT: _shiftDown = false; break;\n                default: break;\n            }\n\n            return true; // Consume event ONLY\n        };\n\n        this.update = function() {\n            if (this.allowNav && this.panTool && this.panTool.update) {\n                return this.panTool.update();\n            }\n            return false;\n        };\n\n        this.handleSingleClick = function( event, button ) {\n            if (this.allowNav) {\n                // If pan tool won't handle single click, then pass over the event.\n                if (this.panTool && this.panTool.handleSingleClick)\n                    return this.panTool.handleSingleClick(event, button);\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleDoubleClick = function( event, button ) {\n            if (this.allowNav) {\n                // If pan tool won't handle double click, then pass over the event\n                if (this.panTool && this.panTool.handleDoubleClick) {\n                    return this.panTool.handleDoubleClick(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleSingleTap = function( event ) {\n            if (this.allowNav) {\n                // If pan tool won't handle single tap, then pass over the event\n                if (this.panTool && this.panTool.handleSingleTap) {\n                    return this.panTool.handleSingleTap(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleDoubleTap = function( event ) {\n            if (this.allowNav) {\n                // If pan tool won't handle double tap, then pass over the event\n                if (this.panTool && this.panTool.handleDoubleTap) {\n                    return this.panTool.handleDoubleTap(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleWheelInput = function(delta, event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle wheel input, then pass over the event\n                if (this.panTool && this.panTool.handleWheelInput) {\n                    this.coreExt.callSnapperMouseMove();\n                    return this.panTool.handleWheelInput(delta, event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleButtonDown = function(event, button) {\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\n                // If pan tool won't handle button down, then pass over the event\n                if (this.panTool && this.panTool.handleButtonDown) {\n                    return this.panTool.handleButtonDown(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleButtonUp = function(event, button) {\n            if (this.allowNav || (this.is2d && (avp.isRightClick(event, this.viewer.navigation) || avp.isMiddleClick(event)))) {\n                // If pan tool won't handle button up, then pass over the event\n                if (this.panTool && this.panTool.handleButtonUp) {\n                    return this.panTool.handleButtonUp(event, button);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleMouseMove = function(event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle button move, then pass over the event\n                if (this.panTool && this.panTool.handleMouseMove) {\n                    return this.panTool.handleMouseMove(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleGesture = function(event) {\n            if (this.allowNav || this.is2d) {\n                // If pan tool won't handle gesture, then pass over the event\n                if (this.panTool && this.panTool.handleGesture) {\n                    return this.panTool.handleGesture(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n        this.handleBlur = function(event) {\n            if (this.allowNav) {\n                // If pan tool won't handle blur, then pass over the event\n                if (this.panTool && this.panTool.handleBlur) {\n                    return this.panTool.handleBlur(event);\n                }\n                else\n                    return false;\n            }\n            return true; // Consume event\n        };\n    }\n","\n// Maps EditMode id (string) into a contructor/class\nvar _editModes = {};\n\nclass EditModeManager {\n    constructor(){\n        // nothing //\n    }\n\n    register(id, clazz) {\n        if (id in _editModes)\n            throw new Error(`EditMode with id (${id}) already registered.`);\n        \n            _editModes[id] = clazz;\n    }\n\n    unregister(id) {\n        if (id in _editModes)\n            delete _editModes[id];\n    }\n\n    getClass(id) {\n        return _editModes[id] || null;\n    }\n\n    getRegistered() {\n        var ret = {}\n        for (var id in _editModes) {\n            if (_editModes.hasOwnProperty(id)) {\n                ret[id] = _editModes[id];\n            }\n        }\n        return ret; // shallow copy.\n    }\n}\n\n\nexport var theEditModeManager =  new EditModeManager();","\nimport { theEditModeManager } from '../EditModeManager'\nimport * as MarkupTypes from '../MarkupTypes'\n\nimport { EditModeArrow } from './EditModeArrow'\nimport { EditModeText } from './EditModeText'\nimport { EditModeRectangle } from './EditModeRectangle'\nimport { EditModeCircle } from './EditModeCircle'\nimport { EditModeCloud } from './EditModeCloud'\nimport { EditModeFreehand } from './EditModeFreehand'\nimport { EditModeHighlight } from './EditModeHighlight'\nimport { EditModePolyline } from './EditModePolyline'\nimport { EditModePolycloud } from './EditModePolycloud'\nimport { EditModeCallout } from './EditModeCallout'\nimport { EditModeDimension } from './EditModeDimension'\nimport { EditModeStamp } from './EditModeStamp'\n\n\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_ARROW, EditModeArrow);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_TEXT, EditModeText);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_RECTANGLE, EditModeRectangle);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CIRCLE, EditModeCircle);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CLOUD, EditModeCloud);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_FREEHAND, EditModeFreehand);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_HIGHLIGHT, EditModeHighlight);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYLINE, EditModePolyline);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_POLYCLOUD, EditModePolycloud);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_CALLOUT, EditModeCallout);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_DIMENSION, EditModeDimension);\ntheEditModeManager.register(MarkupTypes.MARKUP_TYPE_STAMP, EditModeStamp);\n\n","'use strict';\n\nimport { EditActionManager } from './edit-actions/EditActionManager';\nimport * as MarkupEvents from './MarkupEvents';\nimport * as MarkupTypes from './MarkupTypes';\nimport { addTraitEventDispatcher, createSvgElement, setSvgParentAttributes,\n    MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,\n    hideLmvUi, restoreLmvUi, dismissLmvHudMessage, \n    removeAllMetadata, transferChildNodes, addSvgMetadata,\n    svgNodeToString, checkPolygon, stringToSvgNode, createMarkupFromSVG,\n    worldToClient, clientToWorld } from './MarkupsCoreUtils';\nimport { cloneStyle, copyStyle, createStyle } from './StyleUtils';\nimport { DomElementStyle } from './DomElementStyle';\nimport { Clipboard } from './edit-clipboard/Clipboard';\nimport { InputHandler } from './edit-input/InputHandler';\nimport { EditFrame } from './EditFrame';\nimport { MarkupTool } from './MarkupTool';\nimport { EditModeArrow } from './edit-modes/EditModeArrow';\n\nimport './edit-modes/BuiltinEditModes'; // IMPORTANT!! HAS SIDE EFFECTS\nimport './Markups.css'; // IMPORTANT!!\n\n\n    var MeasureCommon = Autodesk.Viewing.MeasureCommon;\n\n    var PERSPECTIVE_MODE_SCALE = 1000;\n\n    /**\n     * Extension that allows end users to draw 2D markups on top of 2D and 3D models.\n     *\n     * @tutorial feature_markup\n     * @param {Autodesk.Viewing.Viewer3D} viewer - Viewer instance used to operate on.\n     * @param {object} options - Same Dictionary object passed into {@link Autodesk.Viewing.Viewer3D|Viewer3D}'s constructor.\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}.\n     * @param {boolean} [options.markupDisableHotkeys] - Disables hotkeys for copy, cut, paste, duplicate, undo, redo and deselect.\n     * @param {Autodesk.Viewing.ToolInterface} [options.markupToolClass] - Class override for input handling.\n     * Use it to override/extend default hotkeys and/or mouse/gesture input.\n     * @memberof Autodesk.Viewing.Extensions.Markups.Core\n     * @class\n     */\n    export function MarkupsCore(viewer, options) {\n\n        Autodesk.Viewing.Extension.call(this, viewer, options);\n\n        this.options = this.options || {};\n        this.markups = [];\n        this.styles = {};\n\n        this.activeLayer = '';\n        this.duringViewMode = false;\n        this.duringEditMode = false;\n\n        this.svgLayersMap = {};\n\n        // Add action manager.\n        this.actionManager = new EditActionManager( 50 ); // history of 50 actions.\n        this.actionManager.addEventListener(MarkupEvents.EVENT_HISTORY_CHANGED, this.onEditActionHistoryChanged.bind(this));\n\n        this.nextId = 0; // Used to identify markups by id during an edit session.\n\n        // Clipboard.\n        this.clipboard = new Clipboard(this);\n\n        // Default Input handler.\n        this.input = new InputHandler();\n        this.input.setGlobalManager(this.globalManager);\n\n        // Bind functions so they have access to globalManager\n        this.createSvgElement = createSvgElement.bind(this);\n        this.addSvgMetadata = addSvgMetadata.bind(this);\n        this.checkPolygon = checkPolygon.bind(this);\n\n        // Extension will dispatch events.\n        addTraitEventDispatcher(this);\n\n        const initStrokeAndFontWidths = (model) => {\n            // For 2d, set these widths once, and not recalculate again\n            if (model.is2d()) {\n                this.getStrokeWidth();\n                this.getFontWidth();\n            }\n        };\n\n        if (viewer.model) {\n            initStrokeAndFontWidths(viewer.model);\n        } else {\n            // Camera is reset right after a model load\n            // This is the right camera to use for widths initialization\n            viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT, ({ model }) => {\n                viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, () => {\n                    initStrokeAndFontWidths(model);\n                }, { once: true });\n            }, { once: true });\n        }\n\n        // Handled events.\n        this.onCameraChangeBinded = this.onCameraChange.bind(this);\n        this.onViewerResizeBinded = function(event) {\n            // This is ugly, but we need to do this twice\n            var self = this;\n            // First usage is to avoid a blinking scenario\n            self.onViewerResize(event);\n            requestAnimationFrame(function(){\n                // Second one is to actually make it work on some resize scenarios.\n                // Check the unlikely scenario that we are no longer in view mode.\n                if (self.duringViewMode) {\n                    self.onViewerResize(event);\n                }\n            });\n        }.bind(this);\n\n        this.onMarkupSelectedBinded = this.onMarkupSelected.bind(this);\n        this.onMarkupEnterEditionBinded = this.onMarkupEnterEdition.bind(this);\n        this.onMarkupCancelEditionBinded = this.onMarkupCancelEdition.bind(this);\n        this.onMarkupDeleteEditionBinded = this.onMarkupDeleteEdition.bind(this);\n        this.onToolChangeBinded = this.onToolChange.bind(this);\n        this.onUnitsCalibrationStartsBinded = this.onUnitsCalibrationStarts.bind(this);\n\n        viewer.addEventListener(MeasureCommon.Events.UNITS_CALIBRATION_STARTS_EVENT, this.onUnitsCalibrationStartsBinded);\n    }\n\n    MarkupsCore.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\n    MarkupsCore.prototype.constructor = MarkupsCore;\n\n    var proto = MarkupsCore.prototype;\n\n    proto.load = async function () {\n\n        // Add layer where annotations will actually live\n        var svg = this.svg = this.createSvgElement('svg');\n        setSvgParentAttributes(svg);\n\n        // NOTE: Required since LMV renders Y coordinates upwards,\n        // while browser's Y coordinates goes downwards.\n        var svgStyle = new DomElementStyle();\n        svgStyle.setAttribute('position', 'absolute');\n        svgStyle.setAttribute('left', '0');\n        svgStyle.setAttribute('top', '0');\n        svgStyle.setAttribute('transform', 'scale(1,-1)', { allBrowsers: true});\n        svgStyle.setAttribute('transformOrigin', '0, 0', { allBrowsers: true});\n        svg.setAttribute('style', svgStyle.getStyleString());\n\n        this.bounds = {x:0, y:0, width:0, height:0};\n\n        this.input.attachTo(this);\n\n        //Instantiate edit frame.\n        this.editFrame = new EditFrame(this.viewer.container, this);\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_START, function(){this.disableMarkupInteractions(true);}.bind(this));\n        this.editFrame.addEventListener(MarkupEvents.EVENT_EDITFRAME_EDITION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\n\n        // Register tool\n        var toolClass = this.options.markupToolClass || MarkupTool;\n        this.changeMarkupTool(toolClass, !this.options.markupDisableHotkeys);\n\n        await this.viewer.loadExtension('Autodesk.Snapping');\n\n        this.snapper = new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer, {markupMode:true});\n        this.viewer.toolController.registerTool(this.snapper);\n\n        return true;\n    };\n\n    /**\n     * Change the markup tool's class in order to implement a different behaviour to the UI.\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.MarkupTool} toolClass - Implementation or extension of MarkupTool's class.\n     * @param {boolean} enableHotKeys - Whether to enable markup's hot-keys or not.\n     */\n    proto.changeMarkupTool = function(toolClass, enableHotKeys) {\n        if (this.markupTool) {\n            this.viewer.toolController.deregisterTool(this.markupTool);\n            this.markupTool = null;\n        }\n\n        this.markupTool = new toolClass();\n        this.markupTool.setCoreExtension(this);\n        this.markupTool.setHotkeysEnabled(enableHotKeys);\n        this.viewer.toolController.registerTool(this.markupTool);\n    };\n\n    proto.unload = function() {\n\n        this.hide();\n\n        this.input.detachFrom(this);\n\n        this.editFrame.unload();\n\n        if (this.markupTool) {\n            this.viewer.toolController.deregisterTool(this.markupTool);\n            this.markupTool = null;\n        }\n\n        if (this.snapper) {\n            this.viewer.toolController.deregisterTool(this.snapper);\n            this.snapper = null;\n        }\n\n        var svg = this.svg;\n        if (svg && this.onMouseDownBinded) {\n            svg.removeEventListener(\"mousedown\", this.onMouseDownBinded);\n            this.onMouseDownBinded = null;\n        }\n        if (svg.parentNode) {\n            svg.parentNode.removeChild(svg);\n        }\n        this.editModeSvgLayerNode = null;\n        this.svg = null;\n\n        return true;\n    };\n\n    MarkupsCore.prototype.getStrokeWidth = function() {\n        \n        if (!this.initialStrokeWidth || (this.viewer.model && !this.viewer.model.is2d())) {\n            this.initialStrokeWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS).y;\n        }\n\n        return this.initialStrokeWidth;\n    };\n\n    MarkupsCore.prototype.getFontWidth = function() {\n        \n        if (!this.initialFontWidth || (this.viewer.model && !this.viewer.model.is2d())) {\n            this.initialFontWidth = this.sizeFromClientToMarkups(0, MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS).y;\n        }\n\n        return this.initialFontWidth;\n    };\n\n    /**\n     * Toggle in and out of Edit mode. In Edit mode the user is able to draw markups on the canvas.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}\n     */\n    MarkupsCore.prototype.toggleEditMode = function() {\n\n        if (this.duringEditMode) {\n            this.leaveEditMode();\n        } else {\n            this.enterEditMode();\n        }\n    };\n\n    /**\n     * Enables mouse interactions and mobile device gestures over the Viewer canvas to create or draw markups.\n     *\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#leaveEditMode|leaveEditMode()}.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\n     *\n     * @param {string} layerId - [optional] Identifier for the layer of markups to be edited. Example \"Layer1\".\n     * @returns {boolean} Returns true if editMode is active\n     */\n    MarkupsCore.prototype.enterEditMode = function(layerId) {\n\n        /**\n         * @param layer\n         * @param disable\n         * @private\n         */\n        function disableLayerMarkups(layer, disable){\n            if (layer){\n                var layerMarkups = layer.markups;\n                for (var k = 0; k < layerMarkups.length; k++){\n                    var m = layerMarkups[k];\n                    m.disableInteractions(disable);\n                }\n            }\n        }\n        if (layerId) {\n            if (!this.svgLayersMap[layerId]) {\n                // if layerId is supplied but it does not exist in the svgLayerMap then create the new layer\n                console.warn(\"No such layer exists.\");\n                return false;\n            }\n        }\n\n        // If not currently shown, then show\n        if (!this.duringViewMode) {\n            if (!this.show()){\n                return false; // Failed to enter view mode.\n            }\n        }\n\n        // Initialize the edit mode layer if it does not exist\n        if(!this.editModeSvgLayerNode) {\n            var parSvg = this.createSvgElement('g');\n            this.editModeSvgLayerNode = {\n                markups: [],\n                svg: parSvg\n            };\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', 'default');\n        }\n\n\n        if ((this.editModeSvgLayerNode.svg.parentNode != this.svg) || !layerId) {\n            this.svg.appendChild(this.editModeSvgLayerNode.svg);\n        }\n        this.svg.setAttribute('cursor', 'crosshair');\n\n\n        if (layerId) {\n            var layer = this.svgLayersMap[layerId];\n            // If the layer exists in the layer map, use the information stored for that specific layer.\n            if (layer) {\n                // Remove the edit layer when entering edit mode of a specific edit mode.\n                var editModeLayerParentNode = this.editModeSvgLayerNode.svg.parentNode;\n                editModeLayerParentNode && editModeLayerParentNode.removeChild(this.editModeSvgLayerNode.svg);\n\n                // disable the markups in the editModeLayer\n                disableLayerMarkups(this.editModeSvgLayerNode, true);\n\n                // Enable interactions for markups in the current edit layer and disable interactions for markups in\n                // the other layers.\n                for (var key in this.svgLayersMap){\n                    var markups = this.svgLayersMap[key].markups;\n                    for (var i = 0; i < markups.length; i++) {\n                        var markup = markups[i];\n                        if (key !== layerId.toString()){\n                            // disable all not in the current layer.\n                            markup.disableInteractions(true);\n                        } else {\n                            // enable all markups in current layer.\n                            markup.disableInteractions(false);\n                        }\n                    }\n                }\n\n                // assign the current layer to the global active layer\n                this.activeLayer = layerId;\n                this.editingLayer = layerId;\n                var svgParent = layer.svg;\n\n                // remove previous svg layer child from svg\n                svgParent.parentNode && this.svg.removeChild(svgParent);\n\n                // reassign the markups in that layer to the global markups list\n                this.markups = layer.markups.slice();\n\n                // re-append svg layer child to svg to make it the top most layer\n                this.svg.appendChild(svgParent);\n            }\n        } else {\n            // disable interactions for the previous markups\n            // Example: enterEditMode(layer) -> enterEditMode()\n            if (this.editingLayer) {\n                for (var k = 0; k < this.markups.length; k++) {\n                    var m = this.markups[k];\n                    m.disableInteractions(true);\n                }\n                disableLayerMarkups(this.editModeSvgLayerNode, false);\n            }\n            this.editingLayer = '';\n            if (!this.editModeSvgLayerNode) {\n                this.markups = [];\n            }else{\n                this.markups = this.editModeSvgLayerNode.markups.slice();\n            }\n            this.activeLayer = '';\n        }\n\n        this.input.enterEditMode();\n        this.activateTool(true);\n        this.styles = {}; // Clear EditMode styles.\n        this.defaultStyle = null;\n        this.duringEditMode = true;\n        this.changeEditMode(new EditModeArrow(this));\n        this.actionManager.clear();\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_ENTER });\n        this.allowNavigation(false);\n        return true;\n    };\n\n    /**\n     * Exits Edit mode.\n     *\n     * See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\n     *\n     * @returns {boolean} Returns true if Edit mode has been deactivated\n     */\n    MarkupsCore.prototype.leaveEditMode = function() {\n\n        var NOT_IN_EDIT_MODE = true;\n        var WE_ARE_STILL_IN_EDIT_MODE = false;\n\n        if (!this.duringEditMode || !this.duringViewMode) {\n            return NOT_IN_EDIT_MODE;\n        }\n\n        var viewer = this.viewer;\n        if (!viewer) {\n            return WE_ARE_STILL_IN_EDIT_MODE; // something is very wrong...\n        }\n\n        this.editMode.destroy();\n        this.editMode = null;\n        this.duringEditMode = false;\n\n        if (this.snapper) {\n            this.snapper.indicator.clearOverlays();\n            this.snapper.clearSnapped();\n        }\n\n        // Remove the edit layer\n        if (this.editModeSvgLayerNode && this.editModeSvgLayerNode.svg.parentNode){\n            this.svg.removeChild(this.editModeSvgLayerNode.svg);\n        }\n        this.svg.setAttribute('cursor', 'default');\n\n        this.input.leaveEditMode();\n        this.editFrame.setMarkup(null);\n        this.activateTool(true);\n\n        this.allowNavigation(true);\n        this.dispatchEvent({ type: MarkupEvents.EVENT_EDITMODE_LEAVE });\n        return NOT_IN_EDIT_MODE;\n    };\n\n    /**\n     * Toggle between visible markups, i.e., show() and hidden markups, i.e., hide().\n     */\n    MarkupsCore.prototype.toggle = function() {\n\n        if (this.duringViewMode) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    };\n\n    /**\n     * Enables loading of previously saved markups.\n     * Exit Edit mode by calling {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\n     *\n     * @returns {boolean} Whether it successfully entered view mode or not.\n     */\n    MarkupsCore.prototype.show = function() {\n\n        var viewer = this.viewer;\n        if (!viewer || !viewer.model || !this.svg) {\n            return false;\n        }\n\n        // Return if already showing or in edit-mode.\n        // Notice that edit mode requires that we are currently show()-ing.\n        if (this.duringViewMode || this.duringEditMode) {\n            return true;\n        }\n\n        viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\n        viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\n\n        // Add parent svg of all markups.\n        viewer.container.appendChild(this.svg);\n        viewer.reorderElements(this.svg);\n\n        this.input.enterViewMode();\n        hideLmvUi(viewer);\n\n        // TODO: Nasty hack, currently there is no API to disable mouse highlighting in 3d models.\n        // TODO: We nuke rollover function in viewer, for now, public api will be added soon.\n        this.onViewerRolloverObject = viewer.impl.rolloverObject;\n        viewer.impl.rolloverObject = function(){};\n\n        this.activateTool(true);\n        var camera = viewer.impl.camera;\n        this.onViewerResize({ width: camera.clientWidth, height: camera.clientHeight });\n\n        // See function loadMarkups() for when the actual SVG gets added onstage //\n        this.svgLayersMap = {};\n        this.duringViewMode = true;\n        this.allowNavigation(true);\n        return true;\n    };\n\n    /**\n     * Removes any markup currently overlaid on the viewer. It exits Edit mode if it is active.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#show|show()}\n     *\n     * @returns {boolean} Whether it successfully left view mode or not.\n     */\n    MarkupsCore.prototype.hide = function() {\n\n        var RESULT_HIDE_OK = true;\n        var RESULT_HIDE_FAIL = false;\n\n        var viewer = this.viewer;\n        if (!viewer || !this.duringViewMode) {\n            return RESULT_HIDE_OK;\n        }\n\n        if (this.duringEditMode) {\n            if (!this.leaveEditMode()) {\n                return RESULT_HIDE_FAIL;\n            }\n        }\n\n        viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT, this.onCameraChangeBinded);\n        viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT, this.onViewerResizeBinded);\n\n        var svg = this.svg;\n        svg.parentNode && svg.parentNode.removeChild(svg);\n\n        // Remove all Markups and metadata (if any)\n        this.unloadMarkupsAllLayers();\n        removeAllMetadata(svg);\n\n        this.input.leaveViewMode();\n        restoreLmvUi(viewer);\n        this.viewer.impl.rolloverObject = this.onViewerRolloverObject;\n\n        this.activateTool(false);\n        this.duringViewMode = false;\n        return RESULT_HIDE_OK;\n    };\n\n    /**\n     * Removes newly created markups in the current editing layer.\n     * Markups that were created in a specific layer will not be removed.\n     *\n     * Markups should have been added while in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     */\n    MarkupsCore.prototype.clear = function() {\n        // Can only clear specific layers when in the edit mode of that layer.\n        if (!this.duringEditMode) {\n            console.warn(\"Clear only removes markups when in Edit Mode.\");\n            return;\n        }\n        var editModeLayer = this.editingLayer ? this.svgLayersMap[this.editingLayer] : this.editModeSvgLayerNode;\n        if (editModeLayer) {\n            var markups = editModeLayer.markups;\n            var svg = editModeLayer.svg;\n            if (svg && svg.childNodes.length > 0) {\n                while (svg.childNodes.length) {\n                    svg.removeChild(svg.childNodes[0]);\n                }\n            }\n            while (markups.length > 0) {\n                var markup = markups[0];\n                this.removeMarkup(markup);\n                markup.destroy();\n            }\n        }\n    };\n\n    /**\n     * Returns an SVG string with the markups created so far.\n     * The SVG string can be reloaded using\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\n     *\n     * Markups should have been added while in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * @returns {string} Returns an SVG element with all of the created markups in a string format.\n     */\n    MarkupsCore.prototype.generateData = function() {\n\n        var defaultLayer = this.editModeSvgLayerNode.svg;\n\n        if (this.editMode) {\n            this.editMode.onSave();\n        }\n\n        // Sanity check, remove any lingering metadata nodes\n        removeAllMetadata(this.svg);\n\n        if (this.activeLayer){\n            defaultLayer = this.svgLayersMap[this.activeLayer].svg;\n        }\n\n        var tmpNode = this.createSvgElement(\"svg\");\n        transferChildNodes(this.svg, tmpNode); // Transfer includes this.editModeSvgLayerNode\n        transferChildNodes(defaultLayer, this.svg);\n\n        // version 1: first implementation.\n        // version 2: added global offset to markup positions.\n        // version 3: change node structure to include hitareas, hit areas are not exported.\n        // version 4: scale perspective markups space by PERSPECTIVE_MODE_SCALE because bug in firefox. LMV-1150\n        var metadataObject = {\n            \"data-model-version\": \"4\"\n        };\n        var metadataNode = this.addSvgMetadata(this.svg, metadataObject);\n        var metadataNodes = [ metadataNode ];\n\n        // Notify each markup to inject metadata\n        this.markups.forEach(function(markup){\n            var addedNode = markup.setMetadata();\n            if (addedNode) {\n                metadataNodes.push(addedNode);\n            }\n        });\n\n        // Generate the data!\n        var data = svgNodeToString(this.svg);\n\n        // Remove metadataObject before returning\n        metadataNodes.forEach(function(metadataNode){\n            metadataNode.parentNode.removeChild(metadataNode);\n        });\n\n        transferChildNodes(this.svg, defaultLayer);\n        transferChildNodes(tmpNode, this.svg);\n        tmpNode = null; // get rid of it.\n\n        return  data;\n    };\n\n    /**\n     * @private\n     */\n    MarkupsCore.prototype.generatePoints3d = function() {\n\n        var result = {markups: [], main: null};\n        var markups = this.markups;\n        var markupsCount = markups.length;\n\n        if (markupsCount === 0) {\n            return result;\n        }\n\n        // Gather a 3d point for markup.\n        var idTarget = this.viewer.impl.renderer().readbackTargetId();\n        for(let i = 0; i < markupsCount; ++i) {\n\n            var markup = markups[i];\n            var point = markup.generatePoint3d(idTarget) || null;\n            result.markups.push(\n                {\n                    id: markup.id,\n                    type: markup.type,\n                    point: point || null\n                });\n        }\n\n\n        // If there is 3d point associated with an arrow, we use that as main point.\n        if (markupsCount === 1) {\n\n            var main = result.markups[0].point;\n            result.main = main && main.clone();\n            return result;\n        }\n\n        for(let i = 0; i < markupsCount; ++i) {\n\n            var collision = result.markups[i];\n            if (collision.type === MarkupTypes.MARKUP_TYPE_ARROW && collision.point !== null) {\n\n                result.main = collision.point.clone();\n                return result;\n            }\n        }\n\n        // If there is no arrows, we average bounding boxes and get a 3d point inside it.\n        var bbX0 = Number.POSITIVE_INFINITY;\n        var bbY0 = Number.POSITIVE_INFINITY;\n        var bbX1 = Number.NEGATIVE_INFINITY;\n        var bbY1 = Number.NEGATIVE_INFINITY;\n\n        for(let i = 0; i < markupsCount; ++i) {\n\n            var boundingBox = markups[i].generateBoundingBox();\n\n            bbX0 = Math.min(bbX0, boundingBox.min.x);\n            bbY0 = Math.min(bbY0, boundingBox.min.y);\n            bbX1 = Math.max(bbX1, boundingBox.max.x);\n            bbY1 = Math.max(bbY1, boundingBox.max.y);\n        }\n\n        var polygon = {};\n\n        polygon.vertexCount = 4;\n        polygon.xVertices = new Float32Array([bbX0, bbX1, bbX1, bbX0]);\n        polygon.yVertices = new Float32Array([bbY0, bbY0, bbY1, bbY1]);\n\n        var point2d = this.checkPolygon(polygon, idTarget);\n        var point3d = point2d && this.viewer.clientToWorld(point2d.x, point2d.y);\n        result.main = point3d && point3d.point;\n\n        return result;\n    };\n\n    /**\n     * Renders the markups onto a 2D canvas context to generate an image.\n     *\n     * @param {CanvasRenderingContext2D} context - Markups are drawn using the context provided\n     * @param callback\n     * @param renderAllMarkups\n     * @private\n     */\n    MarkupsCore.prototype.renderToCanvas = function(context, callback, renderAllMarkups) {\n\n        var width = this.bounds.width;\n        var height = this.bounds.height;\n        var viewBox = this.getSvgViewBox(width, height);\n        var numberOfScreenshotsTaken = 0;\n        var markups = [];\n        var layer;\n\n        var onMarkupScreenshotTaken = function () {\n            if (callback && (++numberOfScreenshotsTaken === markups.length)) {\n                callback();\n            }\n        }.bind(this);\n\n        if (renderAllMarkups) {\n            var svgKeys = Object.keys(this.svg.childNodes);\n            var layersKeys = Object.keys(this.svgLayersMap);\n\n            // Append only markups that their parent layer is contained inside the svg main container.\n            for (var i = 0; i < svgKeys.length; i++) {                \n                for (var j = 0; j < layersKeys.length; j++) {\n                    layer = this.svgLayersMap[layersKeys[j]];\n                    if (this.svg.childNodes[svgKeys[i]] === layer.svg) {\n                        markups = markups.concat(layer.markups);\n                    }\n                }\n            }\n        } else {\n            layer = this.svgLayersMap[this.activeLayer] || this.editModeSvgLayerNode;\n            markups = layer.markups;\n        }\n\n        if (markups.length === 0) {\n            callback();\n        } else {\n            markups.forEach(function(markup) {\n                markup.renderToCanvas(context, viewBox, width, height, onMarkupScreenshotTaken);\n            });\n        }\n    };\n\n    /**\n     * Changes the active drawing tool. For example, from the Arrow drawing tool to the Rectangle drawing tool.\n     * Only applicable while in {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * Supported values are:\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeArrow(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeRectangle(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCircle(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeCloud(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeText(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModeFreehand(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolyline(MarkupsCoreInstance)`\n     * - `new Autodesk.Viewing.Extensions.Markups.Core.EditModePolycloud(MarkupsCoreInstance)`\n     *\n     * This function fires event `Autodesk.Viewing.Extensions.Markups.Core.EVENT_EDITMODE_CHANGED`.\n     *\n     * @param {object} editMode - Object instance for the drawing tool\n     */\n    MarkupsCore.prototype.changeEditMode = function(editMode) {\n\n        var oldEditMode = this.editMode;\n        oldEditMode && oldEditMode.destroy();\n\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_BEGIN, function() {this.disableMarkupInteractions(true);}.bind(this));\n        editMode.addEventListener(MarkupEvents.EVENT_EDITMODE_CREATION_END, function(){this.disableMarkupInteractions(false);}.bind(this));\n        editMode.addEventListener(MarkupEvents.EVENT_MARKUP_DESELECT, function(event){this.dispatchEvent(event);}.bind(this));\n\n        this.editMode = editMode;\n        this.styles[editMode.type] = cloneStyle(editMode.getStyle());\n\n        this.dispatchEvent({type:MarkupEvents.EVENT_EDITMODE_CHANGED, target: editMode});\n    };\n\n    /**\n     * Check whether a user can perform camera navigation operations on the current loaded model.\n     * While the extension is active, the user can still draw markups.\n     * Panning and zooming are only supported for orthographic cameras.\n     *\n     * @returns {boolean} Whether {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#allowNavigation|allowNavigation()} can succeed.\n     */\n    MarkupsCore.prototype.isNavigationAllowed = function() {\n\n        return !this.viewer.impl.camera.isPerspective;\n    };\n\n    /**\n     * Enables click, tap, and swipe behavior to allow camera zoom and panning operations. It is only available in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * @param {boolean} allow - Whether camera navigation interactions are active or not.\n     */\n    MarkupsCore.prototype.allowNavigation = function(allow) {\n\n        //we will still need to update the markup styles even if in perspective mode\n        var editMode = this.editMode;\n        this.navigating = allow;\n\n        if (allow){\n            this.svg.setAttribute(\"pointer-events\", \"none\");\n            editMode && this.selectMarkup(null);\n        } else {\n            this.svg.setAttribute(\"pointer-events\", \"painted\");\n        }\n\n        // Update pointer events for all markups.\n        var markups = this.markups;\n        var markupsCount = markups.length;\n\n        for(var i = 0; i < markupsCount; ++i) {\n            markups[i].updateStyle();\n        }\n        editMode && editMode.notifyAllowNavigation(allow);\n\n        // Navigation is not allowed while in perspective mode.\n        if (allow && (this.duringEditMode || this.duringViewMode) && !this.isNavigationAllowed()) {\n            return false;\n        }\n\n        // Clear snapper.\n        if (allow && this.snapper) {\n            this.snapper.indicator.clearOverlays();\n            this.snapper.clearSnapped();\n        }\n\n        this.markupTool.allowNavigation(allow);\n\n    };\n\n    /**\n     * Sets mouse interactions and mobile device gestures with markups. Only applicable in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * @param {boolean} disable - true to disable interactions with markups; false to enable interactions with markups; default false.\n     */\n    MarkupsCore.prototype.disableMarkupInteractions = function(disable) {\n\n        if (this.editModeSvgLayerNode) {\n            this.editModeSvgLayerNode.svg.setAttribute('cursor', disable ? 'inherit' : 'default');\n        }\n        this.markups.forEach(function(markup) {markup.disableInteractions(disable);});\n    };\n\n    /**\n     *\n     * @param isActive\n     * @private\n     */\n    MarkupsCore.prototype.activateTool = function(isActive) {\n        if (isActive) {\n            if (!this.cachedNavigationTool) {\n                this.cachedNavigationTool = this.viewer.getActiveNavigationTool();\n                this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\n            }\n            this.viewer.setActiveNavigationTool(this.markupTool.getName());\n        } else {\n\n            if (this.cachedNavigationTool) {\n                this.viewer.setActiveNavigationTool(this.cachedNavigationTool);\n                this.cachedNavigationTool = null;\n            } else {\n                var defaultToolName = this.viewer.getDefaultNavigationToolName();\n                this.viewer.setActiveNavigationTool(defaultToolName);\n            }\n\n            this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT, this.onToolChangeBinded);\n        }\n    };\n\n    /**\n     *\n     * @param event\n     * @private\n     */\n    MarkupsCore.prototype.onToolChange = function(event) {\n\n        if (event.toolName !== this.markupTool.getName())\n            return;\n\n        if (event.active) {\n            var navAllowed = this.isNavigationAllowed();\n            this.viewer.setNavigationLockSettings({\n                pan      : navAllowed,\n                zoom     : navAllowed,\n                orbit    : false,\n                roll     : false,\n                fov      : false,\n                walk     : false,\n                gotoview : false\n            });\n        }\n        this.viewer.setNavigationLock(event.active);\n    };\n\n    MarkupsCore.prototype.onUnitsCalibrationStarts = function() {\n        if (this.duringEditMode) {\n            this.hide();\n        }\n    };\n\n    //// Input /////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    proto.changeInputHandler = function(inputHandler) {\n\n        this.input.detachFrom(this);\n        inputHandler.attachTo(this);\n        this.input = inputHandler;\n\n        if (this.duringEditMode) {\n            inputHandler.enterEditMode();\n        }\n\n        if (this.duringViewMode) {\n            inputHandler.enterViewMode();\n        }\n    };\n\n    //// Copy and Paste System /////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     * Standard copy operation. Applies to any selected markup.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\n     */\n    MarkupsCore.prototype.copy = function() {\n\n        this.clipboard.copy();\n    };\n\n    /**\n     * Standard cut operation. Applies to any selected markup, which gets removed from the screen at call time.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#paste|paste()}.\n     */\n    MarkupsCore.prototype.cut = function() {\n\n        this.clipboard.cut();\n    };\n\n    /**\n     * Standard paste operation. This function will paste any previously copied or cut markup.\n     * Can be called repeatedly after a single copy or cut operation.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#copy|copy()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#cut|cut()}.\n     */\n    MarkupsCore.prototype.paste = function() {\n\n        this.clipboard.paste();\n    };\n\n    //// Undo and Redo System //////////////////////////////////////////////////////////////////////////////////////////\n    /**\n     * Will undo the previous operation.<br>\n     * The Undo/Redo stacks will track any change done to the existing markups.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isUndoStackEmpty|isUndoStackEmpty()}.\n     */\n    MarkupsCore.prototype.undo = function() {\n\n        this.actionManager.undo();\n    };\n\n    /**\n     * Will redo any previously undo operation.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#isRedoStackEmpty|isRedoStackEmpty()}.\n     */\n    MarkupsCore.prototype.redo = function() {\n\n        this.actionManager.redo();\n    };\n\n    /**\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undo()}\n     * produces no changes.\n     *\n     * @returns {boolean} true if there are no changes to undo; false if there are changes to undo.\n     */\n    MarkupsCore.prototype.isUndoStackEmpty = function() {\n\n        return this.actionManager.isUndoStackEmpty();\n    };\n\n    /**\n     * Returns true when {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#redo|redo()}\n     * produces no changes.\n     *\n     * @returns {boolean} true if there are no changes to redo; false if there are changes to redo.\n     */\n    MarkupsCore.prototype.isRedoStackEmpty = function() {\n\n        return this.actionManager.isRedoStackEmpty();\n    };\n\n    proto.beginActionGroup = function() {\n\n        this.actionManager.beginActionGroup();\n    };\n\n    proto.closeActionGroup = function() {\n\n        this.actionManager.closeActionGroup();\n    };\n\n    proto.cancelActionGroup = function() {\n\n        this.actionManager.cancelActionGroup();\n    };\n\n    /**\n     * Helper function for generating unique markup ids.\n     *\n     * @returns {number}\n     */\n    proto.getId = function() {\n\n        return ++this.nextId;\n    };\n\n    /**\n     * @param event\n     * @private\n     */\n    proto.onEditActionHistoryChanged = function(event) {\n\n        var data = event.data;\n        if((data.action !== 'undo' && data.targetId !== -1)) {\n\n            // Markup can be null when deleting, that's ok, we unselect in that case.\n            let markup = this.getMarkup(data.targetId);\n            this.selectMarkup(markup);\n        }\n        if(data.action === 'undo' && !this.isUndoStackEmpty()) {\n\n            let markup = this.getMarkup(this.actionManager.getLastElementInUndoStack().getTargetId());\n            this.selectMarkup(markup);\n        }\n\n        this.dispatchEvent(event);\n    };\n\n    /**\n     * Returns a markup with the specified ID. Returns null when not found.\n     * The ID can be retrieved from the return value of getSelection(). <br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getSelection|getSelection()}.\n     *\n     * @param {string} id Markup identifier.\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup} Returns markup object.\n     */\n    MarkupsCore.prototype.getMarkup = function(id) {\n\n        var markups = this.markups;\n        var markupsCount = markups.length;\n\n        for(var i = 0; i < markupsCount; ++i) {\n            if (markups[i].id == id) {\n                return markups[i];\n            }\n        }\n\n        return null;\n    };\n\n\n    /**\n     * Selects or deselects a markup. A selected markup gets an overlayed UI that allows you to perform transformations\n     * such as resizing, rotations, and translations. To deselect a markup, send a null value. <br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#getMarkup|getMarkup()}.\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} markup The markup instance to select. Set the value to null to deselect a markup.\n     */\n    MarkupsCore.prototype.selectMarkup = function(markup) {\n\n        if (markup) {\n\n            if (this.editMode.type === markup.type) {\n                this.editMode.setSelection(markup);\n            } else {\n\n                var editMode = markup.getEditMode();\n                editMode.setSelection(null);\n\n                this.changeEditMode(editMode);\n                this.setStyle(markup.getStyle());\n                this.editMode.setSelection(markup);\n            }\n        } else {\n            // fix for text markup in view mode\n            if (this.editMode){\n                this.editMode.setSelection(null);\n            }\n        }\n    };\n\n    /**\n     * Returns the currently selected markup. A selected markup has a custom UI overlayed that allows you to perform\n     * resizing, rotations and translations.<br>\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#selectMarkup|selectMarkup()}.\n     *\n     * @returns {Autodesk.Viewing.Extensions.Markups.Core.Markup|null} Returns selected markup object; null if no markup is selected.\n     */\n    MarkupsCore.prototype.getSelection = function() {\n\n        return this.editMode.getSelection();\n    };\n\n    /**\n     * Deletes a markup from the canvas. Only applies while in\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|Edit mode}.\n     *\n     * @param {Autodesk.Viewing.Extensions.Markups.Core.Markup} markup - Markup object.\n     * @param {boolean} [dontAddToHistory] Whether delete action can be {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#undo|undone}.\n     */\n    MarkupsCore.prototype.deleteMarkup = function(markup, dontAddToHistory) {\n\n        if (!this.editMode || (this.editMode && this.editMode.selectedMarkup.id !== markup.id)) {\n            this.editMode = markup.getEditMode();\n        }\n        this.editMode.deleteMarkup(markup, dontAddToHistory);\n    };\n\n    proto.addMarkup = function(markup) {\n\n        var markups;\n        var layer = this.activeLayer;\n        var layerObject = this.svgLayersMap[layer] || '';\n\n        if (layerObject) {\n            var svgParent = layerObject.svg;\n            // append markup svg to layer svg\n            markup.setParent(svgParent);\n            // Add markup to layer markups if it does not exist\n            layerObject.markups.push(markup);\n            markups = layerObject.markups.slice();\n        } else {\n            // if layer is undefined create a edit mode svg layer\n            markup.setParent(this.editModeSvgLayerNode.svg);\n            this.editModeSvgLayerNode.markups.push(markup);\n            markups = this.editModeSvgLayerNode.markups.slice();\n        }\n        \n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\n        markup.addEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\n        // Only set the global markups array when in edit mode\n        if (this.duringEditMode) {\n            this.markups = markups;\n        }\n    };\n\n    /**\n     *\n     * @param markup\n     * @private\n     */\n    proto.removeMarkup = function(markup) {\n\n        if (!markup){\n            return false;\n        }\n        var self = this;\n\n        /**\n         * Get the layer markups in which the markup exists.\n         * This function will remove the markup if it exists in the corresponding layer markups array.\n         *\n         * @param markup\n         * @returns {number} returns -1 if the markup does not exist in a layer markups array\n         */\n        function removeMarkupIfExists(markup){\n            var markupIndex;\n            var layerMarkups = -1;\n            // check if the markup exists in the edit layer\n            if (self.editModeSvgLayerNode){\n                var editLayerMarkups = self.editModeSvgLayerNode.markups;\n                markupIndex = editLayerMarkups.indexOf(markup);\n                if (markupIndex !== -1) {\n                    // remove the markup from the corresponding markup array\n                    editLayerMarkups.splice(markupIndex, 1);\n                    layerMarkups = editLayerMarkups.slice();\n                    // update the global markups array if the markup is in the active layer\n                    if (self.activeLayer === ''){\n                        self.markups = layerMarkups;\n                    }\n                    return layerMarkups;\n                }\n            }\n            // check if the markup exists in a layer\n            if (self.svgLayersMap) {\n                for (var layer in self.svgLayersMap) {\n                    var markups = self.svgLayersMap[layer].markups;\n                    markupIndex = markups.indexOf(markup);\n                    if (markupIndex !== -1) {\n                        // remove the markup from the corresponding markup array\n                        markups.splice(markupIndex, 1);\n                        layerMarkups = markups.slice();\n                        // update the global markups array if the markup is in the active layer\n                        if (self.activeLayer === layer){\n                            self.markups = layerMarkups;\n                        }\n                        return layerMarkups;\n                    }\n                }\n            }\n            return layerMarkups;\n        }\n\n        var layerMarkups = removeMarkupIfExists(markup);\n        if (layerMarkups === -1)\n            return false;\n\n        markup.setParent(null);\n\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelectedBinded);\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_ENTER_EDITION, this.onMarkupEnterEditionBinded);\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_CANCEL_EDITION, this.onMarkupCancelEditionBinded);\n        markup.removeEventListener(MarkupEvents.EVENT_MARKUP_DELETE_EDITION, this.onMarkupDeleteEditionBinded);\n\n        var editMode = this.editMode;\n        if (editMode) {\n            var selectedMarkup = editMode.getSelection();\n            if (selectedMarkup === markup) {\n                this.selectMarkup(null);\n            }\n        }\n    };\n\n    //// Markups style /////////////////////////////////////////////////////////////////////////////////////////////////\n\n    MarkupsCore.prototype.setStyle = function(style) {\n\n        var styles = this.styles;\n        var editMode = this.editMode;\n\n        copyStyle(style, styles[editMode.type]);\n        // copyStyle(styles[editMode.type], style);\n        editMode.setStyle(styles[editMode.type]);\n    };\n\n    MarkupsCore.prototype.getStyle = function() {\n\n        return cloneStyle(this.styles[this.editMode.type]);\n    };\n\n    MarkupsCore.prototype.getDefaultStyle = function() {\n\n        var defaultStyleAttributes = [\n            'stroke-width',\n            'font-size',\n            'font-family',\n            'font-style',\n            'font-weight',\n            'stroke-color',\n            'stroke-opacity',\n            'fill-color',\n            'text-data',\n            'fill-opacity'];\n        this.defaultStyle = this.defaultStyle || createStyle(defaultStyleAttributes, this);\n\n        return this.defaultStyle;\n    };\n\n    //// Markups depth order ///////////////////////////////////////////////////////////////////////////////////////////\n\n    /**\n     *\n     * @param markup\n     * @private\n     */\n    proto.bringToFront = function(markup) {\n\n        this.sendMarkupTo(markup, this.markups.length-1);\n    };\n\n    /**\n     *\n     * @param markup\n     * @private\n     */\n    proto.sendToBack = function(markup) {\n\n        this.sendMarkupTo(markup, 0);\n    };\n\n    /**\n     *\n     * @param markup\n     * @private\n     */\n    proto.bringForward = function(markup) {\n\n        var markupIndex = this.markups.indexOf(markup);\n        this.sendMarkupTo(markup, markupIndex+1);\n    };\n\n    /**\n     *\n     * @param markup\n     * @private\n     */\n    proto.bringBackward = function(markup) {\n\n        var markupIndex = this.markups.indexOf(markup);\n        this.sendMarkupTo(markup, markupIndex-1);\n    };\n\n    /**\n     *\n     * @param markup\n     * @param index\n     * @private\n     */\n    proto.sendMarkupTo = function(markup, index) {\n\n        var markups = this.markups;\n        var markupIndex = markups.indexOf(markup);\n\n        if (markupIndex === -1 || index < 0 || index >= markups.length) {\n            return;\n        }\n\n        markups.splice(markupIndex, 1);\n        index = markupIndex > index ? index -1 : index;\n        markups.splice(index, 0, markup);\n\n        // TODO: Add markup in right position not always at the end.\n        markup.setParent(null);\n        if (this.activeLayer){\n            var parent = this.svgLayersMap[this.activeLayer].svg;\n            markup.setParent(parent);\n        }else {\n            markup.setParent(this.editModeSvgLayerNode.svg);\n        }\n    };\n\n\n    /**\n     * Loads data (SVG string) for all markups in a specified layer (layerId) to the Viewer's canvas.<br>\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\n     *\n     * @param {string} markupString - SVG string with markups. See also {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#generateData|generateData()}.\n     * @param {string} layerId - Identifier for the layer where the markup should be loaded to. Example \"Layer1\".\n     * @returns {boolean} Whether the markup string was able to be loaded successfully\n     */\n    MarkupsCore.prototype.loadMarkups = function (markupString, layerId) {\n\n        if (this.duringEditMode) {\n            console.warn(\"Markups will not be loaded during the edit mode\");\n            return false;\n        }\n\n        if (!this.duringViewMode) {\n            return false;\n        }\n\n        if (!layerId) {\n            console.warn(\"loadMarkups failed; missing 2nd argument 'layerId'\");\n            return false;\n        }\n\n        // Can it be parsed into SVG?\n        var parent = stringToSvgNode(markupString);\n        if (!parent) {\n            return false;\n        }\n\n        // If the supplied layerId exists in the svg layers map and there are children in the svg then return false.\n        if (layerId in this.svgLayersMap && this.svg.childNodes.length > 0) {\n            console.warn(\"This layer is already loaded, will not load again.\");\n            return false;\n        }\n        this.activeLayer = layerId;\n        var svgLayerNode = this.svgLayersMap[layerId];\n\n        // if the layer exists, delete it\n        if (svgLayerNode)\n            delete this.svgLayersMap[layerId];\n\n        // create an empty parent svg layer node for layerId\n        // Child markups will get added to th parent svg layer node in the addMarkup function\n        var newSvg = this.createLayerNode();\n\n        svgLayerNode = {\n            markups: [],\n            svgString: markupString,\n            svg: newSvg\n        };\n        this.svgLayersMap[layerId] = svgLayerNode;\n\n        var children = parent.childNodes;\n        for (var i = 0; i < children.length; i++) {\n            var child = children[i];\n            var markup = createMarkupFromSVG(child, this);\n            // Disable markups if already in edit mode and the active layer is different\n            if (markup && this.duringEditMode && this.editingLayer !== this.activeLayer) {\n                markup.disableInteractions(true);\n            }\n\n            if (!markup && child.localName !== \"metadata\") {\n                // Append child removes it from parent and copies it over to the new svg layer node,\n                // so we need to reduce index by 1 to continue proper iteration\n                svgLayerNode.svg.appendChild(child);\n                i--;\n                if (typeof child.setAttribute === 'function') {\n                    child.setAttribute(\"pointer-events\", \"none\");\n                }\n            }\n        }\n\n        var svgParentNode = this.svgLayersMap[this.activeLayer].svg;\n\n        this.svg.appendChild(svgParentNode);\n        // If already in an edit mode layer then reassign active layer to edit layer\n        if(this.duringEditMode && this.editingLayer !== this.activeLayer) {\n            this.activeLayer = this.editingLayer;\n            if (this.editingLayer)\n                this.markups = this.svgLayersMap[this.activeLayer].markups.slice();\n        }\n        return true;\n    };\n\n    /**\n     * TODO: Probably this function needs to be moved to MarkupCoreUtils.js\n     * Creates a new layer node\n     * */\n\n    proto.createLayerNode = function() {\n\n        var newSvgLayerNode = this.createSvgElement('g');\n        newSvgLayerNode.setAttribute('cursor', 'default');\n        return newSvgLayerNode;\n    };\n\n    /**\n     * Revert any changes made to the specific layer.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()} and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#enterEditMode|enterEditMode()}.\n     *\n     * @param {string} layerId - ID of the layer to revert any changes that were made to it.\n     * @returns {boolean} true if the layer was unloaded, false if the layer was not unloaded.\n     */\n    MarkupsCore.prototype.revertLayer = function(layerId){\n        if (!layerId) {\n            console.warn(\"revertLayer failed because no layerId was supplied.\");\n            return false;\n        }\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode){\n            console.warn(\"The supplied layer does not exist.\");\n            return false;\n        }\n        var inEditMode = this.duringEditMode;\n        // Leave editMode to revert a layer\n        if (inEditMode)\n            this.leaveEditMode();\n\n        // keep track of previous global markups.\n        var currentMarkups = this.markups.slice();\n        // Set the global markups to the markups in the current layer. These ones get removed in the unloadMarkups\n        this.markups = svgLayerNode.markups;\n        var layerSvg = svgLayerNode.svgString;\n        this.unloadMarkups(layerId);\n        this.loadMarkups(layerSvg, layerId);\n        // Assign markups\n        if (this.editingLayer){\n            if(this.editingLayer !== layerId) {\n                this.markups = currentMarkups;\n                var layerObject = this.svgLayersMap[this.editingLayer];\n                if (layerObject) {\n                    layerObject.markups = currentMarkups;\n                }\n            }\n        }else{\n            if(this.editModeSvgLayerNode){\n                this.editModeSvgLayerNode.markups = currentMarkups;\n            }\n        }\n\n        if(this.editingLayer || this.editingLayer.length === 0){\n            var svg = this.editingLayer.length === 0 ? this.editModeSvgLayerNode.svg : this.svgLayersMap[this.editingLayer].svg;\n            if (svg.parentNode == this.svg) {\n                this.svg.removeChild(svg);\n                this.svg.appendChild(svg);\n            }\n        }\n        return true;\n    };\n\n    /**\n     * Removes markups from the DOM (Document Object Model). This is helpful for freeing up memory.<br>\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkupsAllLayers|unloadMarkupsAllLayers()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\n     *\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\n     * @returns {boolean} Whether the operation succeeded or not.\n     */\n    MarkupsCore.prototype.unloadMarkups = function(layerId) {\n\n        if (!layerId) {\n            console.warn(\"unloadMarkups failed; No layerId provided.\");\n            return false;\n        }\n\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode) {\n            // TODO: Do we need to log anything here?\n            console.warn('No such layer exists to unload.');\n            return false;\n        }\n\n        var layerMarkups = svgLayerNode.markups.slice();\n        var numMarkups = layerMarkups.length;\n        for (var i = 0; i < numMarkups; i++) {\n            var markup = layerMarkups[i];\n            this.removeMarkup(markup);\n            markup.destroy();\n        }\n\n        // Remove the markups in the layer from the svg canvas\n        if (svgLayerNode.svg.parentNode === this.svg)\n            this.svg.removeChild(svgLayerNode.svg);\n\n        // Delete the layer from the layer map.\n        delete this.svgLayersMap[layerId];\n        // Reset the active layer if the supplied layer id is the same as the active layer\n        if (this.activeLayer.toString() === layerId.toString()) {\n            this.activeLayer = '';\n        }\n        // Leave edit mode and reset the editing layer if the supplied layer is the same as the current editing layer\n        if (this.editingLayer && this.editingLayer.toString() === layerId.toString()){\n            this.editingLayer = '';\n            this.duringEditMode && this.leaveEditMode();\n        }\n\n        return true;\n    };\n\n    /**\n     * Removes all markups loaded so far. Great for freeing up memory.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#clear|clear()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hide|hide()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}.\n     */\n    MarkupsCore.prototype.unloadMarkupsAllLayers = function() {\n        this.activeLayer = '';\n        var self = this;\n\n        //this is specific to the editModeSvgLayerNode, enterEditMode().\n        var unloadSvgLayerNode = function(){\n            if (self.editModeSvgLayerNode){\n                var layerMarkups = self.editModeSvgLayerNode.markups.slice();\n                var numMarkups = layerMarkups.length;\n                for (var i = 0; i < numMarkups; i++) {\n                    var markup = layerMarkups[i];\n                    self.removeMarkup(markup);\n                    markup.destroy();\n                }\n            }\n        };\n\n        // Unload the markups in the editModeSvgLayerNode\n        unloadSvgLayerNode();\n        var layerId;\n        for (layerId in this.svgLayersMap){\n            this.unloadMarkups(layerId);\n        }\n    };\n\n    /**\n     * Hides all markups in a specified layer. Note that hidden markups will not be unloaded.\n     * Use the {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()} method to make\n     * them visible again; no additional parsing is required.\n     *\n     * See also\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#showMarkups|showMarkups()},\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#unloadMarkups|unloadMarkups()}, and\n     * {@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#loadMarkups|loadMarkups()}.\n     *\n     * @param {string} layerId - ID of the layer containing all markups that should be hidden (in the DOM).\n     * @returns {boolean} Whether the operation succeeded or not.\n     */\n    MarkupsCore.prototype.hideMarkups = function(layerId) {\n\n        if (!layerId) {\n            console.warn(\"hideMarkups failed; No layerId provided.\");\n            return false;\n        }\n\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode) {\n            // TODO: Do we need to log anything here?\n            return false;\n        }\n        var layerSvg = svgLayerNode.svg;\n\n        // Return false if the layer svg is not present in the main svg\n        if (layerSvg.parentNode != this.svg) {\n            console.warn(\"Layer is already hidden.\");\n            return false;\n        }\n        // remove the layer svg from the main svg\n        this.svg.removeChild(layerSvg);\n        return true;\n    };\n\n    /**\n     * Unhides a layer of hidden markups\n     * ({@link Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore/#hideMarkups|hideMarkups()}).\n     *\n     * @param {string} layerId - ID of the layer containing all markups to unload (from the DOM).\n     * @returns {boolean} Whether the operation succeeded or not.\n     */\n    MarkupsCore.prototype.showMarkups = function(layerId) {\n\n        if (!layerId) {\n            console.warn(\"showMarkups failed; No layerId provided.\");\n            return false;\n        }\n\n        var svgLayerNode = this.svgLayersMap[layerId];\n        if (!svgLayerNode) {\n            // TODO: Do we need to log anything here?\n            return false;\n        }\n        // Append the layer svg to the main svg\n        var layerSvg = svgLayerNode.svg;\n        this.svg.appendChild(layerSvg);\n    };\n\n    //// Client Space <-> Markup Space /////////////////////////////////////////////////////////////////////////////////\n\n    proto.positionFromClientToMarkups = function(x, y) {\n\n        return this.clientToMarkups(x, y);\n    };\n\n    proto.positionFromMarkupsToClient = function(x, y) {\n\n        return this.markupsToClient(x, y);\n    };\n\n    proto.vectorFromClientToMarkups = function(x, y) {\n\n        var a = this.clientToMarkups(0, 0);\n        var b = this.clientToMarkups(x, y);\n\n        return {x: b.x - a.x, y: b.y - a.y};\n    };\n\n    proto.vectorFromMarkupsToClient = function(x, y) {\n\n        var a = this.markupsToClient(0, 0);\n        var b = this.markupsToClient(x, y);\n\n        return {x: b.x - a.x, y: b.y - a.y};\n    };\n\n    proto.sizeFromClientToMarkups = function(w, h) {\n\n        var a = this.clientToMarkups(0, 0);\n        var b = this.clientToMarkups(w, h);\n\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\n    };\n\n    proto.sizeFromMarkupsToClient = function(w, h) {\n\n        var a = this.markupsToClient(0, 0);\n        var b = this.markupsToClient(w, h);\n\n        return {x: Math.abs(b.x - a.x), y: Math.abs(b.y - a.y)};\n    };\n\n    proto.markupsToClient = function(x, y) {\n\n        var camera = this.viewer.impl.camera;\n        var point = new THREE.Vector3(x, y, 0);\n\n        if (camera.isPerspective) {\n\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\n\n            point.x =( point.x / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.width  * 0.5);\n            point.y =(-point.y / PERSPECTIVE_MODE_SCALE * (bb.height * 0.5) + bb.height * 0.5);\n        } else {\n\n            point.applyMatrix4(camera.matrixWorld);\n            point.sub(camera.position);\n\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\n            // exported markups don't have the offset.\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\n            if (globalOffset) {\n                point.sub(globalOffset);\n            }\n\n            point = worldToClient(point, this.viewer, false);\n            point.z = 0;\n        }\n\n        return point;\n    };\n\n    proto.clientToMarkups = function(x, y) {\n\n        var camera = this.viewer.impl.camera;\n        var point = new THREE.Vector3(x, y, 0);\n\n        if (camera.isPerspective) {\n\n            var bb = this.viewer.impl.getCanvasBoundingClientRect();\n\n            // Multiply by PERSPECTIVE_MODE_SCALE because Firfox on Windows machines have problems to deal with very small paths.\n            point.x = (point.x - bb.width  * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\n            point.y =-(point.y - bb.height * 0.5) / (bb.height * 0.5) * PERSPECTIVE_MODE_SCALE;\n        } else {\n\n            point = clientToWorld(point.x, point.y, 0, this.viewer);\n\n            // In LMV model is offset by a global offset, we correct this offset when transforming to markups space, so\n            // exported markups don't have the offset.\n            var globalOffset = this.viewer.model && this.viewer.model.getData().globalOffset;\n            if (globalOffset) {\n                point.add(globalOffset);\n            }\n\n            point.add(camera.position);\n            point.applyMatrix4(camera.matrixWorldInverse);\n            point.z = 0;\n        }\n\n        return point;\n    };\n\n    proto.getSvgViewBox = function(clientWidth, clientHeight) {\n\n        // Get pan offset.\n        var lt = this.clientToMarkups(0, 0);\n        var rb = this.clientToMarkups(clientWidth, clientHeight);\n\n        var l = Math.min(lt.x, rb.x);\n        var t = Math.min(lt.y, rb.y);\n        var r = Math.max(lt.x, rb.x);\n        var b = Math.max(lt.y, rb.y);\n\n        return [l , t, r-l, b-t].join(' ');\n    };\n\n    proto.getBounds = function () {\n\n        return this.bounds;\n    };\n\n    proto.getMousePosition = function() {\n\n        // When snapping, use the snap position instead of the mouse position\n        // as the start point of the markup drawing.\n        // For now only works for 2D.\n        if (this.editMode.useWithSnapping() && this.snapper && this.snapper.isSnapped()) {\n            return this.getSnapPosition();\n        }\n        return this.input.getMousePosition();\n    };\n\n    proto.getSnapPosition = function() {\n\n        var point = MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(), this.viewer);\n        var p = this.project(point);\n        return {x: p.x, y: p.y};\n    };\n\n    proto.project = function(position) {\n        var camera = this.viewer.navigation.getCamera();\n        var containerBounds = this.viewer.navigation.getScreenViewport();\n\n        var p = new THREE.Vector3().copy(position);\n        p.project(camera);\n\n        return new THREE.Vector3(Math.round((p.x + 1) / 2 * containerBounds.width),\n            Math.round((-p.y + 1) / 2 * containerBounds.height), p.z);\n    };\n\n    //// Handled Events ////////////////////////////////////////////////////////////////////////////////////////////////\n\n    proto.onCameraChange = function() {\n\n        // Update annotations' parent transform.\n        var viewBox = this.getSvgViewBox(this.bounds.width, this.bounds.height);\n\n        // HACK, for some reason the 2nd frame returns an empty canvas.\n        // The reason why this happens is that the code above calls into the viewer\n        // and a division by zero occurs due to LMV canvas having zero width and height\n        // When we detect this case, avoid setting the viewBox value and rely on one\n        // previously set.\n        if (viewBox === \"NaN NaN NaN NaN\") {\n            return;\n        }\n\n        if (this.svg) {\n            this.svg.setAttribute('viewBox', viewBox);\n        }\n\n\n        var editMode = this.editMode;\n\n        if (editMode) {\n            // Edit frame has to be updated, re-setting the selected markup does the job.\n            if (this.editFrame.isActive()) {\n                var selectedMarkup = editMode.getSelection();\n                this.editFrame.setMarkup(selectedMarkup);\n            }\n\n            if (editMode.updateTextBoxStyle) {\n                editMode.updateTextBoxStyle();\n            }\n\n            if (this.snapper && editMode.useWithSnapping()) {\n                this.snapper.indicator.render();\n            }\n        }\n    };\n\n    proto.onViewerResize = function(event) {\n\n        this.bounds.x = 0;\n        this.bounds.y = 0;\n        this.bounds.width = event.width;\n        this.bounds.height = event.height;\n\n        if (this.svg) {\n            this.svg.setAttribute('width', this.bounds.width);\n            this.svg.setAttribute('height', this.bounds.height);\n        }\n\n        this.onCameraChange();\n    };\n\n    proto.callSnapperMouseDown = function() {\n\n        // Disable snapper in freehand mode\n        if (this.editMode && this.editMode.useWithSnapping()){\n            var mousePosition = this.input.getMousePosition();\n            if (this.snapper) {\n                this.snapper.onMouseDown(mousePosition);\n                this.snapper.indicator.render();\n            }\n        }else{\n            // Clear the snapper when selecting a markup that does not allow snapping.\n            if (this.snapper){\n                this.snapper.clearSnapped();\n                this.snapper.indicator.clearOverlays();\n            }\n        }\n    };\n\n    proto.callSnapperMouseMove = function() {\n\n        if (this.editMode && this.editMode.useWithSnapping()) {\n            var mousePosition = this.input.getMousePosition();\n            if (this.snapper) {\n                this.snapper.onMouseMove(mousePosition);\n                this.snapper.indicator.render();\n            }\n        }\n    };\n\n    /**\n     * Handler to mouse move events, used to create markups.\n     *\n     * @param event\n     * @returns {boolean} - if the event was handed by the editor\n     * @private\n     */\n    proto.onMouseMove = function(event) {\n\n        if (this.navigating) {\n            return false;\n        }\n\n        let eventHandled = false;\n        if (this.editFrame.isActive() && event.type === 'mousemove') {\n            eventHandled = this.editFrame.onMouseMove(event);\n        }\n\n        this.callSnapperMouseMove();\n\n        eventHandled = (this.editMode && this.editMode.onMouseMove(event)) || eventHandled;\n\n        return eventHandled;\n    };\n\n    /**\n     * Handler to mouse down events, used to start creation markups.\n     *\n     * @param event\n     * @private\n     */\n    proto.onMouseDown = function(event) {\n\n        dismissLmvHudMessage();\n\n        this.callSnapperMouseDown();\n\n        var bounds = this.getBounds();\n        var mousePosition = this.getMousePosition();\n\n        if (mousePosition.x >= bounds.x && mousePosition.x <= bounds.x + bounds.width &&\n            mousePosition.y >= bounds.y && mousePosition.y <= bounds.y + bounds.height) {\n            this.editMode.onMouseDown(event);\n        }\n\n        // TODO: There is a better way to do this, implement when undo/redo group.\n        if(!this.editMode.creating && event.target === this.svg) {\n            this.selectMarkup(null);\n        }\n        this.ignoreNextMouseUp = false;\n    };\n\n    /**\n     * \n     * @param {*} event \n     * @returns {boolean} - true / false means the editor did / didn't handle the event\n     * @private\n     */\n    proto.onMouseUp = function(event) {\n\n        if (this.navigating) {\n            return false;\n        }\n\n        if (this.editFrame.isActive()) {\n            this.editFrame.onMouseUp(event);\n            return true;\n        }\n\n        if(!this.ignoreNextMouseUp) {\n            return this.editMode.onMouseUp(event);\n        }\n    };\n\n    proto.onMouseDoubleClick = function(event) {\n\n        if (this.navigating) {\n            return;\n        }\n\n        if (this.editFrame.isActive()) {\n            return;\n        }\n\n        this.editMode.onMouseDoubleClick(event);\n    };\n\n    proto.onUserCancel = function() {\n        if (!this.editMode) {\n            return;\n        }\n        else if (this.editMode.creating) {\n            this.editMode.creationCancel();\n        } else {\n            this.editMode.unselect();\n        }\n    };\n\n    /**\n     *\n     * @param event\n     * @private\n     */\n    proto.onMarkupSelected = function(event) {\n\n        this.selectMarkup(event.markup);\n        this.dispatchEvent(event);\n    };\n\n    proto.onMarkupEnterEdition = function() {\n\n    };\n\n    proto.onMarkupCancelEdition = function() {\n\n        this.onUserCancel();\n    };\n\n    proto.onMarkupDeleteEdition = function(event) {\n\n        this.removeMarkup(event.markup);\n        this.editMode.deleteMarkup();\n    };\n\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsCore', MarkupsCore);\n","import { getStyleDefaultValues } from '../core/StyleUtils'\nimport * as MarkupEvents from '../core/MarkupEvents' \nimport * as MarkupTypes from '../core/MarkupTypes'\nimport { theEditModeManager } from '../core/EditModeManager'\n\nimport CSS from './MarkupsGui.css' // IMPORTANT!!\n\n    var CORE_EXTENSION = 'Autodesk.Viewing.MarkupsCore';\n\n    export function MarkupsGui(viewer, options) {\n        Autodesk.Viewing.Extension.call(this, viewer, options);\n        this.domEvents = [];\n        this.name = 'markup';\n        this.onEditModeEnter = this.onEditModeEnter.bind(this);\n        this.onEditModeLeave = this.onEditModeLeave.bind(this);\n        this.onEditModeChange = this.onEditModeChange.bind(this);\n        this.onMarkupSelected = this.onMarkupSelected.bind(this);\n    }\n\n    MarkupsGui.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\n    MarkupsGui.prototype.constructor = MarkupsGui;\n    var proto = MarkupsGui.prototype;\n    var av = Autodesk.Viewing;\n    var avp = av.Private;\n\n    proto.load = function () {\n\n        this.viewer.loadExtension(CORE_EXTENSION).then( coreExt => {\n\n            this.core = coreExt;\n\n            // Hook into markup core events\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\n            this.core.addEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\n            this.core.addEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\n        });\n\n        return true;\n    };\n\n    proto.unload = function() {\n\n        this.deactivate(); // not necessary, but leaves the viewer in an unusable state without it\n        this.unhookAllEvents();\n\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_ENTER, this.onEditModeEnter);\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_LEAVE, this.onEditModeLeave);\n        this.core.removeEventListener(MarkupEvents.EVENT_EDITMODE_CHANGED, this.onEditModeChange);\n        this.core.removeEventListener(MarkupEvents.EVENT_MARKUP_SELECTED, this.onMarkupSelected);\n\n        this.destroyToolUi();\n        this.destroyToolbarUI();\n        this.core = null;\n\n        return true;\n    };\n\n    proto.onToolbarCreated = function(toolbar) {\n        \n        var self = this;\n        var viewer = this.viewer;\n\n        this.markupToolButton = new Autodesk.Viewing.UI.Button(\"toolbar-markupTool\");\n        this.markupToolButton.setToolTip(\"Markup\");\n        this.markupToolButton.setIcon(\"adsk-icon-markup\");\n        this.markupToolButton.onClick = function () {\n            // Since the bar will get hidden when closed, there\n            // is no need to track button state (active or not)\n            self.activate();\n        };\n\n        var modelTools = toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);\n        if (modelTools) {\n            modelTools.addControl(this.markupToolButton, {index:0});\n        }\n    };\n\n    proto.destroyToolbarUI = function() {\n        if (this.markupToolButton) {\n            var toolbar = this.viewer.getToolbar();\n            if (toolbar) {\n                this.markupToolButton.removeFromParent();\n            }\n            this.markupToolButton = null;\n        }\n    };\n\n    proto.onEditModeEnter = function() {\n        avp.logger.log('ENTER edit mode');\n        this.showToolsUi();\n    };\n\n    proto.onEditModeLeave = function() {\n        avp.logger.log('LEAVE edit mode');\n        this.hideToolsUi();\n    };\n\n    proto.onEditModeChange = function(event) {\n        if (!this.domToolSelect || this.ignoreChangeEvent)\n            return;\n        var editMode = this.core.editMode;\n        var optionList = this.domToolSelect.options;\n        for (var i=0, len=optionList.length; i<len; i++) {\n            var option = optionList[i];\n            if (option.value === editMode.type) {\n                this.domToolSelect.selectedIndex = i; // doesn't fire event\n                break;\n            }\n        }\n    };\n\n    proto.onMarkupSelected = function(event) {\n\n        var markup = event.markup;\n        var editMode = this.core.editMode;\n        this.setStylesUi(editMode, markup);\n    };\n\n    proto.showToolsUi = function() {\n        this.createToolsUi();\n\n        // Hide some UI\n        var canNavigate = this.core.isNavigationAllowed();\n        this.setControlVisibility('.lmv-markup-gui-enterNavMode', canNavigate, 'inline-block');\n        this.exitNavigationMode();\n        this.domContent.style.display = 'block'; // remove collapsed state\n\n        // It's okay if we call these many times in a row, no biggie.\n        this.viewer.container.appendChild(this.domRoot);\n    };\n\n    proto.hideToolsUi = function() {\n        if (this.domRoot && this.domRoot.parentNode) {\n            this.domRoot.parentNode.removeChild(this.domRoot);\n        }\n    };\n\n    proto.createToolsUi = function() {\n\n        if (this.domRoot)\n            return;\n\n        var optionIndex = 0;\n        function createEditModeOption(locLabel, editModeType) {\n            return [\n                '<option value=\"', editModeType, '\">',\n                    locLabel,\n                '</option>'\n            ].join('');\n        }\n\n        var html = [\n            '<div class=\"lmv-markup-gui-toolbar-content\">',\n\n                '<button class=\"lmv-markup-gui-collapse-btn\">&lt;-&gt;</button>',\n                '<button class=\"lmv-markup-editmode-done\">Exit</button>',\n                '<div class=\"lmv-markup-gui-collapse-content\">',\n                    '<div class=\"lmv-markup-gui-editMode\">',\n                        '<button class=\"lmv-markup-gui-enterNavMode\">Navigate</button>',\n                        '<button class=\"lmv-markup-gui-undo\">&#8617;</button>',\n                        '<button class=\"lmv-markup-gui-redo\">&#8618;</button>',\n                        '<br>',\n                        '<button class=\"lmv-markup-gui-delete\">Delete</button>',\n                        '<button class=\"lmv-markup-gui-duplicate\">Duplicate</button>',\n                        '<br>',\n                        '<button class=\"lmv-markup-gui-cut\">Cut</button>',\n                        '<button class=\"lmv-markup-gui-copy\">Copy</button>',\n                        '<button class=\"lmv-markup-gui-paste\">Paste</button>',\n                        '<br>',\n                        '<span>Markup:</span>', // TODO: Localize\n                        '<select class=\"lmv-markup-tool-select\">',\n                            createEditModeOption('Arrow', MarkupTypes.MARKUP_TYPE_ARROW),\n                            createEditModeOption('Rectangle', MarkupTypes.MARKUP_TYPE_RECTANGLE),\n                            createEditModeOption('Circle', MarkupTypes.MARKUP_TYPE_CIRCLE),\n                            createEditModeOption('Text', MarkupTypes.MARKUP_TYPE_TEXT),\n                            createEditModeOption('Callout', MarkupTypes.MARKUP_TYPE_CALLOUT),\n                            createEditModeOption('Cloud', MarkupTypes.MARKUP_TYPE_CLOUD),\n                            createEditModeOption('PolyLine', MarkupTypes.MARKUP_TYPE_POLYLINE),\n                            createEditModeOption('Polycloud', MarkupTypes.MARKUP_TYPE_POLYCLOUD),\n                            createEditModeOption('Freehand', MarkupTypes.MARKUP_TYPE_FREEHAND),\n                            createEditModeOption('Highlight', MarkupTypes.MARKUP_TYPE_HIGHLIGHT),\n                            createEditModeOption('Dimension', MarkupTypes.MARKUP_TYPE_DIMENSION),\n                            createEditModeOption('SVG Stamp', MarkupTypes.MARKUP_TYPE_STAMP),\n                        '</select>',\n                        '<br>',\n                        '<div class=\"lmv-markup-gui-style-options\"></div>',\n                    '</div>',\n                    '<div class=\"lmv-markup-gui-navMode\" style=\"display:none;\">',\n                        '<button class=\"lmv-markup-gui-exitNavMode\">Back to Markup</button>',\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('');\n\n        const _document = this.getDocument();\n        this.domRoot = _document.createElement('div');\n        this.domRoot.className = 'lmv-markup-gui-toolbar';\n        this.domRoot.innerHTML = html;\n\n        this.domContent = this.domRoot.querySelector('.lmv-markup-gui-collapse-content');\n        this.domToolSelect = this.domRoot.querySelector('.lmv-markup-tool-select');\n        this.domStylesRoot = this.domRoot.querySelector('.lmv-markup-gui-style-options');\n\n        // General\n        this.hookEvent('click', '.lmv-markup-gui-collapse-btn', this.onToggleCollapse.bind(this));\n        this.hookEvent('click', '.lmv-markup-editmode-done', this.onEditModeDone.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-enterNavMode', this.enterNavigationMode.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-exitNavMode', this.exitNavigationMode.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-undo', this.onUndoClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-redo', this.onRedoClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-delete', this.onDeleteClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-cut', this.onCutClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-copy', this.onCopyClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-paste', this.onPasteClick.bind(this));\n        this.hookEvent('click', '.lmv-markup-gui-duplicate', this.onDuplicateClick.bind(this));\n        // Tools\n        this.hookEvent('change', '.lmv-markup-tool-select', this.onSelectEditMode.bind(this));\n        this.hookEvent('change', '.lmv-markup-gui-style-select', this.onStyleChange.bind(this));\n        // Text input fields for tools\n        this.hookEvent('input', '.lmv-markup-gui-style-textarea', this.onStyleChange.bind(this));\n        this.hookEvent('propertychange', '.lmv-markup-gui-style-textarea', this.onStyleChange.bind(this));\n\n        this.setStylesUi(this.core.editMode);\n    };\n\n    proto.destroyToolUi = function() {\n        if (this.domRoot) {\n            this.hideToolsUi();\n            this.domRoot = null;\n        }\n    };\n\n    proto.getEditMode = function(editModeType) {\n        var EditModeClass = theEditModeManager.getClass(editModeType);\n        if (!EditModeClass)\n            return null;\n\n        var editMode = new EditModeClass(this.core);\n        return editMode;\n    };\n\n    proto.onToggleCollapse = function() {\n        var curr = this.domContent.style.display;\n        if (curr === 'none')\n            this.domContent.style.display = 'block';\n        else\n            this.domContent.style.display = 'none';\n    };\n\n    proto.onEditModeDone = function() {\n        this.deactivate();\n    };\n\n    proto.enterNavigationMode = function() {\n        this.core.allowNavigation(true);\n        this.setControlVisibility('.lmv-markup-gui-editMode', false);\n        this.setControlVisibility('.lmv-markup-gui-navMode', true);\n    };\n    proto.exitNavigationMode = function() {\n        this.core.allowNavigation(false);\n        this.setControlVisibility('.lmv-markup-gui-editMode', true);\n        this.setControlVisibility('.lmv-markup-gui-navMode', false);\n    };\n\n    proto.onUndoClick = function() {\n        this.core.undo();\n    };\n    proto.onRedoClick = function() {\n        this.core.redo();\n    };\n    proto.onDeleteClick = function() {\n        var markup = this.core.getSelection();\n        if (markup) {\n            this.core.deleteMarkup(markup);\n        }\n    };\n    proto.onCutClick = function() {\n        this.core.cut();\n    };\n    proto.onCopyClick = function() {\n        this.core.copy();\n    };\n    proto.onPasteClick = function() {\n        this.core.paste();\n    };\n    proto.onDuplicateClick = function() {\n        // only when there's a selection\n        var markup = this.core.getSelection();\n        if (markup) {\n            this.core.copy();\n            this.core.paste();\n        }\n    };\n\n    proto.onSelectEditMode = function(event) {\n        var editModeType = event.target.value;\n        var editMode = this.getEditMode(editModeType);\n        if (!editMode) {\n            avp.logger.error('Markup editMode not found for type: ' + editModeType);\n            return;\n        }\n\n        if (editMode.cancelEditModeChange) {\n            avp.logger.warn('There was a problem selecting current editMode');\n            return;\n        }\n\n        this.ignoreChangeEvent = true;\n        this.core.changeEditMode(editMode);\n        this.ignoreChangeEvent = false;\n        this.setStylesUi(editMode);\n        this.domToolSelect.blur(); // remove focus from UI\n    };\n\n    proto.onStyleChange = function(event) {\n        var select = event.target;\n        var styleKey = select.getAttribute('style-key');\n        var valueType = select.getAttribute('value-type');\n        \n        var markup = this.core.getSelection();\n        var style = markup ? markup.getStyle() : this.core.getStyle();\n\n        // if it's a string input, just take the raw value\n        if (valueType === 'string') {\n            style[styleKey] = select.value;\n        } else {\n            var option = select.options[select.selectedIndex];\n            style[styleKey] = getTypedValue(option.value, valueType);\n            select.blur(); // remove focus from UI\n        }\n        this.core.setStyle(style);\n\n        function getTypedValue(val, type) {\n            if (type === 'number')\n                return Number(val);\n            if (type === 'boolean')\n                return val === 'true';\n            return val;\n        }\n    };\n\n    proto.setStylesUi = function(editMode, markup) {\n\n        var style = markup ? markup.style : editMode.style;\n        var defaults = getStyleDefaultValues(style, this.core);\n\n        this.domStylesRoot.innerHTML = ''; // flush UI\n        for (var key in defaults) {\n            // Quite inefiient because we are re-creating DOM constantly\n            // Consider optimize if it becomes a problem\n            var domElem = this.getUiForStyleKey(key, defaults[key], style[key]);\n            this.domStylesRoot.appendChild(domElem);\n        }\n    };\n\n    proto.getUiForStyleKey = function(key, defaults, current) {\n\n        var selectionIndex = defaults.default;\n        var options = [];\n        var values = defaults.values;\n        for (var i=0, len=values.length; i<len; ++i) {\n            var optLine = [\n                '<option value=\"', values[i].value,'\">',\n                    values[i].name,\n                '</option>'\n            ].join('');\n            options.push(optLine);\n\n            if (this.valueEquals(values[i].value, current)) {\n                selectionIndex = i;\n            }\n        }\n\n        var valueType = typeof values[0].value;\n\n        // TODO: Build specialized controls for each style-attribute\n        const _document = this.getDocument();\n        var domElem = _document.createElement('div');\n        var html = []\n        let isText = key.includes('text');\n\n        if (isText) {\n            html = [\n                '<span>',key,'</span>',\n                '<br>',\n                '<textarea class=\"lmv-markup-gui-style-textarea\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\n                (current || ''),\n                '</textarea>'\n            ].join('');\n        } else {\n            html = [\n                '<span>',key,'</span>',\n                '<select class=\"lmv-markup-gui-style-select\" style-key=\"', key, '\" value-type=\"', valueType,'\">',\n                    options.join(''),\n                '</select>'\n            ].join('');\n        }\n        \n        domElem.innerHTML = html;\n\n        if (!isText) {\n            // select index\n            var domSelect = domElem.querySelector('select');\n            domSelect.selectedIndex = selectionIndex;\n        }\n\n        return domElem;\n    };\n    proto.valueEquals = function(value1, value2) {\n\n        return value1 === value2;\n    }\n\n    proto.setControlVisibility = function(selector, isVisible, visibleValue) {\n        var elem = this.domRoot.querySelector(selector);\n        if (!visibleValue)\n            visibleValue = 'block';\n        elem.style.display = isVisible ? visibleValue : 'none';\n    };\n\n    proto.hookEvent = function(eventStr, selector, callbackFn) {\n        var handler = function(event){\n            if (this.matchesSelector(event.target, selector)){\n                callbackFn(event);\n            }\n        }.bind(this);\n        this.domRoot.addEventListener(eventStr, handler);\n        this.domEvents.push({str: eventStr, handler: handler });\n    };\n\n    proto.unhookAllEvents = function() {\n        var domRoot = this.domRoot;\n        this.domEvents.forEach(function(event) {\n            domRoot.removeEventListener(event.str, event.handler);\n        });\n        this.domEvents = [];\n    };\n\n    proto.matchesSelector = function(domElem, selector) {\n        if (domElem.matches) return domElem.matches(selector); //Un-prefixed\n        if (domElem.msMatchesSelector) return domElem.msMatchesSelector(selector);  //IE\n        if (domElem.mozMatchesSelector) return domElem.mozMatchesSelector(selector); //Firefox (Gecko)\n        if (domElem.webkitMatchesSelector) return domElem.webkitMatchesSelector(selector); // Opera, Safari, Chrome\n        return false;\n    };\n\n    proto.getStyleOptions = function(editMode) {\n        var style = editMode.getStyle();\n        return getStyleDefaultValues(style, this.core);\n    };\n\n    proto.activate = function () {\n        if(!this.activeStatus) {\n            this.core.enterEditMode();\n            this.activeStatus = true;\n        }\n        return true;\n    };\n\n    proto.deactivate = function () {\n        if(this.activeStatus) {\n            this.core.hide();\n            this.activeStatus = false;\n        }\n        return true;\n    };\n\n\n    Autodesk.Viewing.theExtensionManager.registerExtension('Autodesk.Viewing.MarkupsGui', MarkupsGui);\n","'use strict';\n\nimport { MarkupsCore } from './core/MarkupsCore'\nimport { MarkupsGui } from './gui/MarkupsGui'\n\nimport { Clipboard } from './core/edit-clipboard/Clipboard'\nimport { CloneMarkup } from './core/edit-actions/CloneMarkup'\nimport { CreateArrow } from './core/edit-actions/CreateArrow'\nimport { CreateCallout } from './core/edit-actions/CreateCallout'\nimport { CreateCircle } from './core/edit-actions/CreateCircle'\nimport { CreateCloud } from './core/edit-actions/CreateCloud'\nimport { CreateDimension } from './core/edit-actions/CreateDimension'\nimport { CreateFreehand } from './core/edit-actions/CreateFreehand'\nimport { CreateHighlight } from './core/edit-actions/CreateHighlight'\nimport { CreatePolycloud } from './core/edit-actions/CreatePolycloud'\nimport { CreatePolyline } from './core/edit-actions/CreatePolyline'\nimport { CreateRectangle } from './core/edit-actions/CreateRectangle'\nimport { CreateText } from './core/edit-actions/CreateText'\nimport { DeleteArrow } from './core/edit-actions/DeleteArrow'\nimport { DeleteCallout } from './core/edit-actions/DeleteCallout'\nimport { DeleteCircle } from './core/edit-actions/DeleteCircle'\nimport { DeleteCloud } from './core/edit-actions/DeleteCloud'\nimport { DeleteStamp } from './core/edit-actions/DeleteStamp'\nimport { DeleteDimension } from './core/edit-actions/DeleteDimension'\nimport { DeleteFreehand } from './core/edit-actions/DeleteFreehand'\nimport { DeleteHighlight } from './core/edit-actions/DeleteHighlight'\nimport { DeletePolycloud } from './core/edit-actions/DeletePolycloud'\nimport { DeletePolyline } from './core/edit-actions/DeletePolyline'\nimport { DeleteRectangle } from './core/edit-actions/DeleteRectangle'\nimport { DeleteText } from './core/edit-actions/DeleteText'\n\nimport { EditAction } from './core/edit-actions/EditAction' \nimport { EditActionGroup } from './core/edit-actions/EditActionGroup' \nimport { EditActionManager } from './core/edit-actions/EditActionManager' \nimport { EditFrame } from './core/EditFrame' \n\nimport { EditMode } from './core/edit-modes/EditMode'\nimport { EditModeArrow } from './core/edit-modes/EditModeArrow'\nimport { EditModeCallout } from './core/edit-modes/EditModeCallout'\nimport { EditModeCircle } from './core/edit-modes/EditModeCircle'\nimport { EditModeCloud } from './core/edit-modes/EditModeCloud'\nimport { EditModeStamp } from './core/edit-modes/EditModeStamp'\nimport { EditModeDimension } from './core/edit-modes/EditModeDimension'\nimport { EditModeFreehand } from './core/edit-modes/EditModeFreehand'\nimport { EditModeHighlight } from './core/edit-modes/EditModeHighlight'\nimport { EditModePen } from './core/edit-modes/EditModePen'\nimport { EditModePolycloud } from './core/edit-modes/EditModePolycloud'\nimport { EditModePolyline } from './core/edit-modes/EditModePolyline'\nimport { EditModeRectangle } from './core/edit-modes/EditModeRectangle'\nimport { EditModeText } from './core/edit-modes/EditModeText'\nimport { EditorTextInput } from './core/edit-modes/EditorTextInput'\n\n\nimport { Markup } from './core/Markup'\nimport { MarkupArrow } from './core/MarkupArrow'\nimport { MarkupCallout } from './core/MarkupCallout'\nimport { MarkupCircle } from './core/MarkupCircle'\nimport { MarkupCloud } from './core/MarkupCloud'\nimport { MarkupDimension } from './core/MarkupDimension'\nimport { MarkupFreehand } from './core/MarkupFreehand'\nimport { MarkupHighlight } from './core/MarkupHighlight'\nimport { MarkupPen } from './core/MarkupPen'\nimport { MarkupPolycloud } from './core/MarkupPolycloud'\nimport { MarkupPolyline } from './core/MarkupPolyLine'\nimport { MarkupRectangle } from './core/MarkupRectangle'\nimport { MarkupText } from './core/MarkupText'\nimport { MarkupStamp } from './core/MarkupStamp'\nimport { MarkupTool } from './core/MarkupTool'\n\nimport { SetArrow } from './core/edit-actions/SetArrow'\nimport { SetCallout } from './core/edit-actions/SetCallout'\nimport { SetCircle } from './core/edit-actions/SetCircle'\nimport { SetCloud } from './core/edit-actions/SetCloud'\nimport { SetDimension } from './core/edit-actions/SetDimension'\nimport { SetFreehand } from './core/edit-actions/SetFreehand'\nimport { SetHighlight } from './core/edit-actions/SetHighlight'\nimport { SetPolycloud } from './core/edit-actions/SetPolycloud'\nimport { SetPolyline } from './core/edit-actions/SetPolyline'\nimport { SetPosition } from './core/edit-actions/SetPosition'\nimport { SetRectangle } from './core/edit-actions/SetRectangle'\nimport { SetRotation } from './core/edit-actions/SetRotation'\nimport { SetSize } from './core/edit-actions/SetSize'\nimport { SetStyle } from './core/edit-actions/SetStyle'\nimport { SetText } from './core/edit-actions/SetText'\nimport { SetStamp } from './core/edit-actions/SetStamp'\n\n\nimport * as MarkupEvents from './core/MarkupEvents'\nimport * as MarkupTypes from './core/MarkupTypes'\n\nimport * as Utils from './core/MarkupsCoreUtils'\nimport * as StyleUtils from './core/StyleUtils'\n\nimport { theEditModeManager } from './core/EditModeManager'\n\n// All the things\nexport const Core = {\n    Clipboard,\n    CloneMarkup,\n    CreateArrow,\n    CreateCallout,\n    CreateCircle,\n    CreateCloud,\n    CreateDimension,\n    CreateFreehand,\n    CreateHighlight,\n    CreatePolycloud,\n    CreatePolyline,\n    CreateRectangle,\n    CreateText,\n    DeleteArrow,\n    DeleteCallout,\n    DeleteCircle,\n    DeleteCloud,\n    DeleteDimension,\n    DeleteFreehand,\n    DeleteHighlight,\n    DeletePolycloud,\n    DeletePolyline,\n    DeleteRectangle,\n    DeleteText,\n    DeleteStamp,\n\n    EditAction,\n    EditActionGroup,\n    EditActionManager,\n    EditFrame,\n\n    EditMode,\n    EditModeArrow,\n    EditModeCallout,\n    EditModeCircle,\n    EditModeCloud,\n    EditModeDimension,\n    EditModeFreehand,\n    EditModeHighlight,\n    EditModePen,\n    EditModePolycloud,\n    EditModePolyline,\n    EditModeRectangle,\n    EditModeText,\n    EditModeStamp,\n    EditorTextInput,\n\n    Markup,\n    MarkupArrow,\n    MarkupCallout,\n    MarkupCircle,\n    MarkupCloud,\n    MarkupDimension,\n    MarkupFreehand,\n    MarkupHighlight,\n    MarkupPen,\n    MarkupPolycloud,\n    MarkupPolyline,\n    MarkupRectangle,\n    MarkupText,\n    MarkupStamp,\n    MarkupTool,\n    \n    MarkupsCore,\n\n    SetArrow,\n    SetCallout,\n    SetCircle,\n    SetCloud,\n    SetDimension,\n    SetFreehand,\n    SetHighlight,\n    SetPolycloud,\n    SetPolyline,\n    SetPosition,\n    SetRectangle,\n    SetRotation,\n    SetSize,\n    SetStyle,\n    SetText,\n    SetStamp,\n\n\n    MarkupEvents,\n    MarkupTypes,\n    theEditModeManager,\n    Utils,\n};\n\n// Spread the markup types to minimize breaking changes (sigh)\nfor (var markupType in MarkupTypes) {\n    Core[markupType] = MarkupTypes[markupType];\n}\n\n// Spread the event ids to minimize breaking changes (sigh)\nfor (var eventType in MarkupEvents) {\n    Core[eventType] = MarkupEvents[eventType];\n}\n\n// Merge StyleUtils with utils (because those methods used to live in Utils)\nfor (var thing in StyleUtils) {\n    if (thing in Core.Utils)\n        throw new Error(`Property ${thing} from StyleUtils already present in MarkupsCoreUtils.`);\n\n    Core.Utils[thing] = StyleUtils[thing];\n}\n\n\nexport const Gui = {\n    MarkupsGui\n}\n\n\n// Also map back to legacy namespace\nAutodesk.Viewing.Extensions.Markups = {\n    Core\n};\n"],"sourceRoot":""}