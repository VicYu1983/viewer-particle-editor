{"version":3,"sources":["webpack://Autodesk.Extensions.[name]/webpack/bootstrap","webpack://Autodesk.Extensions.[name]/./extensions/OMV/ConfettiController.js","webpack://Autodesk.Extensions.[name]/./extensions/OMV/OMVPanel.js","webpack://Autodesk.Extensions.[name]/./extensions/OMV/OMVLocales.js","webpack://Autodesk.Extensions.[name]/./extensions/OMV/OMV.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ConfettiController","viewer","_controller","this","getDiameterFromFrag","fragId","vb","model","getFragmentList","getGeometry","center","getConfettiCenter","on_circle","THREE","Vector3","diameter","distanceTo","parseFloat","toFixed","setFragmentDiameter","fragProxy","impl","getFragmentProxy","getAnimTransform","scale","worldInv","Matrix4","getOriginalWorldMatrix","getInverse","confetti_center","position","x","elements","y","z","updateAnimTransform","resizeConfetti","newDiameter","instanceTree","getData","findMeasuredPoints","dbIdArray","length","enumNodeFragments","sceneUpdated","getDiameterFromGeom","gotDiameter","onGetMeasuredPoints","findInspectionPoints","options","propFilter","ignoreHidden","getBulkProperties","results","measuredPoints","filter","result","properties","propertyName","displayName","displayValue","getPropertyValue","onGetInspectionPoints","findProperty","then","TAB_ID","OMVPanel","confettiController","title","PANEL_ID","id","Autodesk","Viewing","UI","SettingsPanel","container","heightAdjustment","setGlobalManager","globalManager","classList","add","_onSetConfettiDiameter","addTab","className","selectTab","inspectionSettingsLabel","addLabel","sliderId","addSlider","confettiSizeSlider","getControl","sliderElement","step","stepperElement","createFooter","constructor","syncUI","setValue","event","new_diameter","typeOfEvent","detail","locales","en","cs","de","es","fr","it","ja","ko","pl","ru","tr","nl","sv","da","no","av","OMV","Extension","_configButtonId","_default_geom_diameter","undefined","_panel","hasUI","GuiViewer3D","openPanel","_initialiseConfetti","_initButtonConfig","load","extendLocalization","isLoadDone","addEventListener","GEOMETRY_LOADED_EVENT","once","unload","removeEventListener","viewerSettingsPanel","removeConfigButton","uninitialize","geom_diameter","setConfettiDiameter","setVisible","settingsPanel","getSettingsPanel","addConfigButton","SETTINGS_PANEL_CREATED_EVENT","theExtensionManager","registerExtension"],"mappings":"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","file":"OMV/OMV.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 855);\n","'use strict';\n\nvar surfaceInspectionProperty = 'Surface Inspection Point';\nvar measuredPointLabel = 'projected';\n\n/**\n * Controller for the confetti\n * \n * @memberof Autodesk.Viewing.Extensions.OMV\n * @alias Autodesk.Viewing.Extensions.OMV.ConfettiController\n * @constructor\n*/\nexport var ConfettiController = function (viewer) {\n\n    var _controller = this;\n    this.viewer = viewer;\n    this.diameter = null;\n\n    /**\n     * Resize the confetti to the given diameter.\n     * @param {number} newDiameter The diameter to resize the confetti to.\n    */\n    this.resizeConfetti = function (newDiameter) {\n        if (newDiameter === this.diameter) {\n            return;\n        }\n        var viewer = this.viewer;\n        var instanceTree = viewer.model.getData().instanceTree;\n        this.diameter = newDiameter;\n\n        this.findMeasuredPoints(function(dbIdArray) {\n            for (var i = 0; i < dbIdArray.length; i++) {\n                instanceTree.enumNodeFragments(dbIdArray[i], function(fragId) {\n                    setFragmentDiameter(fragId, newDiameter);\n                    // If we just resized the last confetti, update the view\n                    if (i === dbIdArray.length - 1) {\n                        // Update the scene\n                        viewer.impl.sceneUpdated(true);\n                    }\n                }, false);\n            }\n        });\n    };\n\n    /**\n     * Get the current diameter from the geometry of the confetti\n     * @param {function} gotDiameter The callback with the diameter as the argument.\n     * \n    */\n    this.getDiameterFromGeom = function(gotDiameter) {\n        var viewer = this.viewer;\n        var instanceTree = viewer.model.getData().instanceTree;\n\n        this.findMeasuredPoints(function(dbIdArray) {\n            instanceTree.enumNodeFragments(dbIdArray[0], function(fragId) {\n                var diameter = getDiameterFromFrag(fragId);\n                gotDiameter(diameter);\n            }, false);\n        });\n    };\n\n    /**\n     * Find the measured points.\n     * @param {function} onGetMeasuredPoints The callback with the measured points as an array argument.\n    */\n    this.findMeasuredPoints = function(onGetMeasuredPoints) {\n        var viewer = this.viewer;\n        this.findInspectionPoints(function(dbIdArray) {\n            var options = {propFilter: [surfaceInspectionProperty], ignoreHidden: false};\n            viewer.model.getBulkProperties(dbIdArray, options, function(results) {\n                var measuredPoints = results.filter(function(result) {\n                    var propValue = getPropertyValue(result.properties, surfaceInspectionProperty);\n                    return propValue === measuredPointLabel;\n                });\n                onGetMeasuredPoints(measuredPoints);\n            });\n        });\n    };\n\n    /**\n     * Find inspection points\n     * @param {function} onGetInspectionPoints The callback with the IDs of the inspection points.\n    */\n    this.findInspectionPoints = function(onGetInspectionPoints) {\n        this.viewer.model.findProperty(surfaceInspectionProperty).then(function(dbIdArray) {\n            onGetInspectionPoints(dbIdArray);\n        });\n    };\n\n    /**\n     * Get the diameter from the given fragment\n     * @param fragId The fragment ID of the confetti to get the diameter of.\n     * @returns {number} The diameter of the confetti\n     * @private\n    */\n    function getDiameterFromFrag(fragId) {\n        var viewer = _controller.viewer;\n\n        // Get the diameter of the geometry\n        var geometry = viewer.model.getFragmentList().getGeometry(fragId);\n        var vb = geometry.vb;\n        var center = getConfettiCenter(fragId);\n        var on_circle = new THREE.Vector3(vb[3], vb[4], vb[5]);\n        var diameter = 2 * center.distanceTo(on_circle);\n        return parseFloat(diameter.toFixed(1));\n    }\n\n    /**\n     * Get the center of the confetti\n     * @param fragId The fragment ID of the confetti to get the center of.\n     * @returns {THREE.Vector3} The center point of the confetti\n     * @private\n    */\n    function getConfettiCenter(fragId) {\n        var geometry = _controller.viewer.model.getFragmentList().getGeometry(fragId);\n        var vb = geometry.vb;\n        return new THREE.Vector3(vb[0], vb[1], vb[2]);\n    }\n\n    /**\n     * Set the diameter of the given fragment confetti. \n     * This applies a transformation to scale the geometry, so we can achieve\n     * the diameter we want.\n     * @param fragId The fragment ID of the confetti to resize to the new diameter.\n     * @param diameter THe diameter to resize the confetti to.\n     * @private\n    */\n    function setFragmentDiameter(fragId, diameter) {\n        var viewer = _controller.viewer;\n        var fragProxy = viewer.impl.getFragmentProxy(\n            viewer.model,\n            fragId\n        );\n        fragProxy.getAnimTransform();\n        \n        // Get the diameter of the geometry\n        var geom_diameter = getDiameterFromFrag(fragId);\n        // Calculate the scale we need to have in order to simulate the new diameter\n        var scale = diameter / geom_diameter;\n\n        // get inverse of world matrix\n        var worldInv = new THREE.Matrix4();\n        fragProxy.getOriginalWorldMatrix(worldInv);\n        worldInv.getInverse(worldInv);\n        var confetti_center = getConfettiCenter(fragId);\n\n        // Set the scale we need in order to achieve the diameter we want\n        fragProxy.scale = new THREE.Vector3(scale, scale, scale);\n\n        // Move the position of the fragment, so it will stay in the same place after the scaling\n        fragProxy.position.x = worldInv.elements[12] * (scale - 1) - confetti_center.x * (scale - 1);\n        fragProxy.position.y = worldInv.elements[13] * (scale - 1) - confetti_center.y * (scale - 1);\n        fragProxy.position.z = worldInv.elements[14] * (scale - 1) - confetti_center.z * (scale - 1);\n\n        fragProxy.updateAnimTransform();\n    }\n\n    /**\n     * Get the value of the property that matches the given name\n     * @param properties The array of properties to search in.\n     * * @param propertyName The name of the property we want to find the value of.\n     * @returns The value of the requested property. If it doesn't exist, return null.\n     * @private\n    */\n    function getPropertyValue(properties, propertyName){\n        for(var i = 0; i < properties.length; ++i) {\n            var property = properties[i];\n            if(property.displayName === propertyName) {\n                return property.displayValue;\n            }\n        }\n        return null;\n    }    \n};\n\n","\n'use strict';\n\n\nconst TAB_ID = 'configTab';\nconst TAB_LABEL = 'Probing';\nconst INSPECTION_POINTS_LABEL = 'Inspection Points';\nconst SLIDER_LABEL = 'Confetti diameter';\n\nconst SLIDER_MIN_VALUE = 0.5;\nconst SLIDER_MAX_VALUE = 40;\nconst SLIDER_INIT_VALUE = 1;\nconst SLIDER_STEP_VALUE = 0.1;\n\n/**\n * Panel with UI to configure the On-Machine Verification (OMV) extension.\n * \n * @memberof Autodesk.Viewing.Extensions.OMV\n * @alias Autodesk.Viewing.Extensions.OMV.OMVPanel\n * @extends {Autodesk.Viewing.UI.SettingsPanel}\n * @constructor\n*/\nexport var OMVPanel = function (viewer, confettiController, title) {\n\n    const PANEL_ID = 'adsk_omv_panel_' + viewer.id;\n    const opts = { heightAdjustment: 90 };\n    Autodesk.Viewing.UI.SettingsPanel.call(this, viewer.container, PANEL_ID, title, opts);\n    this.setGlobalManager(viewer.globalManager);\n    this.container.classList.add('viewer-settings-panel');\n\n    this.viewer = viewer;\n    this.confettiController = confettiController;\n    this._onSetConfettiDiameter = this._onSetConfettiDiameter.bind(this);\n    \n    // Add a default tab called Configuration\n    this.addTab(TAB_ID, TAB_LABEL, { className: 'config' });\n    this.selectTab(TAB_ID);\n\n    // Add the Inspection Points settings\n    this.inspectionSettingsLabel = this.addLabel(TAB_ID, INSPECTION_POINTS_LABEL);\n    // Add a slider for confetti diameter\n    this.sliderId = this.addSlider( TAB_ID, SLIDER_LABEL,\n        SLIDER_MIN_VALUE, SLIDER_MAX_VALUE, SLIDER_INIT_VALUE,\n        this._onSetConfettiDiameter\n    );\n    this.confettiSizeSlider = this.getControl(this.sliderId);\n    this.confettiSizeSlider.sliderElement.step = this.confettiSizeSlider.stepperElement.step = SLIDER_STEP_VALUE;\n\n    this.createFooter();\n};\n\n\nOMVPanel.prototype = Object.create(Autodesk.Viewing.UI.SettingsPanel.prototype);\nOMVPanel.prototype.constructor = OMVPanel;\n\n/**\n * Syncronize UI controls with confetti controller data.\n */\nOMVPanel.prototype.syncUI = function() {\n    this.confettiSizeSlider.setValue(this.confettiController.diameter);\n};\n\n/**\n * When the diameter has been changed\n * @param event The event that caused the confetti size to change. Either an object or a number.\n * @private\n */\nOMVPanel.prototype._onSetConfettiDiameter = function(event) {\n    var new_diameter = null;\n    // We can have two types of input\n    // 1. An event from the slider control\n    // 2. The actual value that the preference was changed to\n    var typeOfEvent = typeof event;\n    if (typeOfEvent === 'object' && event.detail && event.detail.value) {\n        new_diameter = parseFloat(event.detail.value);\n    } else if (typeOfEvent === 'number') {\n        new_diameter = event;\n    }\n    if (!new_diameter) {\n        return;\n    }\n\n    this.confettiController.resizeConfetti(new_diameter);\n    // No need to syncUI() when event comes from UI...\n};\n\n","/**\n * Include each locale json file and return it in an object\n * that can be consumed by i18n\n */\n\nimport json_en from '../../res/locales/en/nobundle-omv.loc.json';\nimport json_en_GB from '../../res/locales/en-GB/nobundle-omv.loc.json';\nimport json_cs from '../../res/locales/cs/nobundle-omv.loc.json';\nimport json_de from '../../res/locales/de/nobundle-omv.loc.json';\nimport json_es from '../../res/locales/es/nobundle-omv.loc.json';\nimport json_fr from '../../res/locales/fr/nobundle-omv.loc.json';\nimport json_fr_CA from '../../res/locales/fr-CA/nobundle-omv.loc.json';\nimport json_it from '../../res/locales/it/nobundle-omv.loc.json';\nimport json_ja from '../../res/locales/ja/nobundle-omv.loc.json';\nimport json_ko from '../../res/locales/ko/nobundle-omv.loc.json';\nimport json_pl from '../../res/locales/pl/nobundle-omv.loc.json';\nimport json_pt_BR from '../../res/locales/pt-BR/nobundle-omv.loc.json';\nimport json_ru from '../../res/locales/ru/nobundle-omv.loc.json';\nimport json_tr from '../../res/locales/tr/nobundle-omv.loc.json';\nimport json_zh_HANS from '../../res/locales/zh-HANS/nobundle-omv.loc.json';\nimport json_zh_HANT from '../../res/locales/zh-HANT/nobundle-omv.loc.json';\nimport json_zh_HK from '../../res/locales/zh-HK/nobundle-omv.loc.json';\nimport json_nl from '../../res/locales/nl/nobundle-omv.loc.json';\nimport json_sv from '../../res/locales/sv/nobundle-omv.loc.json';\nimport json_da from '../../res/locales/da/nobundle-omv.loc.json';\nimport json_no from '../../res/locales/no/nobundle-omv.loc.json';\n\nexport const locales = {\n    en: json_en,\n    \"en-GB\": json_en_GB,\n    cs: json_cs,\n    de: json_de,\n    es: json_es,\n    fr: json_fr,\n    \"fr-CA\": json_fr_CA,\n    it: json_it,\n    ja: json_ja,\n    ko: json_ko,\n    pl: json_pl,\n    \"pt-BR\": json_pt_BR,\n    ru: json_ru,\n    tr: json_tr,\n    \"zh-HANS\": json_zh_HANS,\n    \"zh-HANT\": json_zh_HANT,\n    \"zh-HK\": json_zh_HK,\n    nl: json_nl,\n    sv: json_sv,\n    da: json_da,\n    no: json_no,\n};\n\n","import { ConfettiController } from './ConfettiController';\nimport { OMVPanel } from './OMVPanel';\nimport { locales } from './OMVLocales';\n\nconst SETTINGS_BUTTON_LABEL = 'On-Machine Verification';\nconst av = Autodesk.Viewing;\n\n'use strict';\n\n/**\n * Provides UI controls for OMV settings\n * \n * The extension id is: `Autodesk.OMV`\n * \n * @example\n *   viewer.loadExtension('Autodesk.OMV')\n * \n * @memberof Autodesk.Viewing.Extensions.OMV\n * @alias Autodesk.Viewing.Extensions.OMV.OMV\n * @see {@link Autodesk.Viewing.Extension} for common inherited methods.\n * @constructor\n*/\nexport function OMV(viewer, options) {\n\n    Autodesk.Viewing.Extension.call(this, viewer, options);\n    this._configButtonId = null;\n    this._default_geom_diameter = undefined;\n    this._panel = null;\n    this.confettiController = null;\n    this.hasUI = Autodesk.Viewing.GuiViewer3D && viewer instanceof Autodesk.Viewing.GuiViewer3D;\n    this.openPanel = this.openPanel.bind(this);\n    this._initialiseConfetti = this._initialiseConfetti.bind(this);\n    this._initButtonConfig = this._initButtonConfig.bind(this);\n}\n\nOMV.prototype = Object.create(Autodesk.Viewing.Extension.prototype);\nOMV.prototype.constructor = OMV;\n\n/**\n * Load the OMV extension.\n * It will fail to load when running a headless viewer.\n */\nOMV.prototype.load = function () {\n    // Don't do anything if there is no UI\n    if (!this.hasUI) {\n        return false;\n    }\n\n    this.extendLocalization(locales);\n\n    if (this.viewer.model && this.viewer.model.isLoadDone()) {\n        this._initialiseConfetti();\n    } else {\n        // Add an one time listener for the geometry loaded event\n        this.viewer.addEventListener(\n            Autodesk.Viewing.GEOMETRY_LOADED_EVENT, \n            this._initialiseConfetti, \n            { once: true }\n        );\n    }\n\n    return true;\n};\n\n/**\n * Unload the OMV extension.\n*/\nOMV.prototype.unload = function () {\n\n    // Remove the listener in case we unload the extension before the geometry has been loaded\n    this.viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT, this._initialiseConfetti);\n    \n    if (this._configButtonId !== null) {\n        this.viewer.viewerSettingsPanel.removeConfigButton(this._configButtonId);\n        this._configButtonId = null;   \n    }\n\n    if (this._panel) {\n        this._panel.uninitialize();\n        this._panel = null;\n    }\n\n    this.confettiController = null;\n    return true;\n};\n\n/**\n * @private\n */\nOMV.prototype._initialiseConfetti = function() {\n\n    this.confettiController = new ConfettiController(this.viewer);\n\n    // Get the initial diameter from the geometry of the confetti\n    this.confettiController.getDiameterFromGeom((geom_diameter) => {\n        \n        // Abort if the extension got unloaded before it fully initialized the UI.\n        if (!this.viewer)\n            return;\n\n        this._default_geom_diameter = geom_diameter;\n        this.setConfettiDiameter(geom_diameter);\n        this._initButtonConfig();\n    });\n\n    \n};\n\n/**\n * Change the confetti diameter.\n * @param {number} [diameter] - Confetti diameter. Use `undefined` to set model's default value.\n * @returns {boolean} true is the confetti value has changed.\n */\nOMV.prototype.setConfettiDiameter = function(diameter) {\n\n    // When no diameter is passed, use the default one from the model.\n    if (diameter === undefined) {\n        diameter = this._default_geom_diameter;\n    }\n\n    if (diameter === undefined) {\n        // Model has no default confeti diamter specified, abort.\n        return false;\n    }\n\n    this.confettiController.resizeConfetti(diameter);\n    this._panel && this._panel.syncUI();\n    return true;\n};\n\n\n/**\n * Opens the OMV configuration panel.\n */\nOMV.prototype.openPanel = function() {\n    if (!this._panel) {\n        this._panel = new OMVPanel(this.viewer, this.confettiController, SETTINGS_BUTTON_LABEL);\n    }\n    this._panel.setVisible(true);\n};\n\n/**\n * Adds a button to the Settings Panel.\n * @private\n */\nOMV.prototype._initButtonConfig = function() {\n    \n    var settingsPanel = this.viewer.getSettingsPanel();\n    if (!settingsPanel) {\n        this.addEventListener(av.SETTINGS_PANEL_CREATED_EVENT, this._initButtonConfig, {once: true});\n        return;\n    }\n\n    this._configButtonId = settingsPanel.addConfigButton(SETTINGS_BUTTON_LABEL, this.openPanel);\n};\n\nAutodesk.Viewing.theExtensionManager.registerExtension('Autodesk.OMV', OMV);\n\n"],"sourceRoot":""}